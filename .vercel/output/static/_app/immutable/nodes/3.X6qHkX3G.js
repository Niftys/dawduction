const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/Ue2r4fdp.js","../chunks/BJF9mgOB.js","../chunks/C-KikI3b.js"])))=>i.map(i=>d[i]);
import{_ as pl}from"../chunks/C1FmrZbK.js";import{S as ut,i as dt,s as rt,n as We,d as D,N as Le,o as k,b as W,c as C,m as X,e as y,f as A,g as fe,h as R,j as M,t as ce,k as z,l as mt,A as Ut,O as Tt,I as Ct,P as Ge,q as re,p as pt,r as gt,H as x,a as Me,Q as Xe,u as Z,v as K,w as Ue,x as He,y as Ee,R as lt,T as ze,U as Ae,D as me,F as pe,G as ge,E as ve,V as je,W as gl,X as fl,Y as cl,Z as tn}from"../chunks/C-KikI3b.js";import{e as we,a as ul,P as Ve,p as dl,b as Rt,T as vl,c as bl,v as kl}from"../chunks/KHC7JF7e.js";import"../chunks/IHki7fMi.js";import{projectStore as Q}from"../chunks/CpFYu2kg.js";import{loadingStore as Tl}from"../chunks/Ue2r4fdp.js";import{p as en}from"../chunks/DZoq5sg5.js";import{g as nn}from"../chunks/6De2MNrw.js";function Ne(t,e){const n={},l={},r={$$scope:1};let o=t.length;for(;o--;){const a=t[o],s=e[o];if(s){for(const f in a)f in s||(l[f]=1);for(const f in s)r[f]||(n[f]=s[f],r[f]=1);t[o]=s}else for(const f in a)r[f]=1}for(const a in l)a in n||(n[a]=void 0);return n}function Oe(t){return typeof t=="object"&&t!==null?t:{}}function ln(t,e,n){const l=t.slice();return l[51]=e[n],l}function rn(t,e,n){const l=t.slice();return l[48]=e[n],l}function an(t,e,n){const l=t.slice();return l[45]=e[n],l}function on(t,e,n){const l=t.slice();return l[48]=e[n],l}function Cl(t){let e,n,l,r,o="+ Create Envelope",a,s,f,u,_,h,p,b,d,T,g=t[7]&&sn(t),i=we(t[8]),c=[];for(let v=0;v<i.length;v+=1)c[v]=cn(ln(t,i,v));let m=t[8].length===0&&un();return{c(){e=M("div"),n=M("div"),l=M("button"),r=M("span"),r.textContent=o,a=z(),s=gt("svg"),f=gt("path"),_=z(),g&&g.c(),h=z(),p=M("div");for(let v=0;v<c.length;v+=1)c[v].c();b=z(),m&&m.c(),this.h()},l(v){e=y(v,"DIV",{class:!0});var w=A(e);n=y(w,"DIV",{class:!0});var E=A(n);l=y(E,"BUTTON",{class:!0,title:!0});var I=A(l);r=y(I,"SPAN",{"data-svelte-h":!0}),re(r)!=="svelte-14u6rfp"&&(r.textContent=o),a=R(I),s=pt(I,"svg",{class:!0,width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0});var V=A(s);f=pt(V,"path",{d:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),A(f).forEach(D),V.forEach(D),I.forEach(D),_=R(E),g&&g.l(E),E.forEach(D),h=R(w),p=y(w,"DIV",{class:!0});var N=A(p);for(let H=0;H<c.length;H+=1)c[H].l(N);b=R(N),m&&m.l(N),N.forEach(D),w.forEach(D),this.h()},h(){k(f,"d","M3 4.5L6 7.5L9 4.5"),k(f,"stroke","currentColor"),k(f,"stroke-width","1.5"),k(f,"stroke-linecap","round"),k(f,"stroke-linejoin","round"),k(s,"class",u="dropdown-arrow "+(t[7]?"open":"")),k(s,"width","12"),k(s,"height","12"),k(s,"viewBox","0 0 12 12"),k(s,"fill","none"),k(s,"xmlns","http://www.w3.org/2000/svg"),k(l,"class","create-dropdown-trigger"),k(l,"title","Create new envelope"),k(n,"class","create-dropdown-wrapper"),k(p,"class","items-list"),k(e,"class","envelopes-section")},m(v,w){W(v,e,w),C(e,n),C(n,l),C(l,r),C(l,a),C(l,s),C(s,f),C(n,_),g&&g.m(n,null),C(e,h),C(e,p);for(let E=0;E<c.length;E+=1)c[E]&&c[E].m(p,null);C(p,b),m&&m.m(p,null),d||(T=X(l,"click",t[31]),d=!0)},p(v,w){if(w[0]&128&&u!==(u="dropdown-arrow "+(v[7]?"open":""))&&k(s,"class",u),v[7]?g?g.p(v,w):(g=sn(v),g.c(),g.m(n,null)):g&&(g.d(1),g=null),w[0]&8469){i=we(v[8]);let E;for(E=0;E<i.length;E+=1){const I=ln(v,i,E);c[E]?c[E].p(I,w):(c[E]=cn(I),c[E].c(),c[E].m(p,b))}for(;E<c.length;E+=1)c[E].d(1);c.length=i.length}v[8].length===0?m||(m=un(),m.c(),m.m(p,null)):m&&(m.d(1),m=null)},d(v){v&&D(e),g&&g.d(),Ge(c,v),m&&m.d(),d=!1,T()}}}function El(t){let e,n,l,r,o="+ Create Effect",a,s,f,u,_,h,p,b,d,T,g=t[6]&&dn(t),i=we(t[9]),c=[];for(let v=0;v<i.length;v+=1)c[v]=_n(an(t,i,v));let m=t[9].length===0&&mn();return{c(){e=M("div"),n=M("div"),l=M("button"),r=M("span"),r.textContent=o,a=z(),s=gt("svg"),f=gt("path"),_=z(),g&&g.c(),h=z(),p=M("div");for(let v=0;v<c.length;v+=1)c[v].c();b=z(),m&&m.c(),this.h()},l(v){e=y(v,"DIV",{class:!0});var w=A(e);n=y(w,"DIV",{class:!0});var E=A(n);l=y(E,"BUTTON",{class:!0,title:!0});var I=A(l);r=y(I,"SPAN",{"data-svelte-h":!0}),re(r)!=="svelte-po4y4q"&&(r.textContent=o),a=R(I),s=pt(I,"svg",{class:!0,width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0});var V=A(s);f=pt(V,"path",{d:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),A(f).forEach(D),V.forEach(D),I.forEach(D),_=R(E),g&&g.l(E),E.forEach(D),h=R(w),p=y(w,"DIV",{class:!0});var N=A(p);for(let H=0;H<c.length;H+=1)c[H].l(N);b=R(N),m&&m.l(N),N.forEach(D),w.forEach(D),this.h()},h(){k(f,"d","M3 4.5L6 7.5L9 4.5"),k(f,"stroke","currentColor"),k(f,"stroke-width","1.5"),k(f,"stroke-linecap","round"),k(f,"stroke-linejoin","round"),k(s,"class",u="dropdown-arrow "+(t[6]?"open":"")),k(s,"width","12"),k(s,"height","12"),k(s,"viewBox","0 0 12 12"),k(s,"fill","none"),k(s,"xmlns","http://www.w3.org/2000/svg"),k(l,"class","create-dropdown-trigger"),k(l,"title","Create new effect"),k(n,"class","create-dropdown-wrapper"),k(p,"class","items-list"),k(e,"class","effects-section")},m(v,w){W(v,e,w),C(e,n),C(n,l),C(l,r),C(l,a),C(l,s),C(s,f),C(n,_),g&&g.m(n,null),C(e,h),C(e,p);for(let E=0;E<c.length;E+=1)c[E]&&c[E].m(p,null);C(p,b),m&&m.m(p,null),d||(T=X(l,"click",t[22]),d=!0)},p(v,w){if(w[0]&64&&u!==(u="dropdown-arrow "+(v[6]?"open":""))&&k(s,"class",u),v[6]?g?g.p(v,w):(g=dn(v),g.c(),g.m(n,null)):g&&(g.d(1),g=null),w[0]&4619){i=we(v[9]);let E;for(E=0;E<i.length;E+=1){const I=an(v,i,E);c[E]?c[E].p(I,w):(c[E]=_n(I),c[E].c(),c[E].m(p,b))}for(;E<c.length;E+=1)c[E].d(1);c.length=i.length}v[9].length===0?m||(m=mn(),m.c(),m.m(p,null)):m&&(m.d(1),m=null)},d(v){v&&D(e),g&&g.d(),Ge(c,v),m&&m.d(),d=!1,T()}}}function sn(t){let e,n=we(t[11]),l=[];for(let r=0;r<n.length;r+=1)l[r]=fn(rn(t,n,r));return{c(){e=M("div");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=y(r,"DIV",{class:!0});var o=A(e);for(let a=0;a<l.length;a+=1)l[a].l(o);o.forEach(D),this.h()},h(){k(e,"class","create-dropdown-menu")},m(r,o){W(r,e,o);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(r,o){if(o[0]&34816){n=we(r[11]);let a;for(a=0;a<n.length;a+=1){const s=rn(r,n,a);l[a]?l[a].p(s,o):(l[a]=fn(s),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}},d(r){r&&D(e),Ge(l,r)}}}function fn(t){let e,n=t[48].label+"",l,r,o,a;function s(){return t[32](t[48])}return{c(){e=M("button"),l=ce(n),r=z(),this.h()},l(f){e=y(f,"BUTTON",{class:!0,title:!0});var u=A(e);l=fe(u,n),r=R(u),u.forEach(D),this.h()},h(){k(e,"class","dropdown-menu-item"),k(e,"title","Create "+t[48].label)},m(f,u){W(f,e,u),C(e,l),C(e,r),o||(a=X(e,"click",s),o=!0)},p(f,u){t=f},d(f){f&&D(e),o=!1,a()}}}function wl(t){let e,n=t[51].name+"",l,r,o;function a(){return t[36](t[51])}function s(...f){return t[37](t[51],...f)}return{c(){e=M("span"),l=ce(n),this.h()},l(f){e=y(f,"SPAN",{class:!0,role:!0,tabindex:!0,"aria-label":!0,title:!0});var u=A(e);l=fe(u,n),u.forEach(D),this.h()},h(){k(e,"class","item-name"),k(e,"role","button"),k(e,"tabindex","0"),k(e,"aria-label","Double-click to rename envelope"),k(e,"title","Double-click to rename")},m(f,u){W(f,e,u),C(e,l),r||(o=[X(e,"dblclick",Xe(a)),X(e,"keydown",s)],r=!0)},p(f,u){t=f,u[0]&256&&n!==(n=t[51].name+"")&&Me(l,n)},d(f){f&&D(e),r=!1,Le(o)}}}function Dl(t){let e,n,l,r;function o(...a){return t[34](t[51],...a)}return{c(){e=M("input"),this.h()},l(a){e=y(a,"INPUT",{type:!0,class:!0}),this.h()},h(){k(e,"type","text"),k(e,"class","item-name-input"),e.value=n=t[51].name},m(a,s){W(a,e,s),t[33](e),l||(r=[X(e,"blur",o),X(e,"keydown",t[35]),X(e,"click",Xe(t[19]))],l=!0)},p(a,s){t=a,s[0]&256&&n!==(n=t[51].name)&&e.value!==n&&(e.value=n)},d(a){a&&D(e),t[33](null),l=!1,Le(r)}}}function cn(t){let e,n,l,r,o,a=t[51].type+"",s,f,u,_="×",h,p,b,d;function T(v,w){return v[2]===v[51].id?Dl:wl}let g=T(t),i=g(t);function c(){return t[38](t[51])}function m(...v){return t[39](t[51],...v)}return{c(){e=M("button"),n=M("div"),l=z(),i.c(),r=z(),o=M("span"),s=ce(a),f=z(),u=M("button"),u.textContent=_,this.h()},l(v){e=y(v,"BUTTON",{class:!0,draggable:!0});var w=A(e);n=y(w,"DIV",{class:!0,style:!0}),A(n).forEach(D),l=R(w),i.l(w),r=R(w),o=y(w,"SPAN",{class:!0});var E=A(o);s=fe(E,a),E.forEach(D),f=R(w),u=y(w,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),re(u)!=="svelte-1pcn55q"&&(u.textContent=_),w.forEach(D),this.h()},h(){k(n,"class","item-color"),x(n,"background",t[51].color),k(o,"class","item-type"),k(u,"class","item-delete"),k(u,"title","Delete envelope"),k(e,"class",h="item "+t[51].type),k(e,"draggable",p=t[2]!==t[51].id)},m(v,w){W(v,e,w),C(e,n),C(e,l),i.m(e,null),C(e,r),C(e,o),C(o,s),C(e,f),C(e,u),b||(d=[X(u,"click",Xe(c)),X(e,"dragstart",m)],b=!0)},p(v,w){t=v,w[0]&256&&x(n,"background",t[51].color),g===(g=T(t))&&i?i.p(t,w):(i.d(1),i=g(t),i&&(i.c(),i.m(e,r))),w[0]&256&&a!==(a=t[51].type+"")&&Me(s,a),w[0]&256&&h!==(h="item "+t[51].type)&&k(e,"class",h),w[0]&260&&p!==(p=t[2]!==t[51].id)&&k(e,"draggable",p)},d(v){v&&D(e),i.d(),b=!1,Le(d)}}}function un(t){let e,n="No envelopes yet. Create one above!";return{c(){e=M("div"),e.textContent=n,this.h()},l(l){e=y(l,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-h7n36y"&&(e.textContent=n),this.h()},h(){k(e,"class","empty-state")},m(l,r){W(l,e,r)},d(l){l&&D(e)}}}function dn(t){let e,n=we(t[10]),l=[];for(let r=0;r<n.length;r+=1)l[r]=hn(on(t,n,r));return{c(){e=M("div");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=y(r,"DIV",{class:!0});var o=A(e);for(let a=0;a<l.length;a+=1)l[a].l(o);o.forEach(D),this.h()},h(){k(e,"class","create-dropdown-menu")},m(r,o){W(r,e,o);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(r,o){if(o[0]&17408){n=we(r[10]);let a;for(a=0;a<n.length;a+=1){const s=on(r,n,a);l[a]?l[a].p(s,o):(l[a]=hn(s),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}},d(r){r&&D(e),Ge(l,r)}}}function hn(t){let e,n=t[48].label+"",l,r,o,a;function s(){return t[23](t[48])}return{c(){e=M("button"),l=ce(n),r=z(),this.h()},l(f){e=y(f,"BUTTON",{class:!0,title:!0});var u=A(e);l=fe(u,n),r=R(u),u.forEach(D),this.h()},h(){k(e,"class","dropdown-menu-item"),k(e,"title","Create "+t[48].label)},m(f,u){W(f,e,u),C(e,l),C(e,r),o||(a=X(e,"click",s),o=!0)},p(f,u){t=f},d(f){f&&D(e),o=!1,a()}}}function Il(t){let e,n=t[45].name+"",l,r,o;function a(){return t[27](t[45])}function s(...f){return t[28](t[45],...f)}return{c(){e=M("span"),l=ce(n),this.h()},l(f){e=y(f,"SPAN",{class:!0,role:!0,tabindex:!0,"aria-label":!0,title:!0});var u=A(e);l=fe(u,n),u.forEach(D),this.h()},h(){k(e,"class","item-name"),k(e,"role","button"),k(e,"tabindex","0"),k(e,"aria-label","Double-click to rename effect"),k(e,"title","Double-click to rename")},m(f,u){W(f,e,u),C(e,l),r||(o=[X(e,"dblclick",Xe(a)),X(e,"keydown",s)],r=!0)},p(f,u){t=f,u[0]&512&&n!==(n=t[45].name+"")&&Me(l,n)},d(f){f&&D(e),r=!1,Le(o)}}}function Pl(t){let e,n,l,r;function o(...a){return t[25](t[45],...a)}return{c(){e=M("input"),this.h()},l(a){e=y(a,"INPUT",{type:!0,class:!0}),this.h()},h(){k(e,"type","text"),k(e,"class","item-name-input"),e.value=n=t[45].name},m(a,s){W(a,e,s),t[24](e),l||(r=[X(e,"blur",o),X(e,"keydown",t[26]),X(e,"click",Xe(t[18]))],l=!0)},p(a,s){t=a,s[0]&512&&n!==(n=t[45].name)&&e.value!==n&&(e.value=n)},d(a){a&&D(e),t[24](null),l=!1,Le(r)}}}function _n(t){let e,n,l,r,o,a=t[45].type+"",s,f,u,_="×",h,p,b,d;function T(v,w){return v[1]===v[45].id?Pl:Il}let g=T(t),i=g(t);function c(){return t[29](t[45])}function m(...v){return t[30](t[45],...v)}return{c(){e=M("button"),n=M("div"),l=z(),i.c(),r=z(),o=M("span"),s=ce(a),f=z(),u=M("button"),u.textContent=_,this.h()},l(v){e=y(v,"BUTTON",{class:!0,draggable:!0});var w=A(e);n=y(w,"DIV",{class:!0,style:!0}),A(n).forEach(D),l=R(w),i.l(w),r=R(w),o=y(w,"SPAN",{class:!0});var E=A(o);s=fe(E,a),E.forEach(D),f=R(w),u=y(w,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),re(u)!=="svelte-cfhv99"&&(u.textContent=_),w.forEach(D),this.h()},h(){k(n,"class","item-color"),x(n,"background",t[45].color),k(o,"class","item-type"),k(u,"class","item-delete"),k(u,"title","Delete effect"),k(e,"class",h="item "+t[45].type),k(e,"draggable",p=t[1]!==t[45].id)},m(v,w){W(v,e,w),C(e,n),C(e,l),i.m(e,null),C(e,r),C(e,o),C(o,s),C(e,f),C(e,u),b||(d=[X(u,"click",Xe(c)),X(e,"dragstart",m)],b=!0)},p(v,w){t=v,w[0]&512&&x(n,"background",t[45].color),g===(g=T(t))&&i?i.p(t,w):(i.d(1),i=g(t),i&&(i.c(),i.m(e,r))),w[0]&512&&a!==(a=t[45].type+"")&&Me(s,a),w[0]&512&&h!==(h="item "+t[45].type)&&k(e,"class",h),w[0]&514&&p!==(p=t[1]!==t[45].id)&&k(e,"draggable",p)},d(v){v&&D(e),i.d(),b=!1,Le(d)}}}function mn(t){let e,n="No effects yet. Create one above!";return{c(){e=M("div"),e.textContent=n,this.h()},l(l){e=y(l,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-1funn0j"&&(e.textContent=n),this.h()},h(){k(e,"class","empty-state")},m(l,r){W(l,e,r)},d(l){l&&D(e)}}}function yl(t){let e,n,l,r,o,a,s,f,u,_,h,p,b;function d(i,c){return i[5]==="effects"?El:Cl}let T=d(t),g=T(t);return{c(){e=M("div"),n=M("div"),l=M("button"),r=ce("Effects"),a=z(),s=M("button"),f=ce("Envelopes"),_=z(),h=M("div"),g.c(),this.h()},l(i){e=y(i,"DIV",{class:!0});var c=A(e);n=y(c,"DIV",{class:!0});var m=A(n);l=y(m,"BUTTON",{class:!0});var v=A(l);r=fe(v,"Effects"),v.forEach(D),a=R(m),s=y(m,"BUTTON",{class:!0});var w=A(s);f=fe(w,"Envelopes"),w.forEach(D),m.forEach(D),_=R(c),h=y(c,"DIV",{class:!0});var E=A(h);g.l(E),E.forEach(D),c.forEach(D),this.h()},h(){k(l,"class",o="tab "+(t[5]==="effects"?"active":"")),k(s,"class",u="tab "+(t[5]==="envelopes"?"active":"")),k(n,"class","panel-tabs"),k(h,"class","panel-content"),k(e,"class","effects-envelopes-panel")},m(i,c){W(i,e,c),C(e,n),C(n,l),C(l,r),C(n,a),C(n,s),C(s,f),C(e,_),C(e,h),g.m(h,null),p||(b=[X(l,"click",t[20]),X(s,"click",t[21])],p=!0)},p(i,c){c[0]&32&&o!==(o="tab "+(i[5]==="effects"?"active":""))&&k(l,"class",o),c[0]&32&&u!==(u="tab "+(i[5]==="envelopes"?"active":""))&&k(s,"class",u),T===(T=d(i))&&g?g.p(i,c):(g.d(1),g=T(i),g&&(g.c(),g.m(h,null)))},i:We,o:We,d(i){i&&D(e),g.d(),p=!1,Le(b)}}}function Ml(t,e,n){let l,r,o,a;mt(t,en,Y=>n(17,a=Y));let s;Q.subscribe(Y=>n(16,s=Y));let f="effects",u=null,_=null,h=null,p=null,b=!1,d=!1;const T=[{value:"reverb",label:"Reverb"},{value:"delay",label:"Delay"},{value:"filter",label:"Filter"},{value:"distortion",label:"Distortion"},{value:"compressor",label:"Compressor"},{value:"chorus",label:"Chorus"}],g=[{value:"volume",label:"Volume"},{value:"filter",label:"Filter"},{value:"pitch",label:"Pitch"},{value:"pan",label:"Pan"}];function i(Y){if(!s||!o){console.error("Cannot create effect: project or projectId missing",{project:s,projectId:o});return}try{const he=l.filter(Fe=>Fe.type===Y).length,ye=Q.createEffect(o,`${Y.charAt(0).toUpperCase()+Y.slice(1)} ${he+1}`,Y);Q.addEffect(ye)}catch(he){console.error("Error creating effect:",he)}}function c(Y){if(!s||!o){console.error("Cannot create envelope: project or projectId missing",{project:s,projectId:o});return}try{const he=r.filter(Fe=>Fe.type===Y).length,ye=Q.createEnvelope(o,`${Y.charAt(0).toUpperCase()+Y.slice(1)} ${he+1}`,Y);Q.addEnvelope(ye)}catch(he){console.error("Error creating envelope:",he)}}function m(Y){Q.deleteEffect(Y)}function v(Y){Q.deleteEnvelope(Y)}function w(Y){i(Y),n(6,b=!1)}function E(Y){c(Y),n(7,d=!1)}function I(){n(6,b=!1),n(7,d=!1)}function V(Y){if(!b&&!d)return;Y.target.closest(".create-dropdown-wrapper")||I()}Ut(()=>(document.addEventListener("click",V,!0),()=>{document.removeEventListener("click",V,!0)}));let{onDragStart:N=void 0}=e;function H(Y){Tt.call(this,t,Y)}function G(Y){Tt.call(this,t,Y)}const j=()=>n(5,f="effects"),le=()=>n(5,f="envelopes"),$=()=>{n(6,b=!b),n(7,d=!1)},ue=Y=>w(Y.value);function P(Y){Ct[Y?"unshift":"push"](()=>{h=Y,n(3,h)})}const L=(Y,he)=>{const ye=he.currentTarget.value.trim()||Y.name;Q.updateEffect(Y.id,{name:ye}),n(1,u=null)},ae=Y=>{Y.key==="Enter"?Y.currentTarget.blur():Y.key==="Escape"&&n(1,u=null)},q=Y=>n(1,u=Y.id),J=(Y,he)=>{(he.key==="Enter"||he.key===" ")&&(he.preventDefault(),n(1,u=Y.id))},ie=Y=>m(Y.id),de=(Y,he)=>{if(u!==Y.id){const ye={type:"effect",id:Y.id};he.dataTransfer&&(he.dataTransfer.effectAllowed="copy",he.dataTransfer.setData("text/plain",Y.id),he.dataTransfer.setData("application/json",JSON.stringify(ye))),N&&N(he,ye)}},be=()=>{n(7,d=!d),n(6,b=!1)},ne=Y=>E(Y.value);function oe(Y){Ct[Y?"unshift":"push"](()=>{p=Y,n(4,p)})}const Ce=(Y,he)=>{const ye=he.currentTarget.value.trim()||Y.name;Q.updateEnvelope(Y.id,{name:ye}),n(2,_=null)},De=Y=>{Y.key==="Enter"?Y.currentTarget.blur():Y.key==="Escape"&&n(2,_=null)},Te=Y=>n(2,_=Y.id),Pe=(Y,he)=>{(he.key==="Enter"||he.key===" ")&&(he.preventDefault(),n(2,_=Y.id))},Ye=Y=>v(Y.id),xe=(Y,he)=>{if(_!==Y.id){const ye={type:"envelope",id:Y.id};he.dataTransfer&&(he.dataTransfer.effectAllowed="copy",he.dataTransfer.setData("text/plain",Y.id),he.dataTransfer.setData("application/json",JSON.stringify(ye))),N&&N(he,ye)}};return t.$$set=Y=>{"onDragStart"in Y&&n(0,N=Y.onDragStart)},t.$$.update=()=>{t.$$.dirty[0]&10&&u&&h&&setTimeout(()=>h==null?void 0:h.focus(),0),t.$$.dirty[0]&20&&_&&p&&setTimeout(()=>p==null?void 0:p.focus(),0),t.$$.dirty[0]&65536&&n(9,l=(s==null?void 0:s.effects)||[]),t.$$.dirty[0]&65536&&n(8,r=(s==null?void 0:s.envelopes)||[]),t.$$.dirty[0]&131072&&(o=a.params.id)},[N,u,_,h,p,f,b,d,r,l,T,g,m,v,w,E,s,a,H,G,j,le,$,ue,P,L,ae,q,J,ie,de,be,ne,oe,Ce,De,Te,Pe,Ye,xe]}class Sl extends ut{constructor(e){super(),dt(this,e,Ml,yl,rt,{onDragStart:0},null,[-1,-1])}}function Wt(t,e,n,l){if(!t||t.length===0)return(n+l)/2;const r=[...t].sort((o,a)=>o.beat-a.beat);if(e<=r[0].beat)return r[0].value;if(e>=r[r.length-1].beat)return r[r.length-1].value;for(let o=0;o<r.length-1;o++){const a=r[o],s=r[o+1];if(e>=a.beat&&e<=s.beat){const f=(e-a.beat)/(s.beat-a.beat);return a.value+(s.value-a.value)*f}}return r[0].value}function Bl(t,e,n,l,r){if(!n||!n.points||n.points.length===0)return"";const{points:o,min:a,max:s}=n,f=l+r,u=o.filter(w=>w.beat>=l&&w.beat<=f);if(u.length===0)return"";[...u].sort((w,E)=>w.beat-E.beat);const _=Math.max(20,Math.floor(t/2)),h=[];for(let w=0;w<=_;w++){const E=w/_,I=l+E*r,N=(Wt(o,I,a,s)-a)/(s-a),H=E*t,G=e*(1-N);h.push([H,G])}const p=Wt(o,l,a,s),b=Wt(o,f,a,s),d=(p-a)/(s-a),T=(b-a)/(s-a),g=e*(1-d),i=e*(1-T),c=Math.max(0,Math.min(e,g)),m=Math.max(0,Math.min(e,i));let v=`M 0 ${e}`;v+=` L 0 ${c}`;for(const[w,E]of h){const I=Math.max(0,Math.min(e,E));v+=` L ${w} ${I}`}return v+=` L ${t} ${m}`,v+=` L ${t} ${e} Z`,v}function Al(t){const e=t.slice(),n=e[6]("rate",e[0].settings.rate??.5,0,1,e[4]);e[78]=n;const l=e[6]("depth",e[0].settings.depth??.3,0,1,e[4]);e[79]=l;const r=e[6]("delay",e[0].settings.delay??.02,0,.1,e[4]);return e[80]=r,e}function Vl(t){const e=t.slice(),n=e[6]("threshold",e[0].settings.threshold??.7,0,1,e[4]);e[74]=n;const l=e[6]("ratio",e[0].settings.ratio??4,1,20,e[4]);e[75]=l;const r=e[6]("attack",e[0].settings.attack??.01,0,1,e[4]);e[76]=r;const o=e[6]("release",e[0].settings.release??.1,0,1,e[4]);return e[77]=o,e}function Nl(t){const e=t.slice(),n=e[6]("amount",e[0].settings.amount??.3,0,1,e[4]);e[72]=n;const l=e[6]("drive",e[0].settings.drive??.5,0,1,e[4]);return e[73]=l,e}function Ol(t){const e=t.slice(),n=e[6]("frequency",e[0].settings.frequency??.5,0,1,e[4]);e[70]=n;const l=e[6]("resonance",e[0].settings.resonance??.5,0,1,e[4]);return e[71]=l,e}function Ll(t){const e=t.slice(),n=e[6]("time",e[0].settings.time??.25,0,2,e[4]);e[66]=n;const l=e[6]("feedback",e[0].settings.feedback??.3,0,1,e[4]);e[67]=l;const r=e[6]("wet",e[0].settings.wet??.3,0,1,e[4]);e[68]=r;const o=e[6]("dry",e[0].settings.dry??.7,0,1,e[4]);return e[69]=o,e}function Rl(t){const e=t.slice(),n=e[6]("roomSize",e[0].settings.roomSize??.5,0,1,e[4]);e[62]=n;const l=e[6]("dampening",e[0].settings.dampening??.5,0,1,e[4]);e[63]=l;const r=e[6]("wet",e[0].settings.wet??.3,0,1,e[4]);e[64]=r;const o=e[6]("dry",e[0].settings.dry??.7,0,1,e[4]);return e[65]=o,e}function pn(t,e,n){const l=t.slice();return l[81]=e[n],l}function gn(t,e,n){const l=t.slice();return l[81]=e[n],l}function vn(t){var E,I,V,N;let e,n,l,r=(((E=t[0])==null?void 0:E.name)||((I=t[3])==null?void 0:I.name))+"",o,a,s,f=(((V=t[0])==null?void 0:V.type)||((N=t[3])==null?void 0:N.type))+"",u,_,h,p,b,d,T,g,i=t[1]&&bn(t),c=t[2]&&Tn(t);const m=[Wl,zl],v=[];function w(H,G){return H[0]?0:H[3]?1:-1}return~(d=w(t))&&(T=v[d]=m[d](t)),{c(){e=M("div"),n=M("div"),l=M("h3"),o=ce(r),a=z(),s=M("span"),u=ce(f),_=z(),h=M("div"),i&&i.c(),p=z(),c&&c.c(),b=z(),T&&T.c(),this.h()},l(H){e=y(H,"DIV",{class:!0});var G=A(e);n=y(G,"DIV",{class:!0});var j=A(n);l=y(j,"H3",{});var le=A(l);o=fe(le,r),le.forEach(D),a=R(j),s=y(j,"SPAN",{class:!0});var $=A(s);u=fe($,f),$.forEach(D),j.forEach(D),_=R(G),h=y(G,"DIV",{class:!0});var ue=A(h);i&&i.l(ue),p=R(ue),c&&c.l(ue),b=R(ue),T&&T.l(ue),ue.forEach(D),G.forEach(D),this.h()},h(){k(s,"class","properties-type"),k(n,"class","properties-header"),k(h,"class","properties-content"),k(e,"class","effect-envelope-properties")},m(H,G){W(H,e,G),C(e,n),C(n,l),C(l,o),C(n,a),C(n,s),C(s,u),C(e,_),C(e,h),i&&i.m(h,null),C(h,p),c&&c.m(h,null),C(h,b),~d&&v[d].m(h,null),g=!0},p(H,G){var le,$,ue,P;(!g||G[0]&9)&&r!==(r=(((le=H[0])==null?void 0:le.name)||(($=H[3])==null?void 0:$.name))+"")&&Me(o,r),(!g||G[0]&9)&&f!==(f=(((ue=H[0])==null?void 0:ue.type)||((P=H[3])==null?void 0:P.type))+"")&&Me(u,f),H[1]?i?i.p(H,G):(i=bn(H),i.c(),i.m(h,p)):i&&(i.d(1),i=null),H[2]?c?c.p(H,G):(c=Tn(H),c.c(),c.m(h,b)):c&&(c.d(1),c=null);let j=d;d=w(H),d===j?~d&&v[d].p(H,G):(T&&(Ue(),Z(v[j],1,1,()=>{v[j]=null}),He()),~d?(T=v[d],T?T.p(H,G):(T=v[d]=m[d](H),T.c()),K(T,1),T.m(h,null)):T=null)},i(H){g||(K(T),g=!0)},o(H){Z(T),g=!1},d(H){H&&D(e),i&&i.d(),c&&c.d(),~d&&v[d].d()}}}function bn(t){let e,n,l,r,o,a="All Patterns (Global)",s,f,u,_='Select which pattern this effect applies to, or leave as "All Patterns" for global effect.',h,p,b=we(t[5]),d=[];for(let T=0;T<b.length;T+=1)d[T]=kn(gn(t,b,T));return{c(){e=M("div"),n=M("label"),l=ce(`Apply to Pattern:\r
						`),r=M("select"),o=M("option"),o.textContent=a;for(let T=0;T<d.length;T+=1)d[T].c();f=z(),u=M("p"),u.textContent=_,this.h()},l(T){e=y(T,"DIV",{class:!0});var g=A(e);n=y(g,"LABEL",{});var i=A(n);l=fe(i,`Apply to Pattern:\r
						`),r=y(i,"SELECT",{});var c=A(r);o=y(c,"OPTION",{"data-svelte-h":!0}),re(o)!=="svelte-9z4g18"&&(o.textContent=a);for(let m=0;m<d.length;m+=1)d[m].l(c);c.forEach(D),i.forEach(D),f=R(g),u=y(g,"P",{class:!0,"data-svelte-h":!0}),re(u)!=="svelte-zuizk8"&&(u.textContent=_),g.forEach(D),this.h()},h(){o.__value="",ze(o,o.__value),k(u,"class","help-text"),k(e,"class","pattern-assignment")},m(T,g){W(T,e,g),C(e,n),C(n,l),C(n,r),C(r,o);for(let i=0;i<d.length;i+=1)d[i]&&d[i].m(r,null);lt(r,t[1].patternId||""),C(e,f),C(e,u),h||(p=X(r,"change",t[22]),h=!0)},p(T,g){if(g[0]&32){b=we(T[5]);let i;for(i=0;i<b.length;i+=1){const c=gn(T,b,i);d[i]?d[i].p(c,g):(d[i]=kn(c),d[i].c(),d[i].m(r,null))}for(;i<d.length;i+=1)d[i].d(1);d.length=b.length}g[0]&34&&s!==(s=T[1].patternId||"")&&lt(r,T[1].patternId||"")},d(T){T&&D(e),Ge(d,T),h=!1,p()}}}function kn(t){let e,n=t[81].name+"",l,r;return{c(){e=M("option"),l=ce(n),this.h()},l(o){e=y(o,"OPTION",{});var a=A(e);l=fe(a,n),a.forEach(D),this.h()},h(){e.__value=r=t[81].id,ze(e,e.__value)},m(o,a){W(o,e,a),C(e,l)},p(o,a){a[0]&32&&n!==(n=o[81].name+"")&&Me(l,n),a[0]&32&&r!==(r=o[81].id)&&(e.__value=r,ze(e,e.__value))},d(o){o&&D(e)}}}function Tn(t){let e,n,l,r,o,a="All Patterns (Global)",s,f,u,_='Select which pattern this envelope applies to, or leave as "All Patterns" for global envelope.',h,p,b=we(t[5]),d=[];for(let T=0;T<b.length;T+=1)d[T]=Cn(pn(t,b,T));return{c(){e=M("div"),n=M("label"),l=ce(`Apply to Pattern:\r
						`),r=M("select"),o=M("option"),o.textContent=a;for(let T=0;T<d.length;T+=1)d[T].c();f=z(),u=M("p"),u.textContent=_,this.h()},l(T){e=y(T,"DIV",{class:!0});var g=A(e);n=y(g,"LABEL",{});var i=A(n);l=fe(i,`Apply to Pattern:\r
						`),r=y(i,"SELECT",{});var c=A(r);o=y(c,"OPTION",{"data-svelte-h":!0}),re(o)!=="svelte-9z4g18"&&(o.textContent=a);for(let m=0;m<d.length;m+=1)d[m].l(c);c.forEach(D),i.forEach(D),f=R(g),u=y(g,"P",{class:!0,"data-svelte-h":!0}),re(u)!=="svelte-fe9k0e"&&(u.textContent=_),g.forEach(D),this.h()},h(){o.__value="",ze(o,o.__value),k(u,"class","help-text"),k(e,"class","pattern-assignment")},m(T,g){W(T,e,g),C(e,n),C(n,l),C(n,r),C(r,o);for(let i=0;i<d.length;i+=1)d[i]&&d[i].m(r,null);lt(r,t[2].patternId||""),C(e,f),C(e,u),h||(p=X(r,"change",t[23]),h=!0)},p(T,g){if(g[0]&32){b=we(T[5]);let i;for(i=0;i<b.length;i+=1){const c=pn(T,b,i);d[i]?d[i].p(c,g):(d[i]=Cn(c),d[i].c(),d[i].m(r,null))}for(;i<d.length;i+=1)d[i].d(1);d.length=b.length}g[0]&36&&s!==(s=T[2].patternId||"")&&lt(r,T[2].patternId||"")},d(T){T&&D(e),Ge(d,T),h=!1,p()}}}function Cn(t){let e,n=t[81].name+"",l,r;return{c(){e=M("option"),l=ce(n),this.h()},l(o){e=y(o,"OPTION",{});var a=A(e);l=fe(a,n),a.forEach(D),this.h()},h(){e.__value=r=t[81].id,ze(e,e.__value)},m(o,a){W(o,e,a),C(e,l)},p(o,a){a[0]&32&&n!==(n=o[81].name+"")&&Me(l,n),a[0]&32&&r!==(r=o[81].id)&&(e.__value=r,ze(e,e.__value))},d(o){o&&D(e)}}}function zl(t){let e,n,l,r;const o=[Xl,Kl,Hl,Ul],a=[];function s(f,u){return f[3].type==="volume"?0:f[3].type==="filter"?1:f[3].type==="pitch"?2:f[3].type==="pan"?3:-1}return~(e=s(t))&&(n=a[e]=o[e](t)),{c(){n&&n.c(),l=Ee()},l(f){n&&n.l(f),l=Ee()},m(f,u){~e&&a[e].m(f,u),W(f,l,u),r=!0},p(f,u){let _=e;e=s(f),e===_?~e&&a[e].p(f,u):(n&&(Ue(),Z(a[_],1,1,()=>{a[_]=null}),He()),~e?(n=a[e],n?n.p(f,u):(n=a[e]=o[e](f),n.c()),K(n,1),n.m(l.parentNode,l)):n=null)},i(f){r||(K(n),r=!0)},o(f){Z(n),r=!1},d(f){f&&D(l),~e&&a[e].d(f)}}}function Wl(t){let e,n,l,r;const o=[Zl,Gl,ql,jl,Yl,Fl],a=[];function s(u,_){return u[0].type==="reverb"?0:u[0].type==="delay"?1:u[0].type==="filter"?2:u[0].type==="distortion"?3:u[0].type==="compressor"?4:u[0].type==="chorus"?5:-1}function f(u,_){if(_===0)return Rl(u);if(_===1)return Ll(u);if(_===2)return Ol(u);if(_===3)return Nl(u);if(_===4)return Vl(u);if(_===5)return Al(u)}return~(e=s(t))&&(n=a[e]=o[e](f(t,e))),{c(){n&&n.c(),l=Ee()},l(u){n&&n.l(u),l=Ee()},m(u,_){~e&&a[e].m(u,_),W(u,l,_),r=!0},p(u,_){let h=e;e=s(u),e===h?~e&&a[e].p(f(u,e),_):(n&&(Ue(),Z(a[h],1,1,()=>{a[h]=null}),He()),~e?(n=a[e],n?n.p(f(u,e),_):(n=a[e]=o[e](f(u,e)),n.c()),K(n,1),n.m(l.parentNode,l)):n=null)},i(u){r||(K(n),r=!0)},o(u){Z(n),r=!1},d(u){u&&D(l),~e&&a[e].d(u)}}}function Ul(t){let e,n,l,r,o,a,s="Curve Type",f,u,_,h="Linear",p,b="Exponential",d,T="Logarithmic",g,i,c,m,v,w,E,I,V="Reverse Direction",N,H,G;const j=[{label:"Pan Start"},{value:t[3].settings.startValue??.5},{min:0},{max:1},{step:.01},{onChange:t[57]},qe()];let le={};for(let P=0;P<j.length;P+=1)le=Ae(le,j[P]);e=new Ve({props:le});const $=[{label:"Pan End"},{value:t[3].settings.endValue??.5},{min:0},{max:1},{step:.01},{onChange:t[58]},qe()];let ue={};for(let P=0;P<$.length;P+=1)ue=Ae(ue,$[P]);return l=new Ve({props:ue}),{c(){ve(e.$$.fragment),n=z(),ve(l.$$.fragment),r=z(),o=M("div"),a=M("label"),a.textContent=s,f=z(),u=M("select"),_=M("option"),_.textContent=h,p=M("option"),p.textContent=b,d=M("option"),d.textContent=T,i=z(),c=M("div"),m=M("label"),v=M("input"),E=z(),I=M("span"),I.textContent=V,this.h()},l(P){ge(e.$$.fragment,P),n=R(P),ge(l.$$.fragment,P),r=R(P),o=y(P,"DIV",{class:!0});var L=A(o);a=y(L,"LABEL",{for:!0,"data-svelte-h":!0}),re(a)!=="svelte-1xhste2"&&(a.textContent=s),f=R(L),u=y(L,"SELECT",{id:!0});var ae=A(u);_=y(ae,"OPTION",{"data-svelte-h":!0}),re(_)!=="svelte-1jte1b2"&&(_.textContent=h),p=y(ae,"OPTION",{"data-svelte-h":!0}),re(p)!=="svelte-byu318"&&(p.textContent=b),d=y(ae,"OPTION",{"data-svelte-h":!0}),re(d)!=="svelte-8u6hh4"&&(d.textContent=T),ae.forEach(D),L.forEach(D),i=R(P),c=y(P,"DIV",{class:!0});var q=A(c);m=y(q,"LABEL",{class:!0});var J=A(m);v=y(J,"INPUT",{type:!0,class:!0}),E=R(J),I=y(J,"SPAN",{"data-svelte-h":!0}),re(I)!=="svelte-1qwxmvj"&&(I.textContent=V),J.forEach(D),q.forEach(D),this.h()},h(){k(a,"for","pan-curve"),_.__value="linear",ze(_,_.__value),p.__value="exponential",ze(p,p.__value),d.__value="logarithmic",ze(d,d.__value),k(u,"id","pan-curve"),k(o,"class","param"),k(v,"type","checkbox"),k(v,"class","styled-checkbox"),v.checked=w=t[3].settings.reverse??!1,k(m,"class","checkbox-label"),k(c,"class","param param-checkbox")},m(P,L){pe(e,P,L),W(P,n,L),pe(l,P,L),W(P,r,L),W(P,o,L),C(o,a),C(o,f),C(o,u),C(u,_),C(u,p),C(u,d),lt(u,t[3].settings.curve??"linear"),W(P,i,L),W(P,c,L),C(c,m),C(m,v),C(m,E),C(m,I),N=!0,H||(G=[X(u,"change",t[59]),X(v,"change",t[60])],H=!0)},p(P,L){const ae=L[0]&264?Ne(j,[j[0],L[0]&8&&{value:P[3].settings.startValue??.5},j[2],j[3],j[4],L[0]&256&&{onChange:P[57]},L&0&&Oe(qe())]):{};e.$set(ae);const q=L[0]&264?Ne($,[$[0],L[0]&8&&{value:P[3].settings.endValue??.5},$[2],$[3],$[4],L[0]&256&&{onChange:P[58]},L&0&&Oe(qe())]):{};l.$set(q),(!N||L[0]&8&&g!==(g=P[3].settings.curve??"linear"))&&lt(u,P[3].settings.curve??"linear"),(!N||L[0]&8&&w!==(w=P[3].settings.reverse??!1))&&(v.checked=w)},i(P){N||(K(e.$$.fragment,P),K(l.$$.fragment,P),N=!0)},o(P){Z(e.$$.fragment,P),Z(l.$$.fragment,P),N=!1},d(P){P&&(D(n),D(r),D(o),D(i),D(c)),me(e,P),me(l,P),H=!1,Le(G)}}}function Hl(t){let e,n,l,r,o,a,s="Curve Type",f,u,_,h="Linear",p,b="Exponential",d,T="Logarithmic",g,i,c,m,v,w,E,I,V="Reverse Direction",N,H,G;const j=[{label:"Pitch Start"},{value:t[3].settings.startValue??.5},{min:0},{max:1},{step:.01},{onChange:t[53]},qe()];let le={};for(let P=0;P<j.length;P+=1)le=Ae(le,j[P]);e=new Ve({props:le});const $=[{label:"Pitch End"},{value:t[3].settings.endValue??1},{min:0},{max:1},{step:.01},{onChange:t[54]},qe()];let ue={};for(let P=0;P<$.length;P+=1)ue=Ae(ue,$[P]);return l=new Ve({props:ue}),{c(){ve(e.$$.fragment),n=z(),ve(l.$$.fragment),r=z(),o=M("div"),a=M("label"),a.textContent=s,f=z(),u=M("select"),_=M("option"),_.textContent=h,p=M("option"),p.textContent=b,d=M("option"),d.textContent=T,i=z(),c=M("div"),m=M("label"),v=M("input"),E=z(),I=M("span"),I.textContent=V,this.h()},l(P){ge(e.$$.fragment,P),n=R(P),ge(l.$$.fragment,P),r=R(P),o=y(P,"DIV",{class:!0});var L=A(o);a=y(L,"LABEL",{for:!0,"data-svelte-h":!0}),re(a)!=="svelte-1efyil"&&(a.textContent=s),f=R(L),u=y(L,"SELECT",{id:!0});var ae=A(u);_=y(ae,"OPTION",{"data-svelte-h":!0}),re(_)!=="svelte-1jte1b2"&&(_.textContent=h),p=y(ae,"OPTION",{"data-svelte-h":!0}),re(p)!=="svelte-byu318"&&(p.textContent=b),d=y(ae,"OPTION",{"data-svelte-h":!0}),re(d)!=="svelte-8u6hh4"&&(d.textContent=T),ae.forEach(D),L.forEach(D),i=R(P),c=y(P,"DIV",{class:!0});var q=A(c);m=y(q,"LABEL",{class:!0});var J=A(m);v=y(J,"INPUT",{type:!0,class:!0}),E=R(J),I=y(J,"SPAN",{"data-svelte-h":!0}),re(I)!=="svelte-1qwxmvj"&&(I.textContent=V),J.forEach(D),q.forEach(D),this.h()},h(){k(a,"for","pitch-curve"),_.__value="linear",ze(_,_.__value),p.__value="exponential",ze(p,p.__value),d.__value="logarithmic",ze(d,d.__value),k(u,"id","pitch-curve"),k(o,"class","param"),k(v,"type","checkbox"),k(v,"class","styled-checkbox"),v.checked=w=t[3].settings.reverse??!1,k(m,"class","checkbox-label"),k(c,"class","param param-checkbox")},m(P,L){pe(e,P,L),W(P,n,L),pe(l,P,L),W(P,r,L),W(P,o,L),C(o,a),C(o,f),C(o,u),C(u,_),C(u,p),C(u,d),lt(u,t[3].settings.curve??"linear"),W(P,i,L),W(P,c,L),C(c,m),C(m,v),C(m,E),C(m,I),N=!0,H||(G=[X(u,"change",t[55]),X(v,"change",t[56])],H=!0)},p(P,L){const ae=L[0]&264?Ne(j,[j[0],L[0]&8&&{value:P[3].settings.startValue??.5},j[2],j[3],j[4],L[0]&256&&{onChange:P[53]},L&0&&Oe(qe())]):{};e.$set(ae);const q=L[0]&264?Ne($,[$[0],L[0]&8&&{value:P[3].settings.endValue??1},$[2],$[3],$[4],L[0]&256&&{onChange:P[54]},L&0&&Oe(qe())]):{};l.$set(q),(!N||L[0]&8&&g!==(g=P[3].settings.curve??"linear"))&&lt(u,P[3].settings.curve??"linear"),(!N||L[0]&8&&w!==(w=P[3].settings.reverse??!1))&&(v.checked=w)},i(P){N||(K(e.$$.fragment,P),K(l.$$.fragment,P),N=!0)},o(P){Z(e.$$.fragment,P),Z(l.$$.fragment,P),N=!1},d(P){P&&(D(n),D(r),D(o),D(i),D(c)),me(e,P),me(l,P),H=!1,Le(G)}}}function Kl(t){let e,n,l,r,o,a,s="Curve Type",f,u,_,h="Linear",p,b="Exponential",d,T="Logarithmic",g,i,c,m,v,w,E,I,V="Reverse Direction",N,H,G;const j=[{label:"Filter Start"},{value:t[3].settings.startValue??.2},{min:0},{max:1},{step:.01},{onChange:t[49]},qe()];let le={};for(let P=0;P<j.length;P+=1)le=Ae(le,j[P]);e=new Ve({props:le});const $=[{label:"Filter End"},{value:t[3].settings.endValue??.8},{min:0},{max:1},{step:.01},{onChange:t[50]},qe()];let ue={};for(let P=0;P<$.length;P+=1)ue=Ae(ue,$[P]);return l=new Ve({props:ue}),{c(){ve(e.$$.fragment),n=z(),ve(l.$$.fragment),r=z(),o=M("div"),a=M("label"),a.textContent=s,f=z(),u=M("select"),_=M("option"),_.textContent=h,p=M("option"),p.textContent=b,d=M("option"),d.textContent=T,i=z(),c=M("div"),m=M("label"),v=M("input"),E=z(),I=M("span"),I.textContent=V,this.h()},l(P){ge(e.$$.fragment,P),n=R(P),ge(l.$$.fragment,P),r=R(P),o=y(P,"DIV",{class:!0});var L=A(o);a=y(L,"LABEL",{for:!0,"data-svelte-h":!0}),re(a)!=="svelte-zoc8f7"&&(a.textContent=s),f=R(L),u=y(L,"SELECT",{id:!0});var ae=A(u);_=y(ae,"OPTION",{"data-svelte-h":!0}),re(_)!=="svelte-1jte1b2"&&(_.textContent=h),p=y(ae,"OPTION",{"data-svelte-h":!0}),re(p)!=="svelte-byu318"&&(p.textContent=b),d=y(ae,"OPTION",{"data-svelte-h":!0}),re(d)!=="svelte-8u6hh4"&&(d.textContent=T),ae.forEach(D),L.forEach(D),i=R(P),c=y(P,"DIV",{class:!0});var q=A(c);m=y(q,"LABEL",{class:!0});var J=A(m);v=y(J,"INPUT",{type:!0,class:!0}),E=R(J),I=y(J,"SPAN",{"data-svelte-h":!0}),re(I)!=="svelte-1qwxmvj"&&(I.textContent=V),J.forEach(D),q.forEach(D),this.h()},h(){k(a,"for","filter-curve"),_.__value="linear",ze(_,_.__value),p.__value="exponential",ze(p,p.__value),d.__value="logarithmic",ze(d,d.__value),k(u,"id","filter-curve"),k(o,"class","param"),k(v,"type","checkbox"),k(v,"class","styled-checkbox"),v.checked=w=t[3].settings.reverse??!1,k(m,"class","checkbox-label"),k(c,"class","param param-checkbox")},m(P,L){pe(e,P,L),W(P,n,L),pe(l,P,L),W(P,r,L),W(P,o,L),C(o,a),C(o,f),C(o,u),C(u,_),C(u,p),C(u,d),lt(u,t[3].settings.curve??"linear"),W(P,i,L),W(P,c,L),C(c,m),C(m,v),C(m,E),C(m,I),N=!0,H||(G=[X(u,"change",t[51]),X(v,"change",t[52])],H=!0)},p(P,L){const ae=L[0]&264?Ne(j,[j[0],L[0]&8&&{value:P[3].settings.startValue??.2},j[2],j[3],j[4],L[0]&256&&{onChange:P[49]},L&0&&Oe(qe())]):{};e.$set(ae);const q=L[0]&264?Ne($,[$[0],L[0]&8&&{value:P[3].settings.endValue??.8},$[2],$[3],$[4],L[0]&256&&{onChange:P[50]},L&0&&Oe(qe())]):{};l.$set(q),(!N||L[0]&8&&g!==(g=P[3].settings.curve??"linear"))&&lt(u,P[3].settings.curve??"linear"),(!N||L[0]&8&&w!==(w=P[3].settings.reverse??!1))&&(v.checked=w)},i(P){N||(K(e.$$.fragment,P),K(l.$$.fragment,P),N=!0)},o(P){Z(e.$$.fragment,P),Z(l.$$.fragment,P),N=!1},d(P){P&&(D(n),D(r),D(o),D(i),D(c)),me(e,P),me(l,P),H=!1,Le(G)}}}function Xl(t){let e,n,l,r,o,a,s="Curve Type",f,u,_,h="Linear",p,b="Exponential",d,T="Logarithmic",g,i,c,m,v,w,E,I,V="Reverse Direction",N,H,G;const j=[{label:"Volume Start"},{value:t[3].settings.startValue??.5},{min:0},{max:1},{step:.01},{onChange:t[45]},qe()];let le={};for(let P=0;P<j.length;P+=1)le=Ae(le,j[P]);e=new Ve({props:le});const $=[{label:"Volume End"},{value:t[3].settings.endValue??1},{min:0},{max:1},{step:.01},{onChange:t[46]},qe()];let ue={};for(let P=0;P<$.length;P+=1)ue=Ae(ue,$[P]);return l=new Ve({props:ue}),{c(){ve(e.$$.fragment),n=z(),ve(l.$$.fragment),r=z(),o=M("div"),a=M("label"),a.textContent=s,f=z(),u=M("select"),_=M("option"),_.textContent=h,p=M("option"),p.textContent=b,d=M("option"),d.textContent=T,i=z(),c=M("div"),m=M("label"),v=M("input"),E=z(),I=M("span"),I.textContent=V,this.h()},l(P){ge(e.$$.fragment,P),n=R(P),ge(l.$$.fragment,P),r=R(P),o=y(P,"DIV",{class:!0});var L=A(o);a=y(L,"LABEL",{for:!0,"data-svelte-h":!0}),re(a)!=="svelte-h9450r"&&(a.textContent=s),f=R(L),u=y(L,"SELECT",{id:!0});var ae=A(u);_=y(ae,"OPTION",{"data-svelte-h":!0}),re(_)!=="svelte-1jte1b2"&&(_.textContent=h),p=y(ae,"OPTION",{"data-svelte-h":!0}),re(p)!=="svelte-byu318"&&(p.textContent=b),d=y(ae,"OPTION",{"data-svelte-h":!0}),re(d)!=="svelte-8u6hh4"&&(d.textContent=T),ae.forEach(D),L.forEach(D),i=R(P),c=y(P,"DIV",{class:!0});var q=A(c);m=y(q,"LABEL",{class:!0});var J=A(m);v=y(J,"INPUT",{type:!0,class:!0}),E=R(J),I=y(J,"SPAN",{"data-svelte-h":!0}),re(I)!=="svelte-1qwxmvj"&&(I.textContent=V),J.forEach(D),q.forEach(D),this.h()},h(){k(a,"for","volume-curve"),_.__value="linear",ze(_,_.__value),p.__value="exponential",ze(p,p.__value),d.__value="logarithmic",ze(d,d.__value),k(u,"id","volume-curve"),k(o,"class","param"),k(v,"type","checkbox"),k(v,"class","styled-checkbox"),v.checked=w=t[3].settings.reverse??!1,k(m,"class","checkbox-label"),k(c,"class","param param-checkbox")},m(P,L){pe(e,P,L),W(P,n,L),pe(l,P,L),W(P,r,L),W(P,o,L),C(o,a),C(o,f),C(o,u),C(u,_),C(u,p),C(u,d),lt(u,t[3].settings.curve??"linear"),W(P,i,L),W(P,c,L),C(c,m),C(m,v),C(m,E),C(m,I),N=!0,H||(G=[X(u,"change",t[47]),X(v,"change",t[48])],H=!0)},p(P,L){const ae=L[0]&264?Ne(j,[j[0],L[0]&8&&{value:P[3].settings.startValue??.5},j[2],j[3],j[4],L[0]&256&&{onChange:P[45]},L&0&&Oe(qe())]):{};e.$set(ae);const q=L[0]&264?Ne($,[$[0],L[0]&8&&{value:P[3].settings.endValue??1},$[2],$[3],$[4],L[0]&256&&{onChange:P[46]},L&0&&Oe(qe())]):{};l.$set(q),(!N||L[0]&8&&g!==(g=P[3].settings.curve??"linear"))&&lt(u,P[3].settings.curve??"linear"),(!N||L[0]&8&&w!==(w=P[3].settings.reverse??!1))&&(v.checked=w)},i(P){N||(K(e.$$.fragment,P),K(l.$$.fragment,P),N=!0)},o(P){Z(e.$$.fragment,P),Z(l.$$.fragment,P),N=!1},d(P){P&&(D(n),D(r),D(o),D(i),D(c)),me(e,P),me(l,P),H=!1,Le(G)}}}function Fl(t){let e,n,l,r,o,a,s,f;const u=[{label:"Rate"},{value:t[78]},{min:0},{max:1},{step:.01},{onChange:t[41]},t[11]("rate")];let _={};for(let i=0;i<u.length;i+=1)_=Ae(_,u[i]);e=new Ve({props:_});const h=[{label:"Depth"},{value:t[79]},{min:0},{max:1},{step:.01},{onChange:t[42]},t[11]("depth")];let p={};for(let i=0;i<h.length;i+=1)p=Ae(p,h[i]);l=new Ve({props:p});const b=[{label:"Delay"},{value:t[80]},{min:0},{max:.1},{step:.001},{onChange:t[43]},t[11]("delay")];let d={};for(let i=0;i<b.length;i+=1)d=Ae(d,b[i]);o=new Ve({props:d});const T=[{label:"Wet"},{value:t[0].settings.wet??.3},{min:0},{max:1},{step:.01},{onChange:t[44]},t[11]("wet")];let g={};for(let i=0;i<T.length;i+=1)g=Ae(g,T[i]);return s=new Ve({props:g}),{c(){ve(e.$$.fragment),n=z(),ve(l.$$.fragment),r=z(),ve(o.$$.fragment),a=z(),ve(s.$$.fragment)},l(i){ge(e.$$.fragment,i),n=R(i),ge(l.$$.fragment,i),r=R(i),ge(o.$$.fragment,i),a=R(i),ge(s.$$.fragment,i)},m(i,c){pe(e,i,c),W(i,n,c),pe(l,i,c),W(i,r,c),pe(o,i,c),W(i,a,c),pe(s,i,c),f=!0},p(i,c){const m=c[0]&2257?Ne(u,[u[0],c[0]&81&&{value:i[78]},u[2],u[3],u[4],c[0]&128&&{onChange:i[41]},c[0]&2048&&Oe(i[11]("rate"))]):{};e.$set(m);const v=c[0]&2257?Ne(h,[h[0],c[0]&81&&{value:i[79]},h[2],h[3],h[4],c[0]&128&&{onChange:i[42]},c[0]&2048&&Oe(i[11]("depth"))]):{};l.$set(v);const w=c[0]&2257?Ne(b,[b[0],c[0]&81&&{value:i[80]},b[2],b[3],b[4],c[0]&128&&{onChange:i[43]},c[0]&2048&&Oe(i[11]("delay"))]):{};o.$set(w);const E=c[0]&2177?Ne(T,[T[0],c[0]&1&&{value:i[0].settings.wet??.3},T[2],T[3],T[4],c[0]&128&&{onChange:i[44]},c[0]&2048&&Oe(i[11]("wet"))]):{};s.$set(E)},i(i){f||(K(e.$$.fragment,i),K(l.$$.fragment,i),K(o.$$.fragment,i),K(s.$$.fragment,i),f=!0)},o(i){Z(e.$$.fragment,i),Z(l.$$.fragment,i),Z(o.$$.fragment,i),Z(s.$$.fragment,i),f=!1},d(i){i&&(D(n),D(r),D(a)),me(e,i),me(l,i),me(o,i),me(s,i)}}}function Yl(t){let e,n,l,r,o,a,s,f;const u=[{label:"Threshold"},{value:t[74]},{min:0},{max:1},{step:.01},{onChange:t[37]},t[11]("threshold")];let _={};for(let i=0;i<u.length;i+=1)_=Ae(_,u[i]);e=new Ve({props:_});const h=[{label:"Ratio"},{value:t[75]},{min:1},{max:20},{step:.1},{onChange:t[38]},t[11]("ratio")];let p={};for(let i=0;i<h.length;i+=1)p=Ae(p,h[i]);l=new Ve({props:p});const b=[{label:"Attack"},{value:t[76]},{min:0},{max:1},{step:.001},{onChange:t[39]},t[11]("attack")];let d={};for(let i=0;i<b.length;i+=1)d=Ae(d,b[i]);o=new Ve({props:d});const T=[{label:"Release"},{value:t[77]},{min:0},{max:1},{step:.001},{onChange:t[40]},t[11]("release")];let g={};for(let i=0;i<T.length;i+=1)g=Ae(g,T[i]);return s=new Ve({props:g}),{c(){ve(e.$$.fragment),n=z(),ve(l.$$.fragment),r=z(),ve(o.$$.fragment),a=z(),ve(s.$$.fragment)},l(i){ge(e.$$.fragment,i),n=R(i),ge(l.$$.fragment,i),r=R(i),ge(o.$$.fragment,i),a=R(i),ge(s.$$.fragment,i)},m(i,c){pe(e,i,c),W(i,n,c),pe(l,i,c),W(i,r,c),pe(o,i,c),W(i,a,c),pe(s,i,c),f=!0},p(i,c){const m=c[0]&2257?Ne(u,[u[0],c[0]&81&&{value:i[74]},u[2],u[3],u[4],c[0]&128&&{onChange:i[37]},c[0]&2048&&Oe(i[11]("threshold"))]):{};e.$set(m);const v=c[0]&2257?Ne(h,[h[0],c[0]&81&&{value:i[75]},h[2],h[3],h[4],c[0]&128&&{onChange:i[38]},c[0]&2048&&Oe(i[11]("ratio"))]):{};l.$set(v);const w=c[0]&2257?Ne(b,[b[0],c[0]&81&&{value:i[76]},b[2],b[3],b[4],c[0]&128&&{onChange:i[39]},c[0]&2048&&Oe(i[11]("attack"))]):{};o.$set(w);const E=c[0]&2257?Ne(T,[T[0],c[0]&81&&{value:i[77]},T[2],T[3],T[4],c[0]&128&&{onChange:i[40]},c[0]&2048&&Oe(i[11]("release"))]):{};s.$set(E)},i(i){f||(K(e.$$.fragment,i),K(l.$$.fragment,i),K(o.$$.fragment,i),K(s.$$.fragment,i),f=!0)},o(i){Z(e.$$.fragment,i),Z(l.$$.fragment,i),Z(o.$$.fragment,i),Z(s.$$.fragment,i),f=!1},d(i){i&&(D(n),D(r),D(a)),me(e,i),me(l,i),me(o,i),me(s,i)}}}function jl(t){let e,n,l,r;const o=[{label:"Amount"},{value:t[72]},{min:0},{max:1},{step:.01},{onChange:t[35]},t[11]("amount")];let a={};for(let u=0;u<o.length;u+=1)a=Ae(a,o[u]);e=new Ve({props:a});const s=[{label:"Drive"},{value:t[73]},{min:0},{max:1},{step:.01},{onChange:t[36]},t[11]("drive")];let f={};for(let u=0;u<s.length;u+=1)f=Ae(f,s[u]);return l=new Ve({props:f}),{c(){ve(e.$$.fragment),n=z(),ve(l.$$.fragment)},l(u){ge(e.$$.fragment,u),n=R(u),ge(l.$$.fragment,u)},m(u,_){pe(e,u,_),W(u,n,_),pe(l,u,_),r=!0},p(u,_){const h=_[0]&2257?Ne(o,[o[0],_[0]&81&&{value:u[72]},o[2],o[3],o[4],_[0]&128&&{onChange:u[35]},_[0]&2048&&Oe(u[11]("amount"))]):{};e.$set(h);const p=_[0]&2257?Ne(s,[s[0],_[0]&81&&{value:u[73]},s[2],s[3],s[4],_[0]&128&&{onChange:u[36]},_[0]&2048&&Oe(u[11]("drive"))]):{};l.$set(p)},i(u){r||(K(e.$$.fragment,u),K(l.$$.fragment,u),r=!0)},o(u){Z(e.$$.fragment,u),Z(l.$$.fragment,u),r=!1},d(u){u&&D(n),me(e,u),me(l,u)}}}function ql(t){let e,n,l,r,o="Lowpass",a,s="Highpass",f,u="Bandpass",_,h,p,b,d,T,g,i;const c=[{label:"Frequency"},{value:t[70]},{min:0},{max:1},{step:.01},{onChange:t[33]},t[11]("frequency")];let m={};for(let E=0;E<c.length;E+=1)m=Ae(m,c[E]);p=new Ve({props:m});const v=[{label:"Resonance"},{value:t[71]},{min:0},{max:1},{step:.01},{onChange:t[34]},t[11]("resonance")];let w={};for(let E=0;E<v.length;E+=1)w=Ae(w,v[E]);return d=new Ve({props:w}),{c(){e=M("label"),n=ce(`Type\r
						`),l=M("select"),r=M("option"),r.textContent=o,a=M("option"),a.textContent=s,f=M("option"),f.textContent=u,h=z(),ve(p.$$.fragment),b=z(),ve(d.$$.fragment),this.h()},l(E){e=y(E,"LABEL",{});var I=A(e);n=fe(I,`Type\r
						`),l=y(I,"SELECT",{});var V=A(l);r=y(V,"OPTION",{"data-svelte-h":!0}),re(r)!=="svelte-qh68bg"&&(r.textContent=o),a=y(V,"OPTION",{"data-svelte-h":!0}),re(a)!=="svelte-1al95b6"&&(a.textContent=s),f=y(V,"OPTION",{"data-svelte-h":!0}),re(f)!=="svelte-1q8zb76"&&(f.textContent=u),V.forEach(D),I.forEach(D),h=R(E),ge(p.$$.fragment,E),b=R(E),ge(d.$$.fragment,E),this.h()},h(){r.__value="lowpass",ze(r,r.__value),a.__value="highpass",ze(a,a.__value),f.__value="bandpass",ze(f,f.__value)},m(E,I){W(E,e,I),C(e,n),C(e,l),C(l,r),C(l,a),C(l,f),lt(l,t[0].settings.type??"lowpass"),W(E,h,I),pe(p,E,I),W(E,b,I),pe(d,E,I),T=!0,g||(i=X(l,"change",t[32]),g=!0)},p(E,I){(!T||I[0]&1&&_!==(_=E[0].settings.type??"lowpass"))&&lt(l,E[0].settings.type??"lowpass");const V=I[0]&2257?Ne(c,[c[0],I[0]&81&&{value:E[70]},c[2],c[3],c[4],I[0]&128&&{onChange:E[33]},I[0]&2048&&Oe(E[11]("frequency"))]):{};p.$set(V);const N=I[0]&2257?Ne(v,[v[0],I[0]&81&&{value:E[71]},v[2],v[3],v[4],I[0]&128&&{onChange:E[34]},I[0]&2048&&Oe(E[11]("resonance"))]):{};d.$set(N)},i(E){T||(K(p.$$.fragment,E),K(d.$$.fragment,E),T=!0)},o(E){Z(p.$$.fragment,E),Z(d.$$.fragment,E),T=!1},d(E){E&&(D(e),D(h),D(b)),me(p,E),me(d,E),g=!1,i()}}}function Gl(t){let e,n,l,r,o,a,s,f;const u=[{label:"Time"},{value:t[66]},{min:0},{max:2},{step:.01},{onChange:t[28]},t[11]("time")];let _={};for(let i=0;i<u.length;i+=1)_=Ae(_,u[i]);e=new Ve({props:_});const h=[{label:"Feedback"},{value:t[67]},{min:0},{max:1},{step:.01},{onChange:t[29]},t[11]("feedback")];let p={};for(let i=0;i<h.length;i+=1)p=Ae(p,h[i]);l=new Ve({props:p});const b=[{label:"Wet"},{value:t[68]},{min:0},{max:1},{step:.01},{onChange:t[30]},t[11]("wet")];let d={};for(let i=0;i<b.length;i+=1)d=Ae(d,b[i]);o=new Ve({props:d});const T=[{label:"Dry"},{value:t[69]},{min:0},{max:1},{step:.01},{onChange:t[31]},t[11]("dry")];let g={};for(let i=0;i<T.length;i+=1)g=Ae(g,T[i]);return s=new Ve({props:g}),{c(){ve(e.$$.fragment),n=z(),ve(l.$$.fragment),r=z(),ve(o.$$.fragment),a=z(),ve(s.$$.fragment)},l(i){ge(e.$$.fragment,i),n=R(i),ge(l.$$.fragment,i),r=R(i),ge(o.$$.fragment,i),a=R(i),ge(s.$$.fragment,i)},m(i,c){pe(e,i,c),W(i,n,c),pe(l,i,c),W(i,r,c),pe(o,i,c),W(i,a,c),pe(s,i,c),f=!0},p(i,c){const m=c[0]&2257?Ne(u,[u[0],c[0]&81&&{value:i[66]},u[2],u[3],u[4],c[0]&128&&{onChange:i[28]},c[0]&2048&&Oe(i[11]("time"))]):{};e.$set(m);const v=c[0]&2257?Ne(h,[h[0],c[0]&81&&{value:i[67]},h[2],h[3],h[4],c[0]&128&&{onChange:i[29]},c[0]&2048&&Oe(i[11]("feedback"))]):{};l.$set(v);const w=c[0]&2257?Ne(b,[b[0],c[0]&81&&{value:i[68]},b[2],b[3],b[4],c[0]&128&&{onChange:i[30]},c[0]&2048&&Oe(i[11]("wet"))]):{};o.$set(w);const E=c[0]&2257?Ne(T,[T[0],c[0]&81&&{value:i[69]},T[2],T[3],T[4],c[0]&128&&{onChange:i[31]},c[0]&2048&&Oe(i[11]("dry"))]):{};s.$set(E)},i(i){f||(K(e.$$.fragment,i),K(l.$$.fragment,i),K(o.$$.fragment,i),K(s.$$.fragment,i),f=!0)},o(i){Z(e.$$.fragment,i),Z(l.$$.fragment,i),Z(o.$$.fragment,i),Z(s.$$.fragment,i),f=!1},d(i){i&&(D(n),D(r),D(a)),me(e,i),me(l,i),me(o,i),me(s,i)}}}function Zl(t){let e,n,l,r,o,a,s,f;const u=[{label:"Room Size"},{value:t[62]},{min:0},{max:1},{step:.01},{onChange:t[24]},t[11]("roomSize")];let _={};for(let i=0;i<u.length;i+=1)_=Ae(_,u[i]);e=new Ve({props:_});const h=[{label:"Dampening"},{value:t[63]},{min:0},{max:1},{step:.01},{onChange:t[25]},t[11]("dampening")];let p={};for(let i=0;i<h.length;i+=1)p=Ae(p,h[i]);l=new Ve({props:p});const b=[{label:"Wet"},{value:t[64]},{min:0},{max:1},{step:.01},{onChange:t[26]},t[11]("wet")];let d={};for(let i=0;i<b.length;i+=1)d=Ae(d,b[i]);o=new Ve({props:d});const T=[{label:"Dry"},{value:t[65]},{min:0},{max:1},{step:.01},{onChange:t[27]},t[11]("dry")];let g={};for(let i=0;i<T.length;i+=1)g=Ae(g,T[i]);return s=new Ve({props:g}),{c(){ve(e.$$.fragment),n=z(),ve(l.$$.fragment),r=z(),ve(o.$$.fragment),a=z(),ve(s.$$.fragment)},l(i){ge(e.$$.fragment,i),n=R(i),ge(l.$$.fragment,i),r=R(i),ge(o.$$.fragment,i),a=R(i),ge(s.$$.fragment,i)},m(i,c){pe(e,i,c),W(i,n,c),pe(l,i,c),W(i,r,c),pe(o,i,c),W(i,a,c),pe(s,i,c),f=!0},p(i,c){const m=c[0]&2257?Ne(u,[u[0],c[0]&81&&{value:i[62]},u[2],u[3],u[4],c[0]&128&&{onChange:i[24]},c[0]&2048&&Oe(i[11]("roomSize"))]):{};e.$set(m);const v=c[0]&2257?Ne(h,[h[0],c[0]&81&&{value:i[63]},h[2],h[3],h[4],c[0]&128&&{onChange:i[25]},c[0]&2048&&Oe(i[11]("dampening"))]):{};l.$set(v);const w=c[0]&2257?Ne(b,[b[0],c[0]&81&&{value:i[64]},b[2],b[3],b[4],c[0]&128&&{onChange:i[26]},c[0]&2048&&Oe(i[11]("wet"))]):{};o.$set(w);const E=c[0]&2257?Ne(T,[T[0],c[0]&81&&{value:i[65]},T[2],T[3],T[4],c[0]&128&&{onChange:i[27]},c[0]&2048&&Oe(i[11]("dry"))]):{};s.$set(E)},i(i){f||(K(e.$$.fragment,i),K(l.$$.fragment,i),K(o.$$.fragment,i),K(s.$$.fragment,i),f=!0)},o(i){Z(e.$$.fragment,i),Z(l.$$.fragment,i),Z(o.$$.fragment,i),Z(s.$$.fragment,i),f=!1},d(i){i&&(D(n),D(r),D(a)),me(e,i),me(l,i),me(o,i),me(s,i)}}}function Jl(t){let e,n,l=(t[0]||t[3])&&vn(t);return{c(){l&&l.c(),e=Ee()},l(r){l&&l.l(r),e=Ee()},m(r,o){l&&l.m(r,o),W(r,e,o),n=!0},p(r,o){r[0]||r[3]?l?(l.p(r,o),o[0]&9&&K(l,1)):(l=vn(r),l.c(),K(l,1),l.m(e.parentNode,e)):l&&(Ue(),Z(l,1,1,()=>{l=null}),He())},i(r){n||(K(l),n=!0)},o(r){Z(l),n=!1},d(r){r&&D(e),l&&l.d(r)}}}function qe(t){return{}}function Ql(t,e,n){let l,r,o,a,s,f,u,_,h,p,b;mt(t,dl,O=>n(21,b=O));let{selectedEffectId:d=null}=e,{selectedEnvelopeId:T=null}=e,{selectedTimelineEffectId:g=null}=e,{selectedTimelineEnvelopeId:i=null}=e,c;Q.subscribe(O=>n(16,c=O));let m=null;ul.subscribe(O=>m=O);function v(O,tt,_t,Nt,vt){var Dt;if(!f||!_||!(c!=null&&c.automation))return tt;const Ot=`effect:${f.id}:${_.id}:${O}`,ht=(Dt=c.automation)==null?void 0:Dt[Ot];if(!ht||!ht.points||ht.points.length===0)return tt;const wt=_.startBeat||0,Lt=wt+(_.duration||0);return vt<wt||vt>=Lt?tt:Wt(ht.points,vt,ht.min??_t,ht.max??Nt)}function w(O,tt){if(!f)return;const _t={...f.settings,[O]:tt};Q.updateEffect(f.id,{settings:_t}),m&&m.updateEffect(f.id,{[O]:tt})}function E(O,tt){if(!u)return;const _t={...u.settings,[O]:tt};Q.updateEnvelope(u.id,{settings:_t}),m&&m.updateEnvelope(u.id,{[O]:tt})}function I(O){_&&(Q.updateTimelineEffect(_.id,{patternId:O||void 0}),window.dispatchEvent(new CustomEvent("reloadProject")))}function V(O){h&&(Q.updateTimelineEnvelope(h.id,{patternId:O||void 0}),window.dispatchEvent(new CustomEvent("reloadProject")))}function N(O){return f?{automationTargetType:"effect",automationTargetId:f.id,automationParameterKey:O,automationTimelineInstanceId:(_==null?void 0:_.id)||null,automationLabel:`${f.name} - ${O.charAt(0).toUpperCase()+O.slice(1)}`}:{}}const H=O=>I(O.currentTarget.value||null),G=O=>V(O.currentTarget.value||null),j=O=>w("roomSize",O),le=O=>w("dampening",O),$=O=>w("wet",O),ue=O=>w("dry",O),P=O=>w("time",O),L=O=>w("feedback",O),ae=O=>w("wet",O),q=O=>w("dry",O),J=O=>w("type",O.currentTarget.value),ie=O=>w("frequency",O),de=O=>w("resonance",O),be=O=>w("amount",O),ne=O=>w("drive",O),oe=O=>w("threshold",O),Ce=O=>w("ratio",O),De=O=>w("attack",O),Te=O=>w("release",O),Pe=O=>w("rate",O),Ye=O=>w("depth",O),xe=O=>w("delay",O),Y=O=>w("wet",O),he=O=>E("startValue",O),ye=O=>E("endValue",O),Fe=O=>E("curve",O.currentTarget.value),$e=O=>E("reverse",O.currentTarget.checked),it=O=>E("startValue",O),et=O=>E("endValue",O),at=O=>E("curve",O.currentTarget.value),yt=O=>E("reverse",O.currentTarget.checked),Et=O=>E("startValue",O),Ze=O=>E("endValue",O),st=O=>E("curve",O.currentTarget.value),Mt=O=>E("reverse",O.currentTarget.checked),St=O=>E("startValue",O),Bt=O=>E("endValue",O),At=O=>E("curve",O.currentTarget.value),Vt=O=>E("reverse",O.currentTarget.checked);return t.$$set=O=>{"selectedEffectId"in O&&n(12,d=O.selectedEffectId),"selectedEnvelopeId"in O&&n(13,T=O.selectedEnvelopeId),"selectedTimelineEffectId"in O&&n(14,g=O.selectedTimelineEffectId),"selectedTimelineEnvelopeId"in O&&n(15,i=O.selectedTimelineEnvelopeId)},t.$$.update=()=>{t.$$.dirty[0]&2097152&&n(17,l=b),t.$$.dirty[0]&65536&&n(20,r=(c==null?void 0:c.effects)||[]),t.$$.dirty[0]&65536&&n(19,o=(c==null?void 0:c.envelopes)||[]),t.$$.dirty[0]&65536&&n(5,a=(c==null?void 0:c.patterns)||[]),t.$$.dirty[0]&65536&&n(18,s=c==null?void 0:c.timeline),t.$$.dirty[0]&1052672&&n(0,f=d?r.find(O=>O.id===d):null),t.$$.dirty[0]&532480&&n(3,u=T?o.find(O=>O.id===T):null),t.$$.dirty[0]&278528&&n(1,_=g&&(s!=null&&s.effects)?s.effects.find(O=>O.id===g):null),t.$$.dirty[0]&294912&&n(2,h=i&&(s!=null&&s.envelopes)?s.envelopes.find(O=>O.id===i):null),t.$$.dirty[0]&131072&&n(4,p=l.currentTime||0)},[f,_,h,u,p,a,v,w,E,I,V,N,d,T,g,i,c,l,s,o,r,b,H,G,j,le,$,ue,P,L,ae,q,J,ie,de,be,ne,oe,Ce,De,Te,Pe,Ye,xe,Y,he,ye,Fe,$e,it,et,at,yt,Et,Ze,st,Mt,St,Bt,At,Vt]}class xl extends ut{constructor(e){super(),dt(this,e,Ql,Jl,rt,{selectedEffectId:12,selectedEnvelopeId:13,selectedTimelineEffectId:14,selectedTimelineEnvelopeId:15},null,[-1,-1,-1])}}function En(t){let e,n="×",l,r;return{c(){e=M("button"),e.textContent=n,this.h()},l(o){e=y(o,"BUTTON",{class:!0,title:!0,"aria-label":!0,"data-svelte-h":!0}),re(e)!=="svelte-v65pnz"&&(e.textContent=n),this.h()},h(){k(e,"class","pattern-card-delete svelte-1sc0z43"),k(e,"title","Delete pattern"),k(e,"aria-label","Delete pattern")},m(o,a){W(o,e,a),l||(r=X(e,"click",Xe(t[5])),l=!0)},p:We,d(o){o&&D(e),l=!1,r()}}}function $l(t){let e,n=t[0].instrumentType+"",l;return{c(){e=M("span"),l=ce(n),this.h()},l(r){e=y(r,"SPAN",{class:!0});var o=A(e);l=fe(o,n),o.forEach(D),this.h()},h(){k(e,"class","pattern-card-instrument svelte-1sc0z43")},m(r,o){W(r,e,o),C(e,l)},p(r,o){o&1&&n!==(n=r[0].instrumentType+"")&&Me(l,n)},d(r){r&&D(e)}}}function er(t){let e,n=t[0].instruments.length+"",l,r,o=t[0].instruments.length===1?"instrument":"instruments",a;return{c(){e=M("span"),l=ce(n),r=z(),a=ce(o),this.h()},l(s){e=y(s,"SPAN",{class:!0});var f=A(e);l=fe(f,n),r=R(f),a=fe(f,o),f.forEach(D),this.h()},h(){k(e,"class","pattern-card-instrument svelte-1sc0z43")},m(s,f){W(s,e,f),C(e,l),C(e,r),C(e,a)},p(s,f){f&1&&n!==(n=s[0].instruments.length+"")&&Me(l,n),f&1&&o!==(o=s[0].instruments.length===1?"instrument":"instruments")&&Me(a,o)},d(s){s&&D(e)}}}function tr(t){let e,n,l,r,o,a,s,f=t[0].name+"",u,_,h,p,b=t[2]&&En(t);function d(i,c){if(i[0].instruments&&i[0].instruments.length>0)return er;if(i[0].instrumentType)return $l}let T=d(t),g=T&&T(t);return{c(){e=M("div"),b&&b.c(),n=z(),l=M("div"),r=M("canvas"),o=z(),a=M("div"),s=M("h3"),u=ce(f),_=z(),g&&g.c(),this.h()},l(i){e=y(i,"DIV",{class:!0,role:!0,tabindex:!0});var c=A(e);b&&b.l(c),n=R(c),l=y(c,"DIV",{class:!0});var m=A(l);r=y(m,"CANVAS",{width:!0,height:!0,class:!0}),A(r).forEach(D),m.forEach(D),o=R(c),a=y(c,"DIV",{class:!0});var v=A(a);s=y(v,"H3",{class:!0});var w=A(s);u=fe(w,f),w.forEach(D),_=R(v),g&&g.l(v),v.forEach(D),c.forEach(D),this.h()},h(){k(r,"width",400),k(r,"height",300),k(r,"class","svelte-1sc0z43"),k(l,"class","pattern-card-preview svelte-1sc0z43"),k(s,"class","pattern-card-title svelte-1sc0z43"),k(a,"class","pattern-card-info svelte-1sc0z43"),k(e,"class","pattern-card svelte-1sc0z43"),k(e,"role","button"),k(e,"tabindex","0")},m(i,c){W(i,e,c),b&&b.m(e,null),C(e,n),C(e,l),C(l,r),t[6](r),C(e,o),C(e,a),C(a,s),C(s,u),C(a,_),g&&g.m(a,null),h||(p=[X(e,"click",function(){je(t[1])&&t[1].apply(this,arguments)}),X(e,"keydown",t[7])],h=!0)},p(i,[c]){t=i,t[2]?b?b.p(t,c):(b=En(t),b.c(),b.m(e,n)):b&&(b.d(1),b=null),c&1&&f!==(f=t[0].name+"")&&Me(u,f),T===(T=d(t))&&g?g.p(t,c):(g&&g.d(1),g=T&&T(t),g&&(g.c(),g.m(a,null)))},i:We,o:We,d(i){i&&D(e),b&&b.d(),t[6](null),g&&g.d(),h=!1,Le(p)}}}function wn(t){if(t.startsWith("#")){const e=parseInt(t.slice(1),16),n=e>>16&255,l=e>>8&255,r=e&255,o=Math.floor(n*.6+100*.4),a=Math.floor(l*.6+100*.4),s=Math.floor(r*.6+100*.4);return`rgb(${o}, ${a}, ${s})`}return t}function bt(t,e){if(t.startsWith("#")){const n=parseInt(t.slice(1),16),l=n>>16&255,r=n>>8&255,o=n&255;return`rgba(${l}, ${r}, ${o}, ${e})`}else if(t.startsWith("rgb(")){const n=t.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(n)return`rgba(${n[1]}, ${n[2]}, ${n[3]}, ${e})`}return t}function hl(t,e,n,l,r,o,a,s){const f=t.x||0,u=t.y||0;if(f===void 0||u===void 0||isNaN(f)||isNaN(u))return;const _=f*n+l,h=u*n+r,b=(a===0?50:18)*n;if(t.children&&t.children.length>0){const m=wn(o);e.strokeStyle=bt(m,.2),e.lineWidth=Math.max(.5,1*n),e.lineCap="round";for(const v of t.children){const w=(v.x||0)*n+l,E=(v.y||0)*n+r;v.x!==void 0&&v.y!==void 0&&!isNaN(v.x)&&!isNaN(v.y)&&(e.beginPath(),e.moveTo(_,h),e.lineTo(w,E),e.stroke()),hl(v,e,n,l,r,o,a+1,s)}}const d=t.velocity!==void 0&&t.velocity!==null&&t.children.length===0,T=d?t.velocity??1:1,g=wn(o);if(e.beginPath(),e.arc(_,h,b,0,Math.PI*2),d&&T<1){e.strokeStyle=bt(g,.3),e.lineWidth=Math.max(1,2*n),e.stroke();const m=b*2*T,v=h+b-m;if(e.save(),e.beginPath(),e.arc(_,h,b,0,Math.PI*2),e.clip(),a===0){const w=e.createLinearGradient(_,v,_,h+b);w.addColorStop(0,g),w.addColorStop(1,bt(g,.8)),e.fillStyle=w}else e.fillStyle=bt(g,.5);e.fillRect(_-b,v,b*2,m),e.restore()}else{if(a===0){const m=e.createRadialGradient(_-b*.2,h-b*.2,0,_,h,b);m.addColorStop(0,bt(g,1)),m.addColorStop(.7,g),m.addColorStop(1,bt(g,.8)),e.fillStyle=m}else e.fillStyle=bt(g,.5);e.fill()}e.strokeStyle=a===0?"rgba(255, 255, 255, 0.3)":"rgba(255, 255, 255, 0.2)",e.lineWidth=a===0?Math.max(1,2*n):Math.max(.5,1*n),e.stroke();let i;a===1&&t.children.length>0?i=t.children.length:i=t.division;const c=a===0?18*n:10*n;if(e.fillStyle=a===0?"#e8e8e8":"rgba(255, 255, 255, 0.8)",e.font=`${c}px -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(i.toString(),_,h),a===0&&s){const m=h+b+20*n,v=12*n;e.font=`${v}px -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`,e.fillStyle="#b0b0b0",e.textAlign="center",e.textBaseline="top";const w=s.charAt(0).toUpperCase()+s.slice(1);e.fillText(w,_,m)}}function nr(t){return t.instruments&&Array.isArray(t.instruments)&&t.instruments.length>0?t.instruments:t.instrumentType&&t.patternTree?[{id:t.id,instrumentType:t.instrumentType,patternTree:t.patternTree,settings:t.settings||{},instrumentSettings:t.instrumentSettings,color:t.color||"#7ab8ff",volume:t.volume??1,pan:t.pan??0,mute:t.mute,solo:t.solo}]:[]}function lr(t,e,n){let{pattern:l}=e,{onClick:r}=e,{onDelete:o=null}=e,a,s=null;const f=h=>{h.preventDefault(),h.stopPropagation(),o&&o(l.id)};function u(h){Ct[h?"unshift":"push"](()=>{a=h,n(3,a)})}const _=h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),r())};return t.$$set=h=>{"pattern"in h&&n(0,l=h.pattern),"onClick"in h&&n(1,r=h.onClick),"onDelete"in h&&n(2,o=h.onDelete)},t.$$.update=()=>{if(t.$$.dirty&25&&a&&l&&(n(4,s=a.getContext("2d")),s)){s.clearRect(0,0,a.width,a.height),n(4,s.fillStyle="#1a1a1a",s),s.fillRect(0,0,a.width,a.height);const h=nr(l);if(h.length>0){let p=function(c){const m=c.x||0,v=c.y||0;if(m!==void 0&&v!==void 0&&!isNaN(m)&&!isNaN(v)&&(i=!0,b=Math.min(b,m),d=Math.max(d,m),T=Math.min(T,v),g=Math.max(g,v)),c.children&&c.children.length>0)for(const w of c.children)p(w)},b=1/0,d=-1/0,T=1/0,g=-1/0,i=!1;for(const c of h)c.patternTree&&p(c.patternTree);if(i&&b!==1/0&&d!==-1/0){const c=d-b,m=g-T,v=.2,w=30,E=Math.max(w,c*v),I=Math.max(w,m*v),V=c+E*2,N=m+I*2,H=a.width,G=a.height,j=10,le=H-j*2,$=G-j*2,ue=le/V,P=$/N,L=Math.min(ue,P),ae=V*L,q=N*L,J=(H-ae)/2-(b-E)*L,ie=(G-q)/2-(T-I)*L;for(const de of h)de.patternTree&&hl(de.patternTree,s,L,J,ie,de.color||"#7ab8ff",0,de.instrumentType)}}}},[l,r,o,a,s,f,u,_]}class rr extends ut{constructor(e){super(),dt(this,e,lr,tr,rt,{pattern:0,onClick:1,onDelete:2})}}function ar(t){let e,n,l,r,o="📈",a,s,f=t[0].label+"",u,_,h,p,b="Clear",d,T,g="×",i,c,m,v,w,E,I,V=t[2].toFixed(1)+"",N,H,G=t[3].toFixed(1)+"",j,le,$,ue,P=t[5].toFixed(2)+"",L,ae,q=t[4].toFixed(2)+"",J,ie,de,be,ne=t[6].length+"",oe,Ce,De;return{c(){e=M("div"),n=M("div"),l=M("div"),r=M("span"),r.textContent=o,a=z(),s=M("span"),u=ce(f),_=z(),h=M("div"),p=M("button"),p.textContent=b,d=z(),T=M("button"),T.textContent=g,i=z(),c=M("div"),m=M("canvas"),v=z(),w=M("div"),E=M("span"),I=ce("Beats: "),N=ce(V),H=ce(" - "),j=ce(G),le=z(),$=M("span"),ue=ce("Value: "),L=ce(P),ae=ce(" - "),J=ce(q),ie=z(),de=M("span"),be=ce("Points: "),oe=ce(ne),this.h()},l(Te){e=y(Te,"DIV",{class:!0});var Pe=A(e);n=y(Pe,"DIV",{class:!0});var Ye=A(n);l=y(Ye,"DIV",{class:!0});var xe=A(l);r=y(xe,"SPAN",{class:!0,"data-svelte-h":!0}),re(r)!=="svelte-1hnspyf"&&(r.textContent=o),a=R(xe),s=y(xe,"SPAN",{});var Y=A(s);u=fe(Y,f),Y.forEach(D),xe.forEach(D),_=R(Ye),h=y(Ye,"DIV",{class:!0});var he=A(h);p=y(he,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),re(p)!=="svelte-1abnc5a"&&(p.textContent=b),d=R(he),T=y(he,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),re(T)!=="svelte-7arj6m"&&(T.textContent=g),he.forEach(D),Ye.forEach(D),i=R(Pe),c=y(Pe,"DIV",{class:!0});var ye=A(c);m=y(ye,"CANVAS",{class:!0,style:!0}),A(m).forEach(D),v=R(ye),w=y(ye,"DIV",{class:!0});var Fe=A(w);E=y(Fe,"SPAN",{});var $e=A(E);I=fe($e,"Beats: "),N=fe($e,V),H=fe($e," - "),j=fe($e,G),$e.forEach(D),le=R(Fe),$=y(Fe,"SPAN",{});var it=A($);ue=fe(it,"Value: "),L=fe(it,P),ae=fe(it," - "),J=fe(it,q),it.forEach(D),ie=R(Fe),de=y(Fe,"SPAN",{});var et=A(de);be=fe(et,"Points: "),oe=fe(et,ne),et.forEach(D),Fe.forEach(D),ye.forEach(D),Pe.forEach(D),this.h()},h(){k(r,"class","automation-icon"),k(l,"class","automation-window-title"),k(p,"class","clear-btn"),k(p,"title","Clear automation"),k(T,"class","close-btn"),k(T,"title","Close"),k(h,"class","automation-window-controls"),k(n,"class","automation-window-header"),k(m,"class","automation-canvas"),x(m,"height",kt+"px"),k(w,"class","automation-info"),k(c,"class","automation-window-content"),k(e,"class","automation-window")},m(Te,Pe){W(Te,e,Pe),C(e,n),C(n,l),C(l,r),C(l,a),C(l,s),C(s,u),C(n,_),C(n,h),C(h,p),C(h,d),C(h,T),C(e,i),C(e,c),C(c,m),t[21](m),C(c,v),C(c,w),C(w,E),C(E,I),C(E,N),C(E,H),C(E,j),C(w,le),C(w,$),C($,ue),C($,L),C($,ae),C($,J),C(w,ie),C(w,de),C(de,be),C(de,oe),Ce||(De=[X(p,"click",t[11]),X(T,"click",t[20]),X(m,"mousedown",t[7]),X(m,"mousemove",t[9]),X(m,"mouseup",t[10]),X(m,"mouseleave",t[10]),X(m,"contextmenu",t[8])],Ce=!0)},p(Te,Pe){Pe[0]&1&&f!==(f=Te[0].label+"")&&Me(u,f),Pe[0]&4&&V!==(V=Te[2].toFixed(1)+"")&&Me(N,V),Pe[0]&8&&G!==(G=Te[3].toFixed(1)+"")&&Me(j,G),Pe[0]&32&&P!==(P=Te[5].toFixed(2)+"")&&Me(L,P),Pe[0]&16&&q!==(q=Te[4].toFixed(2)+"")&&Me(J,q),Pe[0]&64&&ne!==(ne=Te[6].length+"")&&Me(oe,ne)},i:We,o:We,d(Te){Te&&D(e),t[21](null),Ce=!1,Le(De)}}}let kt=200;function or(t,e,n){let l,r,o,a,s,f,u,_;mt(t,Q,q=>n(19,_=q));let{automationWindow:h}=e,p,b,d=null,T=!1,g=null,i=null,c=0,m=32,v=0;Ut(()=>{b&&(n(13,d=b.getContext("2d")),w(),H());const q=new ResizeObserver(()=>{w()});b&&q.observe(b);const J=()=>{T&&$()};return typeof window<"u"&&window.addEventListener("mouseup",J),()=>{q.disconnect(),typeof window<"u"&&window.removeEventListener("mouseup",J),T&&Q.endBatch()}});function w(){if(!b)return;const J=b.getBoundingClientRect().width;J!==v&&(v=J,n(1,b.width=v,b),n(1,b.height=kt,b))}function E(q){return(q-c)/(m-c)*v}function I(q){const J=(q-o)/(a-o);return kt-J*kt}function V(q){return c+q/v*(m-c)}function N(q){const J=1-q/kt;return o+J*(a-o)}function H(){if(!(!d||!b)){d.clearRect(0,0,b.width,b.height),n(13,d.strokeStyle="rgba(255, 255, 255, 0.1)",d),n(13,d.lineWidth=1,d);for(let q=Math.ceil(c);q<=m;q++){const J=E(q);d.beginPath(),d.moveTo(J,0),d.lineTo(J,kt),d.stroke()}for(let q=0;q<=10;q++){const J=o+q/10*(a-o),ie=I(J);d.beginPath(),d.moveTo(0,ie),d.lineTo(v,ie),d.stroke()}if(s.length>0){n(13,d.strokeStyle="#7ab8ff",d),n(13,d.lineWidth=2,d),d.beginPath();const q=[...s].sort((J,ie)=>J.beat-ie.beat);for(let J=0;J<q.length;J++){const ie=q[J],de=E(ie.beat),be=I(ie.value);J===0?d.moveTo(de,be):d.lineTo(de,be)}d.stroke(),q.forEach((J,ie)=>{const de=E(J.beat),be=I(J.value),ne=i===ie,oe=g===ie;n(13,d.fillStyle=oe?"#00ff88":ne?"#5a9eff":"#7ab8ff",d),d.beginPath(),d.arc(de,be,ne||oe?6:4,0,Math.PI*2),d.fill(),n(13,d.strokeStyle="#ffffff",d),n(13,d.lineWidth=1,d),d.stroke()})}else n(13,d.fillStyle="rgba(255, 255, 255, 0.3)",d),n(13,d.font="14px sans-serif",d),n(13,d.textAlign="center",d),d.fillText("Click to add automation points",v/2,kt/2)}}function G(q){if(!b||!d||q.button===2)return;const J=b.getBoundingClientRect(),ie=q.clientX-J.left,de=q.clientY-J.top,be=[...s].sort((Ce,De)=>Ce.beat-De.beat);for(let Ce=0;Ce<be.length;Ce++){const De=be[Ce],Te=E(De.beat),Pe=I(De.value);if(Math.sqrt((ie-Te)**2+(de-Pe)**2)<10){g=Ce,T=!0,Q.startBatch(),H();return}}const ne=Math.max(c,Math.min(m,V(ie))),oe=Math.max(o,Math.min(a,N(de)));l?Q.addAutomationPoint(h.targetType,h.targetId,h.parameterKey,{beat:ne,value:oe},h.timelineInstanceId):Q.setParameterAutomation({targetType:h.targetType,targetId:h.targetId,parameterKey:h.parameterKey,timelineInstanceId:h.timelineInstanceId,points:[{beat:ne,value:oe}],min:o,max:a},h.timelineInstanceId)}function j(q){if(!b||!d)return;q.preventDefault();const J=b.getBoundingClientRect(),ie=q.clientX-J.left,de=q.clientY-J.top,be=[...s].sort((ne,oe)=>ne.beat-oe.beat);for(let ne=0;ne<be.length;ne++){const oe=be[ne],Ce=E(oe.beat),De=I(oe.value);if(Math.sqrt((ie-Ce)**2+(de-De)**2)<10){const Pe=s.findIndex(Ye=>Ye.beat===oe.beat&&Ye.value===oe.value);Pe>=0&&Q.removeAutomationPoint(h.targetType,h.targetId,h.parameterKey,Pe,h.timelineInstanceId);return}}}function le(q){if(!b||!d)return;const J=b.getBoundingClientRect(),ie=q.clientX-J.left,de=q.clientY-J.top;if(T&&g!==null){const ne=[...s].sort((Te,Pe)=>Te.beat-Pe.beat)[g],oe=Math.max(c,Math.min(m,V(ie))),Ce=Math.max(o,Math.min(a,N(de))),De=s.findIndex(Te=>Te.beat===ne.beat&&Te.value===ne.value);De>=0&&(Q.updateAutomationPoint(h.targetType,h.targetId,h.parameterKey,De,{beat:oe,value:Ce},h.timelineInstanceId),H())}else{const be=[...s].sort((oe,Ce)=>oe.beat-Ce.beat);let ne=null;for(let oe=0;oe<be.length;oe++){const Ce=be[oe],De=E(Ce.beat),Te=I(Ce.value);if(Math.sqrt((ie-De)**2+(de-Te)**2)<10){ne=oe;break}}ne!==i&&(i=ne,H())}}function $(){T&&(T=!1,g=null,Q.endBatch())}function ue(){l&&Q.deleteParameterAutomation(h.targetType,h.targetId,h.parameterKey,h.timelineInstanceId)}let P=0;const L=()=>Rt.closeWindow(h.id);function ae(q){Ct[q?"unshift":"push"](()=>{b=q,n(1,b)})}return t.$$set=q=>{"automationWindow"in q&&n(0,h=q.automationWindow)},t.$$.update=()=>{var q,J;t.$$.dirty[0]&524288&&n(12,p=_),t.$$.dirty[0]&4097&&n(16,l=(()=>{if(!p||!p.automation)return null;const ie=h.timelineInstanceId?`${h.targetType}:${h.targetId}:${h.timelineInstanceId}:${h.parameterKey}`:`${h.targetType}:${h.targetId}:${h.parameterKey}`;return p.automation[ie]||null})()),t.$$.dirty[0]&4097&&n(18,r=(()=>{var ie,de;return!h.timelineInstanceId||!(p!=null&&p.timeline)?null:h.targetType==="effect"?(ie=p.timeline.effects)==null?void 0:ie.find(be=>be.id===h.timelineInstanceId):(de=p.timeline.envelopes)==null?void 0:de.find(be=>be.id===h.timelineInstanceId)})()),t.$$.dirty[0]&266240&&(r?(n(2,c=r.startBeat||0),n(3,m=(r.startBeat||0)+(r.duration||32))):(n(2,c=0),n(3,m=((q=p==null?void 0:p.timeline)==null?void 0:q.totalLength)||32))),t.$$.dirty[0]&8,t.$$.dirty[0]&69633&&n(5,o=(()=>{var ie,de;if(h.targetType==="effect"){if((ie=p==null?void 0:p.effects)==null?void 0:ie.find(ne=>ne.id===h.targetId))return(l==null?void 0:l.min)??0}else if((de=p==null?void 0:p.envelopes)==null?void 0:de.find(ne=>ne.id===h.targetId))return(l==null?void 0:l.min)??0;return(l==null?void 0:l.min)??0})()),t.$$.dirty[0]&69633&&n(4,a=(()=>{var ie,de;if(h.targetType==="effect"){if((ie=p==null?void 0:p.effects)==null?void 0:ie.find(ne=>ne.id===h.targetId))return(l==null?void 0:l.max)??1}else if((de=p==null?void 0:p.envelopes)==null?void 0:de.find(ne=>ne.id===h.targetId))return(l==null?void 0:l.max)??1;return(l==null?void 0:l.max)??1})()),t.$$.dirty[0]&65536&&n(6,s=(l==null?void 0:l.points)||[]),t.$$.dirty[0]&64&&n(17,f=s?JSON.stringify(s):""),t.$$.dirty[0]&196668&&n(15,u=`${f}-${c}-${m}-${((J=l==null?void 0:l.points)==null?void 0:J.length)||0}-${o}-${a}`),t.$$.dirty[0]&57346&&b&&d&&u&&(cancelAnimationFrame(P),n(14,P=requestAnimationFrame(()=>{b&&d&&(w(),H())})))},[h,b,c,m,a,o,s,G,j,le,$,ue,p,d,P,u,l,f,r,_,L,ae]}class ir extends ut{constructor(e){super(),dt(this,e,or,ar,rt,{automationWindow:0},null,[-1,-1])}}function sr(t,e,n){let l=0,r=1;n==="pitch"&&(l=.5,r=.5);const o=e.startValue!==void 0&&e.startValue!==null?e.startValue:l,a=e.endValue!==void 0&&e.endValue!==null?e.endValue:r,s=e.curve||"linear";let u=e.reverse===!0?1-t:t,_;switch(s){case"exponential":_=o+(a-o)*((Math.exp(u*5)-1)/(Math.exp(5)-1));break;case"logarithmic":_=o+(a-o)*(Math.log(u*9+1)/Math.log(10));break;case"linear":default:_=o+(a-o)*u;break}return Math.max(0,Math.min(1,_))}function fr(t,e,n,l){if(!n||!n.settings)return"";const r=n.settings;let o=0,a=1;n.type==="pitch"&&(o=.5,a=.5);const s=r.startValue!==void 0&&r.startValue!==null?r.startValue:o,f=r.endValue!==void 0&&r.endValue!==null?r.endValue:a,u=e*(1-s),_=e*(1-f),h=Math.max(20,Math.floor(t/2)),p=[];for(let g=0;g<=h;g++){const i=g/h,c=sr(i,r,n.type),m=i*t,v=e*(1-c);p.push([m,v])}const b=Math.max(0,Math.min(e,u)),d=Math.max(0,Math.min(e,_));let T=`M 0 ${e}`;T+=` L 0 ${b}`;for(const[g,i]of p){const c=Math.max(0,Math.min(e,i));T+=` L ${g} ${c}`}return T+=` L ${t} ${d}`,T+=` L ${t} ${e} Z`,T}const ot={ROW_LABEL_WIDTH:200,BASE_ZOOM:8,BASE_PIXELS_PER_BEAT:4,RULER_HEIGHT:50,PATTERN_ROW_HEIGHT:80,BEATS_PER_BAR:4};function ct(t,e){return t*e}function cr(t,e){return t/e}function Qe(t){return Math.round(t*4)/4}function ur(t,e){return`${Math.round(t/e*100)}%`}function dr(t,e,n=.25,l=64){return Math.max(n,Math.min(l,t+e))}function _l(t,e){if(!t)return[];const n=[],{BEATS_PER_BAR:l}=ot;for(let r=0;r<=t;r+=1){const o=r%l===0,a=Math.floor(r/l),s=Math.floor(r%l);n.push({beat:r,x:r*e,isBar:o,isBeat:!0,barNumber:a,beatInBar:s})}return n}function ml(t,e){if(!t)return[];const n=[],{BEATS_PER_BAR:l}=ot;for(let r=0;r<=t;r+=1){const o=r%l===0;n.push({beat:r,x:r*e,isBar:o,isBeat:!0})}return n}function Dn(t,e,n){const l=t.slice();return l[20]=e[n],l}function hr(t){let e,n=t[20].name+"",l,r,o;function a(){return t[15](t[20])}function s(...f){return t[16](t[20],...f)}return{c(){e=M("span"),l=ce(n),this.h()},l(f){e=y(f,"SPAN",{class:!0,role:!0,tabindex:!0,"aria-label":!0,title:!0});var u=A(e);l=fe(u,n),u.forEach(D),this.h()},h(){k(e,"class","pattern-name"),k(e,"role","button"),k(e,"tabindex","0"),k(e,"aria-label","Double-click to rename pattern"),k(e,"title","Double-click to rename")},m(f,u){W(f,e,u),C(e,l),r||(o=[X(e,"dblclick",Xe(a)),X(e,"keydown",s)],r=!0)},p(f,u){t=f,u&2&&n!==(n=t[20].name+"")&&Me(l,n)},d(f){f&&D(e),r=!1,Le(o)}}}function _r(t){let e,n,l,r;function o(...a){return t[13](t[20],...a)}return{c(){e=M("input"),this.h()},l(a){e=y(a,"INPUT",{type:!0,class:!0}),this.h()},h(){k(e,"type","text"),k(e,"class","pattern-name-input-inline"),e.value=n=t[20].name},m(a,s){W(a,e,s),t[12](e),l||(r=[X(e,"blur",o),X(e,"keydown",t[14]),X(e,"click",Xe(t[11]))],l=!0)},p(a,s){t=a,s&2&&n!==(n=t[20].name)&&e.value!==n&&(e.value=n)},d(a){a&&D(e),t[12](null),l=!1,Le(r)}}}function In(t){let e,n,l,r,o,a=t[20].instrumentType+"",s,f,u,_="×",h,p,b,d;function T(w,E){return w[0]===w[20].id?_r:hr}let g=T(t),i=g(t);function c(){return t[17](t[20])}function m(){return t[18](t[20])}function v(...w){return t[19](t[20],...w)}return{c(){e=M("button"),n=M("div"),l=z(),i.c(),r=z(),o=M("span"),s=ce(a),f=z(),u=M("button"),u.textContent=_,this.h()},l(w){e=y(w,"BUTTON",{class:!0,draggable:!0,tabindex:!0});var E=A(e);n=y(E,"DIV",{class:!0,style:!0}),A(n).forEach(D),l=R(E),i.l(E),r=R(E),o=y(E,"SPAN",{class:!0});var I=A(o);s=fe(I,a),I.forEach(D),f=R(E),u=y(E,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),re(u)!=="svelte-1wnfonf"&&(u.textContent=_),E.forEach(D),this.h()},h(){k(n,"class","pattern-color"),x(n,"background",t[20].color),k(o,"class","pattern-instrument"),k(u,"class","pattern-delete"),k(u,"title","Delete pattern"),k(e,"class",h="pattern-item "+(t[9].url.pathname.includes(`/pattern/${t[20].id}`)?"active":"")),k(e,"draggable",p=t[3]==="arrangement"&&t[0]!==t[20].id),k(e,"tabindex","0")},m(w,E){W(w,e,E),C(e,n),C(e,l),i.m(e,null),C(e,r),C(e,o),C(o,s),C(e,f),C(e,u),b||(d=[X(u,"click",Xe(c)),X(e,"click",m),X(e,"dragstart",v)],b=!0)},p(w,E){t=w,E&2&&x(n,"background",t[20].color),g===(g=T(t))&&i?i.p(t,E):(i.d(1),i=g(t),i&&(i.c(),i.m(e,r))),E&2&&a!==(a=t[20].instrumentType+"")&&Me(s,a),E&514&&h!==(h="pattern-item "+(t[9].url.pathname.includes(`/pattern/${t[20].id}`)?"active":""))&&k(e,"class",h),E&11&&p!==(p=t[3]==="arrangement"&&t[0]!==t[20].id)&&k(e,"draggable",p)},d(w){w&&D(e),i.d(),b=!1,Le(d)}}}function Pn(t){let e,n="No patterns yet. Create one to get started!";return{c(){e=M("div"),e.textContent=n,this.h()},l(l){e=y(l,"DIV",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-1f2ld55"&&(e.textContent=n),this.h()},h(){k(e,"class","empty-state")},m(l,r){W(l,e,r)},d(l){l&&D(e)}}}function mr(t){let e,n,l,r="Patterns",o,a,s="+",f,u,_,h,p,b,d,T,g=we(t[1]),i=[];for(let m=0;m<g.length;m+=1)i[m]=In(Dn(t,g,m));let c=t[1].length===0&&Pn();return p=new Sl({props:{onDragStart:t[7]}}),{c(){e=M("div"),n=M("div"),l=M("h3"),l.textContent=r,o=z(),a=M("button"),a.textContent=s,f=z(),u=M("div");for(let m=0;m<i.length;m+=1)i[m].c();_=z(),c&&c.c(),h=z(),ve(p.$$.fragment),this.h()},l(m){e=y(m,"DIV",{class:!0,style:!0});var v=A(e);n=y(v,"DIV",{class:!0});var w=A(n);l=y(w,"H3",{"data-svelte-h":!0}),re(l)!=="svelte-y7hicb"&&(l.textContent=r),o=R(w),a=y(w,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),re(a)!=="svelte-qnytug"&&(a.textContent=s),w.forEach(D),f=R(v),u=y(v,"DIV",{class:!0});var E=A(u);for(let I=0;I<i.length;I+=1)i[I].l(E);_=R(E),c&&c.l(E),E.forEach(D),h=R(v),ge(p.$$.fragment,v),v.forEach(D),this.h()},h(){k(a,"class","create-pattern-btn"),k(a,"title","Create new pattern"),k(n,"class","sidebar-header"),k(u,"class","patterns-list"),k(e,"class","pattern-sidebar"),x(e,"width",t[2]+"px")},m(m,v){W(m,e,v),C(e,n),C(n,l),C(n,o),C(n,a),C(e,f),C(e,u);for(let w=0;w<i.length;w+=1)i[w]&&i[w].m(u,null);C(u,_),c&&c.m(u,null),C(e,h),pe(p,e,null),b=!0,d||(T=X(a,"click",function(){je(t[4])&&t[4].apply(this,arguments)}),d=!0)},p(m,[v]){if(t=m,v&1899){g=we(t[1]);let E;for(E=0;E<g.length;E+=1){const I=Dn(t,g,E);i[E]?i[E].p(I,v):(i[E]=In(I),i[E].c(),i[E].m(u,_))}for(;E<i.length;E+=1)i[E].d(1);i.length=g.length}t[1].length===0?c||(c=Pn(),c.c(),c.m(u,null)):c&&(c.d(1),c=null);const w={};v&128&&(w.onDragStart=t[7]),p.$set(w),(!b||v&4)&&x(e,"width",t[2]+"px")},i(m){b||(K(p.$$.fragment,m),b=!0)},o(m){Z(p.$$.fragment,m),b=!1},d(m){m&&D(e),Ge(i,m),c&&c.d(),me(p),d=!1,T()}}}function pr(t,e,n){let l;mt(t,en,I=>n(9,l=I));let{patterns:r}=e,{sidebarWidth:o}=e,{editingPatternId:a=null}=e,{viewMode:s}=e,{createPattern:f}=e,{deletePattern:u}=e,{selectPattern:_}=e,{handleEffectEnvelopeDragStart:h}=e,p=null;function b(I,V){s==="arrangement"&&I.dataTransfer&&(I.dataTransfer.effectAllowed="copy",I.dataTransfer.setData("text/plain",V),I.dataTransfer.setData("application/json",JSON.stringify({type:"pattern",id:V})))}function d(I){Tt.call(this,t,I)}function T(I){Ct[I?"unshift":"push"](()=>{p=I,n(8,p)})}const g=(I,V)=>{const N=V.currentTarget.value.trim()||I.name;Q.updatePattern(I.id,{name:N}),n(0,a=null)},i=I=>{I.key==="Enter"?I.currentTarget.blur():I.key==="Escape"&&n(0,a=null)},c=I=>n(0,a=I.id),m=(I,V)=>{(V.key==="Enter"||V.key===" ")&&(V.preventDefault(),n(0,a=I.id))},v=I=>u(I.id),w=I=>{a!==I.id&&_(I.id)},E=(I,V)=>{a!==I.id&&b(V,I.id)};return t.$$set=I=>{"patterns"in I&&n(1,r=I.patterns),"sidebarWidth"in I&&n(2,o=I.sidebarWidth),"editingPatternId"in I&&n(0,a=I.editingPatternId),"viewMode"in I&&n(3,s=I.viewMode),"createPattern"in I&&n(4,f=I.createPattern),"deletePattern"in I&&n(5,u=I.deletePattern),"selectPattern"in I&&n(6,_=I.selectPattern),"handleEffectEnvelopeDragStart"in I&&n(7,h=I.handleEffectEnvelopeDragStart)},t.$$.update=()=>{t.$$.dirty&257&&a&&p&&setTimeout(()=>p==null?void 0:p.focus(),0)},[a,r,o,s,f,u,_,h,p,l,b,d,T,g,i,c,m,v,w,E]}class gr extends ut{constructor(e){super(),dt(this,e,pr,mr,rt,{patterns:1,sidebarWidth:2,editingPatternId:0,viewMode:3,createPattern:4,deletePattern:5,selectPattern:6,handleEffectEnvelopeDragStart:7})}}function yn(t,e,n){const l=t.slice();return l[13]=e[n],l}function Mn(t){let e,n,l;return{c(){e=M("div"),n=ce(t[6]),this.h()},l(r){e=y(r,"DIV",{class:!0,title:!0});var o=A(e);n=fe(o,t[6]),o.forEach(D),this.h()},h(){k(e,"class","zoom-indicator"),k(e,"title",l="Zoom: "+t[6]+" (Ctrl+Wheel to zoom)")},m(r,o){W(r,e,o),C(e,n)},p(r,o){o&64&&Me(n,r[6]),o&64&&l!==(l="Zoom: "+r[6]+" (Ctrl+Wheel to zoom)")&&k(e,"title",l)},d(r){r&&D(e)}}}function Sn(t){let e,n,l="Pattern Track",r,o,a="Effect Track",s,f,u="Envelope Track",_,h;return{c(){e=M("div"),n=M("button"),n.textContent=l,r=z(),o=M("button"),o.textContent=a,s=z(),f=M("button"),f.textContent=u,this.h()},l(p){e=y(p,"DIV",{class:!0});var b=A(e);n=y(b,"BUTTON",{"data-svelte-h":!0}),re(n)!=="svelte-5byxaf"&&(n.textContent=l),r=R(b),o=y(b,"BUTTON",{"data-svelte-h":!0}),re(o)!=="svelte-1uprckr"&&(o.textContent=a),s=R(b),f=y(b,"BUTTON",{"data-svelte-h":!0}),re(f)!=="svelte-2k7w7x"&&(f.textContent=u),b.forEach(D),this.h()},h(){k(e,"class","add-track-menu")},m(p,b){W(p,e,b),C(e,n),C(e,r),C(e,o),C(e,s),C(e,f),_||(h=[X(n,"click",t[10]),X(o,"click",t[11]),X(f,"click",t[12])],_=!0)},p:We,d(p){p&&D(e),_=!1,Le(h)}}}function vr(t){let e,n=t[13].beatInBar+1+"",l;return{c(){e=M("span"),l=ce(n),this.h()},l(r){e=y(r,"SPAN",{class:!0});var o=A(e);l=fe(o,n),o.forEach(D),this.h()},h(){k(e,"class","ruler-label beat-label")},m(r,o){W(r,e,o),C(e,l)},p(r,o){o&128&&n!==(n=r[13].beatInBar+1+"")&&Me(l,n)},d(r){r&&D(e)}}}function br(t){let e,n=t[13].barNumber+1+"",l;return{c(){e=M("span"),l=ce(n),this.h()},l(r){e=y(r,"SPAN",{class:!0});var o=A(e);l=fe(o,n),o.forEach(D),this.h()},h(){k(e,"class","ruler-label bar-label")},m(r,o){W(r,e,o),C(e,l)},p(r,o){o&128&&n!==(n=r[13].barNumber+1+"")&&Me(l,n)},d(r){r&&D(e)}}}function Bn(t){let e,n,l;function r(s,f){if(s[13].isBar)return br;if(s[13].beatInBar>0)return vr}let o=r(t),a=o&&o(t);return{c(){e=M("div"),a&&a.c(),n=z(),this.h()},l(s){e=y(s,"DIV",{class:!0,style:!0});var f=A(e);a&&a.l(f),n=R(f),f.forEach(D),this.h()},h(){k(e,"class",l="ruler-mark "+(t[13].isBar?"bar":"beat")),x(e,"left",t[13].x+"px")},m(s,f){W(s,e,f),a&&a.m(e,null),C(e,n)},p(s,f){o===(o=r(s))&&a?a.p(s,f):(a&&a.d(1),a=o&&o(s),a&&(a.c(),a.m(e,n))),f&128&&l!==(l="ruler-mark "+(s[13].isBar?"bar":"beat"))&&k(e,"class",l),f&128&&x(e,"left",s[13].x+"px")},d(s){s&&D(e),a&&a.d()}}}function kr(t){let e,n,l=Math.round(t[2]/ot.BASE_ZOOM*100)!==100,r,o,a,s="+ Add Track",f,u,_,h,p,b=l&&Mn(t),d=t[3]&&Sn(t),T=we(t[7]),g=[];for(let i=0;i<T.length;i+=1)g[i]=Bn(yn(t,T,i));return{c(){e=M("div"),n=M("div"),b&&b.c(),r=z(),o=M("div"),a=M("span"),a.textContent=s,f=z(),d&&d.c(),u=z(),_=M("div");for(let i=0;i<g.length;i+=1)g[i].c();this.h()},l(i){e=y(i,"DIV",{class:!0});var c=A(e);n=y(c,"DIV",{class:!0,style:!0});var m=A(n);b&&b.l(m),r=R(m),o=y(m,"DIV",{class:!0});var v=A(o);a=y(v,"SPAN",{class:!0,role:!0,tabindex:!0,"data-svelte-h":!0}),re(a)!=="svelte-1b9cssx"&&(a.textContent=s),f=R(v),d&&d.l(v),v.forEach(D),m.forEach(D),u=R(c),_=y(c,"DIV",{class:!0,style:!0});var w=A(_);for(let E=0;E<g.length;E+=1)g[E].l(w);w.forEach(D),c.forEach(D),this.h()},h(){k(a,"class","add-track-trigger"),k(a,"role","button"),k(a,"tabindex","0"),k(o,"class","add-track-dropdown-ruler"),k(n,"class","ruler-label-spacer"),x(n,"width",ot.ROW_LABEL_WIDTH+"px"),k(_,"class","timeline-ruler"),x(_,"height",ot.RULER_HEIGHT+"px"),x(_,"width",ct(t[0],t[1])+"px"),k(e,"class","timeline-ruler-container")},m(i,c){W(i,e,c),C(e,n),b&&b.m(n,null),C(n,r),C(n,o),C(o,a),C(o,f),d&&d.m(o,null),C(e,u),C(e,_);for(let m=0;m<g.length;m+=1)g[m]&&g[m].m(_,null);h||(p=[X(a,"click",function(){je(t[5])&&t[5].apply(this,arguments)}),X(a,"keydown",t[9])],h=!0)},p(i,[c]){if(t=i,c&4&&(l=Math.round(t[2]/ot.BASE_ZOOM*100)!==100),l?b?b.p(t,c):(b=Mn(t),b.c(),b.m(n,r)):b&&(b.d(1),b=null),t[3]?d?d.p(t,c):(d=Sn(t),d.c(),d.m(o,null)):d&&(d.d(1),d=null),c&128){T=we(t[7]);let m;for(m=0;m<T.length;m+=1){const v=yn(t,T,m);g[m]?g[m].p(v,c):(g[m]=Bn(v),g[m].c(),g[m].m(_,null))}for(;m<g.length;m+=1)g[m].d(1);g.length=T.length}c&3&&x(_,"width",ct(t[0],t[1])+"px")},i:We,o:We,d(i){i&&D(e),b&&b.d(),d&&d.d(),Ge(g,i),h=!1,Le(p)}}}function Tr(t,e,n){let l,r,{totalLength:o}=e,{pixelsPerBeat:a}=e,{zoomLevel:s}=e,{showAddTrackMenu:f}=e,{onZoomWheel:u=()=>{}}=e,{onCreateTrack:_}=e,{onToggleAddTrackMenu:h}=e;const p=g=>{(g.key==="Enter"||g.key===" ")&&(g.preventDefault(),h())},b=()=>_("pattern"),d=()=>_("effect"),T=()=>_("envelope");return t.$$set=g=>{"totalLength"in g&&n(0,o=g.totalLength),"pixelsPerBeat"in g&&n(1,a=g.pixelsPerBeat),"zoomLevel"in g&&n(2,s=g.zoomLevel),"showAddTrackMenu"in g&&n(3,f=g.showAddTrackMenu),"onZoomWheel"in g&&n(8,u=g.onZoomWheel),"onCreateTrack"in g&&n(4,_=g.onCreateTrack),"onToggleAddTrackMenu"in g&&n(5,h=g.onToggleAddTrackMenu)},t.$$.update=()=>{t.$$.dirty&3&&n(7,l=_l(o,a)),t.$$.dirty&4&&n(6,r=ur(s,ot.BASE_ZOOM))},[o,a,s,f,_,h,r,l,u,p,b,d,T]}class Cr extends ut{constructor(e){super(),dt(this,e,Tr,kr,rt,{totalLength:0,pixelsPerBeat:1,zoomLevel:2,showAddTrackMenu:3,onZoomWheel:8,onCreateTrack:4,onToggleAddTrackMenu:5})}}function An(t){let e,n,l,r,o=t[0].name+"",a,s,f,u,_,h,p;return{c(){e=M("div"),n=M("div"),l=z(),r=M("span"),a=ce(o),s=z(),f=M("div"),this.h()},l(b){e=y(b,"DIV",{class:!0,style:!0,role:!0,tabindex:!0,"aria-label":!0,title:!0});var d=A(e);n=y(d,"DIV",{class:!0,title:!0}),A(n).forEach(D),l=R(d),r=y(d,"SPAN",{class:!0});var T=A(r);a=fe(T,o),T.forEach(D),s=R(d),f=y(d,"DIV",{class:!0,title:!0}),A(f).forEach(D),d.forEach(D),this.h()},h(){k(n,"class","clip-resize-handle-left"),k(n,"title","Drag to resize left edge"),k(r,"class","clip-label"),k(f,"class","clip-resize-handle-right"),k(f,"title","Drag to resize right edge"),k(e,"class",u="timeline-clip "+(t[1]?"dragging":"")+" "+(t[2]?"greyed-out":"")),x(e,"left",t[7]+"px"),x(e,"width",t[6]+"px"),x(e,"background",(t[2]?"#666666":t[0].color)+"CC"),x(e,"border-color",t[2]?"#666666":t[0].color),x(e,"opacity",t[2]?.5:1),k(e,"role","button"),k(e,"tabindex","0"),k(e,"aria-label",_="Timeline clip: "+t[0].name),k(e,"title","Right-click to delete")},m(b,d){W(b,e,d),C(e,n),C(e,l),C(e,r),C(r,a),C(e,s),C(e,f),h||(p=[X(e,"mousedown",function(){je(t[3])&&t[3].apply(this,arguments)}),X(e,"click",Xe(function(){je(t[4])&&t[4].apply(this,arguments)})),X(e,"keydown",t[11]),X(e,"contextmenu",Xe(function(){je(t[5])&&t[5].apply(this,arguments)}))],h=!0)},p(b,d){t=b,d&1&&o!==(o=t[0].name+"")&&Me(a,o),d&6&&u!==(u="timeline-clip "+(t[1]?"dragging":"")+" "+(t[2]?"greyed-out":""))&&k(e,"class",u),d&128&&x(e,"left",t[7]+"px"),d&64&&x(e,"width",t[6]+"px"),d&5&&x(e,"background",(t[2]?"#666666":t[0].color)+"CC"),d&5&&x(e,"border-color",t[2]?"#666666":t[0].color),d&4&&x(e,"opacity",t[2]?.5:1),d&1&&_!==(_="Timeline clip: "+t[0].name)&&k(e,"aria-label",_)},d(b){b&&D(e),h=!1,Le(p)}}}function Er(t){let e,n=t[0]&&An(t);return{c(){n&&n.c(),e=Ee()},l(l){n&&n.l(l),e=Ee()},m(l,r){n&&n.m(l,r),W(l,e,r)},p(l,[r]){l[0]?n?n.p(l,r):(n=An(l),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},i:We,o:We,d(l){l&&D(e),n&&n.d(l)}}}function wr(t,e,n){let l,r,{clip:o}=e,{pattern:a}=e,{pixelsPerBeat:s}=e,{isDragging:f}=e,{isGreyedOut:u}=e,{onMouseDown:_}=e,{onClick:h}=e,{onContextMenu:p}=e;const b=()=>{},d=T=>{T.key==="Enter"||T.key===" "?(T.preventDefault(),h(T)):(T.key==="Delete"||T.key==="Backspace")&&(T.preventDefault(),p(T))};return t.$$set=T=>{"clip"in T&&n(8,o=T.clip),"pattern"in T&&n(0,a=T.pattern),"pixelsPerBeat"in T&&n(9,s=T.pixelsPerBeat),"isDragging"in T&&n(1,f=T.isDragging),"isGreyedOut"in T&&n(2,u=T.isGreyedOut),"onMouseDown"in T&&n(3,_=T.onMouseDown),"onClick"in T&&n(4,h=T.onClick),"onContextMenu"in T&&n(5,p=T.onContextMenu)},t.$$.update=()=>{t.$$.dirty&768&&n(7,l=ct(o.startBeat,s)),t.$$.dirty&768&&n(6,r=Math.max(20,ct(o.duration,s)))},[a,f,u,_,h,p,r,l,o,s,b,d]}class Dr extends ut{constructor(e){super(),dt(this,e,wr,Er,rt,{clip:8,pattern:0,pixelsPerBeat:9,isDragging:1,isGreyedOut:2,onMouseDown:3,onClick:4,onContextMenu:5,onDelete:10})}get onDelete(){return this.$$.ctx[10]}}function Vn(t,e,n){const l=t.slice();l[15]=e[n];const r=Bl(l[11],l[10],l[15].automation,l[0].startBeat,l[0].duration);return l[16]=r,l}function Nn(t){let e,n=we(t[5]),l=[];for(let r=0;r<n.length;r+=1)l[r]=Ln(Vn(t,n,r));return{c(){e=gt("svg");for(let r=0;r<l.length;r+=1)l[r].c();this.h()},l(r){e=pt(r,"svg",{class:!0,width:!0,height:!0,style:!0});var o=A(e);for(let a=0;a<l.length;a+=1)l[a].l(o);o.forEach(D),this.h()},h(){k(e,"class","envelope-curve-visualization"),k(e,"width",t[11]),k(e,"height",t[10]),x(e,"position","absolute"),x(e,"top","0"),x(e,"left","0"),x(e,"pointer-events","none"),x(e,"z-index","1")},m(r,o){W(r,e,o);for(let a=0;a<l.length;a+=1)l[a]&&l[a].m(e,null)},p(r,o){if(o&3107){n=we(r[5]);let a;for(a=0;a<n.length;a+=1){const s=Vn(r,n,a);l[a]?l[a].p(s,o):(l[a]=Ln(s),l[a].c(),l[a].m(e,null))}for(;a<l.length;a+=1)l[a].d(1);l.length=n.length}o&2048&&k(e,"width",r[11]),o&1024&&k(e,"height",r[10])},d(r){r&&D(e),Ge(l,r)}}}function On(t){let e,n,l;return{c(){e=gt("path"),this.h()},l(r){e=pt(r,"path",{d:!0,fill:!0,"fill-opacity":!0}),A(e).forEach(D),this.h()},h(){k(e,"d",n=t[16]),k(e,"fill",l=t[1].color),k(e,"fill-opacity","0.5")},m(r,o){W(r,e,o)},p(r,o){o&3105&&n!==(n=r[16])&&k(e,"d",n),o&2&&l!==(l=r[1].color)&&k(e,"fill",l)},d(r){r&&D(e)}}}function Ln(t){let e,n=t[16]&&On(t);return{c(){n&&n.c(),e=Ee()},l(l){n&&n.l(l),e=Ee()},m(l,r){n&&n.m(l,r),W(l,e,r)},p(l,r){l[16]?n?n.p(l,r):(n=On(l),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d(l){l&&D(e),n&&n.d(l)}}}function Ir(t){let e,n="Global";return{c(){e=M("span"),e.textContent=n,this.h()},l(l){e=y(l,"SPAN",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-1fp1kt"&&(e.textContent=n),this.h()},h(){k(e,"class","pattern-badge global")},m(l,r){W(l,e,r)},p:We,d(l){l&&D(e)}}}function Pr(t){let e,n,l=t[2].name+"",r;return{c(){e=M("span"),n=ce("→ "),r=ce(l),this.h()},l(o){e=y(o,"SPAN",{class:!0});var a=A(e);n=fe(a,"→ "),r=fe(a,l),a.forEach(D),this.h()},h(){k(e,"class","pattern-badge")},m(o,a){W(o,e,a),C(e,n),C(e,r)},p(o,a){a&4&&l!==(l=o[2].name+"")&&Me(r,l)},d(o){o&&D(e)}}}function yr(t){let e,n,l,r,o,a=t[1].name+"",s,f,u,_,h,p,b,d=t[5].length>0&&Nn(t);function T(c,m){return c[2]?Pr:Ir}let g=T(t),i=g(t);return{c(){e=M("div"),d&&d.c(),n=z(),l=M("div"),r=z(),o=M("span"),s=ce(a),f=z(),i.c(),u=z(),_=M("div"),this.h()},l(c){e=y(c,"DIV",{class:!0,style:!0,role:!0,tabindex:!0,title:!0});var m=A(e);d&&d.l(m),n=R(m),l=y(m,"DIV",{class:!0,title:!0}),A(l).forEach(D),r=R(m),o=y(m,"SPAN",{class:!0});var v=A(o);s=fe(v,a),f=R(v),i.l(v),v.forEach(D),u=R(m),_=y(m,"DIV",{class:!0,title:!0}),A(_).forEach(D),m.forEach(D),this.h()},h(){k(l,"class","clip-resize-handle-left"),k(l,"title","Drag to resize left edge"),k(o,"class","clip-label"),k(_,"class","clip-resize-handle-right"),k(_,"title","Drag to resize right edge"),k(e,"class",h="timeline-clip timeline-effect "+(t[3]?"selected":"")+" "+(t[4]?"dragging":"")),x(e,"left",t[12]+"px"),x(e,"width",t[11]+"px"),x(e,"background",t[1].color+"80"),x(e,"border-color",t[1].color),k(e,"role","button"),k(e,"tabindex","0"),k(e,"title","Right-click to delete")},m(c,m){W(c,e,m),d&&d.m(e,null),C(e,n),C(e,l),C(e,r),C(e,o),C(o,s),C(o,f),i.m(o,null),C(e,u),C(e,_),p||(b=[X(e,"mousedown",function(){je(t[6])&&t[6].apply(this,arguments)}),X(e,"click",function(){je(t[7])&&t[7].apply(this,arguments)}),X(e,"keydown",function(){je(t[8])&&t[8].apply(this,arguments)}),X(e,"contextmenu",Xe(function(){je(t[9])&&t[9].apply(this,arguments)}))],p=!0)},p(c,[m]){t=c,t[5].length>0?d?d.p(t,m):(d=Nn(t),d.c(),d.m(e,n)):d&&(d.d(1),d=null),m&2&&a!==(a=t[1].name+"")&&Me(s,a),g===(g=T(t))&&i?i.p(t,m):(i.d(1),i=g(t),i&&(i.c(),i.m(o,null))),m&24&&h!==(h="timeline-clip timeline-effect "+(t[3]?"selected":"")+" "+(t[4]?"dragging":""))&&k(e,"class",h),m&4096&&x(e,"left",t[12]+"px"),m&2048&&x(e,"width",t[11]+"px"),m&2&&x(e,"background",t[1].color+"80"),m&2&&x(e,"border-color",t[1].color)},i:We,o:We,d(c){c&&D(e),d&&d.d(),i.d(),p=!1,Le(b)}}}function Mr(t,e,n){let l,r,o,{timelineEffect:a}=e,{effect:s}=e,{assignedPattern:f}=e,{pixelsPerBeat:u}=e,{isSelected:_}=e,{isDragging:h}=e,{automationCurves:p}=e,{onMouseDown:b}=e,{onClick:d}=e,{onKeyDown:T}=e,{onContextMenu:g}=e;const i=()=>{};return t.$$set=c=>{"timelineEffect"in c&&n(0,a=c.timelineEffect),"effect"in c&&n(1,s=c.effect),"assignedPattern"in c&&n(2,f=c.assignedPattern),"pixelsPerBeat"in c&&n(13,u=c.pixelsPerBeat),"isSelected"in c&&n(3,_=c.isSelected),"isDragging"in c&&n(4,h=c.isDragging),"automationCurves"in c&&n(5,p=c.automationCurves),"onMouseDown"in c&&n(6,b=c.onMouseDown),"onClick"in c&&n(7,d=c.onClick),"onKeyDown"in c&&n(8,T=c.onKeyDown),"onContextMenu"in c&&n(9,g=c.onContextMenu)},t.$$.update=()=>{t.$$.dirty&8193&&n(12,l=ct(a.startBeat,u)),t.$$.dirty&8193&&n(11,r=Math.max(20,ct(a.duration,u)))},n(10,o=ot.PATTERN_ROW_HEIGHT-18),[a,s,f,_,h,p,b,d,T,g,o,r,l,u,i]}class Sr extends ut{constructor(e){super(),dt(this,e,Mr,yr,rt,{timelineEffect:0,effect:1,assignedPattern:2,pixelsPerBeat:13,isSelected:3,isDragging:4,automationCurves:5,onMouseDown:6,onClick:7,onKeyDown:8,onContextMenu:9,onDelete:14})}get onDelete(){return this.$$.ctx[14]}}function Br(t){let e,n="Global";return{c(){e=M("span"),e.textContent=n,this.h()},l(l){e=y(l,"SPAN",{class:!0,"data-svelte-h":!0}),re(e)!=="svelte-1fp1kt"&&(e.textContent=n),this.h()},h(){k(e,"class","pattern-badge global")},m(l,r){W(l,e,r)},p:We,d(l){l&&D(e)}}}function Ar(t){let e,n,l=t[1].name+"",r;return{c(){e=M("span"),n=ce("→ "),r=ce(l),this.h()},l(o){e=y(o,"SPAN",{class:!0});var a=A(e);n=fe(a,"→ "),r=fe(a,l),a.forEach(D),this.h()},h(){k(e,"class","pattern-badge")},m(o,a){W(o,e,a),C(e,n),C(e,r)},p(o,a){a&2&&l!==(l=o[1].name+"")&&Me(r,l)},d(o){o&&D(e)}}}function Vr(t){let e,n,l,r,o,a,s,f,u=t[0].name+"",_,h,p,b,d,T,g;function i(v,w){return v[1]?Ar:Br}let c=i(t),m=c(t);return{c(){e=M("div"),n=gt("svg"),l=gt("path"),o=z(),a=M("div"),s=z(),f=M("span"),_=ce(u),h=z(),m.c(),p=z(),b=M("div"),this.h()},l(v){e=y(v,"DIV",{class:!0,style:!0,role:!0,tabindex:!0,title:!0});var w=A(e);n=pt(w,"svg",{class:!0,width:!0,height:!0,style:!0});var E=A(n);l=pt(E,"path",{d:!0,fill:!0,opacity:!0}),A(l).forEach(D),E.forEach(D),o=R(w),a=y(w,"DIV",{class:!0,title:!0}),A(a).forEach(D),s=R(w),f=y(w,"SPAN",{class:!0});var I=A(f);_=fe(I,u),h=R(I),m.l(I),I.forEach(D),p=R(w),b=y(w,"DIV",{class:!0,title:!0}),A(b).forEach(D),w.forEach(D),this.h()},h(){k(l,"d",t[10]),k(l,"fill",r=t[0].color),k(l,"opacity","0.7"),k(n,"class","envelope-curve-visualization"),k(n,"width",t[9]),k(n,"height",t[8]),x(n,"position","absolute"),x(n,"top","0"),x(n,"left","0"),x(n,"pointer-events","none"),x(n,"z-index","1"),k(a,"class","clip-resize-handle-left"),k(a,"title","Drag to resize left edge"),k(f,"class","clip-label"),k(b,"class","clip-resize-handle-right"),k(b,"title","Drag to resize right edge"),k(e,"class",d="timeline-clip timeline-envelope "+(t[2]?"selected":"")+" "+(t[3]?"dragging":"")),x(e,"left",t[11]+"px"),x(e,"width",t[9]+"px"),x(e,"background",t[0].color+"40"),x(e,"border-color",t[0].color),k(e,"role","button"),k(e,"tabindex","0"),k(e,"title","Right-click to delete")},m(v,w){W(v,e,w),C(e,n),C(n,l),C(e,o),C(e,a),C(e,s),C(e,f),C(f,_),C(f,h),m.m(f,null),C(e,p),C(e,b),T||(g=[X(e,"mousedown",function(){je(t[4])&&t[4].apply(this,arguments)}),X(e,"click",function(){je(t[5])&&t[5].apply(this,arguments)}),X(e,"keydown",function(){je(t[6])&&t[6].apply(this,arguments)}),X(e,"contextmenu",Xe(function(){je(t[7])&&t[7].apply(this,arguments)}))],T=!0)},p(v,[w]){t=v,w&1024&&k(l,"d",t[10]),w&1&&r!==(r=t[0].color)&&k(l,"fill",r),w&512&&k(n,"width",t[9]),w&256&&k(n,"height",t[8]),w&1&&u!==(u=t[0].name+"")&&Me(_,u),c===(c=i(t))&&m?m.p(t,w):(m.d(1),m=c(t),m&&(m.c(),m.m(f,null))),w&12&&d!==(d="timeline-clip timeline-envelope "+(t[2]?"selected":"")+" "+(t[3]?"dragging":""))&&k(e,"class",d),w&2048&&x(e,"left",t[11]+"px"),w&512&&x(e,"width",t[9]+"px"),w&1&&x(e,"background",t[0].color+"40"),w&1&&x(e,"border-color",t[0].color)},i:We,o:We,d(v){v&&D(e),m.d(),T=!1,Le(g)}}}function Nr(t,e,n){let l,r,o,a,{timelineEnvelope:s}=e,{envelope:f}=e,{assignedPattern:u}=e,{pixelsPerBeat:_}=e,{isSelected:h}=e,{isDragging:p}=e,{onMouseDown:b}=e,{onClick:d}=e,{onKeyDown:T}=e,{onContextMenu:g}=e;const i=()=>{};return t.$$set=c=>{"timelineEnvelope"in c&&n(12,s=c.timelineEnvelope),"envelope"in c&&n(0,f=c.envelope),"assignedPattern"in c&&n(1,u=c.assignedPattern),"pixelsPerBeat"in c&&n(13,_=c.pixelsPerBeat),"isSelected"in c&&n(2,h=c.isSelected),"isDragging"in c&&n(3,p=c.isDragging),"onMouseDown"in c&&n(4,b=c.onMouseDown),"onClick"in c&&n(5,d=c.onClick),"onKeyDown"in c&&n(6,T=c.onKeyDown),"onContextMenu"in c&&n(7,g=c.onContextMenu)},t.$$.update=()=>{t.$$.dirty&12288&&n(11,l=ct(s.startBeat,_)),t.$$.dirty&12288&&n(9,r=Math.max(20,ct(s.duration,_))),t.$$.dirty&4865&&n(10,a=fr(r,o,f,s.duration))},n(8,o=ot.PATTERN_ROW_HEIGHT-18),[f,u,h,p,b,d,T,g,o,r,a,l,s,_,i]}class Or extends ut{constructor(e){super(),dt(this,e,Nr,Vr,rt,{timelineEnvelope:12,envelope:0,assignedPattern:1,pixelsPerBeat:13,isSelected:2,isDragging:3,onMouseDown:4,onClick:5,onKeyDown:6,onContextMenu:7,onDelete:14})}get onDelete(){return this.$$.ctx[14]}}function Rn(t,e,n){const l=t.slice();return l[86]=e[n],l}function zn(t,e,n){const l=t.slice();l[99]=e[n];const r=l[5].find(function(...s){return t[83](l[99],...s)});l[100]=r;const o=l[27](l[99].patternId);return l[95]=o,l}function Wn(t,e,n){const l=t.slice();l[93]=e[n];const r=l[4].find(function(...s){return t[77](l[93],...s)});l[94]=r;const o=l[27](l[93].patternId);return l[95]=o,l}function $t(t){const e=t.slice(),n=e[14](e[94].id,e[93].id);return e[98]=n,e}function Un(t,e,n){const l=t.slice();l[89]=e[n];const r=l[27](l[89].patternId);return l[90]=r,l}function Hn(t,e,n){const l=t.slice();return l[103]=e[n],l}function Kn(t){let e,n,l,r,o,a,s,f,u,_,h,p,b,d,T,g,i,c,m;return{c(){e=M("div"),n=M("div"),l=M("div"),r=M("div"),s=z(),f=M("div"),u=M("button"),_=ce("M"),b=z(),d=M("button"),T=ce("S"),this.h()},l(v){e=y(v,"DIV",{class:!0});var w=A(e);n=y(w,"DIV",{class:!0,role:!0,"aria-label":!0,"aria-valuemin":!0,"aria-valuemax":!0,"aria-valuenow":!0,tabindex:!0,title:!0});var E=A(n);l=y(E,"DIV",{class:!0});var I=A(l);r=y(I,"DIV",{class:!0,style:!0}),A(r).forEach(D),I.forEach(D),E.forEach(D),s=R(w),f=y(w,"DIV",{class:!0});var V=A(f);u=y(V,"BUTTON",{class:!0,title:!0});var N=A(u);_=fe(N,"M"),N.forEach(D),b=R(V),d=y(V,"BUTTON",{class:!0,title:!0});var H=A(d);T=fe(H,"S"),H.forEach(D),V.forEach(D),w.forEach(D),this.h()},h(){k(r,"class","track-volume-fill"),x(r,"height",(t[0].volume??1)/2*100+"%"),k(l,"class","track-volume-bar"),k(n,"class","track-volume-control"),k(n,"role","slider"),k(n,"aria-label","Track volume"),k(n,"aria-valuemin","0"),k(n,"aria-valuemax","200"),k(n,"aria-valuenow",o=Math.round((t[0].volume??1)*100)),k(n,"tabindex","0"),k(n,"title",a="Drag to adjust volume: "+Math.round((t[0].volume??1)*100)+"%"),k(u,"class",h="track-mute "+(t[0].mute?"active":"")),k(u,"title",p=t[0].mute?"Unmute track":"Mute track"),k(d,"class",g="track-solo "+(t[0].solo?"active":"")),k(d,"title",i=t[0].solo?"Unsolo track":"Solo track"),k(f,"class","track-buttons-vertical"),k(e,"class","track-controls-group")},m(v,w){W(v,e,w),C(e,n),C(n,l),C(l,r),C(e,s),C(e,f),C(f,u),C(u,_),C(f,b),C(f,d),C(d,T),c||(m=[X(n,"mousedown",t[62]),X(u,"click",Xe(t[63])),X(u,"dragstart",Xe(t[59])),X(d,"click",Xe(t[64])),X(d,"dragstart",Xe(t[58]))],c=!0)},p(v,w){w[0]&1&&x(r,"height",(v[0].volume??1)/2*100+"%"),w[0]&1&&o!==(o=Math.round((v[0].volume??1)*100))&&k(n,"aria-valuenow",o),w[0]&1&&a!==(a="Drag to adjust volume: "+Math.round((v[0].volume??1)*100)+"%")&&k(n,"title",a),w[0]&1&&h!==(h="track-mute "+(v[0].mute?"active":""))&&k(u,"class",h),w[0]&1&&p!==(p=v[0].mute?"Unmute track":"Mute track")&&k(u,"title",p),w[0]&1&&g!==(g="track-solo "+(v[0].solo?"active":""))&&k(d,"class",g),w[0]&1&&i!==(i=v[0].solo?"Unsolo track":"Solo track")&&k(d,"title",i)},d(v){v&&D(e),c=!1,Le(m)}}}function Xn(t){let e,n;return{c(){e=M("div"),this.h()},l(l){e=y(l,"DIV",{class:!0,style:!0}),A(e).forEach(D),this.h()},h(){k(e,"class",n="grid-line "+(t[103].isBar?"bar-line":"beat-line")),x(e,"left",t[103].x+"px")},m(l,r){W(l,e,r)},p(l,r){r[1]&8&&n!==(n="grid-line "+(l[103].isBar?"bar-line":"beat-line"))&&k(e,"class",n),r[1]&8&&x(e,"left",l[103].x+"px")},d(l){l&&D(e)}}}function Lr(t){let e=t[6],n,l,r=jn(t);return{c(){r.c(),n=Ee()},l(o){r.l(o),n=Ee()},m(o,a){r.m(o,a),W(o,n,a),l=!0},p(o,a){a[0]&64&&rt(e,e=o[6])?(Ue(),Z(r,1,1,We),He(),r=jn(o),r.c(),K(r,1),r.m(n.parentNode,n)):r.p(o,a)},i(o){l||(K(r),l=!0)},o(o){Z(r),l=!1},d(o){o&&D(n),r.d(o)}}}function Rr(t){let e=t[6],n,l,r=Zn(t);return{c(){r.c(),n=Ee()},l(o){r.l(o),n=Ee()},m(o,a){r.m(o,a),W(o,n,a),l=!0},p(o,a){a[0]&64&&rt(e,e=o[6])?(Ue(),Z(r,1,1,We),He(),r=Zn(o),r.c(),K(r,1),r.m(n.parentNode,n)):r.p(o,a)},i(o){l||(K(r),l=!0)},o(o){Z(r),l=!1},d(o){o&&D(n),r.d(o)}}}function zr(t){let e=t[6],n,l,r=xn(t);return{c(){r.c(),n=Ee()},l(o){r.l(o),n=Ee()},m(o,a){r.m(o,a),W(o,n,a),l=!0},p(o,a){a[0]&64&&rt(e,e=o[6])?(Ue(),Z(r,1,1,We),He(),r=xn(o),r.c(),K(r,1),r.m(n.parentNode,n)):r.p(o,a)},i(o){l||(K(r),l=!0)},o(o){Z(r),l=!1},d(o){o&&D(n),r.d(o)}}}function Fn(t){var f,u;let e,n;function l(..._){return t[78](t[99],..._)}function r(){return t[79](t[99])}function o(..._){return t[80](t[99],..._)}function a(..._){return t[81](t[99],..._)}function s(){return t[82](t[99])}return e=new Or({props:{timelineEnvelope:t[99],envelope:t[100],assignedPattern:t[95],pixelsPerBeat:t[6],isSelected:t[13]===t[99].id,isDragging:((f=t[11])==null?void 0:f.id)===t[99].id&&((u=t[11])==null?void 0:u.type)==="envelope",onMouseDown:l,onClick:r,onKeyDown:o,onContextMenu:a,onDelete:s}}),{c(){ve(e.$$.fragment)},l(_){ge(e.$$.fragment,_)},m(_,h){pe(e,_,h),n=!0},p(_,h){var b,d;t=_;const p={};h[0]&8&&(p.timelineEnvelope=t[99]),h[0]&40&&(p.envelope=t[100]),h[0]&134217736&&(p.assignedPattern=t[95]),h[0]&64&&(p.pixelsPerBeat=t[6]),h[0]&8200&&(p.isSelected=t[13]===t[99].id),h[0]&2056&&(p.isDragging=((b=t[11])==null?void 0:b.id)===t[99].id&&((d=t[11])==null?void 0:d.type)==="envelope"),h[0]&8388616&&(p.onMouseDown=l),h[0]&16780296&&(p.onClick=r),h[0]&33554440&&(p.onKeyDown=o),h[0]&67108872&&(p.onContextMenu=a),h[0]&67108872&&(p.onDelete=s),e.$set(p)},i(_){n||(K(e.$$.fragment,_),n=!0)},o(_){Z(e.$$.fragment,_),n=!1},d(_){me(e,_)}}}function Yn(t){let e,n,l=t[100]&&Fn(t);return{c(){l&&l.c(),e=Ee()},l(r){l&&l.l(r),e=Ee()},m(r,o){l&&l.m(r,o),W(r,e,o),n=!0},p(r,o){r[100]?l?(l.p(r,o),o[0]&40&&K(l,1)):(l=Fn(r),l.c(),K(l,1),l.m(e.parentNode,e)):l&&(Ue(),Z(l,1,1,()=>{l=null}),He())},i(r){n||(K(l),n=!0)},o(r){Z(l),n=!1},d(r){r&&D(e),l&&l.d(r)}}}function jn(t){let e,n,l=we(t[3]),r=[];for(let a=0;a<l.length;a+=1)r[a]=Yn(zn(t,l,a));const o=a=>Z(r[a],1,1,()=>{r[a]=null});return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=Ee()},l(a){for(let s=0;s<r.length;s+=1)r[s].l(a);e=Ee()},m(a,s){for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(a,s);W(a,e,s),n=!0},p(a,s){if(s[0]&260058216){l=we(a[3]);let f;for(f=0;f<l.length;f+=1){const u=zn(a,l,f);r[f]?(r[f].p(u,s),K(r[f],1)):(r[f]=Yn(u),r[f].c(),K(r[f],1),r[f].m(e.parentNode,e))}for(Ue(),f=l.length;f<r.length;f+=1)o(f);He()}},i(a){if(!n){for(let s=0;s<l.length;s+=1)K(r[s]);n=!0}},o(a){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)Z(r[s]);n=!1},d(a){a&&D(e),Ge(r,a)}}}function qn(t){var f,u;let e,n;function l(..._){return t[72](t[93],..._)}function r(){return t[73](t[93])}function o(..._){return t[74](t[93],..._)}function a(..._){return t[75](t[93],..._)}function s(){return t[76](t[93])}return e=new Sr({props:{timelineEffect:t[93],effect:t[94],assignedPattern:t[95],pixelsPerBeat:t[6],isSelected:t[12]===t[93].id,isDragging:((f=t[11])==null?void 0:f.id)===t[93].id&&((u=t[11])==null?void 0:u.type)==="effect",automationCurves:t[98],onMouseDown:l,onClick:r,onKeyDown:o,onContextMenu:a,onDelete:s}}),{c(){ve(e.$$.fragment)},l(_){ge(e.$$.fragment,_)},m(_,h){pe(e,_,h),n=!0},p(_,h){var b,d;t=_;const p={};h[0]&4&&(p.timelineEffect=t[93]),h[0]&20&&(p.effect=t[94]),h[0]&134217732&&(p.assignedPattern=t[95]),h[0]&64&&(p.pixelsPerBeat=t[6]),h[0]&4100&&(p.isSelected=t[12]===t[93].id),h[0]&2052&&(p.isDragging=((b=t[11])==null?void 0:b.id)===t[93].id&&((d=t[11])==null?void 0:d.type)==="effect"),h[0]&16404&&(p.automationCurves=t[98]),h[0]&8388612&&(p.onMouseDown=l),h[0]&16780292&&(p.onClick=r),h[0]&33554436&&(p.onKeyDown=o),h[0]&67108868&&(p.onContextMenu=a),h[0]&67108868&&(p.onDelete=s),e.$set(p)},i(_){n||(K(e.$$.fragment,_),n=!0)},o(_){Z(e.$$.fragment,_),n=!1},d(_){me(e,_)}}}function Gn(t){let e,n,l=t[94]&&qn($t(t));return{c(){l&&l.c(),e=Ee()},l(r){l&&l.l(r),e=Ee()},m(r,o){l&&l.m(r,o),W(r,e,o),n=!0},p(r,o){r[94]?l?(l.p($t(r),o),o[0]&20&&K(l,1)):(l=qn($t(r)),l.c(),K(l,1),l.m(e.parentNode,e)):l&&(Ue(),Z(l,1,1,()=>{l=null}),He())},i(r){n||(K(l),n=!0)},o(r){Z(l),n=!1},d(r){r&&D(e),l&&l.d(r)}}}function Zn(t){let e,n,l=we(t[2]),r=[];for(let a=0;a<l.length;a+=1)r[a]=Gn(Wn(t,l,a));const o=a=>Z(r[a],1,1,()=>{r[a]=null});return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=Ee()},l(a){for(let s=0;s<r.length;s+=1)r[s].l(a);e=Ee()},m(a,s){for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(a,s);W(a,e,s),n=!0},p(a,s){if(s[0]&260070484){l=we(a[2]);let f;for(f=0;f<l.length;f+=1){const u=Wn(a,l,f);r[f]?(r[f].p(u,s),K(r[f],1)):(r[f]=Gn(u),r[f].c(),K(r[f],1),r[f].m(e.parentNode,e))}for(Ue(),f=l.length;f<r.length;f+=1)o(f);He()}},i(a){if(!n){for(let s=0;s<l.length;s+=1)K(r[s]);n=!0}},o(a){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)Z(r[s]);n=!1},d(a){a&&D(e),Ge(r,a)}}}function Jn(t){var a,s;let e,n;function l(...f){return t[68](t[89],...f)}function r(...f){return t[70](t[89],...f)}function o(){return t[71](t[89])}return e=new Dr({props:{clip:t[89],pattern:t[90],pixelsPerBeat:t[6],isDragging:((a=t[11])==null?void 0:a.id)===t[89].id&&((s=t[11])==null?void 0:s.type)==="clip",isGreyedOut:t[32],onMouseDown:l,onClick:t[69],onContextMenu:r,onDelete:o}}),{c(){ve(e.$$.fragment)},l(f){ge(e.$$.fragment,f)},m(f,u){pe(e,f,u),n=!0},p(f,u){var h,p;t=f;const _={};u[0]&2&&(_.clip=t[89]),u[0]&134217730&&(_.pattern=t[90]),u[0]&64&&(_.pixelsPerBeat=t[6]),u[0]&2050&&(_.isDragging=((h=t[11])==null?void 0:h.id)===t[89].id&&((p=t[11])==null?void 0:p.type)==="clip"),u[1]&2&&(_.isGreyedOut=t[32]),u[0]&8388610&&(_.onMouseDown=l),u[0]&3072&&(_.onClick=t[69]),u[0]&67108866&&(_.onContextMenu=r),u[0]&67108866&&(_.onDelete=o),e.$set(_)},i(f){n||(K(e.$$.fragment,f),n=!0)},o(f){Z(e.$$.fragment,f),n=!1},d(f){me(e,f)}}}function Qn(t){let e,n,l=t[90]&&Jn(t);return{c(){l&&l.c(),e=Ee()},l(r){l&&l.l(r),e=Ee()},m(r,o){l&&l.m(r,o),W(r,e,o),n=!0},p(r,o){r[90]?l?(l.p(r,o),o[0]&134217730&&K(l,1)):(l=Jn(r),l.c(),K(l,1),l.m(e.parentNode,e)):l&&(Ue(),Z(l,1,1,()=>{l=null}),He())},i(r){n||(K(l),n=!0)},o(r){Z(l),n=!1},d(r){r&&D(e),l&&l.d(r)}}}function xn(t){let e,n,l=we(t[1]),r=[];for(let a=0;a<l.length;a+=1)r[a]=Qn(Un(t,l,a));const o=a=>Z(r[a],1,1,()=>{r[a]=null});return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=Ee()},l(a){for(let s=0;s<r.length;s+=1)r[s].l(a);e=Ee()},m(a,s){for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(a,s);W(a,e,s),n=!0},p(a,s){if(s[0]&209718338|s[1]&2){l=we(a[1]);let f;for(f=0;f<l.length;f+=1){const u=Un(a,l,f);r[f]?(r[f].p(u,s),K(r[f],1)):(r[f]=Qn(u),r[f].c(),K(r[f],1),r[f].m(e.parentNode,e))}for(Ue(),f=l.length;f<r.length;f+=1)o(f);He()}},i(a){if(!n){for(let s=0;s<l.length;s+=1)K(r[s]);n=!0}},o(a){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)Z(r[s]);n=!1},d(a){a&&D(e),Ge(r,a)}}}function $n(t){let e,n,l="Delete Track",r,o,a,s="Change Color:",f,u,_,h,p=we(t[35]),b=[];for(let d=0;d<p.length;d+=1)b[d]=el(Rn(t,p,d));return{c(){e=M("div"),n=M("button"),n.textContent=l,r=z(),o=M("div"),a=M("label"),a.textContent=s,f=z(),u=M("div");for(let d=0;d<b.length;d+=1)b[d].c();this.h()},l(d){e=y(d,"DIV",{class:!0,style:!0});var T=A(e);n=y(T,"BUTTON",{class:!0,"data-svelte-h":!0}),re(n)!=="svelte-pe60ho"&&(n.textContent=l),r=R(T),o=y(T,"DIV",{class:!0});var g=A(o);a=y(g,"LABEL",{"data-svelte-h":!0}),re(a)!=="svelte-bdccwb"&&(a.textContent=s),f=R(g),u=y(g,"DIV",{class:!0});var i=A(u);for(let c=0;c<b.length;c+=1)b[c].l(i);i.forEach(D),g.forEach(D),T.forEach(D),this.h()},h(){k(n,"class","menu-item"),k(u,"class","color-swatches"),k(o,"class","menu-item color-picker-section"),k(e,"class","track-context-menu"),x(e,"left",t[30]+"px"),x(e,"top",t[31]+"px")},m(d,T){W(d,e,T),C(e,n),C(e,r),C(e,o),C(o,a),C(o,f),C(o,u);for(let g=0;g<b.length;g+=1)b[g]&&b[g].m(u,null);_||(h=[X(n,"click",t[39]),X(e,"click",Xe(t[56])),X(e,"contextmenu",Xe(gl(t[57])))],_=!0)},p(d,T){if(T[0]&268435456|T[1]&144){p=we(d[35]);let g;for(g=0;g<p.length;g+=1){const i=Rn(d,p,g);b[g]?b[g].p(i,T):(b[g]=el(i),b[g].c(),b[g].m(u,null))}for(;g<b.length;g+=1)b[g].d(1);b.length=p.length}T[0]&1073741824&&x(e,"left",d[30]+"px"),T[1]&1&&x(e,"top",d[31]+"px")},d(d){d&&D(e),Ge(b,d),_=!1,Le(h)}}}function el(t){let e,n,l,r;function o(){return t[84](t[86])}return{c(){e=M("button"),this.h()},l(a){e=y(a,"BUTTON",{class:!0,style:!0,title:!0,"aria-label":!0}),A(e).forEach(D),this.h()},h(){k(e,"class",n="color-swatch "+(t[28]===t[86]?"active":"")),x(e,"background",t[86]),k(e,"title","Set color to "+t[86]),k(e,"aria-label","Set color to "+t[86])},m(a,s){W(a,e,s),l||(r=X(e,"click",o),l=!0)},p(a,s){t=a,s[0]&268435456&&n!==(n="color-swatch "+(t[28]===t[86]?"active":""))&&k(e,"class",n)},d(a){a&&D(e),l=!1,r()}}}function Wr(t){let e,n,l,r,o=t[0].name+"",a,s,f,u,_,h,p,b,d,T,g,i,c=t[0].type==="pattern"&&Kn(t),m=we(t[34]),v=[];for(let N=0;N<m.length;N+=1)v[N]=Xn(Hn(t,m,N));const w=[zr,Rr,Lr],E=[];function I(N,H){return N[0].type==="pattern"?0:N[0].type==="effect"?1:N[0].type==="envelope"?2:-1}~(_=I(t))&&(h=E[_]=w[_](t));let V=t[29]&&$n(t);return{c(){e=M("div"),n=M("div"),c&&c.c(),l=z(),r=M("span"),a=ce(o),s=z(),f=M("div");for(let N=0;N<v.length;N+=1)v[N].c();u=z(),h&&h.c(),p=z(),V&&V.c(),this.h()},l(N){e=y(N,"DIV",{class:!0,style:!0,role:!0,"aria-label":!0});var H=A(e);n=y(H,"DIV",{class:!0,style:!0,draggable:!0,role:!0,tabindex:!0});var G=A(n);c&&c.l(G),l=R(G),r=y(G,"SPAN",{class:!0});var j=A(r);a=fe(j,o),j.forEach(D),G.forEach(D),s=R(H),f=y(H,"DIV",{class:!0,style:!0});var le=A(f);for(let $=0;$<v.length;$+=1)v[$].l(le);u=R(le),h&&h.l(le),le.forEach(D),p=R(H),V&&V.l(H),H.forEach(D),this.h()},h(){k(r,"class","track-name"),k(n,"class","row-label"),x(n,"background",t[33]),k(n,"draggable","true"),k(n,"role","button"),k(n,"tabindex","0"),k(f,"class","row-clips"),x(f,"width",ct(t[7],t[6])+"px"),k(e,"class",b="pattern-row "+t[0].type+"-row "+(t[8]===t[0].id?"drag-over":"")+" "+(t[9]===t[0].id?"drag-over-track":"")),x(e,"height",ot.PATTERN_ROW_HEIGHT+"px"),k(e,"role","region"),k(e,"aria-label",d=t[0].type+" timeline track")},m(N,H){W(N,e,H),C(e,n),c&&c.m(n,null),C(n,l),C(n,r),C(r,a),C(e,s),C(e,f);for(let G=0;G<v.length;G+=1)v[G]&&v[G].m(f,null);C(f,u),~_&&E[_].m(f,null),C(e,p),V&&V.m(e,null),T=!0,g||(i=[X(window,"click",t[60]),X(window,"contextmenu",t[61]),X(n,"dragstart",t[65]),X(n,"dragover",t[66]),X(n,"dragleave",function(){je(t[17])&&t[17].apply(this,arguments)}),X(n,"drop",t[67]),X(n,"contextmenu",t[36]),X(e,"dragover",t[41]),X(e,"dragleave",function(){je(t[19])&&t[19].apply(this,arguments)}),X(e,"drop",t[40])],g=!0)},p(N,H){if(t=N,t[0].type==="pattern"?c?c.p(t,H):(c=Kn(t),c.c(),c.m(n,l)):c&&(c.d(1),c=null),(!T||H[0]&1)&&o!==(o=t[0].name+"")&&Me(a,o),(!T||H[1]&4)&&x(n,"background",t[33]),H[1]&8){m=we(t[34]);let j;for(j=0;j<m.length;j+=1){const le=Hn(t,m,j);v[j]?v[j].p(le,H):(v[j]=Xn(le),v[j].c(),v[j].m(f,u))}for(;j<v.length;j+=1)v[j].d(1);v.length=m.length}let G=_;_=I(t),_===G?~_&&E[_].p(t,H):(h&&(Ue(),Z(E[G],1,1,()=>{E[G]=null}),He()),~_?(h=E[_],h?h.p(t,H):(h=E[_]=w[_](t),h.c()),K(h,1),h.m(f,null)):h=null),(!T||H[0]&192)&&x(f,"width",ct(t[7],t[6])+"px"),t[29]?V?V.p(t,H):(V=$n(t),V.c(),V.m(e,null)):V&&(V.d(1),V=null),(!T||H[0]&769&&b!==(b="pattern-row "+t[0].type+"-row "+(t[8]===t[0].id?"drag-over":"")+" "+(t[9]===t[0].id?"drag-over-track":"")))&&k(e,"class",b),(!T||H[0]&1&&d!==(d=t[0].type+" timeline track"))&&k(e,"aria-label",d)},i(N){T||(K(h),T=!0)},o(N){Z(h),T=!1},d(N){N&&D(e),c&&c.d(),Ge(v,N),~_&&E[_].d(),V&&V.d(),g=!1,Le(i)}}}function Ur(t,e,n){let l,r,o,a,s,f,{track:u}=e,{trackClips:_}=e,{trackEffects:h}=e,{trackEnvelopes:p}=e,{trackPattern:b}=e;const d=[];let{effects:T}=e,{envelopes:g}=e,{timeline:i}=e,{pixelsPerBeat:c}=e,{totalLength:m}=e,{dragOverRow:v}=e,{dragOverTrackId:w}=e,{draggedTrackId:E}=e,{isResizing:I}=e,{isDraggingClip:V}=e,{selectedEffectId:N}=e,{selectedEnvelopeId:H}=e,{getAutomationCurvesForEffect:G}=e,{onTrackDragStart:j}=e,{onTrackDragOver:le}=e,{onTrackDragLeave:$}=e,{onTrackDrop:ue}=e,{onRowDragOver:P}=e,{onRowDragLeave:L}=e,{onRowDrop:ae}=e,{onRowClick:q}=e,{onTrackVolumeMouseDown:J}=e,{onToggleTrackMute:ie}=e,{onToggleTrackSolo:de}=e,{onDeleteTrack:be}=e,{onChangeTrackColor:ne=()=>{}}=e,{onClipMouseDown:oe}=e,{onClipClick:Ce}=e,{onClipKeyDown:De}=e,{onDeleteClip:Te}=e;const Pe=()=>{},Ye=()=>{},xe=()=>{};let{findPatternById:Y}=e;const he=["#7ab8ff","#ff00ff","#00ffcc","#ff6600","#00ff00","#ff0066","#6600ff","#ffff00"];let ye=!1,Fe=0,$e=0;function it(B){B.preventDefault(),B.stopPropagation(),n(30,Fe=B.clientX),n(31,$e=B.clientY),n(29,ye=!0),B.currentTarget}function et(){n(29,ye=!1)}function at(B){ne&&ne(u.id,B),et()}function yt(){be(u.id),et()}function Et(B){if(E&&E!==u.id){ue(B,u.id);return}ae(B)}function Ze(B){if(E&&E!==u.id){B.preventDefault(),B.dataTransfer&&(B.dataTransfer.dropEffect="move"),le(B,u.id);return}P(B)}function st(B){Tt.call(this,t,B)}function Mt(B){Tt.call(this,t,B)}function St(B){Tt.call(this,t,B)}function Bt(B){Tt.call(this,t,B)}const At=B=>{ye&&et()},Vt=B=>{ye&&et()},O=B=>J(B,u.id),tt=()=>ie(u.id),_t=()=>de(u.id),Nt=B=>j(B,u.id),vt=B=>le(B,u.id),Ot=B=>ue(B,u.id),ht=(B,Se)=>oe(Se,B,"clip"),wt=B=>{!I&&!V&&B.stopPropagation()},Lt=(B,Se)=>{Se.preventDefault(),Te(B.id,"clip")},zt=B=>Te(B.id,"clip"),Dt=(B,Se)=>oe(Se,B,"effect"),Ht=B=>{!I&&!V&&Ce(B.id,"effect")},Kt=(B,Se)=>{(Se.key==="Enter"||Se.key===" ")&&(Se.preventDefault(),De(B.id,"effect"))},Xt=(B,Se)=>{Se.preventDefault(),Te(B.id,"effect")},Ft=B=>Te(B.id,"effect"),Yt=(B,Se)=>Se.id===B.effectId,jt=(B,Se)=>oe(Se,B,"envelope"),qt=B=>{!I&&!V&&Ce(B.id,"envelope")},Gt=(B,Se)=>{(Se.key==="Enter"||Se.key===" ")&&(Se.preventDefault(),De(B.id,"envelope"))},Zt=(B,Se)=>{Se.preventDefault(),Te(B.id,"envelope")},Jt=B=>Te(B.id,"envelope"),Qt=(B,Se)=>Se.id===B.envelopeId,xt=B=>at(B);return t.$$set=B=>{"track"in B&&n(0,u=B.track),"trackClips"in B&&n(1,_=B.trackClips),"trackEffects"in B&&n(2,h=B.trackEffects),"trackEnvelopes"in B&&n(3,p=B.trackEnvelopes),"trackPattern"in B&&n(42,b=B.trackPattern),"effects"in B&&n(4,T=B.effects),"envelopes"in B&&n(5,g=B.envelopes),"timeline"in B&&n(44,i=B.timeline),"pixelsPerBeat"in B&&n(6,c=B.pixelsPerBeat),"totalLength"in B&&n(7,m=B.totalLength),"dragOverRow"in B&&n(8,v=B.dragOverRow),"dragOverTrackId"in B&&n(9,w=B.dragOverTrackId),"draggedTrackId"in B&&n(45,E=B.draggedTrackId),"isResizing"in B&&n(10,I=B.isResizing),"isDraggingClip"in B&&n(11,V=B.isDraggingClip),"selectedEffectId"in B&&n(12,N=B.selectedEffectId),"selectedEnvelopeId"in B&&n(13,H=B.selectedEnvelopeId),"getAutomationCurvesForEffect"in B&&n(14,G=B.getAutomationCurvesForEffect),"onTrackDragStart"in B&&n(15,j=B.onTrackDragStart),"onTrackDragOver"in B&&n(16,le=B.onTrackDragOver),"onTrackDragLeave"in B&&n(17,$=B.onTrackDragLeave),"onTrackDrop"in B&&n(18,ue=B.onTrackDrop),"onRowDragOver"in B&&n(46,P=B.onRowDragOver),"onRowDragLeave"in B&&n(19,L=B.onRowDragLeave),"onRowDrop"in B&&n(47,ae=B.onRowDrop),"onRowClick"in B&&n(48,q=B.onRowClick),"onTrackVolumeMouseDown"in B&&n(20,J=B.onTrackVolumeMouseDown),"onToggleTrackMute"in B&&n(21,ie=B.onToggleTrackMute),"onToggleTrackSolo"in B&&n(22,de=B.onToggleTrackSolo),"onDeleteTrack"in B&&n(49,be=B.onDeleteTrack),"onChangeTrackColor"in B&&n(50,ne=B.onChangeTrackColor),"onClipMouseDown"in B&&n(23,oe=B.onClipMouseDown),"onClipClick"in B&&n(24,Ce=B.onClipClick),"onClipKeyDown"in B&&n(25,De=B.onClipKeyDown),"onDeleteClip"in B&&n(26,Te=B.onDeleteClip),"findPatternById"in B&&n(27,Y=B.findPatternById)},t.$$.update=()=>{var B;t.$$.dirty[0]&192&&n(34,l=ml(m,c)),t.$$.dirty[0]&1|t.$$.dirty[1]&16777216&&n(28,o=u.color||r[u.type]),t.$$.dirty[0]&268435456&&n(33,a=o+"20"),t.$$.dirty[1]&8192&&n(54,s=((B=i.tracks)==null?void 0:B.some(Se=>Se.type==="pattern"&&Se.solo===!0))||!1),t.$$.dirty[0]&1|t.$$.dirty[1]&8388608&&n(32,f=u.mute||s&&!u.solo)},n(55,r={pattern:"#7ab8ff",effect:"#9b59b6",envelope:"#2ecc71"}),[u,_,h,p,T,g,c,m,v,w,I,V,N,H,G,j,le,$,ue,L,J,ie,de,oe,Ce,De,Te,Y,o,ye,Fe,$e,f,a,l,he,it,et,at,yt,Et,Ze,b,d,i,E,P,ae,q,be,ne,Pe,Ye,xe,s,r,st,Mt,St,Bt,At,Vt,O,tt,_t,Nt,vt,Ot,ht,wt,Lt,zt,Dt,Ht,Kt,Xt,Ft,Yt,jt,qt,Gt,Zt,Jt,Qt,xt]}class Hr extends ut{constructor(e){super(),dt(this,e,Ur,Wr,rt,{track:0,trackClips:1,trackEffects:2,trackEnvelopes:3,trackPattern:42,patterns:43,effects:4,envelopes:5,timeline:44,pixelsPerBeat:6,totalLength:7,dragOverRow:8,dragOverTrackId:9,draggedTrackId:45,isResizing:10,isDraggingClip:11,selectedEffectId:12,selectedEnvelopeId:13,getAutomationCurvesForEffect:14,onTrackDragStart:15,onTrackDragOver:16,onTrackDragLeave:17,onTrackDrop:18,onRowDragOver:46,onRowDragLeave:19,onRowDrop:47,onRowClick:48,onTrackVolumeMouseDown:20,onToggleTrackMute:21,onToggleTrackSolo:22,onDeleteTrack:49,onChangeTrackColor:50,onClipMouseDown:23,onClipClick:24,onClipKeyDown:25,onDeleteClip:26,onAddClipToTimeline:51,onAddEffectToTimeline:52,onAddEnvelopeToTimeline:53,findPatternById:27},null,[-1,-1,-1,-1])}get patterns(){return this.$$.ctx[43]}get onAddClipToTimeline(){return this.$$.ctx[51]}get onAddEffectToTimeline(){return this.$$.ctx[52]}get onAddEnvelopeToTimeline(){return this.$$.ctx[53]}}function tl(t,e,n){const l=t.slice();return l[109]=e[n],l}function nl(t,e,n){const l=t.slice();l[102]=e[n];const r=l[51](l[102].id);l[103]=r;const o=l[52](l[102].id);l[104]=o;const a=l[53](l[102].id);l[105]=a;const s=l[102].type==="pattern"&&l[102].patternId?l[25](l[102].patternId):null;return l[106]=s,l}function Kr(t){let e,n,l,r,o,a,s=t[4]==="arrangement"&&ll(t);const f=[Yr,Fr],u=[];function _(h,p){return h[4]==="arrangement"?0:h[4]==="pattern"?1:-1}return~(r=_(t))&&(o=u[r]=f[r](t)),{c(){e=M("div"),s&&s.c(),n=z(),l=M("div"),o&&o.c(),this.h()},l(h){e=y(h,"DIV",{class:!0,style:!0});var p=A(e);s&&s.l(p),n=R(p),l=y(p,"DIV",{class:!0,style:!0});var b=A(l);o&&o.l(b),b.forEach(D),p.forEach(D),this.h()},h(){k(l,"class","main-content"),x(l,"margin-left",(t[4]==="arrangement"?Pt:0)+"px"),k(e,"class","project-view"),x(e,"--sidebar-width",Pt+"px")},m(h,p){W(h,e,p),s&&s.m(e,null),C(e,n),C(e,l),~r&&u[r].m(l,null),a=!0},p(h,p){h[4]==="arrangement"?s?(s.p(h,p),p[0]&16&&K(s,1)):(s=ll(h),s.c(),K(s,1),s.m(e,n)):s&&(Ue(),Z(s,1,1,()=>{s=null}),He());let b=r;r=_(h),r===b?~r&&u[r].p(h,p):(o&&(Ue(),Z(u[b],1,1,()=>{u[b]=null}),He()),~r?(o=u[r],o?o.p(h,p):(o=u[r]=f[r](h),o.c()),K(o,1),o.m(l,null)):o=null),(!a||p[0]&16)&&x(l,"margin-left",(h[4]==="arrangement"?Pt:0)+"px")},i(h){a||(K(s),K(o),a=!0)},o(h){Z(s),Z(o),a=!1},d(h){h&&D(e),s&&s.d(),~r&&u[r].d()}}}function Xr(t){let e,n;return e=new bl({props:{viewMode:t[4]}}),{c(){ve(e.$$.fragment)},l(l){ge(e.$$.fragment,l)},m(l,r){pe(e,l,r),n=!0},p(l,r){const o={};r[0]&16&&(o.viewMode=l[4]),e.$set(o)},i(l){n||(K(e.$$.fragment,l),n=!0)},o(l){Z(e.$$.fragment,l),n=!1},d(l){me(e,l)}}}function ll(t){let e,n,l;function r(a){t[60](a)}let o={patterns:t[8],sidebarWidth:Pt,viewMode:t[4],createPattern:t[26],deletePattern:t[27],selectPattern:t[28],handleEffectEnvelopeDragStart:t[31]};return t[12]!==void 0&&(o.editingPatternId=t[12]),e=new gr({props:o}),Ct.push(()=>fl(e,"editingPatternId",r)),{c(){ve(e.$$.fragment)},l(a){ge(e.$$.fragment,a)},m(a,s){pe(e,a,s),l=!0},p(a,s){const f={};s[0]&256&&(f.patterns=a[8]),s[0]&16&&(f.viewMode=a[4]),!n&&s[0]&4096&&(n=!0,f.editingPatternId=a[12],cl(()=>n=!1)),e.$set(f)},i(a){l||(K(e.$$.fragment,a),l=!0)},o(a){Z(e.$$.fragment,a),l=!1},d(a){me(e,a)}}}function Fr(t){let e,n,l,r="Patterns",o,a,s="+ New Pattern",f,u,_,h,p,b=we(t[8]),d=[];for(let g=0;g<b.length;g+=1)d[g]=rl(tl(t,b,g));const T=g=>Z(d[g],1,1,()=>{d[g]=null});return{c(){e=M("div"),n=M("div"),l=M("h2"),l.textContent=r,o=z(),a=M("button"),a.textContent=s,f=z(),u=M("div");for(let g=0;g<d.length;g+=1)d[g].c();this.h()},l(g){e=y(g,"DIV",{class:!0});var i=A(e);n=y(i,"DIV",{class:!0});var c=A(n);l=y(c,"H2",{"data-svelte-h":!0}),re(l)!=="svelte-jbqu7h"&&(l.textContent=r),o=R(c),a=y(c,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),re(a)!=="svelte-s6pdne"&&(a.textContent=s),c.forEach(D),f=R(i),u=y(i,"DIV",{class:!0});var m=A(u);for(let v=0;v<d.length;v+=1)d[v].l(m);m.forEach(D),i.forEach(D),this.h()},h(){k(a,"class","create-pattern-btn-large"),k(a,"title","Create new pattern"),k(n,"class","pattern-list-header"),k(u,"class","pattern-grid"),k(e,"class","pattern-list-view")},m(g,i){W(g,e,i),C(e,n),C(n,l),C(n,o),C(n,a),C(e,f),C(e,u);for(let c=0;c<d.length;c+=1)d[c]&&d[c].m(u,null);_=!0,h||(p=X(a,"click",t[26]),h=!0)},p(g,i){if(i[0]&402653440){b=we(g[8]);let c;for(c=0;c<b.length;c+=1){const m=tl(g,b,c);d[c]?(d[c].p(m,i),K(d[c],1)):(d[c]=rl(m),d[c].c(),K(d[c],1),d[c].m(u,null))}for(Ue(),c=b.length;c<d.length;c+=1)T(c);He()}},i(g){if(!_){for(let i=0;i<b.length;i+=1)K(d[i]);_=!0}},o(g){d=d.filter(Boolean);for(let i=0;i<d.length;i+=1)Z(d[i]);_=!1},d(g){g&&D(e),Ge(d,g),h=!1,p()}}}function Yr(t){let e,n,l,r,o,a,s,f,u,_,h,p,b,d,T,g;function i(I){t[62](I)}let c={totalLength:t[6].totalLength,pixelsPerBeat:t[9],zoomLevel:t[0],onZoomWheel:t[23],onCreateTrack:t[42],onToggleAddTrackMenu:t[61]};t[3]!==void 0&&(c.showAddTrackMenu=t[3]),l=new Cr({props:c}),Ct.push(()=>fl(l,"showAddTrackMenu",i));let m=we(t[21].sort(sl)),v=[];for(let I=0;I<m.length;I+=1)v[I]=al(nl(t,m,I));const w=I=>Z(v[I],1,1,()=>{v[I]=null});h=new xl({props:{selectedEffectId:t[19],selectedEnvelopeId:t[18],selectedTimelineEffectId:t[1],selectedTimelineEnvelopeId:t[2]}});let E=t[10].length>0&&ol(t);return{c(){e=M("div"),n=M("div"),ve(l.$$.fragment),o=z(),a=M("div"),s=M("div"),f=z(),u=M("div");for(let I=0;I<v.length;I+=1)v[I].c();_=z(),ve(h.$$.fragment),p=z(),E&&E.c(),b=Ee(),this.h()},l(I){e=y(I,"DIV",{class:!0});var V=A(e);n=y(V,"DIV",{class:!0,role:!0,"aria-label":!0});var N=A(n);ge(l.$$.fragment,N),o=R(N),a=y(N,"DIV",{class:!0});var H=A(a);s=y(H,"DIV",{class:!0,style:!0}),A(s).forEach(D),H.forEach(D),f=R(N),u=y(N,"DIV",{class:!0});var G=A(u);for(let j=0;j<v.length;j+=1)v[j].l(G);G.forEach(D),N.forEach(D),V.forEach(D),_=R(I),ge(h.$$.fragment,I),p=R(I),E&&E.l(I),b=Ee(),this.h()},h(){k(s,"class","playhead"),x(s,"left",t[22]+t[24](t[20])+"px"),k(a,"class","playhead-container"),k(u,"class","pattern-rows"),k(n,"class","timeline-area"),k(n,"role","region"),k(n,"aria-label","Timeline area"),k(e,"class","arrangement-view"),tn(e,"automation-open",t[10].length>0)},m(I,V){W(I,e,V),C(e,n),pe(l,n,null),C(n,o),C(n,a),C(a,s),C(n,f),C(n,u);for(let N=0;N<v.length;N+=1)v[N]&&v[N].m(u,null);W(I,_,V),pe(h,I,V),W(I,p,V),E&&E.m(I,V),W(I,b,V),d=!0,T||(g=[X(n,"wheel",t[72]),X(n,"mousemove",t[73]),X(n,"mouseup",t[74]),X(n,"mouseleave",t[75])],T=!0)},p(I,V){const N={};if(V[0]&64&&(N.totalLength=I[6].totalLength),V[0]&512&&(N.pixelsPerBeat=I[9]),V[0]&1&&(N.zoomLevel=I[0]),V[0]&8&&(N.onToggleAddTrackMenu=I[61]),!r&&V[0]&8&&(r=!0,N.showAddTrackMenu=I[3],cl(()=>r=!1)),l.$set(N),(!d||V[0]&1048576)&&x(s,"left",I[22]+I[24](I[20])+"px"),V[0]&1646519270|V[1]&16775154){m=we(I[21].sort(sl));let G;for(G=0;G<m.length;G+=1){const j=nl(I,m,G);v[G]?(v[G].p(j,V),K(v[G],1)):(v[G]=al(j),v[G].c(),K(v[G],1),v[G].m(u,null))}for(Ue(),G=m.length;G<v.length;G+=1)w(G);He()}(!d||V[0]&1024)&&tn(e,"automation-open",I[10].length>0);const H={};V[0]&524288&&(H.selectedEffectId=I[19]),V[0]&262144&&(H.selectedEnvelopeId=I[18]),V[0]&2&&(H.selectedTimelineEffectId=I[1]),V[0]&4&&(H.selectedTimelineEnvelopeId=I[2]),h.$set(H),I[10].length>0?E?(E.p(I,V),V[0]&1024&&K(E,1)):(E=ol(I),E.c(),K(E,1),E.m(b.parentNode,b)):E&&(Ue(),Z(E,1,1,()=>{E=null}),He())},i(I){if(!d){K(l.$$.fragment,I);for(let V=0;V<m.length;V+=1)K(v[V]);K(h.$$.fragment,I),K(E),d=!0}},o(I){Z(l.$$.fragment,I),v=v.filter(Boolean);for(let V=0;V<v.length;V+=1)Z(v[V]);Z(h.$$.fragment,I),Z(E),d=!1},d(I){I&&(D(e),D(_),D(p),D(b)),me(l),Ge(v,I),me(h,I),E&&E.d(I),T=!1,Le(g)}}}function rl(t){let e,n;function l(){return t[76](t[109])}return e=new rr({props:{pattern:t[109],onClick:l,onDelete:t[27]}}),{c(){ve(e.$$.fragment)},l(r){ge(e.$$.fragment,r)},m(r,o){pe(e,r,o),n=!0},p(r,o){t=r;const a={};o[0]&256&&(a.pattern=t[109]),o[0]&256&&(a.onClick=l),e.$set(a)},i(r){n||(K(e.$$.fragment,r),n=!0)},o(r){Z(e.$$.fragment,r),n=!1},d(r){me(e,r)}}}function al(t){let e,n;function l(...a){return t[63](t[102],...a)}function r(...a){return t[64](t[102],...a)}function o(...a){return t[65](t[102],...a)}return e=new Hr({props:{track:t[102],trackClips:t[103],trackEffects:t[104],trackEnvelopes:t[105],trackPattern:t[106],patterns:t[8],effects:t[7],envelopes:t[5],timeline:t[6],pixelsPerBeat:t[9],totalLength:t[6].totalLength,dragOverRow:t[13],dragOverTrackId:t[17],draggedTrackId:t[16],isResizing:t[14],isDraggingClip:t[15],selectedEffectId:t[1],selectedEnvelopeId:t[2],getAutomationCurvesForEffect:t[54],onTrackDragStart:t[43],onTrackDragOver:t[44],onTrackDragLeave:t[45],onTrackDrop:t[46],onRowDragOver:l,onRowDragLeave:t[36],onRowDrop:r,onRowClick:o,onTrackVolumeMouseDown:t[48],onToggleTrackMute:t[49],onToggleTrackSolo:t[50],onDeleteTrack:t[47],onChangeTrackColor:t[66],onClipMouseDown:t[32],onClipClick:t[67],onClipKeyDown:t[68],onDeleteClip:t[69],onAddClipToTimeline:t[29],onAddEffectToTimeline:t[70],onAddEnvelopeToTimeline:t[71],findPatternById:t[25]}}),{c(){ve(e.$$.fragment)},l(a){ge(e.$$.fragment,a)},m(a,s){pe(e,a,s),n=!0},p(a,s){t=a;const f={};s[0]&2097152&&(f.track=t[102]),s[0]&2097152&&(f.trackClips=t[103]),s[0]&2097152&&(f.trackEffects=t[104]),s[0]&2097152&&(f.trackEnvelopes=t[105]),s[0]&2097152&&(f.trackPattern=t[106]),s[0]&256&&(f.patterns=t[8]),s[0]&128&&(f.effects=t[7]),s[0]&32&&(f.envelopes=t[5]),s[0]&64&&(f.timeline=t[6]),s[0]&512&&(f.pixelsPerBeat=t[9]),s[0]&64&&(f.totalLength=t[6].totalLength),s[0]&8192&&(f.dragOverRow=t[13]),s[0]&131072&&(f.dragOverTrackId=t[17]),s[0]&65536&&(f.draggedTrackId=t[16]),s[0]&16384&&(f.isResizing=t[14]),s[0]&32768&&(f.isDraggingClip=t[15]),s[0]&2&&(f.selectedEffectId=t[1]),s[0]&4&&(f.selectedEnvelopeId=t[2]),s[0]&2105344&&(f.onRowDragOver=l),s[0]&2097152&&(f.onRowDrop=r),s[0]&2097152&&(f.onRowClick=o),s[0]&6&&(f.onClipClick=t[67]),s[0]&6&&(f.onClipKeyDown=t[68]),e.$set(f)},i(a){n||(K(e.$$.fragment,a),n=!0)},o(a){Z(e.$$.fragment,a),n=!1},d(a){me(e,a)}}}function ol(t){let e,n,l,r=t[10][0]&&il(t);return{c(){e=M("div"),n=M("div"),r&&r.c(),this.h()},l(o){e=y(o,"DIV",{class:!0});var a=A(e);n=y(a,"DIV",{class:!0});var s=A(n);r&&r.l(s),s.forEach(D),a.forEach(D),this.h()},h(){k(n,"class","automation-windows-container"),k(e,"class","automation-panel-container")},m(o,a){W(o,e,a),C(e,n),r&&r.m(n,null),l=!0},p(o,a){o[10][0]?r?(r.p(o,a),a[0]&1024&&K(r,1)):(r=il(o),r.c(),K(r,1),r.m(n,null)):r&&(Ue(),Z(r,1,1,()=>{r=null}),He())},i(o){l||(K(r),l=!0)},o(o){Z(r),l=!1},d(o){o&&D(e),r&&r.d()}}}function il(t){let e,n;return e=new ir({props:{automationWindow:t[10][0]}}),{c(){ve(e.$$.fragment)},l(l){ge(e.$$.fragment,l)},m(l,r){pe(e,l,r),n=!0},p(l,r){const o={};r[0]&1024&&(o.automationWindow=l[10][0]),e.$set(o)},i(l){n||(K(e.$$.fragment,l),n=!0)},o(l){Z(e.$$.fragment,l),n=!1},d(l){me(e,l)}}}function jr(t){let e,n,l,r,o,a;e=new vl({});const s=[Xr,Kr],f=[];function u(_,h){return _[11]?0:1}return l=u(t),r=f[l]=s[l](t),{c(){ve(e.$$.fragment),n=z(),r.c(),o=Ee()},l(_){ge(e.$$.fragment,_),n=R(_),r.l(_),o=Ee()},m(_,h){pe(e,_,h),W(_,n,h),f[l].m(_,h),W(_,o,h),a=!0},p(_,h){let p=l;l=u(_),l===p?f[l].p(_,h):(Ue(),Z(f[p],1,1,()=>{f[p]=null}),He(),r=f[l],r?r.p(_,h):(r=f[l]=s[l](_),r.c()),K(r,1),r.m(o.parentNode,o))},i(_){a||(K(e.$$.fragment,_),K(r),a=!0)},o(_){Z(e.$$.fragment,_),Z(r),a=!1},d(_){_&&(D(n),D(o)),me(e,_),f[l].d(_)}}}const Pt=280,sl=(t,e)=>t.order-e.order;function qr(t,e,n){let l,r,o,a,s,f,u,_,h,p,b,d,T,g,i,c;mt(t,Rt,S=>n(10,T=S)),mt(t,ul,S=>n(85,g=S)),mt(t,en,S=>n(86,i=S)),mt(t,kl,S=>n(59,c=S));let m,v,w=!0;Q.subscribe(S=>{n(55,m=S),m&&w&&setTimeout(()=>{n(11,w=!1)},100)}),dl.subscribe(S=>n(56,v=S));let E=null;Ut(()=>{if(n(11,w=!0),Tl.stopLoading(),m&&m.id===i.params.id){n(11,w=!1);return}const S=localStorage.getItem(`project_${i.params.id}`);if(S)try{const F=JSON.parse(S);Q.set(F)}catch(F){console.error("Failed to load project:",F),n(11,w=!1)}else!m&&i.params.id&&Q.set({id:i.params.id,title:"New Project",bpm:120,tracks:[],patterns:[],effects:[],envelopes:[],timeline:{tracks:[],clips:[],effects:[],envelopes:[],totalLength:16}});typeof document<"u"&&document.documentElement.style.setProperty("--sidebar-width",`${Pt}px`);const U=Q.subscribe(F=>{F&&i.params.id&&localStorage.setItem(`project_${i.params.id}`,JSON.stringify(F))});return()=>{U()}});const I=ot.ROW_LABEL_WIDTH;let N=ot.BASE_ZOOM;const H=ot.BASE_PIXELS_PER_BEAT;function G(S){if(!S.ctrlKey&&!S.metaKey)return;S.preventDefault(),S.stopPropagation();const U=S.deltaY>0?-.5:.5;n(0,N=dr(N,U))}function j(S){return ct(S,_)}function le(S){return cr(S,_)}function $(S){return S&&r.find(U=>U.id===S)||null}function ue(){if(!m){console.error("Cannot create pattern: no project exists");return}try{const S=i.params.id;if(!S){console.error("Cannot create pattern: project ID is missing");return}const U=Q.createPattern(S,`Pattern ${r.length+1}`);Q.addPattern(U),nn(`/project/${S}/pattern/${U.id}`)}catch(S){console.error("Error creating pattern:",S)}}function P(S){Q.deletePattern(S)}async function L(S){const{loadingStore:U}=await pl(async()=>{const{loadingStore:te}=await import("../chunks/Ue2r4fdp.js");return{loadingStore:te}},__vite__mapDeps([0,1,2]),import.meta.url);U.startLoading("Loading pattern editor...");const F=i.params.id;F&&await nn(`/project/${F}/pattern/${S}`)}function ae(S,U,F){var Be;if(!m)return;const te=r.find(ee=>ee.id===S);if(!te)return;const se=Qe(U),ke=te.baseMeter;let Ie=F;if(!Ie){const ee=(Be=s.tracks)==null?void 0:Be.find(Re=>Re.type==="pattern");if(ee)Ie=ee.id;else{const Re=Q.createTimelineTrack("pattern",S,te.name);Q.addTimelineTrack(Re),Ie=Re.id}}const _e={id:crypto.randomUUID(),patternId:S,trackId:Ie,startBeat:se,duration:ke};Q.addTimelineClip(_e),l==="arrangement"&&window.dispatchEvent(new CustomEvent("reloadProject"))}function q(S){Q.deleteTimelineClip(S)}let J=null,ie=null,de=null,be=null,ne=null,oe=null,Ce=null,De=null;function Te(S,U){l==="arrangement"&&(U.type==="effect"?ie=U.id:de=U.id,S.dataTransfer&&(S.dataTransfer.effectAllowed="copy",S.dataTransfer.setData("application/json",JSON.stringify(U))))}function Pe(S,U,F="clip"){var ke,Ie;if(S.button!==0)return;S.stopPropagation();const se=S.target.closest(".clip-resize-handle-left, .clip-resize-handle-right");if(se){Q.startBatch();const _e=se.classList.contains("clip-resize-handle-left")?"left":"right",Be=S.currentTarget;if(!Be)return;const ee=(ke=Be.closest(".timeline-area"))==null?void 0:ke.getBoundingClientRect();if(!ee)return;const Re=S.clientX-ee.left-I;n(14,Ce={type:F,id:U.id,side:_e,startBeat:U.startBeat,startDuration:U.duration,startX:Re})}else{Q.startBatch();const _e=S.currentTarget;if(!_e)return;const Be=(Ie=_e.closest(".timeline-area"))==null?void 0:Ie.getBoundingClientRect();if(!Be)return;const ee=S.clientX-Be.left-I;n(15,De={type:F,id:U.id,startBeat:U.startBeat,startX:ee})}}function Ye(S){var te,se,ke,Ie,_e,Be;if(!Ce&&!De||!S||!S.currentTarget)return;const U=S.currentTarget;if(!U)return;const F=U.getBoundingClientRect();if(F){if(Ce){const ee=Ce,ft=S.clientX-F.left-I-ee.startX,Je=le(ft);if(ee.type==="clip"){if((te=s.clips)==null?void 0:te.find(Ke=>Ke.id===ee.id))if(ee.side==="right"){const Ke=Math.max(.25,Qe(ee.startDuration+Je));Q.updateTimelineClip(ee.id,{duration:Ke})}else{const Ke=Math.max(0,Qe(ee.startBeat+Je)),nt=Math.max(.25,Qe(ee.startDuration-Je));nt>0&&Q.updateTimelineClip(ee.id,{startBeat:Ke,duration:nt})}}else if(ee.type==="effect"){if((se=s.effects)==null?void 0:se.find(Ke=>Ke.id===ee.id))if(ee.side==="right"){const Ke=Math.max(.25,Qe(ee.startDuration+Je));Q.updateTimelineEffect(ee.id,{duration:Ke})}else{const Ke=Math.max(0,Qe(ee.startBeat+Je)),nt=Math.max(.25,Qe(ee.startDuration-Je));nt>0&&Q.updateTimelineEffect(ee.id,{startBeat:Ke,duration:nt})}}else if(ee.type==="envelope"&&((ke=s.envelopes)==null?void 0:ke.find(Ke=>Ke.id===ee.id)))if(ee.side==="right"){const Ke=Math.max(.25,Qe(ee.startDuration+Je));Q.updateTimelineEnvelope(ee.id,{duration:Ke})}else{const Ke=Math.max(0,Qe(ee.startBeat+Je)),nt=Math.max(.25,Qe(ee.startDuration-Je));nt>0&&Q.updateTimelineEnvelope(ee.id,{startBeat:Ke,duration:nt})}}else if(De){const ee=De,ft=S.clientX-F.left-I-ee.startX,Je=le(ft),It=Math.max(0,Qe(ee.startBeat+Je));ee.type==="clip"?(Ie=s.clips)!=null&&Ie.find(nt=>nt.id===ee.id)&&Q.updateTimelineClip(ee.id,{startBeat:It}):ee.type==="effect"?(_e=s.effects)!=null&&_e.find(nt=>nt.id===ee.id)&&Q.updateTimelineEffect(ee.id,{startBeat:It}):ee.type==="envelope"&&((Be=s.envelopes)!=null&&Be.find(nt=>nt.id===ee.id))&&Q.updateTimelineEnvelope(ee.id,{startBeat:It})}}}function xe(){(Ce||De)&&Q.endBatch(),n(14,Ce=null),n(15,De=null)}function Y(S,U,F){if(l!=="arrangement")return;const te=S.target;if(!(te&&(te.closest(".timeline-clip")||te.closest(".clip-controls")||te.closest(".clip-resize-handle-left")||te.closest(".clip-resize-handle-right")||te.closest("button")))&&F){const se=S.currentTarget;if(!se)return;const ke=se.getBoundingClientRect(),Ie=S.clientX-ke.left-I,_e=Math.max(0,Qe(le(Ie)));ae(F,_e,U)}}function he(S){const U=S.relatedTarget,F=S.currentTarget;(!U||!F.contains(U))&&(n(13,be=null),n(17,st=null))}function ye(S,U){var Ie,_e,Be;S.preventDefault(),n(13,be=null);const F=S.currentTarget;if(!F)return;const te=F.getBoundingClientRect(),se=S.clientX-te.left-I,ke=Math.max(0,Qe(le(se)));try{const ee=(Ie=S.dataTransfer)==null?void 0:Ie.getData("application/json");if(ee){const Re=JSON.parse(ee);Re.type==="pattern"&&U.type==="pattern"?(ae(Re.id,ke,U.id),J=null):Re.type==="effect"&&U.type==="effect"?(Fe(Re.id,ke,4,void 0,U.id),ie=null):Re.type==="envelope"&&U.type==="envelope"&&($e(Re.id,ke,4,void 0,U.id),de=null)}else{const Re=(_e=S.dataTransfer)==null?void 0:_e.getData("text/plain");if(Re&&!((Be=s.tracks)!=null&&Be.find(ft=>ft.id===Re))){const ft=Re;ft&&U.type==="pattern"&&r.find(Je=>Je.id===ft)&&(ae(ft,ke,U.id),J=null)}}}catch(ee){console.error("Error handling drop:",ee)}}function Fe(S,U,F,te,se){var _e;if(!m)return;let ke=se;if(!ke){const Be=(_e=s.tracks)==null?void 0:_e.find(ee=>ee.type==="effect");if(Be)ke=Be.id;else{const ee=Q.createTimelineTrack("effect");Q.addTimelineTrack(ee),ke=ee.id}}const Ie={id:crypto.randomUUID(),effectId:S,trackId:ke,startBeat:Qe(U),duration:F,patternId:te||void 0};Q.addTimelineEffect(Ie),l==="arrangement"&&window.dispatchEvent(new CustomEvent("reloadProject"))}function $e(S,U,F,te,se){var _e;if(!m)return;let ke=se;if(!ke){const Be=(_e=s.tracks)==null?void 0:_e.find(ee=>ee.type==="envelope");if(Be)ke=Be.id;else{const ee=Q.createTimelineTrack("envelope");Q.addTimelineTrack(ee),ke=ee.id}}const Ie={id:crypto.randomUUID(),envelopeId:S,trackId:ke,startBeat:Qe(U),duration:F,patternId:te||void 0};Q.addTimelineEnvelope(Ie),l==="arrangement"&&window.dispatchEvent(new CustomEvent("reloadProject"))}function it(S){Q.deleteTimelineEffect(S)}function et(S){Q.deleteTimelineEnvelope(S)}let at=!1;function yt(S,U){if(!m)return;const F=Q.createTimelineTrack(S,U);Q.addTimelineTrack(F),n(3,at=!1)}function Et(S){S.target.closest(".add-track-dropdown-ruler")||n(3,at=!1)}let Ze=null,st=null;function Mt(S,U){S.stopPropagation(),n(16,Ze=U),S.dataTransfer&&(S.dataTransfer.effectAllowed="move",S.dataTransfer.setData("application/json",JSON.stringify({type:"track-reorder",trackId:U})),S.dataTransfer.setData("text/plain",U))}function St(S,U){S.preventDefault(),S.stopPropagation(),S.dataTransfer&&(S.dataTransfer.dropEffect="move"),Ze&&Ze!==U&&n(17,st=U)}function Bt(S){S.stopPropagation(),n(17,st=null)}function At(S,U){if(S.preventDefault(),S.stopPropagation(),!Ze||!m||Ze===U){n(16,Ze=null),n(17,st=null);return}const F=[...s.tracks||[]].sort((_e,Be)=>_e.order-Be.order),te=F.find(_e=>_e.id===Ze),se=F.find(_e=>_e.id===U);if(!te||!se){n(16,Ze=null),n(17,st=null);return}const ke=F.indexOf(te),Ie=F.indexOf(se);if(ke===Ie){n(16,Ze=null),n(17,st=null);return}F.splice(ke,1),F.splice(Ie,0,te),F.forEach((_e,Be)=>{_e.order!==Be&&Q.updateTimelineTrack(_e.id,{order:Be})}),n(16,Ze=null),n(17,st=null)}function Vt(S){Q.deleteTimelineTrack(S)}function O(S,U){S.stopPropagation(),S.preventDefault();const F=S.currentTarget.querySelector(".track-volume-bar");if(!F)return;const te=F.getBoundingClientRect(),se=S.clientY-te.top,ke=te.height,Ie=Math.max(0,Math.min(2,2*(1-se/ke)));tt(U,Ie);const _e=ee=>{const Re=F.getBoundingClientRect(),ft=ee.clientY-Re.top,Je=Math.max(0,Math.min(2,2*(1-ft/Re.height)));tt(U,Je)},Be=()=>{window.removeEventListener("mousemove",_e),window.removeEventListener("mouseup",Be)};window.addEventListener("mousemove",_e),window.addEventListener("mouseup",Be)}function tt(S,U){Q.updateTimelineTrack(S,{volume:U});const F=g;F&&F.updateTimelineTrackVolume(S,U)}function _t(S){if(!m||!m.timeline)return;const U=m.timeline.tracks.find(se=>se.id===S);if(!U)return;const F=!(U.mute??!1);Q.updateTimelineTrack(S,{mute:F});const te=g;te&&te.updateTimelineTrackMute(S,F)}function Nt(S){if(!m||!m.timeline)return;const U=m.timeline.tracks.find(se=>se.id===S);if(!U)return;const F=!(U.solo??!1);F&&m.timeline.tracks.forEach(se=>{if(se.id!==S&&se.type==="pattern"){Q.updateTimelineTrack(se.id,{solo:!1});const ke=g;ke&&ke.updateTimelineTrackSolo(se.id,!1)}}),Q.updateTimelineTrack(S,{solo:F});const te=g;te&&te.updateTimelineTrackSolo(S,F)}function vt(S){return(s.clips||[]).filter(U=>U.trackId===S)}function Ot(S){return(s.effects||[]).filter(U=>U.trackId===S)}function ht(S){return(s.envelopes||[]).filter(U=>U.trackId===S)}function wt(S,U){if(!m||!m.automation)return[];const F=[],te=m.automation,se=T.find(ke=>ke.targetType==="effect"&&ke.targetId===S&&ke.timelineInstanceId===U);for(const[ke,Ie]of Object.entries(te))if(Ie&&typeof Ie=="object"&&"targetType"in Ie&&"targetId"in Ie){const _e=Ie;_e.targetType==="effect"&&_e.targetId===S&&_e.timelineInstanceId===U&&(!se||_e.parameterKey===se.parameterKey)&&_e.points&&_e.points.length>0&&F.push({automation:_e,parameterKey:_e.parameterKey})}return F}Ut(()=>{Q.subscribe(S=>{if(S&&S.standaloneInstruments){const U=S.standaloneInstruments.filter(F=>F.id.startsWith("__pattern_"));U.length>0&&setTimeout(()=>{for(const F of U)Q.removeStandaloneInstrument(F.id)},100)}})()});function Lt(S){E=S,n(12,E)}const zt=()=>n(3,at=!at);function Dt(S){at=S,n(3,at)}const Ht=(S,U)=>{U.preventDefault(),U.dataTransfer&&(U.dataTransfer.dropEffect="copy"),n(13,be=S.id)},Kt=(S,U)=>ye(U,S),Xt=(S,U)=>Y(U,S.id,S.patternId),Ft=(S,U)=>{Q.updateTimelineTrack(S,{color:U})},Yt=(S,U)=>{U==="effect"?(n(1,ne=S),n(2,oe=null)):U==="envelope"&&(n(2,oe=S),n(1,ne=null))},jt=(S,U)=>{U==="effect"?(n(1,ne=S),n(2,oe=null)):U==="envelope"&&(n(2,oe=S),n(1,ne=null))},qt=(S,U)=>{U==="clip"?q(S):U==="effect"?it(S):U==="envelope"&&et(S)},Gt=(S,U,F)=>Fe(S,U,4,void 0,F),Zt=(S,U,F)=>$e(S,U,4,void 0,F),Jt=S=>G(S),Qt=S=>Ye(S),xt=()=>xe(),B=()=>xe(),Se=S=>L(S.id);return t.$$.update=()=>{var S,U;if(t.$$.dirty[1]&268435456&&n(4,l=c),t.$$.dirty[1]&16777216&&n(8,r=(m==null?void 0:m.patterns)||[]),t.$$.dirty[1]&16777216&&n(7,o=(m==null?void 0:m.effects)||[]),t.$$.dirty[1]&16777216&&n(5,a=(m==null?void 0:m.envelopes)||[]),t.$$.dirty[1]&16777216&&n(6,s=(m==null?void 0:m.timeline)||{tracks:[],clips:[],effects:[],envelopes:[],totalLength:16}),t.$$.dirty[0]&64&&s&&!s.tracks&&n(6,s.tracks=[],s),t.$$.dirty[0]&64&&n(21,f=s.tracks||[]),t.$$.dirty[1]&33554432&&n(20,u=(v==null?void 0:v.currentTime)||0),t.$$.dirty[1]&16777216&&m!=null&&m.bpm,t.$$.dirty[0]&320|t.$$.dirty[1]&16777216&&m&&s&&(!s.tracks||s.tracks.length===0)){const F=r.find(te=>te.name==="Pattern 1")||r[0];if(F){const te=Q.createTimelineTrack("pattern",F.id,"Pattern 1"),se=Q.createTimelineTrack("effect",void 0,"Effects"),ke=Q.createTimelineTrack("envelope",void 0,"Envelopes");Q.addTimelineTrack(te),Q.addTimelineTrack(se),Q.addTimelineTrack(ke)}}if(t.$$.dirty[0]&1&&n(9,_=H*N),t.$$.dirty[0]&576&&_l((s==null?void 0:s.totalLength)||0,_),t.$$.dirty[0]&576&&ml((s==null?void 0:s.totalLength)||0,_),t.$$.dirty[0]&1,t.$$.dirty[0]&8&&(at&&typeof window<"u"?window.addEventListener("click",Et):typeof window<"u"&&window.removeEventListener("click",Et)),t.$$.dirty[0]&320&&(()=>{const F=new Map;for(const te of r)F.set(te.id,(s.clips||[]).filter(se=>se.patternId===te.id));return F})(),t.$$.dirty[0]&192&&n(58,h=(s.effects||[]).map(F=>{const te=o.find(se=>se.id===F.effectId);return{...F,effect:te}}).filter(F=>F.effect)),t.$$.dirty[0]&96&&n(57,p=(s.envelopes||[]).map(F=>{const te=a.find(se=>se.id===F.envelopeId);return{...F,envelope:te}}).filter(F=>F.envelope)),t.$$.dirty[0]&2|t.$$.dirty[1]&134217728&&n(19,b=ne&&((S=h.find(F=>F.id===ne))==null?void 0:S.effectId)||null),t.$$.dirty[0]&4|t.$$.dirty[1]&67108864&&n(18,d=oe&&((U=p.find(F=>F.id===oe))==null?void 0:U.envelopeId)||null),t.$$.dirty[0]&1046){const F=T;if(F.length>0)if(!ne&&!oe)Rt.closeAll();else if(l!=="arrangement")Rt.closeAll();else for(const te of F){let se=!1;te.targetType==="effect"?(!ne||te.timelineInstanceId!==ne)&&(se=!0):te.targetType==="envelope"&&(!oe||te.timelineInstanceId!==oe)&&(se=!0),se&&Rt.closeWindow(te.id)}}},typeof document<"u"&&document.documentElement.style.setProperty("--sidebar-width",`${Pt}px`),[N,ne,oe,at,l,a,s,o,r,_,T,w,E,be,Ce,De,Ze,st,d,b,u,f,I,G,j,$,ue,P,L,ae,q,Te,Pe,Ye,xe,Y,he,ye,Fe,$e,it,et,yt,Mt,St,Bt,At,Vt,O,_t,Nt,vt,Ot,ht,wt,m,v,p,h,c,Lt,zt,Dt,Ht,Kt,Xt,Ft,Yt,jt,qt,Gt,Zt,Jt,Qt,xt,B,Se]}class na extends ut{constructor(e){super(),dt(this,e,qr,jr,rt,{},null,[-1,-1,-1,-1])}}export{na as component};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["../chunks/KHC7JF7e.js","../chunks/C-KikI3b.js","../chunks/C1FmrZbK.js","../chunks/IHki7fMi.js","../chunks/6De2MNrw.js","../chunks/BJF9mgOB.js","../chunks/CpFYu2kg.js","../assets/ProjectSkeleton.CxRvAczO.css"])))=>i.map(i=>d[i]);
import{S as Pe,i as $e,s as Ne,n as Ve,d as P,N as Fe,a as Ue,H as me,b as W,c as C,m as ie,Q as Rn,o as $,e as D,f as j,h as F,q as le,g as ke,j as E,k as U,t as be,_ as Fn,O as Un,u as z,v as L,Z as Ee,w as We,x as Ye,y as Oe,A as It,D as H,F as X,G as K,E as G,$ as Mn,T as Ce,I as Le,P as _t,R as Xe,l as bt,a0 as Dn}from"../chunks/C-KikI3b.js";import{s as Se,d as Dt,f as An,a as De,p as Ln,e as Ie,N as vt,P as te,g as kt,h as Et,i as tt,j as Pt,k as Rt,u as Ge,l as Je,v as $t,c as On,T as zn}from"../chunks/KHC7JF7e.js";import"../chunks/IHki7fMi.js";import{b as Bn,g as jn}from"../chunks/6De2MNrw.js";import{projectStore as Z}from"../chunks/CpFYu2kg.js";import{loadingStore as Nt}from"../chunks/Ue2r4fdp.js";import{_ as Wn}from"../chunks/C1FmrZbK.js";import{p as Yn}from"../chunks/DZoq5sg5.js";function Be(s,t){const{patternId:e,trackId:n,instrumentId:o}=t;if(!s)return console.warn("[PatternTreeUpdater] No engine available"),!1;let a=null;return Z.subscribe(d=>{a=d})(),a?e?qn(s,a,e,o):n?Hn(s,a,n):(console.warn("[PatternTreeUpdater] No patternId or trackId provided",t),!1):(console.warn("[PatternTreeUpdater] No project available"),!1)}function qn(s,t,e,n){var r,c;const o=(r=t.patterns)==null?void 0:r.find(_=>_.id===e);if(!o)return console.warn("[PatternTreeUpdater] Pattern not found",{patternId:e,availablePatterns:(c=t.patterns)==null?void 0:c.map(_=>_.id)}),!1;const a=Z.getPatternInstruments(o);if(a.length===0)return console.warn("[PatternTreeUpdater] Pattern has no instruments",{patternId:e}),!1;const i=n?a.find(_=>_.id===n):a[0];if(!i)return console.warn("[PatternTreeUpdater] Instrument not found",{patternId:e,instrumentId:n,availableInstruments:a.map(_=>_.id)}),!1;if(!i.patternTree)return console.warn("[PatternTreeUpdater] Instrument has no pattern tree",{patternId:e,instrumentId:i.id}),!1;const d=`__pattern_${e}_${i.id}`,l=o.baseMeter||4;return s.updatePatternTree(d,i.patternTree,l),!0}function Hn(s,t,e){var o,a;const n=(o=t.standaloneInstruments)==null?void 0:o.find(i=>i.id===e);return n?n.patternTree?(s.updatePatternTree(e,n.patternTree),!0):(console.warn("[PatternTreeUpdater] Standalone instrument has no pattern tree",{instrumentId:e}),!1):(console.warn("[PatternTreeUpdater] Standalone instrument not found",{instrumentId:e,availableInstruments:(a=t.standaloneInstruments)==null?void 0:a.map(i=>i.id)}),!1)}function je(s){var t,e,n,o,a,i,d,l,r;return{patternId:s.patternId??((t=s.editingNode)==null?void 0:t.patternId)??((e=s.menu)==null?void 0:e.patternId)??((n=s.selection)==null?void 0:n.selectedPatternId)??null,trackId:s.trackId??((o=s.editingNode)==null?void 0:o.trackId)??((a=s.menu)==null?void 0:a.trackId)??((i=s.selection)==null?void 0:i.selectedTrackId)??null,instrumentId:s.instrumentId??((d=s.editingNode)==null?void 0:d.instrumentId)??((l=s.menu)==null?void 0:l.instrumentId)??((r=s.selection)==null?void 0:r.selectedInstrumentId)??null}}class Xn{constructor(t=0,e=0,n=1){this.x=t,this.y=e,this.zoom=n}worldToScreen(t,e){return[(t-this.x)*this.zoom,(e-this.y)*this.zoom]}screenToWorld(t,e){return[t/this.zoom+this.x,e/this.zoom+this.y]}applyTransform(t){t.save(),t.translate(-this.x*this.zoom,-this.y*this.zoom),t.scale(this.zoom,this.zoom)}restoreTransform(t){t.restore()}}class Kn{constructor(t,e){this.ctx=t,this.viewport=e}renderNode(t,e,n,o,a=()=>!1,i,d=!1){if(t.x===void 0||t.y===void 0)return;const[l,r]=this.viewport.worldToScreen(t.x,t.y);let c,_;n===0?(c=50,_=1):(c=18,_=.5);const m=c*this.viewport.zoom;if(l+m<0||l-m>this.ctx.canvas.width||r+m<0||r-m>this.ctx.canvas.height)return;t.children.length>0&&this.renderConnections(t,e,a,d);const y=d?"#666666":this.muteColor(e),p=t.velocity!==void 0&&t.velocity!==null&&t.children.length===0,b=p?t.velocity??1:1;if(this.ctx.beginPath(),this.ctx.arc(l,r,m,0,Math.PI*2),p&&b<1){this.ctx.strokeStyle=d?`rgba(102, 102, 102, ${_*.5})`:this.hexToRgba(y,_*.3),this.ctx.lineWidth=2*this.viewport.zoom,this.ctx.stroke();const f=m*2*b,w=r+m-f;if(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(l,r,m,0,Math.PI*2),this.ctx.clip(),n===0){const h=this.ctx.createLinearGradient(l,w,l,r+m);d?(h.addColorStop(0,"#666666"),h.addColorStop(1,"#888888")):(h.addColorStop(0,this.lightenColor(y,.1)),h.addColorStop(1,y)),this.ctx.fillStyle=h}else{const h=d?`rgba(102, 102, 102, ${_})`:this.hexToRgba(y,_);this.ctx.fillStyle=h}this.ctx.fillRect(l-m,w,m*2,f),this.ctx.restore()}else{if(n===0){const f=this.ctx.createRadialGradient(l-m*.2,r-m*.2,0,l,r,m);d?(f.addColorStop(0,"#888888"),f.addColorStop(.7,"#666666"),f.addColorStop(1,"#444444")):(f.addColorStop(0,this.lightenColor(y,.15)),f.addColorStop(.7,y),f.addColorStop(1,this.darkenColor(y,.2))),this.ctx.fillStyle=f}else{const f=d?`rgba(102, 102, 102, ${_})`:this.hexToRgba(y,_);this.ctx.fillStyle=f}this.ctx.fill()}a(t.id)?(this.ctx.shadowColor="#00ff88",this.ctx.shadowBlur=15*this.viewport.zoom,this.ctx.strokeStyle="#00ff88",this.ctx.lineWidth=3*this.viewport.zoom):o?(this.ctx.shadowColor="#7ab8ff",this.ctx.shadowBlur=8*this.viewport.zoom,this.ctx.strokeStyle="#7ab8ff",this.ctx.lineWidth=2.5*this.viewport.zoom):(this.ctx.shadowBlur=0,n===0?(this.ctx.strokeStyle="rgba(255, 255, 255, 0.3)",this.ctx.lineWidth=2*this.viewport.zoom):(this.ctx.strokeStyle=`rgba(255, 255, 255, ${_*.3})`,this.ctx.lineWidth=1*this.viewport.zoom)),this.ctx.stroke(),this.ctx.shadowBlur=0;let T;n===1&&t.children.length>0?T=t.children.length:T=t.division;const u=n===0?18:10,g=n===0?1:_;if(this.ctx.fillStyle=n===0?"#e8e8e8":`rgba(255, 255, 255, ${g})`,this.ctx.font=`${u}px -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`,this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(T.toString(),l,r),n===0&&i){const f=r+m+20,w=12*this.viewport.zoom;this.ctx.font=`${w}px -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`,this.ctx.fillStyle="#b0b0b0",this.ctx.textAlign="center",this.ctx.textBaseline="top";const h=i.charAt(0).toUpperCase()+i.slice(1);this.ctx.fillText(h,l,f)}}renderConnections(t,e,n,o=!1){if(t.x===void 0||t.y===void 0)return;const a=o?"#666666":this.muteColor(e),i=.2,d=o?`rgba(102, 102, 102, ${i})`:a+Math.floor(i*255).toString(16).padStart(2,"0"),l=r=>{if(r.children.length===0)return n(r.id);for(const c of r.children)if(l(c))return!0;return!1};this.ctx.lineCap="round";for(const r of t.children){if(r.x===void 0||r.y===void 0)continue;l(r)?(this.ctx.strokeStyle="#00ff88",this.ctx.lineWidth=2*this.viewport.zoom,this.ctx.shadowColor="#00ff88",this.ctx.shadowBlur=8*this.viewport.zoom):(this.ctx.strokeStyle=d,this.ctx.lineWidth=1*this.viewport.zoom,this.ctx.shadowBlur=0);const[_,m]=this.viewport.worldToScreen(t.x,t.y),[y,p]=this.viewport.worldToScreen(r.x,r.y);this.ctx.beginPath(),this.ctx.moveTo(_,m),this.ctx.lineTo(y,p),this.ctx.stroke()}this.ctx.shadowBlur=0}muteColor(t){if(t.startsWith("#")){const e=parseInt(t.slice(1),16),n=e>>16&255,o=e>>8&255,a=e&255,i=Math.floor(n*.6+100*.4),d=Math.floor(o*.6+100*.4),l=Math.floor(a*.6+100*.4);return`rgb(${i}, ${d}, ${l})`}return t}lightenColor(t,e){if(t.startsWith("#")){const n=parseInt(t.slice(1),16),o=Math.min(255,(n>>16&255)+e*100),a=Math.min(255,(n>>8&255)+e*100),i=Math.min(255,(n&255)+e*100);return`rgb(${o}, ${a}, ${i})`}return t}darkenColor(t,e){if(t.startsWith("#")){const n=parseInt(t.slice(1),16),o=Math.max(0,(n>>16&255)*(1-e)),a=Math.max(0,(n>>8&255)*(1-e)),i=Math.max(0,(n&255)*(1-e));return`rgb(${o}, ${a}, ${i})`}return t}hexToRgba(t,e){if(t.startsWith("#")){const n=parseInt(t.slice(1),16),o=n>>16&255,a=n>>8&255,i=n&255;return`rgba(${o}, ${a}, ${i}, ${e})`}return t}renderTree(t,e,n,o=()=>!1,a,i=!1){const d=(l,r)=>{this.renderNode(l,e,r,n(l.id),o,r===0?a:void 0,i);for(const c of l.children)d(c,r+1)};d(t,0)}}function Gn(s,t){if(s.key==="Delete"||s.key==="Backspace")Jn(s,t);else if(s.key==="a"||s.key==="A"){const e=s.target;e.tagName!=="INPUT"&&e.tagName!=="TEXTAREA"&&xn(s,t)}}function Jn(s,t){const{project:e,patternId:n,selectionState:o}=t;if(!(!o||o.selectedNodes.size===0||!e)){if(n&&o.selectedPatternId===n){Qn(t);return}if(o.selectedTrackId){Zn(t);return}}}function Qn(s){const{patternId:t,pattern:e,selectionState:n,engine:o}=s,a=n.selectedInstrumentId,i=e!=null&&e.instruments&&Array.isArray(e.instruments)&&e.instruments.length>0?e.instruments:[],d=a?i.find(l=>l.id===a):i[0];if(!(!d||!t)){for(const l of n.selectedNodes)if(d.patternTree.id===l){if(Z.removePatternInstrument(t,d.id),o){const r=`__pattern_${t}_${d.id}`;o.removeTrack(r)}Se.clearSelection();return}else Z.deletePatternNode(t,l,d.id);Be(o,je({patternId:t,instrumentId:a,selection:n})),Se.clearSelection()}}function Zn(s){var i,d;const{project:t,selectionState:e,engine:n}=s,o=(i=t.standaloneInstruments)==null?void 0:i.find(l=>l.id===e.selectedTrackId);if(!o)return;const a=e.selectedTrackId;for(const l of e.selectedNodes)o.patternTree.id===l?(Z.removeStandaloneInstrument(a),n&&n.removeTrack(a)):Z.deleteNode(a,l);(o.patternTree.id!==Array.from(e.selectedNodes)[0]||(d=t.standaloneInstruments)!=null&&d.find(l=>l.id===a))&&Be(n,je({trackId:a,selection:e})),Se.clearSelection()}function xn(s,t){const{project:e,patternId:n,pattern:o,selectionState:a,engine:i}=t;if(!a||a.selectedNodes.size===0||!e)return;s.preventDefault();const d=Array.from(a.selectedNodes)[0];let l=null,r=null,c=null,_=null;const m=(y,p)=>{if(y.id===p)return y;for(const b of y.children){const T=m(b,p);if(T)return T}return null};if(n&&o){const y=o.instruments&&Array.isArray(o.instruments)&&o.instruments.length>0?o.instruments:[];for(const p of y){const b=m(p.patternTree,d);if(b){l=b,r=n,_=p.id;break}}}if(!l)for(const y of e.standaloneInstruments||[]){const p=m(y.patternTree,d);if(p){l=p,c=y.id;break}}l&&(r?Z.addPatternChildNode(r,l.id,1,_):c&&Z.addChildNode(c,l.id,1),setTimeout(()=>{Be(i,je({patternId:r,trackId:c,instrumentId:_,selection:a}))},0))}function Mt(s,t,e,n=0,o,a,i){if(s.x===void 0||s.y===void 0)return null;const d=es(n),l=s.x-t,r=s.y-e,c=Math.sqrt(l*l+r*r);for(const _ of s.children){const m=Mt(_,t,e,n+1,o,a,i);if(m)return m}return c<=d?{node:s,depth:n,isRoot:n===0,patternId:o,trackId:a,instrumentId:i}:null}function Ft(s,t,e,n,o,a=0,i,d,l){const r=new Set,c=new Map,_=new Map,m=new Map;let y=!1;const p=(b,T=0)=>{if(!(b.x===void 0||b.y===void 0)){b.x>=s&&b.x<=t&&b.y>=e&&b.y<=n&&(r.add(b.id),i&&c.set(b.id,i),d&&_.set(b.id,d),l&&m.set(b.id,l),T===0&&(y=!0));for(const u of b.children)p(u,T+1)}};return p(o,a),{selectedNodes:r,nodeToTrackId:c,nodeToPatternId:_,nodeToInstrumentId:m,hasRootNode:y}}function es(s){return s===0?50:18}function ts(s,t,e){var o,a,i,d;const{canvas:n}=t;if(s.button===1)return e.isDragging=!0,e.dragStart={x:s.clientX,y:s.clientY},s.preventDefault(),{startedDragging:!0,startedDraggingNode:!1,startedSelecting:!1,selectionBox:null,clickedNode:null};if(s.button===0){const l=as(s,t);if(l){e.isDraggingNode=!0;const r=n.getBoundingClientRect(),c=s.clientX-r.left,_=s.clientY-r.top,m=p=>({...p,children:p.children.map(m)}),y=l.track?m(((o=l.track)==null?void 0:o.patternTree)||((a=l.instrument)==null?void 0:a.patternTree)):l.instrument?m(l.instrument.patternTree):null;if(y){let p=null;Se.subscribe(u=>p=u)();const b=(i=p==null?void 0:p.selectedNodes)==null?void 0:i.has(l.node.id),T=((d=p==null?void 0:p.selectedNodes)==null?void 0:d.size)>1;(!b||!T)&&(Se.selectNode(l.node.id,l.trackId,l.isRoot,s.ctrlKey||s.metaKey,l.patternId,l.instrumentId),Se.subscribe(u=>p=u)()),e.draggedNode={patternId:l.patternId,trackId:l.trackId,nodeId:l.node.id,selectedNodeIds:(p==null?void 0:p.selectedNodes)||new Set([l.node.id]),originalTree:y,startScreenX:c,startScreenY:_,isRoot:l.isRoot,instrumentId:l.instrumentId}}return s.preventDefault(),{startedDragging:!1,startedDraggingNode:!0,startedSelecting:!1,selectionBox:null,clickedNode:l}}if(!s.ctrlKey&&!s.metaKey&&n){const r=n.getBoundingClientRect(),c={startX:s.clientX-r.left,startY:s.clientY-r.top,endX:s.clientX-r.left,endY:s.clientY-r.top};return Se.clearSelection(),s.preventDefault(),{startedDragging:!1,startedDraggingNode:!1,startedSelecting:!0,selectionBox:c,clickedNode:null}}}return{startedDragging:!1,startedDraggingNode:!1,startedSelecting:!1,selectionBox:null,clickedNode:null}}function ns(s,t,e,n){const{canvas:o,viewport:a,project:i}=t;let d=n,l=null;if(n&&o){const r=o.getBoundingClientRect();return d={...n,endX:s.clientX-r.left,endY:s.clientY-r.top},i&&is(d,t),{updatedSelectionBox:d,updatedDragState:e,pendingPositionUpdate:null}}if(e.isDragging){const r=-(s.clientX-e.dragStart.x)/a.zoom,c=-(s.clientY-e.dragStart.y)/a.zoom;return Dt.pan(r,c),e.dragStart={x:s.clientX,y:s.clientY},{updatedSelectionBox:null,updatedDragState:e,pendingPositionUpdate:null}}return e.isDraggingNode&&e.draggedNode&&o&&(l=ls(s,t,e)),e.lastMousePos={x:s.clientX,y:s.clientY},{updatedSelectionBox:null,updatedDragState:e,pendingPositionUpdate:l}}function ss(s,t){return s.button===1?(t.isDragging=!1,{updatedDragState:t,shouldFinalizeSelection:!1}):s.button===0?(t.isDraggingNode=!1,t.draggedNode=null,{updatedDragState:t,shouldFinalizeSelection:!0}):{updatedDragState:t,shouldFinalizeSelection:!1}}function rs(s,t){s.preventDefault();const{canvas:e}=t;if(!e)return;const n=e.getBoundingClientRect(),o=s.clientX-n.left,a=s.clientY-n.top,i=-s.deltaY*.001;Dt.zoom(i,o,a)}function as(s,t){const{project:e,patternId:n,pattern:o,canvas:a,viewport:i}=t;if(!e||!a)return null;const d=a.getBoundingClientRect(),l=s.clientX-d.left,r=s.clientY-d.top,[c,_]=i.screenToWorld(l,r);for(const m of e.standaloneInstruments||[]){const y=Mt(m.patternTree,c,_,0,null,m.id);if(y)return{node:y.node,isRoot:y.isRoot,patternId:null,trackId:m.id,track:m}}if(n&&o){const m=o.instruments&&Array.isArray(o.instruments)&&o.instruments.length>0?o.instruments:[];for(const y of m){const p=Mt(y.patternTree,c,_,0,n,null,y.id);if(p)return{node:p.node,isRoot:p.isRoot,patternId:n,trackId:null,instrumentId:y.id,instrument:y}}}return null}function ls(s,t,e){const{canvas:n,viewport:o}=t;if(!e.draggedNode||!n)return null;const a=n.getBoundingClientRect(),i=s.clientX-a.left,d=s.clientY-a.top,[l,r]=o.screenToWorld(i,d),[c,_]=o.screenToWorld(e.draggedNode.startScreenX,e.draggedNode.startScreenY),m=l-c,y=r-_,p=u=>{const g=u.x??0,f=u.y??0;return{...u,x:g+m,y:f+y,children:u.children.map(p)}},b=u=>{if(!e.draggedNode)return u;if(e.draggedNode.selectedNodeIds.has(u.id)){const f=u.x??0,w=u.y??0;return{...u,x:f+m,y:w+y,children:u.children.map(b)}}else return{...u,children:u.children.map(b)}},T=e.draggedNode.isRoot?p(e.draggedNode.originalTree):b(e.draggedNode.originalTree);return e.draggedNode.patternId?(e.draggedNode.instrumentId?Z.updatePatternInstrument(e.draggedNode.patternId,e.draggedNode.instrumentId,{patternTree:T},!0):Z.updatePattern(e.draggedNode.patternId,{patternTree:T},!0),{patternId:e.draggedNode.patternId,trackId:null,patternTree:T,instrumentId:e.draggedNode.instrumentId}):e.draggedNode.trackId?(Z.updateStandaloneInstrument(e.draggedNode.trackId,{patternTree:T},!0),{patternId:null,trackId:e.draggedNode.trackId,patternTree:T}):null}function is(s,t){const{project:e,patternId:n,pattern:o,viewport:a}=t;if(!e)return;const[i,d]=a.screenToWorld(s.startX,s.startY),[l,r]=a.screenToWorld(s.endX,s.endY),c=Math.min(i,l),_=Math.max(i,l),m=Math.min(d,r),y=Math.max(d,r),p=new Set;let b=null,T=null,u=null,g=!1;const f=new Map,w=new Map,h=new Map;for(const v of e.standaloneInstruments||[]){const I=p.size,k=Ft(c,_,m,y,v.patternTree,0,v.id);for(const S of k.selectedNodes)p.add(S);k.nodeToTrackId.forEach((S,N)=>f.set(N,S)),k.hasRootNode&&(g=!0),p.size>I&&!b&&(b=v.id)}if(n&&o){const v=o.instruments&&Array.isArray(o.instruments)&&o.instruments.length>0?o.instruments:[];for(const I of v){const k=p.size,S=Ft(c,_,m,y,I.patternTree,0,null,n,I.id);for(const N of S.selectedNodes)p.add(N);S.nodeToPatternId.forEach((N,M)=>w.set(M,N)),S.nodeToInstrumentId.forEach((N,M)=>h.set(M,N)),S.hasRootNode&&(g=!0),p.size>k&&!T&&(T=n,u=I.id)}}if(p.size>0){if(b)T=null,u=null;else if(T&&u){const v=Array.from(p).map(I=>h.get(I)).filter(I=>I!==void 0);v.length>0&&v.every(I=>I===v[0]),u=v[0]||null}}p.size>0?Se.selectMultipleNodes(p,b,g,T,u):Se.clearSelection()}function os(s,t){const{project:e,patternId:n,pattern:o,canvas:a,viewport:i}=t;if(!e||!a)return null;const d=a.getBoundingClientRect(),l=s.clientX-d.left,r=s.clientY-d.top,[c,_]=i.screenToWorld(l,r),m=y=>{const p=(b,T=0)=>{if(b.x===void 0||b.y===void 0)return;for(const h of b.children){const v=p(h,T+1);if(v)return v}const u=b.x-c,g=b.y-_,f=Math.sqrt(u*u+g*g),w=cs(T);return f<=w?{node:b,isRoot:T===0}:null};return p(y)};for(const y of e.standaloneInstruments||[]){const p=m(y.patternTree);if(p)return{x:s.clientX,y:s.clientY,node:p.node,patternId:null,trackId:y.id,isRoot:p.isRoot}}if(n&&o){const y=o.instruments&&Array.isArray(o.instruments)&&o.instruments.length>0?o.instruments:[];for(const p of y){const b=m(p.patternTree);if(b)return{x:s.clientX,y:s.clientY,node:b.node,patternId:n,trackId:null,instrumentId:p.id,isRoot:b.isRoot}}}return null}function cs(s){return s===0?50:18}function us(s,t){const{type:e}=s.detail,{menu:n,project:o,engine:a}=t;if(!n||!n.node)return{editingNode:null,editValue:""};const i=n.node;switch(e){case"copy":ds(n,a);break;case"addChild":fs(n,i,a);break;case"delete":ms(n,i,o,a);break;case"edit":return{editingNode:{node:i,patternId:n.patternId,trackId:n.trackId,instrumentId:n.instrumentId},editValue:i.division.toString()}}return{editingNode:null,editValue:""}}function ds(s,t){var e;if(s.patternId&&s.isRoot)if(s.instrumentId){const n=(e=s.node)==null?void 0:e.id;Z.copyPatternInstrument(s.patternId,s.instrumentId),setTimeout(()=>{var l;let o=null;if(Z.subscribe(r=>o=r)(),!o)return;const a=(l=o.patterns)==null?void 0:l.find(r=>r.id===s.patternId);if(!a)return;const d=(a.instruments&&Array.isArray(a.instruments)&&a.instruments.length>0?a.instruments:[]).find(r=>{var c;return((c=r.patternTree)==null?void 0:c.id)&&r.patternTree.id!==n&&r.id!==s.instrumentId});if(d&&(Se.selectNode(d.patternTree.id,null,!0,!1,s.patternId,d.id),t)){const r=`__pattern_${s.patternId}_${d.id}`,c={id:r,projectId:a.projectId,instrumentType:d.instrumentType,patternTree:d.patternTree,settings:d.settings||{},instrumentSettings:d.instrumentSettings,volume:d.volume??1,pan:d.pan??0,color:d.color,mute:d.mute??!1,solo:d.solo??!1};t.updateTrack(r,c)}},0),window.dispatchEvent(new CustomEvent("reloadProject"))}else Z.copyPattern(s.patternId),window.dispatchEvent(new CustomEvent("reloadProject"));else s.trackId&&s.isRoot&&(Z.copyTrack(s.trackId),window.dispatchEvent(new CustomEvent("reloadProject")))}function fs(s,t,e){s.patternId?Z.addPatternChildNode(s.patternId,t.id,1,s.instrumentId):s.trackId&&Z.addChildNode(s.trackId,t.id,1),setTimeout(()=>{Be(e,je({menu:s}))},0)}function ms(s,t,e,n){var a;let o=!1;if(s.isRoot){if(s.patternId)if(s.instrumentId){if(Z.removePatternInstrument(s.patternId,s.instrumentId),o=!0,n){const i=`__pattern_${s.patternId}_${s.instrumentId}`;n.removeTrack(i)}}else{const i=(a=e==null?void 0:e.patterns)==null?void 0:a.find(d=>d.id===s.patternId);if(i){const d=i.instruments&&Array.isArray(i.instruments)&&i.instruments.length>0?i.instruments:[],l=d.find(r=>{var c,_;return((c=r.patternTree)==null?void 0:c.id)===((_=s.node)==null?void 0:_.id)});if(l){if(Z.removePatternInstrument(s.patternId,l.id),o=!0,n){const r=`__pattern_${s.patternId}_${l.id}`;n.removeTrack(r)}}else if(d.length>0&&(Z.removePatternInstrument(s.patternId,d[0].id),o=!0,n)){const r=`__pattern_${s.patternId}_${d[0].id}`;n.removeTrack(r)}}}else s.trackId&&(Z.removeStandaloneInstrument(s.trackId),n&&n.removeTrack(s.trackId));Se.clearSelection()}else s.patternId?Z.deletePatternNode(s.patternId,t.id,s.instrumentId):s.trackId&&Z.deleteNode(s.trackId,t.id),Se.clearSelection();o||Be(n,je({menu:s}))}function ps(s){const{project:t,patternId:e,pattern:n,playbackState:o}=s;return!t||!(o!=null&&o.playingNodes)?new Set:e&&n?hs(e,n,o):gs(t,o)}function hs(s,t,e){const n=new Set,o=t.instruments&&Array.isArray(t.instruments)&&t.instruments.length>0?t.instruments:[],a=t.baseMeter||4;for(const i of o){const d=`__pattern_${s}_${i.id}`,l=a,{nodeToParent:r,timeToNodes:c}=En(i.patternTree,l),_=.001;for(const m of e.playingNodes){const[y,p]=m.split(":");if(y===d){const T=parseFloat(p)%l;let u=c.get(T);if(!u){for(const[g,f]of c.entries())if(Math.abs(g-T)<_){u=f;break}}if(u)for(const g of u){let f=g;for(;f!==null;)n.add(f),f=r.get(f)||null}}}}return n}function gs(s,t){var i,d,l,r;const e=new Set,n=s.baseMeterTrackId||((d=(i=s.standaloneInstruments)==null?void 0:i[0])==null?void 0:d.id),o=(l=s.standaloneInstruments)==null?void 0:l.find(c=>c.id===n),a=((r=o==null?void 0:o.patternTree)==null?void 0:r.division)||4;for(const c of s.standaloneInstruments||[]){const _=c.patternTree.division,{nodeToParent:m,timeToNodes:y}=En(c.patternTree,_);An(c.patternTree,c.id);const p=.001;for(const b of t.playingNodes){const[T,u]=b.split(":");if(T===c.id){let g=parseFloat(u);_<a&&(g=g%_);let f=y.get(g);if(!f){for(const[w,h]of y.entries())if(Math.abs(w-g)<p){f=h;break}}if(f)for(const w of f){let h=w;for(;h!==null;)e.add(h),h=m.get(h)||null}}}}return e}function En(s,t){const e=new Map,n=new Map,o=(i,d)=>{e.set(i.id,d);for(const l of i.children)o(l,i.id)};o(s,null);const a=(i,d,l)=>{if(i.children.length===0){const r=n.get(d)||[];r.push(i.id),n.set(d,r)}else{const r=i.children.reduce((_,m)=>_+(m.division||1),0);let c=d;for(const _ of i.children){const m=_.division||1,y=l*(m/r);a(_,c,y),c+=y}}};return a(s,0,t),{nodeToParent:e,timeToNodes:n}}function _s(s,t){const{selectionState:e}=t;return n=>e.selectedTrackId===s.id&&e.selectedNodes.has(n)}function vs(s,t,e){const{selectionState:n}=e;return o=>n.selectedPatternId!==t||n.selectedInstrumentId!==null&&n.selectedInstrumentId!==s.id?!1:n.selectedNodes.has(o)}function Is(s,t){var i;const{project:e,playingNodeIds:n}=t,o=((i=e.standaloneInstruments)==null?void 0:i.some(d=>d.solo===!0))||!1,a=!s.mute&&(!o||s.solo);return d=>a&&n.has(d)}function ks(s,t,e){const{playingNodeIds:n}=e,a=(t.instruments&&Array.isArray(t.instruments)&&t.instruments.length>0?t.instruments:[]).some(d=>d.solo===!0),i=!t.mute&&!s.mute&&(!a||s.solo);return d=>i&&n.has(d)}function bs(s,t){var n;const e=((n=t.standaloneInstruments)==null?void 0:n.some(o=>o.solo===!0))||!1;return s.mute||e&&!s.solo}function Ts(s,t){const n=(t.instruments&&Array.isArray(t.instruments)&&t.instruments.length>0?t.instruments:[]).some(o=>o.solo===!0);return t.mute||s.mute||n&&!s.solo}function ys(s){const{ctx:t,renderer:e,canvas:n,viewport:o,project:a,patternId:i,pattern:d,selectionState:l,playbackState:r,isSelecting:c,selectionBox:_}=s;if(!t||!e||!a)return;t.fillStyle="#1a1a1a",t.fillRect(0,0,n.width,n.height),ws(t,n,o);const m=ps({project:a,patternId:i,pattern:d,playbackState:r});i||Ss(t,e,a,l,m),i&&d&&Cs(t,e,i,d,l,m),c&&_&&Ps(t,_)}function ws(s,t,e){s.strokeStyle="rgba(255, 255, 255, 0.03)",s.lineWidth=1;const n=50*e.zoom,o=e.x*e.zoom%n,a=e.y*e.zoom%n;for(let i=-o;i<t.width;i+=n)s.beginPath(),s.moveTo(i,0),s.lineTo(i,t.height),s.stroke();for(let i=-a;i<t.height;i+=n)s.beginPath(),s.moveTo(0,i),s.lineTo(t.width,i),s.stroke()}function Ss(s,t,e,n,o){const a={project:e,selectionState:n,playingNodeIds:o};for(const i of e.standaloneInstruments||[]){const d=_s(i,a),l=Is(i,a),r=bs(i,e);t.renderTree(i.patternTree,i.color,d,l,i.instrumentType,r)}}function Cs(s,t,e,n,o,a){let i=[];n.instruments&&Array.isArray(n.instruments)&&n.instruments.length>0?i=n.instruments:n.instrumentType&&n.patternTree&&(i=[{id:n.id,instrumentType:n.instrumentType,patternTree:n.patternTree,settings:n.settings||{},instrumentSettings:n.instrumentSettings,color:n.color||"#7ab8ff",volume:n.volume??1,pan:n.pan??0,mute:n.mute,solo:n.solo}]);const d={selectionState:o,playingNodeIds:a};for(const l of i){const r=vs(l,e,d),c=ks(l,n,d),_=Ts(l,n);t.renderTree(l.patternTree,l.color,r,c,l.instrumentType,_)}}function Ps(s,t){const e=Math.min(t.startX,t.endX),n=Math.min(t.startY,t.endY),o=Math.abs(t.endX-t.startX),a=Math.abs(t.endY-t.startY);o>2&&a>2&&(s.strokeStyle="#7ab8ff",s.lineWidth=2,s.setLineDash([5,5]),s.strokeRect(e,n,o,a),s.fillStyle="rgba(122, 184, 255, 0.1)",s.fillRect(e,n,o,a),s.setLineDash([]))}function Ut(s){let t,e="Copy Instrument",n,o;return{c(){t=E("button"),t.textContent=e,this.h()},l(a){t=D(a,"BUTTON",{class:!0,"data-svelte-h":!0}),le(t)!=="svelte-1w2yuk"&&(t.textContent=e),this.h()},h(){$(t,"class","menu-item")},m(a,i){W(a,t,i),n||(o=ie(t,"click",s[7]),n=!0)},p:Ve,d(a){a&&P(t),n=!1,o()}}}function $s(s){let t,e,n,o='Add Child <span class="shortcut">(A)</span>',a,i,d="Edit Division",l,r,c=s[2]?s[3]?"Delete Pattern":"Delete Track":"Delete Node",_,m,y,p=s[2]&&Ut(s);return{c(){t=E("div"),p&&p.c(),e=U(),n=E("button"),n.innerHTML=o,a=U(),i=E("button"),i.textContent=d,l=U(),r=E("button"),_=be(c),this.h()},l(b){t=D(b,"DIV",{class:!0,style:!0,role:!0,tabindex:!0});var T=j(t);p&&p.l(T),e=F(T),n=D(T,"BUTTON",{class:!0,"data-svelte-h":!0}),le(n)!=="svelte-1b0ym6x"&&(n.innerHTML=o),a=F(T),i=D(T,"BUTTON",{class:!0,"data-svelte-h":!0}),le(i)!=="svelte-3esqzu"&&(i.textContent=d),l=F(T),r=D(T,"BUTTON",{class:!0});var u=j(r);_=ke(u,c),u.forEach(P),T.forEach(P),this.h()},h(){$(n,"class","menu-item"),$(i,"class","menu-item"),$(r,"class","menu-item danger"),$(t,"class","context-menu"),me(t,"left",s[0]+"px"),me(t,"top",s[1]+"px"),$(t,"role","menu"),$(t,"tabindex","-1")},m(b,T){W(b,t,T),p&&p.m(t,null),C(t,e),C(t,n),C(t,a),C(t,i),C(t,l),C(t,r),C(r,_),m||(y=[ie(n,"click",s[4]),ie(i,"click",s[6]),ie(r,"click",s[5]),ie(t,"mousedown",Rn(s[10]))],m=!0)},p(b,[T]){b[2]?p?p.p(b,T):(p=Ut(b),p.c(),p.m(t,e)):p&&(p.d(1),p=null),T&12&&c!==(c=b[2]?b[3]?"Delete Pattern":"Delete Track":"Delete Node")&&Ue(_,c),T&1&&me(t,"left",b[0]+"px"),T&2&&me(t,"top",b[1]+"px")},i:Ve,o:Ve,d(b){b&&P(t),p&&p.d(),m=!1,Fe(y)}}}function Ns(s,t,e){let{x:n}=t,{y:o}=t,{node:a}=t,{isRoot:i}=t,{patternId:d=null}=t;const l=null,r=Fn();function c(b){b.stopPropagation(),b.preventDefault(),a&&r("addChild",{type:"addChild",node:a})}function _(b){b.stopPropagation(),b.preventDefault(),a&&r("delete",{type:"delete",node:a})}function m(b){b.stopPropagation(),b.preventDefault(),a&&r("edit",{type:"edit",node:a})}function y(b){b.stopPropagation(),b.preventDefault(),a&&r("copy",{type:"copy",node:a})}function p(b){Un.call(this,s,b)}return s.$$set=b=>{"x"in b&&e(0,n=b.x),"y"in b&&e(1,o=b.y),"node"in b&&e(8,a=b.node),"isRoot"in b&&e(2,i=b.isRoot),"patternId"in b&&e(3,d=b.patternId)},[n,o,i,d,c,_,m,y,a,l,p]}class Ms extends Pe{constructor(t){super(),$e(this,t,Ns,$s,Ne,{x:0,y:1,node:8,isRoot:2,patternId:3,trackId:9})}get trackId(){return this.$$.ctx[9]}}function At(s){var n,o;let t,e;return t=new Ms({props:{x:s[4].x,y:s[4].y,node:s[4].node,isRoot:s[4].isRoot,patternId:((n=s[4])==null?void 0:n.patternId)??null,trackId:((o=s[4])==null?void 0:o.trackId)??null}}),t.$on("addChild",s[12]),t.$on("delete",s[12]),t.$on("edit",s[12]),t.$on("copy",s[12]),{c(){G(t.$$.fragment)},l(a){K(t.$$.fragment,a)},m(a,i){X(t,a,i),e=!0},p(a,i){var l,r;const d={};i[0]&16&&(d.x=a[4].x),i[0]&16&&(d.y=a[4].y),i[0]&16&&(d.node=a[4].node),i[0]&16&&(d.isRoot=a[4].isRoot),i[0]&16&&(d.patternId=((l=a[4])==null?void 0:l.patternId)??null),i[0]&16&&(d.trackId=((r=a[4])==null?void 0:r.trackId)??null),t.$set(d)},i(a){e||(L(t.$$.fragment,a),e=!0)},o(a){z(t.$$.fragment,a),e=!1},d(a){H(t,a)}}}function Lt(s){let t,e,n,o="Division:",a,i,d,l,r,c="Save",_,m,y="Cancel",p,b;return{c(){t=E("div"),e=E("div"),n=E("label"),n.textContent=o,a=U(),i=E("input"),d=U(),l=E("div"),r=E("button"),r.textContent=c,_=U(),m=E("button"),m.textContent=y,this.h()},l(T){t=D(T,"DIV",{class:!0});var u=j(t);e=D(u,"DIV",{class:!0});var g=j(e);n=D(g,"LABEL",{for:!0,"data-svelte-h":!0}),le(n)!=="svelte-pf52f1"&&(n.textContent=o),a=F(g),i=D(g,"INPUT",{id:!0,type:!0,min:!0}),d=F(g),l=D(g,"DIV",{class:!0});var f=j(l);r=D(f,"BUTTON",{"data-svelte-h":!0}),le(r)!=="svelte-1bidccg"&&(r.textContent=c),_=F(f),m=D(f,"BUTTON",{"data-svelte-h":!0}),le(m)!=="svelte-9ccrc4"&&(m.textContent=y),f.forEach(P),g.forEach(P),u.forEach(P),this.h()},h(){$(n,"for","edit-division"),$(i,"id","edit-division"),$(i,"type","number"),$(i,"min","1"),$(l,"class","edit-buttons"),$(e,"class","edit-dialog"),$(t,"class","edit-overlay")},m(T,u){W(T,t,u),C(t,e),C(e,n),C(e,a),C(e,i),Ce(i,s[6]),C(e,d),C(e,l),C(l,r),C(l,_),C(l,m),p||(b=[ie(i,"input",s[17]),ie(i,"keydown",s[18]),ie(r,"click",s[13]),ie(m,"click",s[19])],p=!0)},p(T,u){u[0]&64&&Mn(i.value)!==T[6]&&Ce(i,T[6])},d(T){T&&P(t),p=!1,Fe(b)}}}function Ds(s){let t,e,n,o,a,i,d,l=s[4]&&At(s),r=s[5]&&Lt(s);return{c(){t=E("canvas"),e=U(),l&&l.c(),n=U(),r&&r.c(),o=Oe(),this.h()},l(c){t=D(c,"CANVAS",{class:!0,style:!0}),j(t).forEach(P),e=F(c),l&&l.l(c),n=F(c),r&&r.l(c),o=Oe(),this.h()},h(){$(t,"class","canvas"),me(t,"cursor",s[2]?"grabbing":s[3]?"crosshair":"grab"),Ee(t,"grabbing",s[1]||s[2]),Ee(t,"selecting",s[3])},m(c,_){W(c,t,_),s[16](t),W(c,e,_),l&&l.m(c,_),W(c,n,_),r&&r.m(c,_),W(c,o,_),a=!0,i||(d=[ie(t,"mousedown",s[7]),ie(t,"mousemove",s[8]),ie(t,"mouseup",s[9]),ie(t,"wheel",s[10]),ie(t,"contextmenu",s[11])],i=!0)},p(c,_){(!a||_[0]&12)&&me(t,"cursor",c[2]?"grabbing":c[3]?"crosshair":"grab"),(!a||_[0]&6)&&Ee(t,"grabbing",c[1]||c[2]),(!a||_[0]&8)&&Ee(t,"selecting",c[3]),c[4]?l?(l.p(c,_),_[0]&16&&L(l,1)):(l=At(c),l.c(),L(l,1),l.m(n.parentNode,n)):l&&(We(),z(l,1,1,()=>{l=null}),Ye()),c[5]?r?r.p(c,_):(r=Lt(c),r.c(),r.m(o.parentNode,o)):r&&(r.d(1),r=null)},i(c){a||(L(l),a=!0)},o(c){z(l),a=!1},d(c){c&&(P(t),P(e),P(n),P(o)),s[16](null),l&&l.d(c),r&&r.d(c),i=!1,Fe(d)}}}function Es(s,t,e){let n,{patternId:o=null}=t,a,i=null,d=new Xn,l=null,r,c,_,m,y=null;Z.subscribe(ee=>e(15,c=ee)),De.subscribe(ee=>y=ee),Dt.subscribe(ee=>{d.x=ee.x,d.y=ee.y,d.zoom=ee.zoom}),Se.subscribe(ee=>_=ee),Ln.subscribe(ee=>m=ee);let p=!1,b=!1,T=null,u=null,g=!1,f=null,w=null,h=null,v="";function I(){return{project:c,patternId:o,pattern:n,selectionState:_,engine:y}}function k(){return{project:c,patternId:o,pattern:n,canvas:a,viewport:d}}function S(){return{project:c,patternId:o,pattern:n,canvas:a,viewport:d}}let N={isDragging:!1,dragStart:{x:0,y:0},isDraggingNode:!1,draggedNode:null,lastMousePos:{x:0,y:0}};It(()=>{if(!a||(i=a.getContext("2d"),!i))return;l=new Kn(i,d);const ee=()=>{e(0,a.width=window.innerWidth,a),e(0,a.height=window.innerHeight,a)};ee(),window.addEventListener("resize",ee);const O=()=>{!i||!l||(M(),r=requestAnimationFrame(O))};O();const de=A=>{A.target instanceof HTMLInputElement||A.target instanceof HTMLTextAreaElement||Gn(A,I())};window.addEventListener("keydown",de);const x=A=>{w&&e(4,w=null)},ce=A=>{w&&e(4,w=null)};return window.addEventListener("mousedown",x),window.addEventListener("contextmenu",ce),()=>{window.removeEventListener("resize",ee),window.removeEventListener("keydown",de),window.removeEventListener("mousedown",x),window.removeEventListener("contextmenu",ce),cancelAnimationFrame(r)}});function M(){!i||!l||!c||!a||ys({ctx:i,renderer:l,canvas:a,viewport:d,project:c,patternId:o,pattern:n,selectionState:_,playbackState:m,isSelecting:g,selectionBox:f})}function q(ee){if(!a||ee.button===2)return;const O=ts(ee,k(),N);if(e(1,p=O.startedDragging),e(2,b=O.startedDraggingNode),e(3,g=O.startedSelecting),f=O.selectionBox,N.isDragging=O.startedDragging,N.isDraggingNode=O.startedDraggingNode,O.clickedNode&&O.clickedNode.track){const de=ge=>({...ge,children:ge.children.map(de)}),x=a.getBoundingClientRect(),ce=ee.clientX-x.left,A=ee.clientY-x.top;let re=null;Se.subscribe(ge=>re=ge)(),N.draggedNode={patternId:O.clickedNode.patternId,trackId:O.clickedNode.trackId,nodeId:O.clickedNode.node.id,selectedNodeIds:(re==null?void 0:re.selectedNodes)||new Set([O.clickedNode.node.id]),originalTree:de(O.clickedNode.track.patternTree),startScreenX:ce,startScreenY:A,isRoot:O.clickedNode.isRoot,instrumentId:O.clickedNode.instrumentId}}else if(O.clickedNode&&O.clickedNode.instrument){const de=ge=>({...ge,children:ge.children.map(de)}),x=a.getBoundingClientRect(),ce=ee.clientX-x.left,A=ee.clientY-x.top;let re=null;Se.subscribe(ge=>re=ge)(),N.draggedNode={patternId:O.clickedNode.patternId,trackId:O.clickedNode.trackId,nodeId:O.clickedNode.node.id,selectedNodeIds:(re==null?void 0:re.selectedNodes)||new Set([O.clickedNode.node.id]),originalTree:de(O.clickedNode.instrument.patternTree),startScreenX:ce,startScreenY:A,isRoot:O.clickedNode.isRoot,instrumentId:O.clickedNode.instrumentId}}else N.draggedNode=null}function J(ee){if(!a)return;const O=ns(ee,k(),N,f);f=O.updatedSelectionBox,N=O.updatedDragState,e(1,p=N.isDragging),e(2,b=N.isDraggingNode),O.pendingPositionUpdate&&(u=O.pendingPositionUpdate)}function R(ee){const O=ss(ee,N);N=O.updatedDragState,e(1,p=N.isDragging),e(2,b=N.isDraggingNode),O.shouldFinalizeSelection&&(e(3,g=!1),f=null),u&&(T&&clearTimeout(T),u.patternId?u.instrumentId?Z.updatePatternInstrument(u.patternId,u.instrumentId,{patternTree:u.patternTree}):Z.updatePattern(u.patternId,{patternTree:u.patternTree},!1):u.trackId&&Z.updateStandaloneInstrument(u.trackId,{patternTree:u.patternTree},!1),u=null,T=null)}function Y(ee){rs(ee,k())}function ne(ee){if(ee.preventDefault(),ee.stopPropagation(),!a)return;const O=os(ee,S());O&&e(4,w=O)}function se(ee){const O=us(ee,{menu:w,project:c,engine:y});O.editingNode&&(e(5,h=O.editingNode),e(6,v=O.editValue)),e(4,w=null)}function V(){if(!h)return;const ee=parseInt(v);isNaN(ee)||ee<1||(h.patternId?(Z.updatePatternNodeDivision(h.patternId,h.node.id,ee,h.instrumentId),Be(y,je({editingNode:h}))):h.trackId&&(Z.updateNodeDivision(h.trackId,h.node.id,ee),Be(y,je({editingNode:h}))),e(5,h=null))}function B(ee){Le[ee?"unshift":"push"](()=>{a=ee,e(0,a)})}function oe(){v=Mn(this.value),e(6,v)}const he=ee=>{ee.key==="Enter"&&V(),ee.key==="Escape"&&e(5,h=null)},_e=()=>e(5,h=null);return s.$$set=ee=>{"patternId"in ee&&e(14,o=ee.patternId)},s.$$.update=()=>{var ee;s.$$.dirty[0]&49152&&(n=o&&c&&((ee=c.patterns)==null?void 0:ee.find(O=>O.id===o))||null)},[a,p,b,g,w,h,v,q,J,R,Y,ne,se,V,o,c,B,oe,he,_e]}class Vs extends Pe{constructor(t){super(),$e(this,t,Es,Ds,Ne,{patternId:14},null,[-1,-1])}}const Vn=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function nt(s){if(s<0||s>127)return"---";const t=Math.floor(s/12)-1,e=s%12;return`${Vn[e]}${t}`}function Rs(s){const e=s.trim().match(/^([A-Ga-g])([#b]?)(\d+)$/);if(!e)return null;const[,n,o,a]=e,i=n.toUpperCase(),d=parseInt(a,10),l=Vn.findIndex(_=>_.startsWith(i));if(l===-1)return null;let r=l;o==="#"?r=(r+1)%12:(o==="b"||o==="B")&&(r=(r-1+12)%12);const c=(d+1)*12+r;return c<0||c>127?null:c}function Ot(s,t,e){const n=s.slice();return n[13]=t[e],n}function zt(s,t,e){const n=s.slice();return n[13]=t[e],n}function Bt(s){let t,e=s[13].label+"",n,o,a,i;function d(){return s[9](s[13])}return{c(){t=E("button"),n=be(e),o=U(),this.h()},l(l){t=D(l,"BUTTON",{class:!0,style:!0});var r=j(t);n=ke(r,e),o=F(r),r.forEach(P),this.h()},h(){var l;$(t,"class","instrument-btn"),me(t,"border-color",s[13].color),Ee(t,"active",((l=s[0])==null?void 0:l.instrumentType)===s[13].value)},m(l,r){W(l,t,r),C(t,n),C(t,o),a||(i=ie(t,"click",d),a=!0)},p(l,r){var c;s=l,r&3&&Ee(t,"active",((c=s[0])==null?void 0:c.instrumentType)===s[13].value)},d(l){l&&P(t),a=!1,i()}}}function jt(s){let t,e=s[13].label+"",n,o,a,i;function d(){return s[10](s[13])}return{c(){t=E("button"),n=be(e),o=U(),this.h()},l(l){t=D(l,"BUTTON",{class:!0,style:!0});var r=j(t);n=ke(r,e),o=F(r),r.forEach(P),this.h()},h(){var l;$(t,"class","instrument-btn"),me(t,"border-color",s[13].color),Ee(t,"active",((l=s[0])==null?void 0:l.instrumentType)===s[13].value)},m(l,r){W(l,t,r),C(t,n),C(t,o),a||(i=ie(t,"click",d),a=!0)},p(l,r){var c;s=l,r&5&&Ee(t,"active",((c=s[0])==null?void 0:c.instrumentType)===s[13].value)},d(l){l&&P(t),a=!1,i()}}}function Fs(s){let t,e,n="Instrument Type",o,a,i,d="Drums",l,r,c,_,m,y="Melodic",p,b,T=Ie(s[1]),u=[];for(let w=0;w<T.length;w+=1)u[w]=Bt(zt(s,T,w));let g=Ie(s[2]),f=[];for(let w=0;w<g.length;w+=1)f[w]=jt(Ot(s,g,w));return{c(){t=E("div"),e=E("h3"),e.textContent=n,o=U(),a=E("div"),i=E("h4"),i.textContent=d,l=U(),r=E("div");for(let w=0;w<u.length;w+=1)u[w].c();c=U(),_=E("div"),m=E("h4"),m.textContent=y,p=U(),b=E("div");for(let w=0;w<f.length;w+=1)f[w].c();this.h()},l(w){t=D(w,"DIV",{class:!0});var h=j(t);e=D(h,"H3",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-p4zah0"&&(e.textContent=n),o=F(h),a=D(h,"DIV",{class:!0});var v=j(a);i=D(v,"H4",{class:!0,"data-svelte-h":!0}),le(i)!=="svelte-1h9ae5c"&&(i.textContent=d),l=F(v),r=D(v,"DIV",{class:!0});var I=j(r);for(let N=0;N<u.length;N+=1)u[N].l(I);I.forEach(P),v.forEach(P),c=F(h),_=D(h,"DIV",{class:!0});var k=j(_);m=D(k,"H4",{class:!0,"data-svelte-h":!0}),le(m)!=="svelte-1m9whdo"&&(m.textContent=y),p=F(k),b=D(k,"DIV",{class:!0});var S=j(b);for(let N=0;N<f.length;N+=1)f[N].l(S);S.forEach(P),k.forEach(P),h.forEach(P),this.h()},h(){$(e,"class","section-title"),$(i,"class","instrument-group-title"),$(r,"class","instrument-grid"),$(a,"class","instrument-group"),$(m,"class","instrument-group-title"),$(b,"class","instrument-grid"),$(_,"class","instrument-group"),$(t,"class","section")},m(w,h){W(w,t,h),C(t,e),C(t,o),C(t,a),C(a,i),C(a,l),C(a,r);for(let v=0;v<u.length;v+=1)u[v]&&u[v].m(r,null);C(t,c),C(t,_),C(_,m),C(_,p),C(_,b);for(let v=0;v<f.length;v+=1)f[v]&&f[v].m(b,null)},p(w,[h]){if(h&11){T=Ie(w[1]);let v;for(v=0;v<T.length;v+=1){const I=zt(w,T,v);u[v]?u[v].p(I,h):(u[v]=Bt(I),u[v].c(),u[v].m(r,null))}for(;v<u.length;v+=1)u[v].d(1);u.length=T.length}if(h&13){g=Ie(w[2]);let v;for(v=0;v<g.length;v+=1){const I=Ot(w,g,v);f[v]?f[v].p(I,h):(f[v]=jt(I),f[v].c(),f[v].m(b,null))}for(;v<f.length;v+=1)f[v].d(1);f.length=g.length}},i:Ve,o:Ve,d(w){w&&P(t),_t(u,w),_t(f,w)}}}function Us(s,t,e){let n,{selectedTrack:o=void 0}=t,{selectedPattern:a=void 0}=t,{isRootNode:i=!1}=t,{selectedInstrumentId:d=null}=t,{selectedInstrument:l=void 0}=t,r=null;De.subscribe(T=>r=T);const c=[{value:"kick",label:"Kick",color:"#00ffff"},{value:"snare",label:"Snare",color:"#ff00ff"},{value:"hihat",label:"Hi-Hat",color:"#ffff00"},{value:"clap",label:"Clap",color:"#ff6600"},{value:"tom",label:"Tom",color:"#00ff00"},{value:"cymbal",label:"Cymbal",color:"#ff0066"},{value:"shaker",label:"Shaker",color:"#6600ff"},{value:"rimshot",label:"Rimshot",color:"#ff9900"}],_=[{value:"bass",label:"Bass",color:"#0066ff"},{value:"subtractive",label:"Subtractive",color:"#00ffcc"},{value:"fm",label:"FM",color:"#cc00ff"},{value:"wavetable",label:"Wavetable",color:"#ffcc00"},{value:"supersaw",label:"Supersaw",color:"#ff3366"},{value:"pluck",label:"Pluck",color:"#66ff99"},{value:"pad",label:"Pad",color:"#9966ff"},{value:"organ",label:"Organ",color:"#ff9966"}],m={kick:{color:"#00ffff",settings:{attack:.005,decay:.4,sustain:0,release:.15}},snare:{color:"#ff00ff",settings:{attack:.005,decay:.2,sustain:0,release:.1}},hihat:{color:"#ffff00",settings:{attack:.001,decay:.05,sustain:0,release:.01}},clap:{color:"#ff6600",settings:{attack:.001,decay:.1,sustain:0,release:.05}},tom:{color:"#00ff00",settings:{attack:.01,decay:.4,sustain:0,release:.1}},cymbal:{color:"#ff0066",settings:{attack:.01,decay:.5,sustain:0,release:.2}},shaker:{color:"#6600ff",settings:{attack:.01,decay:.3,sustain:0,release:.1}},rimshot:{color:"#ff9900",settings:{attack:.001,decay:.08,sustain:0,release:.05}},subtractive:{color:"#00ffcc",settings:{attack:.1,decay:.2,sustain:.7,release:.3,osc1Type:"saw",osc2Type:"saw",osc2Detune:0,filterCutoff:5e3,filterResonance:.5}},fm:{color:"#cc00ff",settings:{attack:.1,decay:.2,sustain:.7,release:.3,operators:[{frequency:1,amplitude:1,waveform:"sine"}]}},wavetable:{color:"#ffcc00",settings:{attack:.1,decay:.2,sustain:.7,release:.3}},supersaw:{color:"#ff3366",settings:{attack:.1,decay:.2,sustain:.7,release:.3,numOscillators:7,detune:.1,spread:.5,filterCutoff:8e3,filterResonance:.5,lfoRate:0,lfoAmount:0}},pluck:{color:"#66ff99",settings:{attack:.01,decay:.3,sustain:0,release:.4,damping:.96}},bass:{color:"#0066ff",settings:{attack:.05,decay:.2,sustain:.8,release:.3,osc1Type:"saw",subLevel:.6,saturation:.3,filterCutoff:2e3,filterResonance:.3}},pad:{color:"#9966ff",settings:{attack:.5,decay:.3,sustain:.9,release:1.5,numOscillators:8,detune:.15,spread:.7,oscType:"saw",filterCutoff:4e3,filterResonance:.3,pitchLfoRate:.5,pitchLfoAmount:.02,filterLfoRate:.3,filterLfoAmount:1e3}},organ:{color:"#ff9966",settings:{attack:.01,decay:.1,sustain:1,release:.2,drawbars:[.8,0,1,0,.6,0,.4,0,.2],rotarySpeed:4,rotaryDepth:.3,filterCutoff:8e3,filterResonance:.2}}};async function y(T){if(!n)return;const u=m[T];if(u){if(i){if(a&&d){const f=(a.instruments&&Array.isArray(a.instruments)&&a.instruments.length>0?a.instruments:a.instrumentType&&a.patternTree?[{id:a.id,instrumentType:a.instrumentType,patternTree:a.patternTree,settings:a.settings||{},instrumentSettings:a.instrumentSettings,color:a.color||"#7ab8ff",volume:a.volume??1,pan:a.pan??0,mute:a.mute,solo:a.solo}]:[]).find(w=>w.id===d);if(f){const w=f.instrumentSettings||{};f.instrumentType&&f.settings&&(w[f.instrumentType]={...f.settings});const h=w[T]?{...w[T]}:{...u.settings};Z.updatePatternInstrument(a.id,d,{instrumentType:T,color:u.color,settings:h,instrumentSettings:w}),setTimeout(()=>{var v;if(r){let I=null;if(Z.subscribe(J=>I=J)(),!I)return;const k=(v=I.patterns)==null?void 0:v.find(J=>J.id===a.id);if(!k)return;const N=(k.instruments&&Array.isArray(k.instruments)&&k.instruments.length>0?k.instruments:k.instrumentType&&k.patternTree?[{id:k.id,instrumentType:k.instrumentType,patternTree:k.patternTree,settings:k.settings||{},instrumentSettings:k.instrumentSettings,color:k.color||"#7ab8ff",volume:k.volume??1,pan:k.pan??0,mute:k.mute,solo:k.solo}]:[]).find(J=>J.id===d);if(!N)return;const M=`__pattern_${a.id}_${d}`,q={id:M,projectId:a.projectId,instrumentType:T,patternTree:N.patternTree,settings:h,instrumentSettings:w,volume:N.volume??1,pan:N.pan??0,color:u.color,mute:N.mute??!1,solo:N.solo??!1};r.updateTrack(M,q)}},0);return}}if(o){const g=n.instrumentSettings||{};n.instrumentType&&n.settings&&(g[n.instrumentType]={...n.settings});const f=g[T]?{...g[T]}:{...u.settings};if(Z.updateStandaloneInstrument(o.id,{instrumentType:T,color:u.color,settings:f,instrumentSettings:g}),r){const w={...o,instrumentType:T,color:u.color,settings:f,instrumentSettings:g,patternTree:o.patternTree};r.updateTrack(o.id,w)}return}}if(a&&!i){const g={id:crypto.randomUUID(),instrumentType:T,patternTree:{id:crypto.randomUUID(),division:4,x:400+Math.random()*200,y:200+Math.random()*100,children:[]},settings:{...u.settings},instrumentSettings:void 0,color:u.color,volume:1,pan:0,mute:!1,solo:!1};Z.addPatternInstrument(a.id,g),Wn(async()=>{const{selectionStore:f}=await import("../chunks/KHC7JF7e.js").then(w=>w.m);return{selectionStore:f}},__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url).then(({selectionStore:f})=>{f.selectNode(g.patternTree.id,null,!0,!1,a.id,g.id)}),setTimeout(()=>{var f;if(r){let w=null;if(Z.subscribe(N=>w=N)(),!w)return;const h=(f=w.patterns)==null?void 0:f.find(N=>N.id===a.id);if(!h)return;const I=(h.instruments&&Array.isArray(h.instruments)&&h.instruments.length>0?h.instruments:[]).find(N=>N.id===g.id);if(!I)return;const k=`__pattern_${a.id}_${g.id}`,S={id:k,projectId:a.projectId,instrumentType:I.instrumentType,patternTree:I.patternTree,settings:I.settings||{},instrumentSettings:I.instrumentSettings,volume:I.volume??1,pan:I.pan??0,color:I.color,mute:I.mute??!1,solo:I.solo??!1};r.updateTrack(k,S)}},0);return}}}const p=T=>y(T.value),b=T=>y(T.value);return s.$$set=T=>{"selectedTrack"in T&&e(4,o=T.selectedTrack),"selectedPattern"in T&&e(5,a=T.selectedPattern),"isRootNode"in T&&e(6,i=T.isRootNode),"selectedInstrumentId"in T&&e(7,d=T.selectedInstrumentId),"selectedInstrument"in T&&e(8,l=T.selectedInstrument)},s.$$.update=()=>{s.$$.dirty&272&&e(0,n=l||o)},[n,c,_,y,o,a,i,d,l,p,b]}class As extends Pe{constructor(t){super(),$e(this,t,Us,Fs,Ne,{selectedTrack:4,selectedPattern:5,isRootNode:6,selectedInstrumentId:7,selectedInstrument:8})}}function Ls(s){let t,e,n,o="Volume",a,i,d="Reset",l,r,c,_,m,y,p,b,T,u="Pan",g,f,w="Reset",h,v,I,k="L",S,N,M,q,J="R",R,Y,ne,se,V;return m=new vt({props:{id:"volume-number",min:0,max:2,step:.01,value:s[3],onInput:s[4]}}),Y=new vt({props:{id:"pan-number",min:-1,max:1,step:.01,value:s[2],onInput:s[5]}}),{c(){t=E("div"),e=E("div"),n=E("label"),n.textContent=o,a=U(),i=E("button"),i.textContent=d,l=U(),r=E("div"),c=E("input"),_=U(),G(m.$$.fragment),y=U(),p=E("div"),b=E("div"),T=E("label"),T.textContent=u,g=U(),f=E("button"),f.textContent=w,h=U(),v=E("div"),I=E("span"),I.textContent=k,S=U(),N=E("input"),M=U(),q=E("span"),q.textContent=J,R=U(),G(Y.$$.fragment),this.h()},l(B){t=D(B,"DIV",{class:!0});var oe=j(t);e=D(oe,"DIV",{class:!0});var he=j(e);n=D(he,"LABEL",{for:!0,"data-svelte-h":!0}),le(n)!=="svelte-1t9gfde"&&(n.textContent=o),a=F(he),i=D(he,"BUTTON",{class:!0,"data-svelte-h":!0}),le(i)!=="svelte-wfrkdx"&&(i.textContent=d),he.forEach(P),l=F(oe),r=D(oe,"DIV",{class:!0});var _e=j(r);c=D(_e,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0}),_=F(_e),K(m.$$.fragment,_e),_e.forEach(P),oe.forEach(P),y=F(B),p=D(B,"DIV",{class:!0});var ee=j(p);b=D(ee,"DIV",{class:!0});var O=j(b);T=D(O,"LABEL",{for:!0,"data-svelte-h":!0}),le(T)!=="svelte-15m1nv0"&&(T.textContent=u),g=F(O),f=D(O,"BUTTON",{class:!0,"data-svelte-h":!0}),le(f)!=="svelte-8hkr0j"&&(f.textContent=w),O.forEach(P),h=F(ee),v=D(ee,"DIV",{class:!0});var de=j(v);I=D(de,"SPAN",{class:!0,title:!0,"data-svelte-h":!0}),le(I)!=="svelte-1nggwdt"&&(I.textContent=k),S=F(de),N=D(de,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0}),M=F(de),q=D(de,"SPAN",{class:!0,title:!0,"data-svelte-h":!0}),le(q)!=="svelte-9q2qib"&&(q.textContent=J),R=F(de),K(Y.$$.fragment,de),de.forEach(P),ee.forEach(P),this.h()},h(){$(n,"for","volume-range"),$(i,"class","reset-btn"),$(e,"class","param-header"),$(c,"id","volume-range"),$(c,"type","range"),$(c,"min","0"),$(c,"max","2"),$(c,"step","0.01"),c.value=s[3],$(r,"class","param-controls"),$(t,"class","section"),$(T,"for","pan-range"),$(f,"class","reset-btn"),$(b,"class","param-header"),$(I,"class","pan-label pan-label-left"),$(I,"title","Left"),$(N,"id","pan-range"),$(N,"type","range"),$(N,"min","-1"),$(N,"max","1"),$(N,"step","0.01"),N.value=s[2],$(q,"class","pan-label pan-label-right"),$(q,"title","Right"),$(v,"class","param-controls pan-controls"),$(p,"class","section")},m(B,oe){W(B,t,oe),C(t,e),C(e,n),C(e,a),C(e,i),C(t,l),C(t,r),C(r,c),C(r,_),X(m,r,null),W(B,y,oe),W(B,p,oe),C(p,b),C(b,T),C(b,g),C(b,f),C(p,h),C(p,v),C(v,I),C(v,S),C(v,N),C(v,M),C(v,q),C(v,R),X(Y,v,null),ne=!0,se||(V=[ie(i,"click",s[11]),ie(c,"mousedown",s[12]),ie(c,"mouseup",s[13]),ie(c,"mouseleave",s[14]),ie(c,"input",s[15]),ie(f,"click",s[16]),ie(N,"mousedown",s[17]),ie(N,"mouseup",s[18]),ie(N,"mouseleave",s[19]),ie(N,"input",s[20])],se=!0)},p(B,[oe]){(!ne||oe&8)&&(c.value=B[3]);const he={};oe&8&&(he.value=B[3]),m.$set(he),(!ne||oe&4)&&(N.value=B[2]);const _e={};oe&4&&(_e.value=B[2]),Y.$set(_e)},i(B){ne||(L(m.$$.fragment,B),L(Y.$$.fragment,B),ne=!0)},o(B){z(m.$$.fragment,B),z(Y.$$.fragment,B),ne=!1},d(B){B&&(P(t),P(y),P(p)),H(m),H(Y),se=!1,Fe(V)}}}function Wt(s){const t=s.target;return(t==null?void 0:t.value)||""}function Os(s,t,e){let n,o,{selectedTrack:a=void 0}=t;const i=void 0;let{selectedInstrument:d=void 0}=t,l=null;De.subscribe(S=>l=S);let r=null;Z.subscribe(S=>e(9,r=S));let c=null;Se.subscribe(S=>e(10,c=S));let _=!1,m=!1;function y(S){const N=Math.max(0,Math.min(2,isNaN(S)?1:S));if(!c){console.warn("[MixerControls] No selection available");return}if(c.selectedPatternId&&c.selectedInstrumentId){if(Z.updatePatternInstrument(c.selectedPatternId,c.selectedInstrumentId,{volume:N}),l){const M=`__pattern_${c.selectedPatternId}_${c.selectedInstrumentId}`;l.updateTrackVolume(M,N)}}else c.selectedTrackId&&(Z.updateStandaloneInstrument(c.selectedTrackId,{volume:N}),l&&l.updateTrackVolume(c.selectedTrackId,N))}function p(S){const N=Math.max(-1,Math.min(1,isNaN(S)?0:S));if(!c){console.warn("[MixerControls] No selection available");return}if(c.selectedPatternId&&c.selectedInstrumentId){if(Z.updatePatternInstrument(c.selectedPatternId,c.selectedInstrumentId,{pan:N}),l){const M=`__pattern_${c.selectedPatternId}_${c.selectedInstrumentId}`;l.updateTrackPan(M,N)}}else c.selectedTrackId&&(Z.updateStandaloneInstrument(c.selectedTrackId,{pan:N}),l&&l.updateTrackPan(c.selectedTrackId,N))}const b=()=>y(1),T=()=>{_||(e(0,_=!0),Z.startBatch())},u=()=>{_&&(e(0,_=!1),Z.endBatch())},g=()=>{_&&(e(0,_=!1),Z.endBatch())},f=S=>y(Number(Wt(S))),w=()=>p(0),h=()=>{m||(e(1,m=!0),Z.startBatch())},v=()=>{m&&(e(1,m=!1),Z.endBatch())},I=()=>{m&&(e(1,m=!1),Z.endBatch())},k=S=>p(Number(Wt(S)));return s.$$set=S=>{"selectedTrack"in S&&e(6,a=S.selectedTrack),"selectedInstrument"in S&&e(8,d=S.selectedInstrument)},s.$$.update=()=>{s.$$.dirty&320,s.$$.dirty&1536&&e(3,n=(()=>{var S,N;if(!r||!c)return 1;if(c.selectedPatternId&&c.selectedInstrumentId){const M=(S=r.patterns)==null?void 0:S.find(q=>q.id===c.selectedPatternId);if(M){const J=(M.instruments&&Array.isArray(M.instruments)&&M.instruments.length>0?M.instruments:M.instrumentType&&M.patternTree?[{id:M.id,instrumentType:M.instrumentType,patternTree:M.patternTree,settings:M.settings||{},instrumentSettings:M.instrumentSettings,color:M.color||"#7ab8ff",volume:M.volume??1,pan:M.pan??0,mute:M.mute,solo:M.solo}]:[]).find(R=>R.id===c.selectedInstrumentId);return(J==null?void 0:J.volume)??1}}if(c.selectedTrackId){const M=(N=r.standaloneInstruments)==null?void 0:N.find(q=>q.id===c.selectedTrackId);return(M==null?void 0:M.volume)??1}return 1})()),s.$$.dirty&1536&&e(2,o=(()=>{var S,N;if(!r||!c)return 0;if(c.selectedPatternId&&c.selectedInstrumentId){const M=(S=r.patterns)==null?void 0:S.find(q=>q.id===c.selectedPatternId);if(M){const J=(M.instruments&&Array.isArray(M.instruments)&&M.instruments.length>0?M.instruments:M.instrumentType&&M.patternTree?[{id:M.id,instrumentType:M.instrumentType,patternTree:M.patternTree,settings:M.settings||{},instrumentSettings:M.instrumentSettings,color:M.color||"#7ab8ff",volume:M.volume??1,pan:M.pan??0,mute:M.mute,solo:M.solo}]:[]).find(R=>R.id===c.selectedInstrumentId);return(J==null?void 0:J.pan)??0}}if(c.selectedTrackId){const M=(N=r.standaloneInstruments)==null?void 0:N.find(q=>q.id===c.selectedTrackId);return(M==null?void 0:M.pan)??0}return 0})())},[_,m,o,n,y,p,a,i,d,r,c,b,T,u,g,f,w,h,v,I,k]}class zs extends Pe{constructor(t){super(),$e(this,t,Os,Ls,Ne,{selectedTrack:6,selectedPattern:7,selectedInstrument:8})}get selectedPattern(){return this.$$.ctx[7]}}function Bs(s){var d,l,r;let t,e,n,o,a,i;return t=new te({props:{id:"attack-range-1",label:"Attack",value:s[0].attack??.01,min:0,max:1,step:.01,resetValue:((d=s[1])==null?void 0:d.attack)??.01,onReset:s[8],onUpdate:s[9]}}),n=new te({props:{id:"decay-range-1",label:"Decay",value:s[0].decay??.3,min:0,max:1,step:.01,resetValue:((l=s[1])==null?void 0:l.decay)??.3,onReset:s[10],onUpdate:s[11]}}),a=new te({props:{id:"release-range-1",label:"Release",value:s[0].release??.1,min:0,max:1,step:.01,resetValue:((r=s[1])==null?void 0:r.release)??.1,onReset:s[12],onUpdate:s[13]}}),{c(){G(t.$$.fragment),e=U(),G(n.$$.fragment),o=U(),G(a.$$.fragment)},l(c){K(t.$$.fragment,c),e=F(c),K(n.$$.fragment,c),o=F(c),K(a.$$.fragment,c)},m(c,_){X(t,c,_),W(c,e,_),X(n,c,_),W(c,o,_),X(a,c,_),i=!0},p(c,[_]){var b,T,u;const m={};_&1&&(m.value=c[0].attack??.01),_&2&&(m.resetValue=((b=c[1])==null?void 0:b.attack)??.01),_&2&&(m.onReset=c[8]),t.$set(m);const y={};_&1&&(y.value=c[0].decay??.3),_&2&&(y.resetValue=((T=c[1])==null?void 0:T.decay)??.3),_&2&&(y.onReset=c[10]),n.$set(y);const p={};_&1&&(p.value=c[0].release??.1),_&2&&(p.resetValue=((u=c[1])==null?void 0:u.release)??.1),_&2&&(p.onReset=c[12]),a.$set(p)},i(c){i||(L(t.$$.fragment,c),L(n.$$.fragment,c),L(a.$$.fragment,c),i=!0)},o(c){z(t.$$.fragment,c),z(n.$$.fragment,c),z(a.$$.fragment,c),i=!1},d(c){c&&(P(e),P(o)),H(t,c),H(n,c),H(a,c)}}}function js(s,t,e){let n,o,a,{selectedTrack:i=void 0}=t,{selectedPattern:d=void 0}=t,{selectedInstrument:l=void 0}=t,{trackSettings:r}=t,c=null;De.subscribe(g=>c=g);function _(g,f){if(!n)return;let w=f;if(typeof f=="number"){if(isNaN(f))return;g==="attack"||g==="decay"||g==="release"?w=Math.max(0,Math.min(1,parseFloat(f.toFixed(2)))):w=parseFloat(f.toFixed(2))}const h={...n.settings,[g]:w},v=n.instrumentSettings||{};if(n.instrumentType&&(v[n.instrumentType]={...h}),d&&l){if(Z.updatePatternInstrument(d.id,l.id,{settings:h,instrumentSettings:v}),c){const I=`__pattern_${d.id}_${l.id}`;c.updateTrackSettings(I,h)}}else i&&(Z.updateTrack(i.id,{settings:h,instrumentSettings:v}),c&&c.updateTrackSettings(i.id,h))}const m=()=>_("attack",(a==null?void 0:a.attack)??.01),y=g=>_("attack",g),p=()=>_("decay",(a==null?void 0:a.decay)??.3),b=g=>_("decay",g),T=()=>_("release",(a==null?void 0:a.release)??.1),u=g=>_("release",g);return s.$$set=g=>{"selectedTrack"in g&&e(3,i=g.selectedTrack),"selectedPattern"in g&&e(4,d=g.selectedPattern),"selectedInstrument"in g&&e(5,l=g.selectedInstrument),"trackSettings"in g&&e(0,r=g.trackSettings)},s.$$.update=()=>{s.$$.dirty&40&&e(6,n=l||i),s.$$.dirty&192&&e(1,a=n!=null&&n.instrumentType?o[n.instrumentType]:null)},e(7,o={kick:{attack:.005,decay:.4,release:.15},snare:{attack:.005,decay:.2,release:.1},hihat:{attack:.001,decay:.05,release:.01},clap:{attack:.01,decay:.15,release:.05},tom:{attack:.01,decay:.4,release:.1},cymbal:{attack:.01,decay:.5,release:.2},shaker:{attack:.01,decay:.3,release:.1},rimshot:{attack:.001,decay:.08,release:.05}}),[r,a,_,i,d,l,n,o,m,y,p,b,T,u]}class Ws extends Pe{constructor(t){super(),$e(this,t,js,Bs,Ne,{selectedTrack:3,selectedPattern:4,selectedInstrument:5,trackSettings:0})}}function Ys(s){let t,e,n="Osc 1 Type",o,a,i,d="Sine",l,r="Saw",c,_="Square",m,y="Triangle",p,b,T,u,g,f,w,h,v,I,k,S,N,M,q,J;return T=new te({props:{id:"filter-cutoff-range",label:"Filter Cutoff",value:s[0].filterCutoff??5e3,min:20,max:2e4,step:10,onUpdate:s[6]}}),g=new te({props:{id:"filter-resonance-range",label:"Filter Resonance",value:s[0].filterResonance??.5,min:0,max:1,step:.01,onUpdate:s[7]}}),w=new te({props:{id:"attack-range-2",label:"Attack",value:s[0].attack??.1,min:0,max:1,step:.01,onUpdate:s[8]}}),v=new te({props:{id:"decay-range-2",label:"Decay",value:s[0].decay??.2,min:0,max:1,step:.01,onUpdate:s[9]}}),k=new te({props:{id:"sustain-range",label:"Sustain",value:s[0].sustain??.7,min:0,max:1,step:.01,onUpdate:s[10]}}),N=new te({props:{id:"release-range-2",label:"Release",value:s[0].release??.3,min:0,max:1,step:.01,onUpdate:s[11]}}),{c(){t=E("div"),e=E("label"),e.textContent=n,o=U(),a=E("select"),i=E("option"),i.textContent=d,l=E("option"),l.textContent=r,c=E("option"),c.textContent=_,m=E("option"),m.textContent=y,b=U(),G(T.$$.fragment),u=U(),G(g.$$.fragment),f=U(),G(w.$$.fragment),h=U(),G(v.$$.fragment),I=U(),G(k.$$.fragment),S=U(),G(N.$$.fragment),this.h()},l(R){t=D(R,"DIV",{class:!0});var Y=j(t);e=D(Y,"LABEL",{for:!0,"data-svelte-h":!0}),le(e)!=="svelte-15oq4zt"&&(e.textContent=n),o=F(Y),a=D(Y,"SELECT",{id:!0});var ne=j(a);i=D(ne,"OPTION",{"data-svelte-h":!0}),le(i)!=="svelte-1mpn6cq"&&(i.textContent=d),l=D(ne,"OPTION",{"data-svelte-h":!0}),le(l)!=="svelte-h02c1s"&&(l.textContent=r),c=D(ne,"OPTION",{"data-svelte-h":!0}),le(c)!=="svelte-bkgndu"&&(c.textContent=_),m=D(ne,"OPTION",{"data-svelte-h":!0}),le(m)!=="svelte-1f5nbzi"&&(m.textContent=y),ne.forEach(P),Y.forEach(P),b=F(R),K(T.$$.fragment,R),u=F(R),K(g.$$.fragment,R),f=F(R),K(w.$$.fragment,R),h=F(R),K(v.$$.fragment,R),I=F(R),K(k.$$.fragment,R),S=F(R),K(N.$$.fragment,R),this.h()},h(){$(e,"for","osc1-type"),i.__value="sine",Ce(i,i.__value),l.__value="saw",Ce(l,l.__value),c.__value="square",Ce(c,c.__value),m.__value="triangle",Ce(m,m.__value),$(a,"id","osc1-type"),$(t,"class","param")},m(R,Y){W(R,t,Y),C(t,e),C(t,o),C(t,a),C(a,i),C(a,l),C(a,c),C(a,m),Xe(a,s[0].osc1Type??"saw"),W(R,b,Y),X(T,R,Y),W(R,u,Y),X(g,R,Y),W(R,f,Y),X(w,R,Y),W(R,h,Y),X(v,R,Y),W(R,I,Y),X(k,R,Y),W(R,S,Y),X(N,R,Y),M=!0,q||(J=ie(a,"change",s[5]),q=!0)},p(R,[Y]){(!M||Y&1&&p!==(p=R[0].osc1Type??"saw"))&&Xe(a,R[0].osc1Type??"saw");const ne={};Y&1&&(ne.value=R[0].filterCutoff??5e3),T.$set(ne);const se={};Y&1&&(se.value=R[0].filterResonance??.5),g.$set(se);const V={};Y&1&&(V.value=R[0].attack??.1),w.$set(V);const B={};Y&1&&(B.value=R[0].decay??.2),v.$set(B);const oe={};Y&1&&(oe.value=R[0].sustain??.7),k.$set(oe);const he={};Y&1&&(he.value=R[0].release??.3),N.$set(he)},i(R){M||(L(T.$$.fragment,R),L(g.$$.fragment,R),L(w.$$.fragment,R),L(v.$$.fragment,R),L(k.$$.fragment,R),L(N.$$.fragment,R),M=!0)},o(R){z(T.$$.fragment,R),z(g.$$.fragment,R),z(w.$$.fragment,R),z(v.$$.fragment,R),z(k.$$.fragment,R),z(N.$$.fragment,R),M=!1},d(R){R&&(P(t),P(b),P(u),P(f),P(h),P(I),P(S)),H(T,R),H(g,R),H(w,R),H(v,R),H(k,R),H(N,R),q=!1,J()}}}function qs(s,t,e){let n,{selectedTrack:o=void 0}=t,{selectedPattern:a=void 0}=t,{selectedInstrument:i=void 0}=t,{trackSettings:d}=t,l=null;De.subscribe(u=>l=u);function r(u,g){if(!n)return;let f=g;if(typeof g=="number"){if(isNaN(g))return;u==="attack"||u==="decay"||u==="release"||u==="sustain"?f=Math.max(0,Math.min(1,parseFloat(g.toFixed(2)))):u==="filterCutoff"?f=Math.max(20,Math.min(2e4,parseFloat(g.toFixed(0)))):u==="filterResonance"?f=Math.max(0,Math.min(1,parseFloat(g.toFixed(2)))):f=parseFloat(g.toFixed(2))}const w={...n.settings,[u]:f},h=n.instrumentSettings||{};if(n.instrumentType&&(h[n.instrumentType]={...w}),a&&i){if(Z.updatePatternInstrument(a.id,i.id,{settings:w,instrumentSettings:h}),l){const v=`__pattern_${a.id}_${i.id}`;l.updateTrackSettings(v,w)}}else o&&(Z.updateTrack(o.id,{settings:w,instrumentSettings:h}),l&&l.updateTrackSettings(o.id,w))}const c=u=>r("osc1Type",kt(u)||"saw"),_=u=>r("filterCutoff",u),m=u=>r("filterResonance",u),y=u=>r("attack",u),p=u=>r("decay",u),b=u=>r("sustain",u),T=u=>r("release",u);return s.$$set=u=>{"selectedTrack"in u&&e(2,o=u.selectedTrack),"selectedPattern"in u&&e(3,a=u.selectedPattern),"selectedInstrument"in u&&e(4,i=u.selectedInstrument),"trackSettings"in u&&e(0,d=u.trackSettings)},s.$$.update=()=>{s.$$.dirty&20&&(n=i||o)},[d,r,o,a,i,c,_,m,y,p,b,T]}class Hs extends Pe{constructor(t){super(),$e(this,t,qs,Ys,Ne,{selectedTrack:2,selectedPattern:3,selectedInstrument:4,trackSettings:0})}}function Xs(s){var R,Y,ne,se;let t,e,n,o,a,i,d="Operator Waveform",l,r,c,_="Sine",m,y="Saw",p,b="Square",T,u="Triangle",g,f,w,h,v,I,k,S,N,M,q,J;return t=new te({props:{id:"fm-op-freq",label:"Operator Frequency Ratio",value:((Y=(R=s[0].operators)==null?void 0:R[0])==null?void 0:Y.frequency)??1,min:.1,max:10,step:.1,onUpdate:s[2]}}),n=new te({props:{id:"fm-op-amp",label:"Operator Amplitude",value:((se=(ne=s[0].operators)==null?void 0:ne[0])==null?void 0:se.amplitude)??1,min:0,max:2,step:.01,onUpdate:s[3]}}),w=new te({props:{id:"attack-range-fm",label:"Attack",value:s[0].attack??.1,min:0,max:1,step:.01,onUpdate:s[9]}}),v=new te({props:{id:"decay-range-fm",label:"Decay",value:s[0].decay??.2,min:0,max:1,step:.01,onUpdate:s[10]}}),k=new te({props:{id:"sustain-range-fm",label:"Sustain",value:s[0].sustain??.7,min:0,max:1,step:.01,onUpdate:s[11]}}),N=new te({props:{id:"release-range-fm",label:"Release",value:s[0].release??.3,min:0,max:1,step:.01,onUpdate:s[12]}}),{c(){G(t.$$.fragment),e=U(),G(n.$$.fragment),o=U(),a=E("div"),i=E("label"),i.textContent=d,l=U(),r=E("select"),c=E("option"),c.textContent=_,m=E("option"),m.textContent=y,p=E("option"),p.textContent=b,T=E("option"),T.textContent=u,f=U(),G(w.$$.fragment),h=U(),G(v.$$.fragment),I=U(),G(k.$$.fragment),S=U(),G(N.$$.fragment),this.h()},l(V){K(t.$$.fragment,V),e=F(V),K(n.$$.fragment,V),o=F(V),a=D(V,"DIV",{class:!0});var B=j(a);i=D(B,"LABEL",{for:!0,"data-svelte-h":!0}),le(i)!=="svelte-1s7nndq"&&(i.textContent=d),l=F(B),r=D(B,"SELECT",{id:!0});var oe=j(r);c=D(oe,"OPTION",{"data-svelte-h":!0}),le(c)!=="svelte-1mpn6cq"&&(c.textContent=_),m=D(oe,"OPTION",{"data-svelte-h":!0}),le(m)!=="svelte-h02c1s"&&(m.textContent=y),p=D(oe,"OPTION",{"data-svelte-h":!0}),le(p)!=="svelte-bkgndu"&&(p.textContent=b),T=D(oe,"OPTION",{"data-svelte-h":!0}),le(T)!=="svelte-1f5nbzi"&&(T.textContent=u),oe.forEach(P),B.forEach(P),f=F(V),K(w.$$.fragment,V),h=F(V),K(v.$$.fragment,V),I=F(V),K(k.$$.fragment,V),S=F(V),K(N.$$.fragment,V),this.h()},h(){$(i,"for","fm-op-waveform"),c.__value="sine",Ce(c,c.__value),m.__value="saw",Ce(m,m.__value),p.__value="square",Ce(p,p.__value),T.__value="triangle",Ce(T,T.__value),$(r,"id","fm-op-waveform"),$(a,"class","param")},m(V,B){var oe,he;X(t,V,B),W(V,e,B),X(n,V,B),W(V,o,B),W(V,a,B),C(a,i),C(a,l),C(a,r),C(r,c),C(r,m),C(r,p),C(r,T),Xe(r,((he=(oe=s[0].operators)==null?void 0:oe[0])==null?void 0:he.waveform)??"sine"),W(V,f,B),X(w,V,B),W(V,h,B),X(v,V,B),W(V,I,B),X(k,V,B),W(V,S,B),X(N,V,B),M=!0,q||(J=ie(r,"change",s[8]),q=!0)},p(V,[B]){var x,ce,A,re,ge,Me,we,Q;const oe={};B&1&&(oe.value=((ce=(x=V[0].operators)==null?void 0:x[0])==null?void 0:ce.frequency)??1),t.$set(oe);const he={};B&1&&(he.value=((re=(A=V[0].operators)==null?void 0:A[0])==null?void 0:re.amplitude)??1),n.$set(he),(!M||B&1&&g!==(g=((Me=(ge=V[0].operators)==null?void 0:ge[0])==null?void 0:Me.waveform)??"sine"))&&Xe(r,((Q=(we=V[0].operators)==null?void 0:we[0])==null?void 0:Q.waveform)??"sine");const _e={};B&1&&(_e.value=V[0].attack??.1),w.$set(_e);const ee={};B&1&&(ee.value=V[0].decay??.2),v.$set(ee);const O={};B&1&&(O.value=V[0].sustain??.7),k.$set(O);const de={};B&1&&(de.value=V[0].release??.3),N.$set(de)},i(V){M||(L(t.$$.fragment,V),L(n.$$.fragment,V),L(w.$$.fragment,V),L(v.$$.fragment,V),L(k.$$.fragment,V),L(N.$$.fragment,V),M=!0)},o(V){z(t.$$.fragment,V),z(n.$$.fragment,V),z(w.$$.fragment,V),z(v.$$.fragment,V),z(k.$$.fragment,V),z(N.$$.fragment,V),M=!1},d(V){V&&(P(e),P(o),P(a),P(f),P(h),P(I),P(S)),H(t,V),H(n,V),H(w,V),H(v,V),H(k,V),H(N,V),q=!1,J()}}}function Ks(s,t,e){let n,{selectedTrack:o=void 0}=t,{selectedPattern:a=void 0}=t,{selectedInstrument:i=void 0}=t,{trackSettings:d}=t,l=null;De.subscribe(g=>l=g);function r(g,f){if(!n)return;let w=f;if(typeof f=="number"){if(isNaN(f))return;g==="attack"||g==="decay"||g==="release"||g==="sustain"?w=Math.max(0,Math.min(1,parseFloat(f.toFixed(2)))):w=parseFloat(f.toFixed(2))}const h={...n.settings,[g]:w},v=n.instrumentSettings||{};if(n.instrumentType&&(v[n.instrumentType]={...h}),a&&i){if(Z.updatePatternInstrument(a.id,i.id,{settings:h,instrumentSettings:v}),l){const I=`__pattern_${a.id}_${i.id}`;l.updateTrackSettings(I,h)}}else o&&(Z.updateTrack(o.id,{settings:h,instrumentSettings:v}),l&&l.updateTrackSettings(o.id,h))}function c(g){if(isNaN(g))return;const f=d.operators||[{frequency:1,amplitude:1,waveform:"sine"}];f[0]={...f[0],frequency:g},r("operators",f)}function _(g){if(isNaN(g))return;const f=d.operators||[{frequency:1,amplitude:1,waveform:"sine"}];f[0]={...f[0],amplitude:g},r("operators",f)}function m(g){const f=d.operators||[{frequency:1,amplitude:1,waveform:"sine"}];f[0]={...f[0],waveform:g},r("operators",f)}const y=g=>m(kt(g)||"sine"),p=g=>r("attack",g),b=g=>r("decay",g),T=g=>r("sustain",g),u=g=>r("release",g);return s.$$set=g=>{"selectedTrack"in g&&e(5,o=g.selectedTrack),"selectedPattern"in g&&e(6,a=g.selectedPattern),"selectedInstrument"in g&&e(7,i=g.selectedInstrument),"trackSettings"in g&&e(0,d=g.trackSettings)},s.$$.update=()=>{s.$$.dirty&160&&(n=i||o)},[d,r,c,_,m,o,a,i,y,p,b,T,u]}class Gs extends Pe{constructor(t){super(),$e(this,t,Ks,Xs,Ne,{selectedTrack:5,selectedPattern:6,selectedInstrument:7,trackSettings:0})}}function Js(s){let t,e,n,o,a,i,d,l;return t=new te({props:{id:"attack-range-wt",label:"Attack",value:s[0].attack??.1,min:0,max:1,step:.01,onUpdate:s[5]}}),n=new te({props:{id:"decay-range-wt",label:"Decay",value:s[0].decay??.2,min:0,max:1,step:.01,onUpdate:s[6]}}),a=new te({props:{id:"sustain-range-wt",label:"Sustain",value:s[0].sustain??.7,min:0,max:1,step:.01,onUpdate:s[7]}}),d=new te({props:{id:"release-range-wt",label:"Release",value:s[0].release??.3,min:0,max:1,step:.01,onUpdate:s[8]}}),{c(){G(t.$$.fragment),e=U(),G(n.$$.fragment),o=U(),G(a.$$.fragment),i=U(),G(d.$$.fragment)},l(r){K(t.$$.fragment,r),e=F(r),K(n.$$.fragment,r),o=F(r),K(a.$$.fragment,r),i=F(r),K(d.$$.fragment,r)},m(r,c){X(t,r,c),W(r,e,c),X(n,r,c),W(r,o,c),X(a,r,c),W(r,i,c),X(d,r,c),l=!0},p(r,[c]){const _={};c&1&&(_.value=r[0].attack??.1),t.$set(_);const m={};c&1&&(m.value=r[0].decay??.2),n.$set(m);const y={};c&1&&(y.value=r[0].sustain??.7),a.$set(y);const p={};c&1&&(p.value=r[0].release??.3),d.$set(p)},i(r){l||(L(t.$$.fragment,r),L(n.$$.fragment,r),L(a.$$.fragment,r),L(d.$$.fragment,r),l=!0)},o(r){z(t.$$.fragment,r),z(n.$$.fragment,r),z(a.$$.fragment,r),z(d.$$.fragment,r),l=!1},d(r){r&&(P(e),P(o),P(i)),H(t,r),H(n,r),H(a,r),H(d,r)}}}function Qs(s,t,e){let n,{selectedTrack:o=void 0}=t,{selectedPattern:a=void 0}=t,{selectedInstrument:i=void 0}=t,{trackSettings:d}=t,l=null;De.subscribe(p=>l=p);function r(p,b){if(!n)return;let T=b;if(typeof b=="number"){if(isNaN(b))return;p==="attack"||p==="decay"||p==="release"||p==="sustain"?T=Math.max(0,Math.min(1,parseFloat(b.toFixed(2)))):T=parseFloat(b.toFixed(2))}const u={...n.settings,[p]:T},g=n.instrumentSettings||{};if(n.instrumentType&&(g[n.instrumentType]={...u}),a&&i){if(Z.updatePatternInstrument(a.id,i.id,{settings:u,instrumentSettings:g}),l){const f=`__pattern_${a.id}_${i.id}`;l.updateTrackSettings(f,u)}}else o&&(Z.updateTrack(o.id,{settings:u,instrumentSettings:g}),l&&l.updateTrackSettings(o.id,u))}const c=p=>r("attack",p),_=p=>r("decay",p),m=p=>r("sustain",p),y=p=>r("release",p);return s.$$set=p=>{"selectedTrack"in p&&e(2,o=p.selectedTrack),"selectedPattern"in p&&e(3,a=p.selectedPattern),"selectedInstrument"in p&&e(4,i=p.selectedInstrument),"trackSettings"in p&&e(0,d=p.trackSettings)},s.$$.update=()=>{s.$$.dirty&20&&(n=i||o)},[d,r,o,a,i,c,_,m,y]}class Zs extends Pe{constructor(t){super(),$e(this,t,Qs,Js,Ne,{selectedTrack:2,selectedPattern:3,selectedInstrument:4,trackSettings:0})}}function xs(s){let t,e,n,o,a,i,d,l,r,c,_,m,y,p,b,T,u,g,f,w,h,v;return t=new te({props:{id:"supersaw-num-osc",label:"Number of Oscillators",value:s[0].numOscillators??7,min:3,max:15,step:1,onUpdate:s[5]}}),n=new te({props:{id:"supersaw-detune",label:"Detune (semitones)",value:s[0].detune??.1,min:0,max:1,step:.01,onUpdate:s[6]}}),a=new te({props:{id:"supersaw-spread",label:"Spread",value:s[0].spread??.5,min:0,max:1,step:.01,onUpdate:s[7]}}),d=new te({props:{id:"supersaw-filter-cutoff",label:"Filter Cutoff (Hz)",value:s[0].filterCutoff??8e3,min:20,max:2e4,step:10,onUpdate:s[8]}}),r=new te({props:{id:"supersaw-filter-resonance",label:"Filter Resonance",value:s[0].filterResonance??.5,min:0,max:1,step:.01,onUpdate:s[9]}}),_=new te({props:{id:"supersaw-lfo-rate",label:"LFO Rate (Hz)",value:s[0].lfoRate??0,min:0,max:20,step:.1,onUpdate:s[10]}}),y=new te({props:{id:"supersaw-lfo-amount",label:"LFO Amount (Hz)",value:s[0].lfoAmount??0,min:0,max:5e3,step:10,onUpdate:s[11]}}),b=new te({props:{id:"supersaw-attack",label:"Attack",value:s[0].attack??.1,min:0,max:1,step:.01,onUpdate:s[12]}}),u=new te({props:{id:"supersaw-decay",label:"Decay",value:s[0].decay??.2,min:0,max:1,step:.01,onUpdate:s[13]}}),f=new te({props:{id:"supersaw-sustain",label:"Sustain",value:s[0].sustain??.7,min:0,max:1,step:.01,onUpdate:s[14]}}),h=new te({props:{id:"supersaw-release",label:"Release",value:s[0].release??.3,min:0,max:1,step:.01,onUpdate:s[15]}}),{c(){G(t.$$.fragment),e=U(),G(n.$$.fragment),o=U(),G(a.$$.fragment),i=U(),G(d.$$.fragment),l=U(),G(r.$$.fragment),c=U(),G(_.$$.fragment),m=U(),G(y.$$.fragment),p=U(),G(b.$$.fragment),T=U(),G(u.$$.fragment),g=U(),G(f.$$.fragment),w=U(),G(h.$$.fragment)},l(I){K(t.$$.fragment,I),e=F(I),K(n.$$.fragment,I),o=F(I),K(a.$$.fragment,I),i=F(I),K(d.$$.fragment,I),l=F(I),K(r.$$.fragment,I),c=F(I),K(_.$$.fragment,I),m=F(I),K(y.$$.fragment,I),p=F(I),K(b.$$.fragment,I),T=F(I),K(u.$$.fragment,I),g=F(I),K(f.$$.fragment,I),w=F(I),K(h.$$.fragment,I)},m(I,k){X(t,I,k),W(I,e,k),X(n,I,k),W(I,o,k),X(a,I,k),W(I,i,k),X(d,I,k),W(I,l,k),X(r,I,k),W(I,c,k),X(_,I,k),W(I,m,k),X(y,I,k),W(I,p,k),X(b,I,k),W(I,T,k),X(u,I,k),W(I,g,k),X(f,I,k),W(I,w,k),X(h,I,k),v=!0},p(I,[k]){const S={};k&1&&(S.value=I[0].numOscillators??7),t.$set(S);const N={};k&1&&(N.value=I[0].detune??.1),n.$set(N);const M={};k&1&&(M.value=I[0].spread??.5),a.$set(M);const q={};k&1&&(q.value=I[0].filterCutoff??8e3),d.$set(q);const J={};k&1&&(J.value=I[0].filterResonance??.5),r.$set(J);const R={};k&1&&(R.value=I[0].lfoRate??0),_.$set(R);const Y={};k&1&&(Y.value=I[0].lfoAmount??0),y.$set(Y);const ne={};k&1&&(ne.value=I[0].attack??.1),b.$set(ne);const se={};k&1&&(se.value=I[0].decay??.2),u.$set(se);const V={};k&1&&(V.value=I[0].sustain??.7),f.$set(V);const B={};k&1&&(B.value=I[0].release??.3),h.$set(B)},i(I){v||(L(t.$$.fragment,I),L(n.$$.fragment,I),L(a.$$.fragment,I),L(d.$$.fragment,I),L(r.$$.fragment,I),L(_.$$.fragment,I),L(y.$$.fragment,I),L(b.$$.fragment,I),L(u.$$.fragment,I),L(f.$$.fragment,I),L(h.$$.fragment,I),v=!0)},o(I){z(t.$$.fragment,I),z(n.$$.fragment,I),z(a.$$.fragment,I),z(d.$$.fragment,I),z(r.$$.fragment,I),z(_.$$.fragment,I),z(y.$$.fragment,I),z(b.$$.fragment,I),z(u.$$.fragment,I),z(f.$$.fragment,I),z(h.$$.fragment,I),v=!1},d(I){I&&(P(e),P(o),P(i),P(l),P(c),P(m),P(p),P(T),P(g),P(w)),H(t,I),H(n,I),H(a,I),H(d,I),H(r,I),H(_,I),H(y,I),H(b,I),H(u,I),H(f,I),H(h,I)}}}function er(s,t,e){let n,{selectedTrack:o=void 0}=t,{selectedPattern:a=void 0}=t,{selectedInstrument:i=void 0}=t,{trackSettings:d}=t,l=null;De.subscribe(h=>l=h);function r(h,v){if(!n)return;let I=v;if(typeof v=="number"){if(isNaN(v))return;h==="attack"||h==="decay"||h==="release"||h==="sustain"?I=Math.max(0,Math.min(1,parseFloat(v.toFixed(2)))):h==="filterCutoff"?I=Math.max(20,Math.min(2e4,parseFloat(v.toFixed(0)))):h==="filterResonance"?I=Math.max(0,Math.min(1,parseFloat(v.toFixed(2)))):h==="lfoAmount"?I=Math.max(0,Math.min(5e3,parseFloat(v.toFixed(0)))):I=parseFloat(v.toFixed(2))}const k={...n.settings,[h]:I},S=n.instrumentSettings||{};if(n.instrumentType&&(S[n.instrumentType]={...k}),a&&i){if(Z.updatePatternInstrument(a.id,i.id,{settings:k,instrumentSettings:S}),l){const N=`__pattern_${a.id}_${i.id}`;l.updateTrackSettings(N,k)}}else o&&(Z.updateTrack(o.id,{settings:k,instrumentSettings:S}),l&&l.updateTrackSettings(o.id,k))}const c=h=>r("numOscillators",h),_=h=>r("detune",h),m=h=>r("spread",h),y=h=>r("filterCutoff",h),p=h=>r("filterResonance",h),b=h=>r("lfoRate",h),T=h=>r("lfoAmount",h),u=h=>r("attack",h),g=h=>r("decay",h),f=h=>r("sustain",h),w=h=>r("release",h);return s.$$set=h=>{"selectedTrack"in h&&e(2,o=h.selectedTrack),"selectedPattern"in h&&e(3,a=h.selectedPattern),"selectedInstrument"in h&&e(4,i=h.selectedInstrument),"trackSettings"in h&&e(0,d=h.trackSettings)},s.$$.update=()=>{s.$$.dirty&20&&(n=i||o)},[d,r,o,a,i,c,_,m,y,p,b,T,u,g,f,w]}class tr extends Pe{constructor(t){super(),$e(this,t,er,xs,Ne,{selectedTrack:2,selectedPattern:3,selectedInstrument:4,trackSettings:0})}}function nr(s){let t,e,n,o,a,i,d,l;return t=new te({props:{id:"pluck-attack",label:"Attack",value:s[0].attack??.01,min:0,max:1,step:.01,onUpdate:s[5]}}),n=new te({props:{id:"pluck-decay",label:"Decay",value:s[0].decay??.3,min:0,max:1,step:.01,onUpdate:s[6]}}),a=new te({props:{id:"pluck-release",label:"Release",value:s[0].release??.4,min:0,max:1,step:.01,onUpdate:s[7]}}),d=new te({props:{id:"pluck-damping",label:"Damping",value:s[0].damping??.98,min:.9,max:.999,step:.001,onUpdate:s[8]}}),{c(){G(t.$$.fragment),e=U(),G(n.$$.fragment),o=U(),G(a.$$.fragment),i=U(),G(d.$$.fragment)},l(r){K(t.$$.fragment,r),e=F(r),K(n.$$.fragment,r),o=F(r),K(a.$$.fragment,r),i=F(r),K(d.$$.fragment,r)},m(r,c){X(t,r,c),W(r,e,c),X(n,r,c),W(r,o,c),X(a,r,c),W(r,i,c),X(d,r,c),l=!0},p(r,[c]){const _={};c&1&&(_.value=r[0].attack??.01),t.$set(_);const m={};c&1&&(m.value=r[0].decay??.3),n.$set(m);const y={};c&1&&(y.value=r[0].release??.4),a.$set(y);const p={};c&1&&(p.value=r[0].damping??.98),d.$set(p)},i(r){l||(L(t.$$.fragment,r),L(n.$$.fragment,r),L(a.$$.fragment,r),L(d.$$.fragment,r),l=!0)},o(r){z(t.$$.fragment,r),z(n.$$.fragment,r),z(a.$$.fragment,r),z(d.$$.fragment,r),l=!1},d(r){r&&(P(e),P(o),P(i)),H(t,r),H(n,r),H(a,r),H(d,r)}}}function sr(s,t,e){let n,{selectedTrack:o=void 0}=t,{selectedPattern:a=void 0}=t,{selectedInstrument:i=void 0}=t,{trackSettings:d}=t,l=null;De.subscribe(p=>l=p);function r(p,b){if(!n)return;let T=b;if(typeof b=="number"){if(isNaN(b))return;p==="attack"||p==="decay"||p==="release"?T=Math.max(0,Math.min(1,parseFloat(b.toFixed(2)))):p==="damping"?T=Math.max(.9,Math.min(.999,parseFloat(b.toFixed(3)))):T=parseFloat(b.toFixed(2))}const u={...n.settings,[p]:T},g=n.instrumentSettings||{};if(n.instrumentType&&(g[n.instrumentType]={...u}),a&&i){if(Z.updatePatternInstrument(a.id,i.id,{settings:u,instrumentSettings:g}),l){const f=`__pattern_${a.id}_${i.id}`;l.updateTrackSettings(f,u)}}else o&&(Z.updateTrack(o.id,{settings:u,instrumentSettings:g}),l&&l.updateTrackSettings(o.id,u))}const c=p=>r("attack",p),_=p=>r("decay",p),m=p=>r("release",p),y=p=>r("damping",p);return s.$$set=p=>{"selectedTrack"in p&&e(2,o=p.selectedTrack),"selectedPattern"in p&&e(3,a=p.selectedPattern),"selectedInstrument"in p&&e(4,i=p.selectedInstrument),"trackSettings"in p&&e(0,d=p.trackSettings)},s.$$.update=()=>{s.$$.dirty&20&&(n=i||o)},[d,r,o,a,i,c,_,m,y]}class rr extends Pe{constructor(t){super(),$e(this,t,sr,nr,Ne,{selectedTrack:2,selectedPattern:3,selectedInstrument:4,trackSettings:0})}}function ar(s){let t,e,n="Oscillator Type",o,a,i,d="Sawtooth",l,r="Square",c,_="Sine",m,y="Triangle",p,b,T,u,g,f,w,h,v,I,k,S,N,M,q,J,R,Y,ne,se;return T=new te({props:{id:"bass-sub-level",label:"Sub Level",value:s[0].subLevel??.6,min:0,max:1,step:.01,onUpdate:s[6]}}),g=new te({props:{id:"bass-saturation",label:"Saturation",value:s[0].saturation??.3,min:0,max:1,step:.01,onUpdate:s[7]}}),w=new te({props:{id:"bass-filter-cutoff",label:"Filter Cutoff",value:s[0].filterCutoff??2e3,min:20,max:8e3,step:10,onUpdate:s[8]}}),v=new te({props:{id:"bass-filter-resonance",label:"Filter Resonance",value:s[0].filterResonance??.3,min:0,max:1,step:.01,onUpdate:s[9]}}),k=new te({props:{id:"bass-attack",label:"Attack",value:s[0].attack??.05,min:0,max:1,step:.01,onUpdate:s[10]}}),N=new te({props:{id:"bass-decay",label:"Decay",value:s[0].decay??.2,min:0,max:1,step:.01,onUpdate:s[11]}}),q=new te({props:{id:"bass-sustain",label:"Sustain",value:s[0].sustain??.8,min:0,max:1,step:.01,onUpdate:s[12]}}),R=new te({props:{id:"bass-release",label:"Release",value:s[0].release??.3,min:0,max:1,step:.01,onUpdate:s[13]}}),{c(){t=E("div"),e=E("label"),e.textContent=n,o=U(),a=E("select"),i=E("option"),i.textContent=d,l=E("option"),l.textContent=r,c=E("option"),c.textContent=_,m=E("option"),m.textContent=y,b=U(),G(T.$$.fragment),u=U(),G(g.$$.fragment),f=U(),G(w.$$.fragment),h=U(),G(v.$$.fragment),I=U(),G(k.$$.fragment),S=U(),G(N.$$.fragment),M=U(),G(q.$$.fragment),J=U(),G(R.$$.fragment),this.h()},l(V){t=D(V,"DIV",{class:!0});var B=j(t);e=D(B,"LABEL",{for:!0,"data-svelte-h":!0}),le(e)!=="svelte-14tfvwv"&&(e.textContent=n),o=F(B),a=D(B,"SELECT",{id:!0});var oe=j(a);i=D(oe,"OPTION",{"data-svelte-h":!0}),le(i)!=="svelte-hfmaw8"&&(i.textContent=d),l=D(oe,"OPTION",{"data-svelte-h":!0}),le(l)!=="svelte-bkgndu"&&(l.textContent=r),c=D(oe,"OPTION",{"data-svelte-h":!0}),le(c)!=="svelte-1mpn6cq"&&(c.textContent=_),m=D(oe,"OPTION",{"data-svelte-h":!0}),le(m)!=="svelte-1f5nbzi"&&(m.textContent=y),oe.forEach(P),B.forEach(P),b=F(V),K(T.$$.fragment,V),u=F(V),K(g.$$.fragment,V),f=F(V),K(w.$$.fragment,V),h=F(V),K(v.$$.fragment,V),I=F(V),K(k.$$.fragment,V),S=F(V),K(N.$$.fragment,V),M=F(V),K(q.$$.fragment,V),J=F(V),K(R.$$.fragment,V),this.h()},h(){$(e,"for","bass-osc1-type"),i.__value="saw",Ce(i,i.__value),l.__value="square",Ce(l,l.__value),c.__value="sine",Ce(c,c.__value),m.__value="triangle",Ce(m,m.__value),$(a,"id","bass-osc1-type"),$(t,"class","param")},m(V,B){W(V,t,B),C(t,e),C(t,o),C(t,a),C(a,i),C(a,l),C(a,c),C(a,m),Xe(a,s[0].osc1Type??"saw"),W(V,b,B),X(T,V,B),W(V,u,B),X(g,V,B),W(V,f,B),X(w,V,B),W(V,h,B),X(v,V,B),W(V,I,B),X(k,V,B),W(V,S,B),X(N,V,B),W(V,M,B),X(q,V,B),W(V,J,B),X(R,V,B),Y=!0,ne||(se=ie(a,"change",s[5]),ne=!0)},p(V,[B]){(!Y||B&1&&p!==(p=V[0].osc1Type??"saw"))&&Xe(a,V[0].osc1Type??"saw");const oe={};B&1&&(oe.value=V[0].subLevel??.6),T.$set(oe);const he={};B&1&&(he.value=V[0].saturation??.3),g.$set(he);const _e={};B&1&&(_e.value=V[0].filterCutoff??2e3),w.$set(_e);const ee={};B&1&&(ee.value=V[0].filterResonance??.3),v.$set(ee);const O={};B&1&&(O.value=V[0].attack??.05),k.$set(O);const de={};B&1&&(de.value=V[0].decay??.2),N.$set(de);const x={};B&1&&(x.value=V[0].sustain??.8),q.$set(x);const ce={};B&1&&(ce.value=V[0].release??.3),R.$set(ce)},i(V){Y||(L(T.$$.fragment,V),L(g.$$.fragment,V),L(w.$$.fragment,V),L(v.$$.fragment,V),L(k.$$.fragment,V),L(N.$$.fragment,V),L(q.$$.fragment,V),L(R.$$.fragment,V),Y=!0)},o(V){z(T.$$.fragment,V),z(g.$$.fragment,V),z(w.$$.fragment,V),z(v.$$.fragment,V),z(k.$$.fragment,V),z(N.$$.fragment,V),z(q.$$.fragment,V),z(R.$$.fragment,V),Y=!1},d(V){V&&(P(t),P(b),P(u),P(f),P(h),P(I),P(S),P(M),P(J)),H(T,V),H(g,V),H(w,V),H(v,V),H(k,V),H(N,V),H(q,V),H(R,V),ne=!1,se()}}}function lr(s,t,e){let n,{selectedTrack:o=void 0}=t,{selectedPattern:a=void 0}=t,{selectedInstrument:i=void 0}=t,{trackSettings:d}=t,l=null;De.subscribe(f=>l=f);function r(f,w){if(!n)return;let h=w;if(typeof w=="number"){if(isNaN(w))return;f==="attack"||f==="decay"||f==="release"||f==="sustain"?h=Math.max(0,Math.min(1,parseFloat(w.toFixed(2)))):f==="filterCutoff"?h=Math.max(20,Math.min(8e3,parseFloat(w.toFixed(0)))):f==="filterResonance"?h=Math.max(0,Math.min(1,parseFloat(w.toFixed(2)))):h=parseFloat(w.toFixed(2))}const v={...n.settings,[f]:h},I=n.instrumentSettings||{};if(n.instrumentType&&(I[n.instrumentType]={...v}),a&&i){if(Z.updatePatternInstrument(a.id,i.id,{settings:v,instrumentSettings:I}),l){const k=`__pattern_${a.id}_${i.id}`;l.updateTrackSettings(k,v)}}else o&&(Z.updateTrack(o.id,{settings:v,instrumentSettings:I}),l&&l.updateTrackSettings(o.id,v))}const c=f=>r("osc1Type",kt(f)||"saw"),_=f=>r("subLevel",f),m=f=>r("saturation",f),y=f=>r("filterCutoff",f),p=f=>r("filterResonance",f),b=f=>r("attack",f),T=f=>r("decay",f),u=f=>r("sustain",f),g=f=>r("release",f);return s.$$set=f=>{"selectedTrack"in f&&e(2,o=f.selectedTrack),"selectedPattern"in f&&e(3,a=f.selectedPattern),"selectedInstrument"in f&&e(4,i=f.selectedInstrument),"trackSettings"in f&&e(0,d=f.trackSettings)},s.$$.update=()=>{s.$$.dirty&20&&(n=i||o)},[d,r,o,a,i,c,_,m,y,p,b,T,u,g]}class ir extends Pe{constructor(t){super(),$e(this,t,lr,ar,Ne,{selectedTrack:2,selectedPattern:3,selectedInstrument:4,trackSettings:0})}}function or(s){let t,e,n="Oscillator Type",o,a,i,d="Sawtooth",l,r="Square",c,_="Sine",m,y="Triangle",p,b,T,u,g,f,w,h,v,I,k,S,N,M,q,J,R,Y,ne,se,V,B,oe,he,_e,ee,O,de,x,ce;return T=new te({props:{id:"pad-num-osc",label:"Number of Oscillators",value:s[0].numOscillators??8,min:4,max:16,step:1,onUpdate:s[6]}}),g=new te({props:{id:"pad-detune",label:"Detune (semitones)",value:s[0].detune??.15,min:0,max:1,step:.01,onUpdate:s[7]}}),w=new te({props:{id:"pad-spread",label:"Spread",value:s[0].spread??.7,min:0,max:1,step:.01,onUpdate:s[8]}}),v=new te({props:{id:"pad-filter-cutoff",label:"Filter Cutoff (Hz)",value:s[0].filterCutoff??4e3,min:20,max:2e4,step:10,onUpdate:s[9]}}),k=new te({props:{id:"pad-filter-resonance",label:"Filter Resonance",value:s[0].filterResonance??.3,min:0,max:1,step:.01,onUpdate:s[10]}}),N=new te({props:{id:"pad-pitch-lfo-rate",label:"Pitch LFO Rate (Hz)",value:s[0].pitchLfoRate??.5,min:0,max:10,step:.1,onUpdate:s[11]}}),q=new te({props:{id:"pad-pitch-lfo-amount",label:"Pitch LFO Amount (semitones)",value:s[0].pitchLfoAmount??.02,min:0,max:.5,step:.01,onUpdate:s[12]}}),R=new te({props:{id:"pad-filter-lfo-rate",label:"Filter LFO Rate (Hz)",value:s[0].filterLfoRate??.3,min:0,max:5,step:.1,onUpdate:s[13]}}),ne=new te({props:{id:"pad-filter-lfo-amount",label:"Filter LFO Amount (Hz)",value:s[0].filterLfoAmount??1e3,min:0,max:5e3,step:10,onUpdate:s[14]}}),V=new te({props:{id:"pad-attack",label:"Attack",value:s[0].attack??.5,min:0,max:1,step:.01,onUpdate:s[15]}}),oe=new te({props:{id:"pad-decay",label:"Decay",value:s[0].decay??.3,min:0,max:1,step:.01,onUpdate:s[16]}}),_e=new te({props:{id:"pad-sustain",label:"Sustain",value:s[0].sustain??.9,min:0,max:1,step:.01,onUpdate:s[17]}}),O=new te({props:{id:"pad-release",label:"Release",value:s[0].release??1.5,min:0,max:3,step:.01,onUpdate:s[18]}}),{c(){t=E("div"),e=E("label"),e.textContent=n,o=U(),a=E("select"),i=E("option"),i.textContent=d,l=E("option"),l.textContent=r,c=E("option"),c.textContent=_,m=E("option"),m.textContent=y,b=U(),G(T.$$.fragment),u=U(),G(g.$$.fragment),f=U(),G(w.$$.fragment),h=U(),G(v.$$.fragment),I=U(),G(k.$$.fragment),S=U(),G(N.$$.fragment),M=U(),G(q.$$.fragment),J=U(),G(R.$$.fragment),Y=U(),G(ne.$$.fragment),se=U(),G(V.$$.fragment),B=U(),G(oe.$$.fragment),he=U(),G(_e.$$.fragment),ee=U(),G(O.$$.fragment),this.h()},l(A){t=D(A,"DIV",{class:!0});var re=j(t);e=D(re,"LABEL",{for:!0,"data-svelte-h":!0}),le(e)!=="svelte-1uyzizm"&&(e.textContent=n),o=F(re),a=D(re,"SELECT",{id:!0});var ge=j(a);i=D(ge,"OPTION",{"data-svelte-h":!0}),le(i)!=="svelte-hfmaw8"&&(i.textContent=d),l=D(ge,"OPTION",{"data-svelte-h":!0}),le(l)!=="svelte-bkgndu"&&(l.textContent=r),c=D(ge,"OPTION",{"data-svelte-h":!0}),le(c)!=="svelte-1mpn6cq"&&(c.textContent=_),m=D(ge,"OPTION",{"data-svelte-h":!0}),le(m)!=="svelte-1f5nbzi"&&(m.textContent=y),ge.forEach(P),re.forEach(P),b=F(A),K(T.$$.fragment,A),u=F(A),K(g.$$.fragment,A),f=F(A),K(w.$$.fragment,A),h=F(A),K(v.$$.fragment,A),I=F(A),K(k.$$.fragment,A),S=F(A),K(N.$$.fragment,A),M=F(A),K(q.$$.fragment,A),J=F(A),K(R.$$.fragment,A),Y=F(A),K(ne.$$.fragment,A),se=F(A),K(V.$$.fragment,A),B=F(A),K(oe.$$.fragment,A),he=F(A),K(_e.$$.fragment,A),ee=F(A),K(O.$$.fragment,A),this.h()},h(){$(e,"for","pad-osc-type"),i.__value="saw",Ce(i,i.__value),l.__value="square",Ce(l,l.__value),c.__value="sine",Ce(c,c.__value),m.__value="triangle",Ce(m,m.__value),$(a,"id","pad-osc-type"),$(t,"class","param")},m(A,re){W(A,t,re),C(t,e),C(t,o),C(t,a),C(a,i),C(a,l),C(a,c),C(a,m),Xe(a,s[0].oscType??"saw"),W(A,b,re),X(T,A,re),W(A,u,re),X(g,A,re),W(A,f,re),X(w,A,re),W(A,h,re),X(v,A,re),W(A,I,re),X(k,A,re),W(A,S,re),X(N,A,re),W(A,M,re),X(q,A,re),W(A,J,re),X(R,A,re),W(A,Y,re),X(ne,A,re),W(A,se,re),X(V,A,re),W(A,B,re),X(oe,A,re),W(A,he,re),X(_e,A,re),W(A,ee,re),X(O,A,re),de=!0,x||(ce=ie(a,"change",s[5]),x=!0)},p(A,[re]){(!de||re&1&&p!==(p=A[0].oscType??"saw"))&&Xe(a,A[0].oscType??"saw");const ge={};re&1&&(ge.value=A[0].numOscillators??8),T.$set(ge);const Me={};re&1&&(Me.value=A[0].detune??.15),g.$set(Me);const we={};re&1&&(we.value=A[0].spread??.7),w.$set(we);const Q={};re&1&&(Q.value=A[0].filterCutoff??4e3),v.$set(Q);const ue={};re&1&&(ue.value=A[0].filterResonance??.3),k.$set(ue);const ae={};re&1&&(ae.value=A[0].pitchLfoRate??.5),N.$set(ae);const pe={};re&1&&(pe.value=A[0].pitchLfoAmount??.02),q.$set(pe);const Te={};re&1&&(Te.value=A[0].filterLfoRate??.3),R.$set(Te);const Ae={};re&1&&(Ae.value=A[0].filterLfoAmount??1e3),ne.$set(Ae);const ve={};re&1&&(ve.value=A[0].attack??.5),V.$set(ve);const ze={};re&1&&(ze.value=A[0].decay??.3),oe.$set(ze);const Re={};re&1&&(Re.value=A[0].sustain??.9),_e.$set(Re);const qe={};re&1&&(qe.value=A[0].release??1.5),O.$set(qe)},i(A){de||(L(T.$$.fragment,A),L(g.$$.fragment,A),L(w.$$.fragment,A),L(v.$$.fragment,A),L(k.$$.fragment,A),L(N.$$.fragment,A),L(q.$$.fragment,A),L(R.$$.fragment,A),L(ne.$$.fragment,A),L(V.$$.fragment,A),L(oe.$$.fragment,A),L(_e.$$.fragment,A),L(O.$$.fragment,A),de=!0)},o(A){z(T.$$.fragment,A),z(g.$$.fragment,A),z(w.$$.fragment,A),z(v.$$.fragment,A),z(k.$$.fragment,A),z(N.$$.fragment,A),z(q.$$.fragment,A),z(R.$$.fragment,A),z(ne.$$.fragment,A),z(V.$$.fragment,A),z(oe.$$.fragment,A),z(_e.$$.fragment,A),z(O.$$.fragment,A),de=!1},d(A){A&&(P(t),P(b),P(u),P(f),P(h),P(I),P(S),P(M),P(J),P(Y),P(se),P(B),P(he),P(ee)),H(T,A),H(g,A),H(w,A),H(v,A),H(k,A),H(N,A),H(q,A),H(R,A),H(ne,A),H(V,A),H(oe,A),H(_e,A),H(O,A),x=!1,ce()}}}function cr(s,t,e){let n,{selectedTrack:o=void 0}=t,{selectedPattern:a=void 0}=t,{selectedInstrument:i=void 0}=t,{trackSettings:d}=t,l=null;De.subscribe(k=>l=k);function r(k,S){if(!n)return;let N=S;if(typeof S=="number"){if(isNaN(S))return;k==="attack"||k==="decay"?N=Math.max(0,Math.min(1,parseFloat(S.toFixed(2)))):k==="release"?N=Math.max(0,Math.min(3,parseFloat(S.toFixed(2)))):k==="sustain"?N=Math.max(0,Math.min(1,parseFloat(S.toFixed(2)))):k==="filterCutoff"?N=Math.max(20,Math.min(2e4,parseFloat(S.toFixed(0)))):k==="filterResonance"?N=Math.max(0,Math.min(1,parseFloat(S.toFixed(2)))):k==="filterLfoAmount"?N=Math.max(0,Math.min(5e3,parseFloat(S.toFixed(0)))):N=parseFloat(S.toFixed(2))}const M={...n.settings,[k]:N},q=n.instrumentSettings||{};if(n.instrumentType&&(q[n.instrumentType]={...M}),a&&i){if(Z.updatePatternInstrument(a.id,i.id,{settings:M,instrumentSettings:q}),l){const J=`__pattern_${a.id}_${i.id}`;l.updateTrackSettings(J,M)}}else o&&(Z.updateTrack(o.id,{settings:M,instrumentSettings:q}),l&&l.updateTrackSettings(o.id,M))}const c=k=>r("oscType",kt(k)||"saw"),_=k=>r("numOscillators",k),m=k=>r("detune",k),y=k=>r("spread",k),p=k=>r("filterCutoff",k),b=k=>r("filterResonance",k),T=k=>r("pitchLfoRate",k),u=k=>r("pitchLfoAmount",k),g=k=>r("filterLfoRate",k),f=k=>r("filterLfoAmount",k),w=k=>r("attack",k),h=k=>r("decay",k),v=k=>r("sustain",k),I=k=>r("release",k);return s.$$set=k=>{"selectedTrack"in k&&e(2,o=k.selectedTrack),"selectedPattern"in k&&e(3,a=k.selectedPattern),"selectedInstrument"in k&&e(4,i=k.selectedInstrument),"trackSettings"in k&&e(0,d=k.trackSettings)},s.$$.update=()=>{s.$$.dirty&20&&(n=i||o)},[d,r,o,a,i,c,_,m,y,p,b,T,u,g,f,w,h,v,I]}class ur extends Pe{constructor(t){super(),$e(this,t,cr,or,Ne,{selectedTrack:2,selectedPattern:3,selectedInstrument:4,trackSettings:0})}}function Yt(s,t,e){const n=s.slice();return n[19]=t[e],n[21]=e,n}function qt(s){let t,e;function n(...o){return s[8](s[21],...o)}return t=new te({props:{id:"organ-drawbar-"+s[21],label:s[2][s[21]],value:s[19],min:0,max:1,step:.01,onUpdate:n}}),{c(){G(t.$$.fragment)},l(o){K(t.$$.fragment,o)},m(o,a){X(t,o,a),e=!0},p(o,a){s=o;const i={};a&4&&(i.label=s[2][s[21]]),a&2&&(i.value=s[19]),t.$set(i)},i(o){e||(L(t.$$.fragment,o),e=!0)},o(o){z(t.$$.fragment,o),e=!1},d(o){H(t,o)}}}function dr(s){let t,e,n="Drawbars",o,a,i,d,l,r,c,_,m,y,p,b,T,u,g,f,w,h,v=Ie(s[1]),I=[];for(let S=0;S<v.length;S+=1)I[S]=qt(Yt(s,v,S));const k=S=>z(I[S],1,1,()=>{I[S]=null});return i=new te({props:{id:"organ-rotary-speed",label:"Rotary Speed (Hz)",value:s[0].rotarySpeed??4,min:0,max:10,step:.1,onUpdate:s[9]}}),l=new te({props:{id:"organ-rotary-depth",label:"Rotary Depth",value:s[0].rotaryDepth??.3,min:0,max:1,step:.01,onUpdate:s[10]}}),c=new te({props:{id:"organ-filter-cutoff",label:"Filter Cutoff (Hz)",value:s[0].filterCutoff??8e3,min:20,max:2e4,step:10,onUpdate:s[11]}}),m=new te({props:{id:"organ-filter-resonance",label:"Filter Resonance",value:s[0].filterResonance??.2,min:0,max:1,step:.01,onUpdate:s[12]}}),p=new te({props:{id:"organ-attack",label:"Attack",value:s[0].attack??.01,min:0,max:1,step:.01,onUpdate:s[13]}}),T=new te({props:{id:"organ-decay",label:"Decay",value:s[0].decay??.1,min:0,max:1,step:.01,onUpdate:s[14]}}),g=new te({props:{id:"organ-sustain",label:"Sustain",value:s[0].sustain??1,min:0,max:1,step:.01,onUpdate:s[15]}}),w=new te({props:{id:"organ-release",label:"Release",value:s[0].release??.2,min:0,max:1,step:.01,onUpdate:s[16]}}),{c(){t=E("div"),e=E("h4"),e.textContent=n,o=U();for(let S=0;S<I.length;S+=1)I[S].c();a=U(),G(i.$$.fragment),d=U(),G(l.$$.fragment),r=U(),G(c.$$.fragment),_=U(),G(m.$$.fragment),y=U(),G(p.$$.fragment),b=U(),G(T.$$.fragment),u=U(),G(g.$$.fragment),f=U(),G(w.$$.fragment),this.h()},l(S){t=D(S,"DIV",{class:!0});var N=j(t);e=D(N,"H4",{"data-svelte-h":!0}),le(e)!=="svelte-1k4eyoy"&&(e.textContent=n),o=F(N);for(let M=0;M<I.length;M+=1)I[M].l(N);N.forEach(P),a=F(S),K(i.$$.fragment,S),d=F(S),K(l.$$.fragment,S),r=F(S),K(c.$$.fragment,S),_=F(S),K(m.$$.fragment,S),y=F(S),K(p.$$.fragment,S),b=F(S),K(T.$$.fragment,S),u=F(S),K(g.$$.fragment,S),f=F(S),K(w.$$.fragment,S),this.h()},h(){$(t,"class","param-section")},m(S,N){W(S,t,N),C(t,e),C(t,o);for(let M=0;M<I.length;M+=1)I[M]&&I[M].m(t,null);W(S,a,N),X(i,S,N),W(S,d,N),X(l,S,N),W(S,r,N),X(c,S,N),W(S,_,N),X(m,S,N),W(S,y,N),X(p,S,N),W(S,b,N),X(T,S,N),W(S,u,N),X(g,S,N),W(S,f,N),X(w,S,N),h=!0},p(S,[N]){if(N&22){v=Ie(S[1]);let B;for(B=0;B<v.length;B+=1){const oe=Yt(S,v,B);I[B]?(I[B].p(oe,N),L(I[B],1)):(I[B]=qt(oe),I[B].c(),L(I[B],1),I[B].m(t,null))}for(We(),B=v.length;B<I.length;B+=1)k(B);Ye()}const M={};N&1&&(M.value=S[0].rotarySpeed??4),i.$set(M);const q={};N&1&&(q.value=S[0].rotaryDepth??.3),l.$set(q);const J={};N&1&&(J.value=S[0].filterCutoff??8e3),c.$set(J);const R={};N&1&&(R.value=S[0].filterResonance??.2),m.$set(R);const Y={};N&1&&(Y.value=S[0].attack??.01),p.$set(Y);const ne={};N&1&&(ne.value=S[0].decay??.1),T.$set(ne);const se={};N&1&&(se.value=S[0].sustain??1),g.$set(se);const V={};N&1&&(V.value=S[0].release??.2),w.$set(V)},i(S){if(!h){for(let N=0;N<v.length;N+=1)L(I[N]);L(i.$$.fragment,S),L(l.$$.fragment,S),L(c.$$.fragment,S),L(m.$$.fragment,S),L(p.$$.fragment,S),L(T.$$.fragment,S),L(g.$$.fragment,S),L(w.$$.fragment,S),h=!0}},o(S){I=I.filter(Boolean);for(let N=0;N<I.length;N+=1)z(I[N]);z(i.$$.fragment,S),z(l.$$.fragment,S),z(c.$$.fragment,S),z(m.$$.fragment,S),z(p.$$.fragment,S),z(T.$$.fragment,S),z(g.$$.fragment,S),z(w.$$.fragment,S),h=!1},d(S){S&&(P(t),P(a),P(d),P(r),P(_),P(y),P(b),P(u),P(f)),_t(I,S),H(i,S),H(l,S),H(c,S),H(m,S),H(p,S),H(T,S),H(g,S),H(w,S)}}}function fr(s,t,e){let n,o,a,{selectedTrack:i=void 0}=t,{selectedPattern:d=void 0}=t,{selectedInstrument:l=void 0}=t,{trackSettings:r}=t,c=null;De.subscribe(v=>c=v);function _(v,I){if(!n)return;let k=I;if(typeof I=="number"){if(isNaN(I))return;v==="attack"||v==="decay"||v==="release"||v==="sustain"?k=Math.max(0,Math.min(1,parseFloat(I.toFixed(2)))):v==="filterCutoff"?k=Math.max(20,Math.min(2e4,parseFloat(I.toFixed(0)))):v==="filterResonance"||v.startsWith("drawbar")?k=Math.max(0,Math.min(1,parseFloat(I.toFixed(2)))):k=parseFloat(I.toFixed(2))}const S={...n.settings,[v]:k},N=n.instrumentSettings||{};if(n.instrumentType&&(N[n.instrumentType]={...S}),d&&l){if(Z.updatePatternInstrument(d.id,l.id,{settings:S,instrumentSettings:N}),c){const M=`__pattern_${d.id}_${l.id}`;c.updateTrackSettings(M,S)}}else i&&(Z.updateTrack(i.id,{settings:S,instrumentSettings:N}),c&&c.updateTrackSettings(i.id,S))}function m(v,I){if(!n)return;const k=[...a];k[v]=Math.max(0,Math.min(1,parseFloat(I.toFixed(2)))),_("drawbars",k)}const y=(v,I)=>m(v,I),p=v=>_("rotarySpeed",v),b=v=>_("rotaryDepth",v),T=v=>_("filterCutoff",v),u=v=>_("filterResonance",v),g=v=>_("attack",v),f=v=>_("decay",v),w=v=>_("sustain",v),h=v=>_("release",v);return s.$$set=v=>{"selectedTrack"in v&&e(5,i=v.selectedTrack),"selectedPattern"in v&&e(6,d=v.selectedPattern),"selectedInstrument"in v&&e(7,l=v.selectedInstrument),"trackSettings"in v&&e(0,r=v.trackSettings)},s.$$.update=()=>{s.$$.dirty&160&&(n=l||i),s.$$.dirty&1&&e(1,a=r.drawbars??[.8,0,1,0,.6,0,.4,0,.2])},e(2,o=["16'","5 1/3'","8'","4'","2 2/3'","2'","1 3/5'","1 1/3'","1'"]),[r,a,o,_,m,i,d,l,y,p,b,T,u,g,f,w,h]}class mr extends Pe{constructor(t){super(),$e(this,t,fr,dr,Ne,{selectedTrack:5,selectedPattern:6,selectedInstrument:7,trackSettings:0})}}function Ht(s){let t,e="Plugin",n,o;return{c(){t=E("button"),t.textContent=e,this.h()},l(a){t=D(a,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(t)!=="svelte-6wa2cm"&&(t.textContent=e),this.h()},h(){$(t,"class","plugin-btn"),$(t,"title","Open Plugin Window")},m(a,i){W(a,t,i),n||(o=ie(t,"click",s[6]),n=!0)},p:Ve,d(a){a&&P(t),n=!1,o()}}}function pr(s){let t,e;return t=new mr({props:{selectedTrack:s[0],selectedPattern:s[1],selectedInstrument:s[2],trackSettings:s[3]}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p(n,o){const a={};o&1&&(a.selectedTrack=n[0]),o&2&&(a.selectedPattern=n[1]),o&4&&(a.selectedInstrument=n[2]),o&8&&(a.trackSettings=n[3]),t.$set(a)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function hr(s){let t,e;return t=new ur({props:{selectedTrack:s[0],selectedPattern:s[1],selectedInstrument:s[2],trackSettings:s[3]}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p(n,o){const a={};o&1&&(a.selectedTrack=n[0]),o&2&&(a.selectedPattern=n[1]),o&4&&(a.selectedInstrument=n[2]),o&8&&(a.trackSettings=n[3]),t.$set(a)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function gr(s){let t,e;return t=new ir({props:{selectedTrack:s[0],selectedPattern:s[1],selectedInstrument:s[2],trackSettings:s[3]}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p(n,o){const a={};o&1&&(a.selectedTrack=n[0]),o&2&&(a.selectedPattern=n[1]),o&4&&(a.selectedInstrument=n[2]),o&8&&(a.trackSettings=n[3]),t.$set(a)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function _r(s){let t,e;return t=new rr({props:{selectedTrack:s[0],selectedPattern:s[1],selectedInstrument:s[2],trackSettings:s[3]}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p(n,o){const a={};o&1&&(a.selectedTrack=n[0]),o&2&&(a.selectedPattern=n[1]),o&4&&(a.selectedInstrument=n[2]),o&8&&(a.trackSettings=n[3]),t.$set(a)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function vr(s){let t,e;return t=new tr({props:{selectedTrack:s[0],selectedPattern:s[1],selectedInstrument:s[2],trackSettings:s[3]}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p(n,o){const a={};o&1&&(a.selectedTrack=n[0]),o&2&&(a.selectedPattern=n[1]),o&4&&(a.selectedInstrument=n[2]),o&8&&(a.trackSettings=n[3]),t.$set(a)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function Ir(s){let t,e;return t=new Zs({props:{selectedTrack:s[0],selectedPattern:s[1],selectedInstrument:s[2],trackSettings:s[3]}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p(n,o){const a={};o&1&&(a.selectedTrack=n[0]),o&2&&(a.selectedPattern=n[1]),o&4&&(a.selectedInstrument=n[2]),o&8&&(a.trackSettings=n[3]),t.$set(a)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function kr(s){let t,e;return t=new Gs({props:{selectedTrack:s[0],selectedPattern:s[1],selectedInstrument:s[2],trackSettings:s[3]}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p(n,o){const a={};o&1&&(a.selectedTrack=n[0]),o&2&&(a.selectedPattern=n[1]),o&4&&(a.selectedInstrument=n[2]),o&8&&(a.trackSettings=n[3]),t.$set(a)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function br(s){let t,e;return t=new Hs({props:{selectedTrack:s[0],selectedPattern:s[1],selectedInstrument:s[2],trackSettings:s[3]}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p(n,o){const a={};o&1&&(a.selectedTrack=n[0]),o&2&&(a.selectedPattern=n[1]),o&4&&(a.selectedInstrument=n[2]),o&8&&(a.trackSettings=n[3]),t.$set(a)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function Tr(s){let t,e;return t=new Ws({props:{selectedTrack:s[0],selectedPattern:s[1],selectedInstrument:s[2],trackSettings:s[3]}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p(n,o){const a={};o&1&&(a.selectedTrack=n[0]),o&2&&(a.selectedPattern=n[1]),o&4&&(a.selectedInstrument=n[2]),o&8&&(a.trackSettings=n[3]),t.$set(a)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function yr(s){let t,e,n,o="Synth Parameters",a,i,d,l,r="Reset All",c,_,m,y,p,b,T,u=s[4]&&(s[4].instrumentType==="pad"||s[4].instrumentType==="organ")&&Ht(s);const g=[Tr,br,kr,Ir,vr,_r,gr,hr,pr],f=[];function w(h,v){return v&16&&(_=null),_==null&&(_=!!(h[4]&&["kick","snare","hihat","clap","tom","cymbal","shaker","rimshot"].includes(h[4].instrumentType))),_?0:h[4]&&h[4].instrumentType==="subtractive"?1:h[4]&&h[4].instrumentType==="fm"?2:h[4]&&h[4].instrumentType==="wavetable"?3:h[4]&&h[4].instrumentType==="supersaw"?4:h[4]&&h[4].instrumentType==="pluck"?5:h[4]&&h[4].instrumentType==="bass"?6:h[4]&&h[4].instrumentType==="pad"?7:h[4]&&h[4].instrumentType==="organ"?8:-1}return~(m=w(s,-1))&&(y=f[m]=g[m](s)),{c(){t=E("div"),e=E("div"),n=E("h3"),n.textContent=o,a=U(),i=E("div"),u&&u.c(),d=U(),l=E("button"),l.textContent=r,c=U(),y&&y.c(),this.h()},l(h){t=D(h,"DIV",{class:!0});var v=j(t);e=D(v,"DIV",{class:!0});var I=j(e);n=D(I,"H3",{"data-svelte-h":!0}),le(n)!=="svelte-pxlaeq"&&(n.textContent=o),a=F(I),i=D(I,"DIV",{class:!0});var k=j(i);u&&u.l(k),d=F(k),l=D(k,"BUTTON",{class:!0,"data-svelte-h":!0}),le(l)!=="svelte-k8wg2u"&&(l.textContent=r),k.forEach(P),I.forEach(P),c=F(v),y&&y.l(v),v.forEach(P),this.h()},h(){$(l,"class","reset-btn"),$(i,"class","param-header-actions"),$(e,"class","param-header"),$(t,"class","section")},m(h,v){W(h,t,v),C(t,e),C(e,n),C(e,a),C(e,i),u&&u.m(i,null),C(i,d),C(i,l),C(t,c),~m&&f[m].m(t,null),p=!0,b||(T=ie(l,"click",s[5]),b=!0)},p(h,[v]){h[4]&&(h[4].instrumentType==="pad"||h[4].instrumentType==="organ")?u?u.p(h,v):(u=Ht(h),u.c(),u.m(i,d)):u&&(u.d(1),u=null);let I=m;m=w(h,v),m===I?~m&&f[m].p(h,v):(y&&(We(),z(f[I],1,1,()=>{f[I]=null}),Ye()),~m?(y=f[m],y?y.p(h,v):(y=f[m]=g[m](h),y.c()),L(y,1),y.m(t,null)):y=null)},i(h){p||(L(y),p=!0)},o(h){z(y),p=!1},d(h){h&&P(t),u&&u.d(),~m&&f[m].d(),b=!1,T()}}}function wr(s,t,e){let n;Se.subscribe(m=>m);let{selectedTrack:o=void 0}=t,{selectedPattern:a=void 0}=t,{selectedInstrument:i=void 0}=t,{trackSettings:d}=t,l=null;De.subscribe(m=>l=m);const r={kick:{color:"#00ffff",settings:{attack:.005,decay:.4,sustain:0,release:.15}},snare:{color:"#ff00ff",settings:{attack:.005,decay:.2,sustain:0,release:.1}},hihat:{color:"#ffff00",settings:{attack:.001,decay:.05,sustain:0,release:.01}},clap:{color:"#ff6600",settings:{attack:.01,decay:.15,sustain:0,release:.05}},tom:{color:"#00ff00",settings:{attack:.01,decay:.4,sustain:0,release:.1}},cymbal:{color:"#ff0066",settings:{attack:.01,decay:.5,sustain:0,release:.2}},shaker:{color:"#6600ff",settings:{attack:.01,decay:.3,sustain:0,release:.1}},rimshot:{color:"#ff9900",settings:{attack:.001,decay:.08,sustain:0,release:.05}},subtractive:{color:"#00ffcc",settings:{attack:.1,decay:.2,sustain:.7,release:.3,osc1Type:"saw",osc2Type:"saw",osc2Detune:0,filterCutoff:5e3,filterResonance:.5}},fm:{color:"#cc00ff",settings:{attack:.1,decay:.2,sustain:.7,release:.3,operators:[{frequency:1,amplitude:1,waveform:"sine"}]}},wavetable:{color:"#ffcc00",settings:{attack:.1,decay:.2,sustain:.7,release:.3}},supersaw:{color:"#ff3366",settings:{attack:.1,decay:.2,sustain:.7,release:.3,numOscillators:7,detune:.1,spread:.5,filterCutoff:8e3,filterResonance:.5,lfoRate:0,lfoAmount:0}},pluck:{color:"#66ff99",settings:{attack:.01,decay:.3,sustain:0,release:.4,damping:.96}},bass:{color:"#0066ff",settings:{attack:.05,decay:.2,sustain:.8,release:.3,osc1Type:"saw",subLevel:.6,saturation:.3,filterCutoff:2e3,filterResonance:.3}},pad:{color:"#9966ff",settings:{attack:.5,decay:.3,sustain:.9,release:1.5,numOscillators:8,detune:.15,spread:.7,oscType:"saw",filterCutoff:4e3,filterResonance:.3,pitchLfoRate:.5,pitchLfoAmount:.02,filterLfoRate:.3,filterLfoAmount:1e3}},organ:{color:"#ff9966",settings:{attack:.01,decay:.1,sustain:1,release:.2,drawbars:[.8,0,1,0,.6,0,.4,0,.2],rotarySpeed:4,rotaryDepth:.3,filterCutoff:8e3,filterResonance:.2}}};function c(){if(!n)return;const m=r[n.instrumentType];if(m)if(a&&i){if(Z.updatePatternInstrument(a.id,i.id,{settings:{...m.settings}}),l){const y=`__pattern_${a.id}_${i.id}`;l.updateTrackSettings(y,m.settings)}}else o&&(Z.updateTrack(o.id,{settings:{...m.settings}}),l&&l.updateTrackSettings(o.id,m.settings))}function _(){if(!n){console.warn("No active item to open plugin window");return}if(n.instrumentType!=="pad"&&n.instrumentType!=="organ"){console.warn("Plugin window only available for pad and organ instruments");return}const m=a&&i?`${a.id}:${i.id}`:(o==null?void 0:o.id)||"";if(!m){console.warn("No window ID available");return}const y=n.instrumentType==="pad"?"Pad Synth":"Organ Synth";console.log("Opening plugin window:",{windowId:m,instrumentType:n.instrumentType}),Et.openWindow({id:m,instrumentType:n.instrumentType,trackId:o==null?void 0:o.id,patternId:a==null?void 0:a.id,instrumentId:i==null?void 0:i.id,label:y})}return s.$$set=m=>{"selectedTrack"in m&&e(0,o=m.selectedTrack),"selectedPattern"in m&&e(1,a=m.selectedPattern),"selectedInstrument"in m&&e(2,i=m.selectedInstrument),"trackSettings"in m&&e(3,d=m.trackSettings)},s.$$.update=()=>{s.$$.dirty&5&&e(4,n=i||o)},[o,a,i,d,n,c,_]}class Sr extends Pe{constructor(t){super(),$e(this,t,wr,yr,Ne,{selectedTrack:0,selectedPattern:1,selectedInstrument:2,trackSettings:3})}}function Xt(s){let t,e,n,o=s[0].length+"",a,i,d,l,r,c="Pitch Editor",_,m,y="Velocity Editor",p,b,T,u=s[9]==="pitch"&&Kt(s);return{c(){t=E("div"),e=E("p"),n=be("Editing "),a=be(o),i=be(" selected nodes"),d=U(),l=E("div"),r=E("button"),r.textContent=c,_=U(),m=E("button"),m.textContent=y,p=U(),u&&u.c(),this.h()},l(g){t=D(g,"DIV",{class:!0});var f=j(t);e=D(f,"P",{class:!0});var w=j(e);n=ke(w,"Editing "),a=ke(w,o),i=ke(w," selected nodes"),w.forEach(P),d=F(f),l=D(f,"DIV",{class:!0});var h=j(l);r=D(h,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(r)!=="svelte-gleplz"&&(r.textContent=c),_=F(h),m=D(h,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(m)!=="svelte-15aj0uz"&&(m.textContent=y),h.forEach(P),p=F(f),u&&u.l(f),f.forEach(P),this.h()},h(){$(e,"class","multi-select-info"),$(r,"class","mode-btn"),$(r,"title","Pitch Editor"),Ee(r,"active",s[9]==="pitch"),$(m,"class","mode-btn"),$(m,"title","Velocity Editor"),Ee(m,"active",s[9]==="velocity"),$(l,"class","editor-mode-switch"),$(t,"class","section")},m(g,f){W(g,t,f),C(t,e),C(e,n),C(e,a),C(e,i),C(t,d),C(t,l),C(l,r),C(l,_),C(l,m),C(t,p),u&&u.m(t,null),b||(T=[ie(r,"click",s[20]),ie(m,"click",s[21])],b=!0)},p(g,f){f[0]&1&&o!==(o=g[0].length+"")&&Ue(a,o),f[0]&512&&Ee(r,"active",g[9]==="pitch"),f[0]&512&&Ee(m,"active",g[9]==="velocity"),g[9]==="pitch"?u?u.p(g,f):(u=Kt(g),u.c(),u.m(t,null)):u&&(u.d(1),u=null)},d(g){g&&P(t),u&&u.d(),b=!1,Fe(T)}}}function Kt(s){let t,e,n="Transpose:",o,a,i,d="-12",l,r,c="-1",_,m,y="+1",p,b,T="+12",u,g;return{c(){t=E("div"),e=E("span"),e.textContent=n,o=U(),a=E("div"),i=E("button"),i.textContent=d,l=U(),r=E("button"),r.textContent=c,_=U(),m=E("button"),m.textContent=y,p=U(),b=E("button"),b.textContent=T,this.h()},l(f){t=D(f,"DIV",{class:!0});var w=j(t);e=D(w,"SPAN",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-vy5ssa"&&(e.textContent=n),o=F(w),a=D(w,"DIV",{class:!0,role:!0,"aria-label":!0});var h=j(a);i=D(h,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(i)!=="svelte-1feho76"&&(i.textContent=d),l=F(h),r=D(h,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(r)!=="svelte-uzvzm2"&&(r.textContent=c),_=F(h),m=D(h,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(m)!=="svelte-zhskgi"&&(m.textContent=y),p=F(h),b=D(h,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(b)!=="svelte-ajnjs"&&(b.textContent=T),h.forEach(P),w.forEach(P),this.h()},h(){$(e,"class","transpose-label"),$(i,"class","transpose-btn"),$(i,"title","Transpose down 1 octave"),$(r,"class","transpose-btn"),$(r,"title","Transpose down 1 semitone"),$(m,"class","transpose-btn"),$(m,"title","Transpose up 1 semitone"),$(b,"class","transpose-btn"),$(b,"title","Transpose up 1 octave"),$(a,"class","transpose-buttons"),$(a,"role","group"),$(a,"aria-label","Transpose selected notes"),$(t,"class","transpose-controls")},m(f,w){W(f,t,w),C(t,e),C(t,o),C(t,a),C(a,i),C(a,l),C(a,r),C(a,_),C(a,m),C(a,p),C(a,b),u||(g=[ie(i,"click",s[22]),ie(r,"click",s[23]),ie(m,"click",s[24]),ie(b,"click",s[25])],u=!0)},p:Ve,d(f){f&&P(t),u=!1,Fe(g)}}}function Gt(s){let t,e,n,o,a=s[1]?`(all ${s[0].length} nodes)`:"",i,d,l,r="Reset",c,_,m,y,p,b,T,u,g,f,w,h,v;return f=new vt({props:{id:"pitch-number",min:0,max:127,step:1,value:s[6],placeholder:s[1]&&s[2](Zt,s[5])?"Mixed":"",title:"MIDI note number (0-127)",onInput:s[10]}}),{c(){t=E("div"),e=E("div"),n=E("label"),o=be("Pitch "),i=be(a),d=U(),l=E("button"),l.textContent=r,c=U(),_=E("div"),m=E("input"),y=U(),p=E("div"),b=E("input"),g=U(),G(f.$$.fragment),this.h()},l(I){t=D(I,"DIV",{class:!0});var k=j(t);e=D(k,"DIV",{class:!0});var S=j(e);n=D(S,"LABEL",{for:!0});var N=j(n);o=ke(N,"Pitch "),i=ke(N,a),N.forEach(P),d=F(S),l=D(S,"BUTTON",{class:!0,"data-svelte-h":!0}),le(l)!=="svelte-17uouwx"&&(l.textContent=r),S.forEach(P),c=F(k),_=D(k,"DIV",{class:!0});var M=j(_);m=D(M,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0}),y=F(M),p=D(M,"DIV",{class:!0});var q=j(p);b=D(q,"INPUT",{id:!0,type:!0,class:!0,placeholder:!0,title:!0}),g=F(q),K(f.$$.fragment,q),q.forEach(P),M.forEach(P),k.forEach(P),this.h()},h(){$(n,"for","pitch-range"),$(l,"class","reset-btn"),$(e,"class","param-header"),$(m,"id","pitch-range"),$(m,"type","range"),$(m,"min","0"),$(m,"max","127"),$(m,"step","1"),m.value=s[6],$(b,"id","pitch-note"),$(b,"type","text"),b.value=T=nt(s[6]),$(b,"class","note-input"),$(b,"placeholder",u=s[1]&&s[2](Qt,s[5])?"Mixed":nt(s[5])),$(b,"title","Enter note name (e.g., C4, D#5)"),$(p,"class","pitch-input-group"),$(_,"class","param-controls"),$(t,"class","section")},m(I,k){W(I,t,k),C(t,e),C(e,n),C(n,o),C(n,i),C(e,d),C(e,l),C(t,c),C(t,_),C(_,m),C(_,y),C(_,p),C(p,b),s[28](b),C(p,g),X(f,p,null),w=!0,h||(v=[ie(l,"click",s[26]),ie(m,"input",s[27]),ie(b,"focus",s[29]),ie(b,"blur",s[30]),ie(b,"input",s[31])],h=!0)},p(I,k){(!w||k[0]&3)&&a!==(a=I[1]?`(all ${I[0].length} nodes)`:"")&&Ue(i,a),(!w||k[0]&64)&&(m.value=I[6]),(!w||k[0]&64&&T!==(T=nt(I[6]))&&b.value!==T)&&(b.value=T),(!w||k[0]&38&&u!==(u=I[1]&&I[2](Qt,I[5])?"Mixed":nt(I[5])))&&$(b,"placeholder",u);const S={};k[0]&64&&(S.value=I[6]),k[0]&38&&(S.placeholder=I[1]&&I[2](Zt,I[5])?"Mixed":""),f.$set(S)},i(I){w||(L(f.$$.fragment,I),w=!0)},o(I){z(f.$$.fragment,I),w=!1},d(I){I&&P(t),s[28](null),H(f),h=!1,Fe(v)}}}function Jt(s){let t,e,n,o,a=s[1]?`(all ${s[0].length} nodes)`:"",i,d,l,r="Reset",c,_,m,y,p,b,T,u;return p=new vt({props:{id:"velocity-number",min:0,max:1,step:.01,value:s[8],placeholder:s[1]&&s[2](xt,1)?"Mixed":"",onInput:s[12]}}),{c(){t=E("div"),e=E("div"),n=E("label"),o=be("Velocity "),i=be(a),d=U(),l=E("button"),l.textContent=r,c=U(),_=E("div"),m=E("input"),y=U(),G(p.$$.fragment),this.h()},l(g){t=D(g,"DIV",{class:!0});var f=j(t);e=D(f,"DIV",{class:!0});var w=j(e);n=D(w,"LABEL",{for:!0});var h=j(n);o=ke(h,"Velocity "),i=ke(h,a),h.forEach(P),d=F(w),l=D(w,"BUTTON",{class:!0,"data-svelte-h":!0}),le(l)!=="svelte-bzbark"&&(l.textContent=r),w.forEach(P),c=F(f),_=D(f,"DIV",{class:!0});var v=j(_);m=D(v,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0}),y=F(v),K(p.$$.fragment,v),v.forEach(P),f.forEach(P),this.h()},h(){$(n,"for","velocity-range"),$(l,"class","reset-btn"),$(e,"class","param-header"),$(m,"id","velocity-range"),$(m,"type","range"),$(m,"min","0"),$(m,"max","1"),$(m,"step","0.01"),m.value=s[8],$(_,"class","param-controls"),$(t,"class","section")},m(g,f){W(g,t,f),C(t,e),C(e,n),C(n,o),C(n,i),C(e,d),C(e,l),C(t,c),C(t,_),C(_,m),C(_,y),X(p,_,null),b=!0,T||(u=[ie(l,"click",s[32]),ie(m,"input",s[33])],T=!0)},p(g,f){(!b||f[0]&3)&&a!==(a=g[1]?`(all ${g[0].length} nodes)`:"")&&Ue(i,a),(!b||f[0]&256)&&(m.value=g[8]);const w={};f[0]&256&&(w.value=g[8]),f[0]&6&&(w.placeholder=g[1]&&g[2](xt,1)?"Mixed":""),p.$set(w)},i(g){b||(L(p.$$.fragment,g),b=!0)},o(g){z(p.$$.fragment,g),b=!1},d(g){g&&P(t),H(p),T=!1,Fe(u)}}}function Cr(s){let t,e,n,o,a,i="Division",d,l,r,c=s[1]&&Xt(s),_=(!s[1]||s[9]==="pitch")&&Gt(s),m=(!s[1]||s[9]==="velocity")&&Jt(s);return l=new vt({props:{id:"division-input",min:1,value:s[7],placeholder:s[1]&&s[2](en,1)?"Mixed":"",onInput:s[34]}}),{c(){c&&c.c(),t=U(),_&&_.c(),e=U(),m&&m.c(),n=U(),o=E("div"),a=E("label"),a.textContent=i,d=U(),G(l.$$.fragment),this.h()},l(y){c&&c.l(y),t=F(y),_&&_.l(y),e=F(y),m&&m.l(y),n=F(y),o=D(y,"DIV",{class:!0});var p=j(o);a=D(p,"LABEL",{for:!0,"data-svelte-h":!0}),le(a)!=="svelte-1al6qdj"&&(a.textContent=i),d=F(p),K(l.$$.fragment,p),p.forEach(P),this.h()},h(){$(a,"for","division-input"),$(o,"class","section")},m(y,p){c&&c.m(y,p),W(y,t,p),_&&_.m(y,p),W(y,e,p),m&&m.m(y,p),W(y,n,p),W(y,o,p),C(o,a),C(o,d),X(l,o,null),r=!0},p(y,p){y[1]?c?c.p(y,p):(c=Xt(y),c.c(),c.m(t.parentNode,t)):c&&(c.d(1),c=null),!y[1]||y[9]==="pitch"?_?(_.p(y,p),p[0]&514&&L(_,1)):(_=Gt(y),_.c(),L(_,1),_.m(e.parentNode,e)):_&&(We(),z(_,1,1,()=>{_=null}),Ye()),!y[1]||y[9]==="velocity"?m?(m.p(y,p),p[0]&514&&L(m,1)):(m=Jt(y),m.c(),L(m,1),m.m(n.parentNode,n)):m&&(We(),z(m,1,1,()=>{m=null}),Ye());const b={};p[0]&128&&(b.value=y[7]),p[0]&6&&(b.placeholder=y[1]&&y[2](en,1)?"Mixed":""),l.$set(b)},i(y){r||(L(_),L(m),L(l.$$.fragment,y),r=!0)},o(y){z(_),z(m),z(l.$$.fragment,y),r=!1},d(y){y&&(P(t),P(e),P(n),P(o)),c&&c.d(y),_&&_.d(y),m&&m.d(y),H(l)}}}const Qt=s=>s.pitch,Zt=s=>s.pitch,xt=s=>s.velocity,en=s=>s.division;function Pr(s,t,e){let n,o,a,i,d,l;bt(s,tt,O=>e(19,l=O));let r=null;De.subscribe(O=>r=O);const c=void 0,_=void 0;let{selectedNodes:m}=t;const y=!1;let{isMultiSelect:p}=t,{getCommonValue:b}=t,{hasMixedValues:T}=t,{activeItem:u=void 0}=t,g,f=!1;function w(){for(const{pattern:O,track:de,instrumentId:x}of m)Be(r,je({patternId:(O==null?void 0:O.id)??null,trackId:(de==null?void 0:de.id)??null,instrumentId:x??null}))}function h(O){if(m.length===0||isNaN(O))return;const de=Math.max(0,Math.min(127,O));for(const{node:x,pattern:ce,track:A,instrumentId:re}of m)ce?Z.updatePatternNodePitch(ce.id,x.id,de,re):A&&Z.updateNodePitch(A.id,x.id,de);g&&!f&&e(3,g.value=nt(de),g),w()}function v(O){if(m.length!==0){for(const{node:de,pattern:x,track:ce,instrumentId:A}of m){const re=de.pitch??o,ge=Math.max(0,Math.min(127,re+O));x?Z.updatePatternNodePitch(x.id,de.id,ge,A):ce&&Z.updateNodePitch(ce.id,de.id,ge)}w()}}function I(O){if(m.length===0||isNaN(O))return;const de=Math.max(0,Math.min(1,O));for(const{node:x,pattern:ce,track:A,instrumentId:re}of m)ce?Z.updatePatternNodeVelocity(ce.id,x.id,de,re):A&&Z.updateNodeVelocity(A.id,x.id,de);w()}function k(O){if(m.length!==0){for(const{node:de,pattern:x,track:ce,instrumentId:A}of m)x?Z.updatePatternNodeDivision(x.id,de.id,O,A):ce&&Z.updateNodeDivision(ce.id,de.id,O);w()}}const S=()=>tt.setMode("pitch"),N=()=>tt.setMode("velocity"),M=()=>v(-12),q=()=>v(-1),J=()=>v(1),R=()=>v(12),Y=()=>h(o),ne=O=>h(Number(Pt(O)));function se(O){Le[O?"unshift":"push"](()=>{g=O,e(3,g),e(4,f),e(0,m),e(6,a),e(17,b),e(5,o),e(18,u)})}const V=()=>e(4,f=!0),B=()=>{e(4,f=!1),g&&e(3,g.value=nt(a),g)},oe=O=>{const de=Rs(Pt(O));de!==null&&h(de)},he=()=>I(1),_e=O=>I(Number(Pt(O))),ee=O=>{O>0&&k(O)};return s.$$set=O=>{"selectedNodes"in O&&e(0,m=O.selectedNodes),"isMultiSelect"in O&&e(1,p=O.isMultiSelect),"getCommonValue"in O&&e(17,b=O.getCommonValue),"hasMixedValues"in O&&e(2,T=O.hasMixedValues),"activeItem"in O&&e(18,u=O.activeItem)},s.$$.update=()=>{s.$$.dirty[0]&524288&&e(9,n=l),s.$$.dirty[0]&262144&&e(5,o=u&&u.instrumentType==="tom"?50:60),s.$$.dirty[0]&131105&&e(6,a=m.length>0?b(O=>O.pitch,o):o),s.$$.dirty[0]&131073&&e(8,i=m.length>0?b(O=>O.velocity,1):1),s.$$.dirty[0]&131073&&e(7,d=m.length>0?b(O=>O.division,1):1),s.$$.dirty[0]&89&&g&&!f&&m.length>0&&e(3,g.value=nt(a),g)},[m,p,T,g,f,o,a,d,i,n,h,v,I,k,c,_,y,b,u,l,S,N,M,q,J,R,Y,ne,se,V,B,oe,he,_e,ee]}class $r extends Pe{constructor(t){super(),$e(this,t,Pr,Cr,Ne,{selectedTrack:14,selectedPattern:15,selectedNodes:0,isMelodicInstrument:16,isMultiSelect:1,getCommonValue:17,hasMixedValues:2,activeItem:18},null,[-1,-1])}get selectedTrack(){return this.$$.ctx[14]}get selectedPattern(){return this.$$.ctx[15]}get isMelodicInstrument(){return this.$$.ctx[16]}}function Nr(s){let t,e,n,o="Note Settings",a,i,d="Close",l,r,c,_,m,y;return c=new $r({props:{selectedTrack:s[3],selectedPattern:s[4],selectedNodes:s[1],isMelodicInstrument:s[8],isMultiSelect:s[6],getCommonValue:s[10],hasMixedValues:s[11],activeItem:s[5]}}),{c(){t=E("div"),e=E("div"),n=E("h2"),n.textContent=o,a=U(),i=E("button"),i.textContent=d,l=U(),r=E("div"),G(c.$$.fragment),this.h()},l(p){t=D(p,"DIV",{class:!0});var b=j(t);e=D(b,"DIV",{class:!0});var T=j(e);n=D(T,"H2",{"data-svelte-h":!0}),le(n)!=="svelte-14kktj1"&&(n.textContent=o),a=F(T),i=D(T,"BUTTON",{class:!0,"data-svelte-h":!0}),le(i)!=="svelte-nt99sh"&&(i.textContent=d),T.forEach(P),l=F(b),r=D(b,"DIV",{class:!0});var u=j(r);K(c.$$.fragment,u),u.forEach(P),b.forEach(P),this.h()},h(){$(i,"class","close-btn"),$(e,"class","sidebar-header"),$(r,"class","sidebar-content"),$(t,"class","sidebar")},m(p,b){W(p,t,b),C(t,e),C(e,n),C(e,a),C(e,i),C(t,l),C(t,r),X(c,r,null),_=!0,m||(y=ie(i,"click",s[15]),m=!0)},p(p,b){const T={};b&8&&(T.selectedTrack=p[3]),b&16&&(T.selectedPattern=p[4]),b&2&&(T.selectedNodes=p[1]),b&256&&(T.isMelodicInstrument=p[8]),b&64&&(T.isMultiSelect=p[6]),b&32&&(T.activeItem=p[5]),c.$set(T)},i(p){_||(L(c.$$.fragment,p),_=!0)},o(p){z(c.$$.fragment,p),_=!1},d(p){p&&P(t),H(c),m=!1,y()}}}function Mr(s){let t,e,n,o=s[4]?"Pattern Settings":"Instrument Settings",a,i,d,l="Close",r,c,_,m,y,p,b,T,u,g;return _=new As({props:{selectedTrack:s[3],selectedPattern:s[4],isRootNode:s[9],selectedInstrumentId:s[0].selectedInstrumentId,selectedInstrument:s[2]}}),y=new zs({props:{selectedTrack:s[3],selectedInstrument:s[2]}}),b=new Sr({props:{selectedTrack:s[3],selectedPattern:s[4],selectedInstrument:s[2],trackSettings:s[7]}}),{c(){t=E("div"),e=E("div"),n=E("h2"),a=be(o),i=U(),d=E("button"),d.textContent=l,r=U(),c=E("div"),G(_.$$.fragment),m=U(),G(y.$$.fragment),p=U(),G(b.$$.fragment),this.h()},l(f){t=D(f,"DIV",{class:!0});var w=j(t);e=D(w,"DIV",{class:!0});var h=j(e);n=D(h,"H2",{});var v=j(n);a=ke(v,o),v.forEach(P),i=F(h),d=D(h,"BUTTON",{class:!0,"data-svelte-h":!0}),le(d)!=="svelte-nt99sh"&&(d.textContent=l),h.forEach(P),r=F(w),c=D(w,"DIV",{class:!0});var I=j(c);K(_.$$.fragment,I),m=F(I),K(y.$$.fragment,I),p=F(I),K(b.$$.fragment,I),I.forEach(P),w.forEach(P),this.h()},h(){$(d,"class","close-btn"),$(e,"class","sidebar-header"),$(c,"class","sidebar-content"),$(t,"class","sidebar")},m(f,w){W(f,t,w),C(t,e),C(e,n),C(n,a),C(e,i),C(e,d),C(t,r),C(t,c),X(_,c,null),C(c,m),X(y,c,null),C(c,p),X(b,c,null),T=!0,u||(g=ie(d,"click",s[14]),u=!0)},p(f,w){(!T||w&16)&&o!==(o=f[4]?"Pattern Settings":"Instrument Settings")&&Ue(a,o);const h={};w&8&&(h.selectedTrack=f[3]),w&16&&(h.selectedPattern=f[4]),w&512&&(h.isRootNode=f[9]),w&1&&(h.selectedInstrumentId=f[0].selectedInstrumentId),w&4&&(h.selectedInstrument=f[2]),_.$set(h);const v={};w&8&&(v.selectedTrack=f[3]),w&4&&(v.selectedInstrument=f[2]),y.$set(v);const I={};w&8&&(I.selectedTrack=f[3]),w&16&&(I.selectedPattern=f[4]),w&4&&(I.selectedInstrument=f[2]),w&128&&(I.trackSettings=f[7]),b.$set(I)},i(f){T||(L(_.$$.fragment,f),L(y.$$.fragment,f),L(b.$$.fragment,f),T=!0)},o(f){z(_.$$.fragment,f),z(y.$$.fragment,f),z(b.$$.fragment,f),T=!1},d(f){f&&P(t),H(_),H(y),H(b),u=!1,g()}}}function Dr(s){let t,e,n,o;const a=[Mr,Nr],i=[];function d(l,r){return l[5]&&l[9]?0:l[5]&&l[1].length>0&&!l[9]?1:-1}return~(t=d(s))&&(e=i[t]=a[t](s)),{c(){e&&e.c(),n=Oe()},l(l){e&&e.l(l),n=Oe()},m(l,r){~t&&i[t].m(l,r),W(l,n,r),o=!0},p(l,[r]){let c=t;t=d(l),t===c?~t&&i[t].p(l,r):(e&&(We(),z(i[c],1,1,()=>{i[c]=null}),Ye()),~t?(e=i[t],e?e.p(l,r):(e=i[t]=a[t](l),e.c()),L(e,1),e.m(n.parentNode,n)):e=null)},i(l){o||(L(e),o=!0)},o(l){z(e),o=!1},d(l){l&&P(n),~t&&i[t].d(l)}}}function Er(s,t,e){let n,o,a,i,d,l,r,c,_,m,y,p;Z.subscribe(w=>e(12,y=w)),Se.subscribe(w=>e(0,p=w)),De.subscribe(w=>w);const b=["bass","subtractive","fm","wavetable","supersaw","pluck","pad","organ"];function T(w,h){if(_.length===0)return h;if(_.length===1){const S=w(_[0].node);return S!==void 0?S:h}const v=w(_[0].node),I=v!==void 0?v:h;return _.every(({node:S})=>{const N=w(S);return(N!==void 0?N:h)===I})?I:h}function u(w,h){if(_.length<=1)return!1;const v=w(_[0].node),I=v!==void 0?v:h;return!_.every(({node:k})=>{const S=w(k);return(S!==void 0?S:h)===I})}const g=()=>Se.clearSelection(),f=()=>Se.clearSelection();return s.$$.update=()=>{s.$$.dirty&4097&&e(3,n=p.selectedTrackId&&(y==null?void 0:y.standaloneInstruments.find(w=>w.id===p.selectedTrackId))),s.$$.dirty&4097&&e(4,o=p.selectedPatternId&&(y==null?void 0:y.patterns.find(w=>w.id===p.selectedPatternId))),s.$$.dirty&17&&e(2,a=(()=>{if(!o||!p.selectedInstrumentId)return null;const w=o.instruments&&Array.isArray(o.instruments)&&o.instruments.length>0?o.instruments:o.instrumentType&&o.patternTree?[{id:o.id,instrumentType:o.instrumentType,patternTree:o.patternTree,settings:o.settings||{},instrumentSettings:o.instrumentSettings,color:o.color||"#7ab8ff",volume:o.volume??1,pan:o.pan??0,mute:o.mute,solo:o.solo}]:[];return w.find(h=>h.id===p.selectedInstrumentId)||w[0]||null})()),s.$$.dirty&12&&e(13,i=(a==null?void 0:a.patternTree)||(n==null?void 0:n.patternTree)),s.$$.dirty&8193&&i&&p.selectedNodeId&&Rt(i,p.selectedNodeId),s.$$.dirty&1&&e(9,d=p.isRoot||!1),s.$$.dirty&12&&e(5,l=a||n),s.$$.dirty&32&&e(8,r=l?b.includes(l.instrumentType):!1),s.$$.dirty&12&&((n==null?void 0:n.volume)??(a==null||a.volume)),s.$$.dirty&12&&((n==null?void 0:n.pan)??(a==null||a.pan)),s.$$.dirty&32&&e(7,c=(l==null?void 0:l.settings)??{}),s.$$.dirty&12317&&e(1,_=(()=>{if(!y||!p.selectedTrackId&&!p.selectedPatternId)return[];const w=i;if(!w)return[];const h=p.selectedNodes.size>0?Array.from(p.selectedNodes):p.selectedNodeId?[p.selectedNodeId]:[];return h.length===0?[]:h.map(v=>{const I=Rt(w,v);return I?{node:I,pattern:o,track:n,instrument:a,instrumentId:p.selectedInstrumentId}:null}).filter(v=>v!==null)})()),s.$$.dirty&2&&e(6,m=_.length>1),s.$$.dirty&2&&_.length>0&&T(w=>w.pitch,60),s.$$.dirty&2&&_.length>0&&T(w=>w.velocity,1),s.$$.dirty&2&&_.length>0&&T(w=>w.division,1)},[p,_,a,n,o,l,m,c,r,d,T,u,y,i,g,f]}class Vr extends Pe{constructor(t){super(),$e(this,t,Er,Dr,Ne,{})}}function tn(s,t,e){const n=s.slice();n[48]=t[e].node,n[49]=t[e].nodeId,n[52]=e;const o=n[48].velocity??1;return n[59]=o,n}function nn(s,t,e){const n=s.slice();n[61]=t[e];const o=Math.abs(n[61].velocity-n[59])<1/ht/2;return n[54]=o,n}function sn(s,t,e){const n=s.slice();return n[61]=t[e],n}function rn(s,t,e){const n=s.slice();n[48]=t[e].node,n[49]=t[e].nodeId,n[52]=e;const o=n[48].pitch??60;return n[50]=o,n}function an(s,t,e){const n=s.slice();n[53]=t[e];const o=n[53].pitch===n[50];return n[54]=o,n}function ln(s,t,e){const n=s.slice();return n[53]=t[e],n}function on(s){let t,e,n,o="Pitch",a,i,d="Velocity",l,r,c,_;function m(b,T){if(b[6])return Fr;if(b[9])return Rr}let y=m(s),p=y&&y(s);return{c(){t=E("div"),e=E("div"),n=E("button"),n.textContent=o,a=U(),i=E("button"),i.textContent=d,l=U(),r=E("div"),p&&p.c(),this.h()},l(b){t=D(b,"DIV",{class:!0});var T=j(t);e=D(T,"DIV",{class:!0});var u=j(e);n=D(u,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(n)!=="svelte-1194ees"&&(n.textContent=o),a=F(u),i=D(u,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(i)!=="svelte-m7vjnc"&&(i.textContent=d),u.forEach(P),l=F(T),r=D(T,"DIV",{class:!0});var g=j(r);p&&p.l(g),g.forEach(P),T.forEach(P),this.h()},h(){$(n,"class","mode-btn"),$(n,"title","Pitch Editor"),Ee(n,"active",s[10]==="pitch"),$(i,"class","mode-btn"),$(i,"title","Velocity Editor"),Ee(i,"active",s[10]==="velocity"),$(e,"class","editor-mode-toggle"),$(r,"class","piano-roll-container"),$(t,"class","midi-editor")},m(b,T){W(b,t,T),C(t,e),C(e,n),C(e,a),C(e,i),C(t,l),C(t,r),p&&p.m(r,null),s[37](t),c||(_=[ie(n,"click",s[25]),ie(i,"click",s[26])],c=!0)},p(b,T){T[0]&1024&&Ee(n,"active",b[10]==="pitch"),T[0]&1024&&Ee(i,"active",b[10]==="velocity"),y===(y=m(b))&&p?p.p(b,T):(p&&p.d(1),p=y&&y(b),p&&(p.c(),p.m(r,null)))},d(b){b&&P(t),p&&p.d(),s[37](null),c=!1,Fe(_)}}}function Rr(s){let t,e,n=[],o=new Map,a,i,d,l,r=[],c=new Map,_,m,y=Ie(s[7]);const p=u=>u[61].velocity;for(let u=0;u<y.length;u+=1){let g=sn(s,y,u),f=p(g);o.set(f,n[u]=cn(f,g))}let b=Ie(s[4]);const T=u=>u[49];for(let u=0;u<b.length;u+=1){let g=tn(s,b,u),f=T(g);c.set(f,r[u]=fn(f,g))}return{c(){t=E("div"),e=E("div");for(let u=0;u<n.length;u+=1)n[u].c();a=U(),i=E("div"),d=E("div"),l=E("div");for(let u=0;u<r.length;u+=1)r[u].c();this.h()},l(u){t=D(u,"DIV",{class:!0});var g=j(t);e=D(g,"DIV",{class:!0,style:!0});var f=j(e);for(let I=0;I<n.length;I+=1)n[I].l(f);f.forEach(P),g.forEach(P),a=F(u),i=D(u,"DIV",{class:!0});var w=j(i);d=D(w,"DIV",{class:!0});var h=j(d);l=D(h,"DIV",{class:!0,style:!0});var v=j(l);for(let I=0;I<r.length;I+=1)r[I].l(v);v.forEach(P),h.forEach(P),w.forEach(P),this.h()},h(){$(e,"class","piano-keys-content"),me(e,"height",s[14]+"px"),$(t,"class","piano-keys"),$(l,"class","grid-content"),me(l,"height",s[14]+"px"),$(d,"class","grid-container"),$(i,"class","grid-area")},m(u,g){W(u,t,g),C(t,e);for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(e,null);s[32](t),W(u,a,g),W(u,i,g),C(i,d),C(d,l);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(l,null);s[35](d),s[36](i),_||(m=[ie(t,"scroll",s[16]),ie(d,"scroll",s[16])],_=!0)},p(u,g){g[0]&128&&(y=Ie(u[7]),n=Ge(n,g,p,1,u,y,o,e,Je,cn,null,sn)),g[0]&16384&&me(e,"height",u[14]+"px"),g[0]&274576&&(b=Ie(u[4]),r=Ge(r,g,T,1,u,b,c,l,Je,fn,null,tn)),g[0]&16384&&me(l,"height",u[14]+"px")},d(u){u&&(P(t),P(a),P(i));for(let g=0;g<n.length;g+=1)n[g].d();s[32](null);for(let g=0;g<r.length;g+=1)r[g].d();s[35](null),s[36](null),_=!1,Fe(m)}}}function Fr(s){let t,e,n=[],o=new Map,a,i,d,l,r=[],c=new Map,_,m,y=Ie(s[8]);const p=u=>u[53].pitch;for(let u=0;u<y.length;u+=1){let g=ln(s,y,u),f=p(g);o.set(f,n[u]=mn(f,g))}let b=Ie(s[5]);const T=u=>u[49];for(let u=0;u<b.length;u+=1){let g=rn(s,b,u),f=T(g);c.set(f,r[u]=gn(f,g))}return{c(){t=E("div"),e=E("div");for(let u=0;u<n.length;u+=1)n[u].c();a=U(),i=E("div"),d=E("div"),l=E("div");for(let u=0;u<r.length;u+=1)r[u].c();this.h()},l(u){t=D(u,"DIV",{class:!0});var g=j(t);e=D(g,"DIV",{class:!0,style:!0});var f=j(e);for(let I=0;I<n.length;I+=1)n[I].l(f);f.forEach(P),g.forEach(P),a=F(u),i=D(u,"DIV",{class:!0});var w=j(i);d=D(w,"DIV",{class:!0});var h=j(d);l=D(h,"DIV",{class:!0,style:!0});var v=j(l);for(let I=0;I<r.length;I+=1)r[I].l(v);v.forEach(P),h.forEach(P),w.forEach(P),this.h()},h(){$(e,"class","piano-keys-content"),me(e,"height",s[15]+"px"),$(t,"class","piano-keys"),$(l,"class","grid-content"),me(l,"height",s[15]+"px"),$(d,"class","grid-container"),$(i,"class","grid-area")},m(u,g){W(u,t,g),C(t,e);for(let f=0;f<n.length;f+=1)n[f]&&n[f].m(e,null);s[27](t),W(u,a,g),W(u,i,g),C(i,d),C(d,l);for(let f=0;f<r.length;f+=1)r[f]&&r[f].m(l,null);s[30](d),s[31](i),_||(m=[ie(t,"scroll",s[16]),ie(d,"scroll",s[16])],_=!0)},p(u,g){g[0]&256&&(y=Ie(u[8]),n=Ge(n,g,p,1,u,y,o,e,Je,mn,null,ln)),g[0]&32768&&me(e,"height",u[15]+"px"),g[0]&143648&&(b=Ie(u[5]),r=Ge(r,g,T,1,u,b,c,l,Je,gn,null,rn)),g[0]&32768&&me(l,"height",u[15]+"px")},d(u){u&&(P(t),P(a),P(i));for(let g=0;g<n.length;g+=1)n[g].d();s[27](null);for(let g=0;g<r.length;g+=1)r[g].d();s[30](null),s[31](null),_=!1,Fe(m)}}}function cn(s,t){let e,n,o=t[61].value+"",a,i,d;return{key:s,first:null,c(){e=E("div"),n=E("span"),a=be(o),i=be("%"),d=U(),this.h()},l(l){e=D(l,"DIV",{class:!0,style:!0});var r=j(e);n=D(r,"SPAN",{class:!0});var c=j(n);a=ke(c,o),i=ke(c,"%"),c.forEach(P),d=F(r),r.forEach(P),this.h()},h(){$(n,"class","key-label"),$(e,"class","piano-key white"),me(e,"height",st+"px"),this.first=e},m(l,r){W(l,e,r),C(e,n),C(n,a),C(n,i),C(e,d)},p(l,r){t=l,r[0]&128&&o!==(o=t[61].value+"")&&Ue(a,o)},d(l){l&&P(e)}}}function un(s){let t,e,n=Math.round(s[59]*100)+"",o,a;return{c(){t=E("div"),e=E("span"),o=be(n),a=be("%"),this.h()},l(i){t=D(i,"DIV",{class:!0,style:!0});var d=j(t);e=D(d,"SPAN",{class:!0});var l=j(e);o=ke(l,n),a=ke(l,"%"),l.forEach(P),d.forEach(P),this.h()},h(){var i;$(e,"class","note-label"),$(t,"class","note-block"),me(t,"background-color",((i=s[13])==null?void 0:i.color)||"#7ab8ff")},m(i,d){W(i,t,d),C(t,e),C(e,o),C(e,a)},p(i,d){var l;d[0]&16&&n!==(n=Math.round(i[59]*100)+"")&&Ue(o,n),d[0]&8192&&me(t,"background-color",((l=i[13])==null?void 0:l.color)||"#7ab8ff")},d(i){i&&P(t)}}}function dn(s,t){let e,n,o,a,i=t[54]&&un(t);function d(...r){return t[33](t[52],t[61],...r)}function l(...r){return t[34](t[52],t[61],...r)}return{key:s,first:null,c(){e=E("div"),i&&i.c(),this.h()},l(r){e=D(r,"DIV",{class:!0,style:!0,role:!0,tabindex:!0});var c=j(e);i&&i.l(c),c.forEach(P),this.h()},h(){$(e,"class",n="grid-cell white "+(t[54]?"active":"")),me(e,"height",st+"px"),$(e,"role","gridcell"),$(e,"tabindex","0"),this.first=e},m(r,c){W(r,e,c),i&&i.m(e,null),o||(a=[ie(e,"click",d),ie(e,"mousedown",Lr),ie(e,"keydown",l)],o=!0)},p(r,c){t=r,t[54]?i?i.p(t,c):(i=un(t),i.c(),i.m(e,null)):i&&(i.d(1),i=null),c[0]&144&&n!==(n="grid-cell white "+(t[54]?"active":""))&&$(e,"class",n)},d(r){r&&P(e),i&&i.d(),o=!1,Fe(a)}}}function fn(s,t){let e,n=[],o=new Map,a,i=Ie(t[7]);const d=l=>l[61].velocity;for(let l=0;l<i.length;l+=1){let r=nn(t,i,l),c=d(r);o.set(c,n[l]=dn(c,r))}return{key:s,first:null,c(){e=E("div");for(let l=0;l<n.length;l+=1)n[l].c();a=U(),this.h()},l(l){e=D(l,"DIV",{class:!0,style:!0});var r=j(e);for(let c=0;c<n.length;c+=1)n[c].l(r);a=F(r),r.forEach(P),this.h()},h(){$(e,"class","grid-column"),me(e,"width",t[12]+"px"),this.first=e},m(l,r){W(l,e,r);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null);C(e,a)},p(l,r){t=l,r[0]&270480&&(i=Ie(t[7]),n=Ge(n,r,d,1,t,i,o,e,Je,dn,a,nn)),r[0]&4096&&me(e,"width",t[12]+"px")},d(l){l&&P(e);for(let r=0;r<n.length;r+=1)n[r].d()}}}function mn(s,t){let e,n,o=t[53].noteName+"",a,i,d;return{key:s,first:null,c(){e=E("div"),n=E("span"),a=be(o),i=U(),this.h()},l(l){e=D(l,"DIV",{class:!0,style:!0});var r=j(e);n=D(r,"SPAN",{class:!0});var c=j(n);a=ke(c,o),c.forEach(P),i=F(r),r.forEach(P),this.h()},h(){$(n,"class","key-label"),$(e,"class",d="piano-key "+(t[53].isBlack?"black":"white")),me(e,"height",st+"px"),this.first=e},m(l,r){W(l,e,r),C(e,n),C(n,a),C(e,i)},p(l,r){t=l,r[0]&256&&o!==(o=t[53].noteName+"")&&Ue(a,o),r[0]&256&&d!==(d="piano-key "+(t[53].isBlack?"black":"white"))&&$(e,"class",d)},d(l){l&&P(e)}}}function pn(s){let t,e,n=s[53].noteName+"",o;return{c(){t=E("div"),e=E("span"),o=be(n),this.h()},l(a){t=D(a,"DIV",{class:!0,style:!0});var i=j(t);e=D(i,"SPAN",{class:!0});var d=j(e);o=ke(d,n),d.forEach(P),i.forEach(P),this.h()},h(){var a;$(e,"class","note-label"),$(t,"class","note-block"),me(t,"background-color",((a=s[13])==null?void 0:a.color)||"#7ab8ff")},m(a,i){W(a,t,i),C(t,e),C(e,o)},p(a,i){var d;i[0]&256&&n!==(n=a[53].noteName+"")&&Ue(o,n),i[0]&8192&&me(t,"background-color",((d=a[13])==null?void 0:d.color)||"#7ab8ff")},d(a){a&&P(t)}}}function hn(s,t){let e,n,o,a,i=t[54]&&pn(t);function d(...r){return t[28](t[52],t[53],...r)}function l(...r){return t[29](t[52],t[53],...r)}return{key:s,first:null,c(){e=E("div"),i&&i.c(),this.h()},l(r){e=D(r,"DIV",{class:!0,style:!0,role:!0,tabindex:!0});var c=j(e);i&&i.l(c),c.forEach(P),this.h()},h(){$(e,"class",n="grid-cell "+(t[53].isBlack?"black":"white")+" "+(t[54]?"active":"")),me(e,"height",st+"px"),$(e,"role","gridcell"),$(e,"tabindex","0"),this.first=e},m(r,c){W(r,e,c),i&&i.m(e,null),o||(a=[ie(e,"click",d),ie(e,"mousedown",Ar),ie(e,"keydown",l)],o=!0)},p(r,c){t=r,t[54]?i?i.p(t,c):(i=pn(t),i.c(),i.m(e,null)):i&&(i.d(1),i=null),c[0]&288&&n!==(n="grid-cell "+(t[53].isBlack?"black":"white")+" "+(t[54]?"active":""))&&$(e,"class",n)},d(r){r&&P(e),i&&i.d(),o=!1,Fe(a)}}}function gn(s,t){let e,n=[],o=new Map,a,i=Ie(t[8]);const d=l=>l[53].pitch;for(let l=0;l<i.length;l+=1){let r=an(t,i,l),c=d(r);o.set(c,n[l]=hn(c,r))}return{key:s,first:null,c(){e=E("div");for(let l=0;l<n.length;l+=1)n[l].c();a=U(),this.h()},l(l){e=D(l,"DIV",{class:!0,style:!0});var r=j(e);for(let c=0;c<n.length;c+=1)n[c].l(r);a=F(r),r.forEach(P),this.h()},h(){$(e,"class","grid-column"),me(e,"width",t[12]+"px"),this.first=e},m(l,r){W(l,e,r);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null);C(e,a)},p(l,r){t=l,r[0]&139552&&(i=Ie(t[8]),n=Ge(n,r,d,1,t,i,o,e,Je,hn,a,an)),r[0]&4096&&me(e,"width",t[12]+"px")},d(l){l&&P(e);for(let r=0;r<n.length;r+=1)n[r].d()}}}function Ur(s){let t,e=s[3]&&s[4].length>0&&on(s);return{c(){e&&e.c(),t=Oe()},l(n){e&&e.l(n),t=Oe()},m(n,o){e&&e.m(n,o),W(n,t,o)},p(n,o){n[3]&&n[4].length>0?e?e.p(n,o):(e=on(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:Ve,o:Ve,d(n){n&&P(t),e&&e.d(n)}}}const st=20,ht=50,Ar=s=>s.preventDefault(),Lr=s=>s.preventDefault();function Or(s,t,e){let n,o,a,i,d,l,r,c,_,m,y,p,b;bt(s,tt,Q=>e(24,b=Q));let T,u,g=null;De.subscribe(Q=>g=Q);let f,w,h,v,I=60,k=!1,S=!1;Z.subscribe(Q=>e(19,T=Q)),Se.subscribe(Q=>e(20,u=Q));const N=["bass","subtractive","fm","wavetable","supersaw","pluck","pad","organ"],M=["kick","snare","hihat","clap","tom","cymbal","shaker","rimshot"],q=[...N,...M],J={min:12,max:108};function R(Q){const ue=Q.target;ue===h&&v?e(2,v.scrollTop=ue.scrollTop,v):ue===v&&h&&e(1,h.scrollTop=ue.scrollTop,h)}function Y(Q,ue,ae){if(Q>=l.length)return;const{nodeId:pe}=l[Q];se(pe,ue)}function ne(Q,ue,ae){if(Q>=d.length)return;const{nodeId:pe}=d[Q];V(pe,ue)}function se(Q,ue){if(!T)return;const ae=Math.max(0,Math.min(127,ue));u.selectedTrackId?(Z.updateNodePitch(u.selectedTrackId,Q,ae),Be(g,je({trackId:u.selectedTrackId,selection:u}))):u.selectedPatternId&&u.selectedInstrumentId&&(Z.updatePatternNodePitch(u.selectedPatternId,Q,ae,u.selectedInstrumentId),Be(g,je({patternId:u.selectedPatternId,instrumentId:u.selectedInstrumentId,selection:u})))}function V(Q,ue){if(!T)return;const ae=Math.max(0,Math.min(1,ue));u.selectedTrackId?(Z.updateNodeVelocity(u.selectedTrackId,Q,ae),Be(g,je({trackId:u.selectedTrackId,selection:u}))):u.selectedPatternId&&u.selectedInstrumentId&&(Z.updatePatternNodeVelocity(u.selectedPatternId,Q,ae,u.selectedInstrumentId),Be(g,je({patternId:u.selectedPatternId,instrumentId:u.selectedInstrumentId,selection:u})))}function B(){w&&y.length>0?e(12,I=Math.max(40,w.clientWidth/y.length)):e(12,I=60)}It(()=>{const Q=new ResizeObserver(()=>{B()}),ue=()=>{w&&Q.observe(w)};return ue(),setTimeout(ue,100),window.addEventListener("resize",B),()=>{Q.disconnect(),window.removeEventListener("resize",B)}});const oe=()=>tt.setMode("pitch"),he=()=>tt.setMode("velocity");function _e(Q){Le[Q?"unshift":"push"](()=>{h=Q,e(1,h),e(6,a),e(22,S),e(21,k),e(5,l),e(2,v),e(3,o),e(9,i),e(4,d),e(10,n),e(19,T),e(20,u),e(24,b)})}const ee=(Q,ue,ae)=>Y(Q,ue.pitch),O=(Q,ue,ae)=>{(ae.key==="Enter"||ae.key===" ")&&(ae.preventDefault(),Y(Q,ue.pitch))};function de(Q){Le[Q?"unshift":"push"](()=>{v=Q,e(2,v),e(6,a),e(22,S),e(21,k),e(5,l),e(1,h),e(3,o),e(9,i),e(4,d),e(10,n),e(19,T),e(20,u),e(24,b)})}function x(Q){Le[Q?"unshift":"push"](()=>{w=Q,e(0,w)})}function ce(Q){Le[Q?"unshift":"push"](()=>{h=Q,e(1,h),e(6,a),e(22,S),e(21,k),e(5,l),e(2,v),e(3,o),e(9,i),e(4,d),e(10,n),e(19,T),e(20,u),e(24,b)})}const A=(Q,ue,ae)=>ne(Q,ue.velocity),re=(Q,ue,ae)=>{(ae.key==="Enter"||ae.key===" ")&&(ae.preventDefault(),ne(Q,ue.velocity))};function ge(Q){Le[Q?"unshift":"push"](()=>{v=Q,e(2,v),e(6,a),e(22,S),e(21,k),e(5,l),e(1,h),e(3,o),e(9,i),e(4,d),e(10,n),e(19,T),e(20,u),e(24,b)})}function Me(Q){Le[Q?"unshift":"push"](()=>{w=Q,e(0,w)})}function we(Q){Le[Q?"unshift":"push"](()=>{f=Q,e(11,f)})}return s.$$.update=()=>{s.$$.dirty[0]&16777216&&e(10,n=b),s.$$.dirty[0]&1572864&&e(4,d=(()=>{var Te,Ae;if(!T||!u)return[];if(u.selectedNodes.size<2)return[];let Q=null;if(u.selectedTrackId&&(Q=(Te=T.standaloneInstruments)==null?void 0:Te.find(ve=>ve.id===u.selectedTrackId)),!Q&&u.selectedPatternId&&u.selectedInstrumentId){const ve=(Ae=T.patterns)==null?void 0:Ae.find(ze=>ze.id===u.selectedPatternId);if(ve){const ze=ve.instruments&&Array.isArray(ve.instruments)&&ve.instruments.length>0?ve.instruments:ve.instrumentType&&ve.patternTree?[{id:ve.id,instrumentType:ve.instrumentType,patternTree:ve.patternTree,settings:ve.settings||{},instrumentSettings:ve.instrumentSettings,color:ve.color||"#7ab8ff",volume:ve.volume??1,pan:ve.pan??0,mute:ve.mute,solo:ve.solo}]:[];Q=ze.find(Re=>Re.id===u.selectedInstrumentId)||ze[0]||null}}if(!Q||!Q.patternTree)return[];if(!q.includes(Q.instrumentType))return[];const ue=[];let ae=0;const pe=ve=>{u.selectedNodes.has(ve.id)&&(!ve.children||ve.children.length===0)&&ue.push({node:ve,nodeId:ve.id,index:ae++});for(const ze of ve.children)pe(ze)};return pe(Q.patternTree),ue})()),s.$$.dirty[0]&16&&e(3,o=d.length>=2),s.$$.dirty[0]&16&&e(5,l=d.filter(({node:Q})=>(Q.velocity??1)>0)),s.$$.dirty[0]&4194360&&o&&!S&&d.length>0&&(l.length>0?tt.setMode("pitch"):tt.setMode("velocity"),e(22,S=!0)),s.$$.dirty[0]&1064&&e(6,a=o&&n==="pitch"&&l.length>0),s.$$.dirty[0]&1032&&e(9,i=o&&n==="velocity"),s.$$.dirty[0]&8&&typeof document<"u"&&(o?document.body.classList.add("midi-editor-visible"):document.body.classList.remove("midi-editor-visible")),s.$$.dirty[0]&6291566&&(a&&S&&!k&&l.length>0?(e(21,k=!1),setTimeout(()=>{if(v&&h&&l.length>0){const Q=l.map(({node:Te})=>Te.pitch??60),ue=Math.round((Math.min(...Q)+Math.max(...Q))/2),ae=J.max-ue,pe=Math.max(0,ae*st-v.clientHeight/2);e(1,h.scrollTop=pe,h),e(2,v.scrollTop=pe,v),e(21,k=!0)}},150)):!o&&S&&(e(22,S=!1),e(21,k=!1))),s.$$.dirty[0]&4194838&&i&&!S&&d.length>0&&setTimeout(()=>{if(v&&h&&d.length>0){const Q=d.map(({node:Ae})=>Ae.velocity??1),ue=Math.max(...Q),ae=(Math.min(...Q)+ue)/2,pe=Math.round(ae*ht);let Te;ue>=.95?Te=0:Te=Math.max(0,(ht-pe)*st-v.clientHeight/2),e(1,h.scrollTop=Te,h),e(2,v.scrollTop=Te,v)}},150),s.$$.dirty[0]&256&&e(15,c=r.length*st),s.$$.dirty[0]&128&&e(14,m=_.length*st),s.$$.dirty[0]&112&&e(23,y=a?l:d),s.$$.dirty[0]&8388609&&w&&y.length>0&&B(),s.$$.dirty[0]&1572872&&e(13,p=(()=>{var Q,ue;if(!o||!T)return null;if(u.selectedTrackId)return((Q=T.standaloneInstruments)==null?void 0:Q.find(ae=>ae.id===u.selectedTrackId))||null;if(u.selectedPatternId&&u.selectedInstrumentId){const ae=(ue=T.patterns)==null?void 0:ue.find(pe=>pe.id===u.selectedPatternId);if(ae){const pe=ae.instruments&&Array.isArray(ae.instruments)&&ae.instruments.length>0?ae.instruments:ae.instrumentType&&ae.patternTree?[{id:ae.id,instrumentType:ae.instrumentType,patternTree:ae.patternTree,settings:ae.settings||{},instrumentSettings:ae.instrumentSettings,color:ae.color||"#7ab8ff",volume:ae.volume??1,pan:ae.pan??0,mute:ae.mute,solo:ae.solo}]:[];return pe.find(Te=>Te.id===u.selectedInstrumentId)||pe[0]||null}}return null})())},e(8,r=(()=>{const Q=[];for(let ue=J.max;ue>=J.min;ue--){const ae=nt(ue),pe=ae.includes("#");Q.push({pitch:ue,noteName:ae,isBlack:pe})}return Q})()),e(7,_=(()=>{const Q=[];for(let ue=ht;ue>=0;ue--){const ae=ue/ht;Q.push({velocity:ae,value:Math.round(ae*100)})}return Q})()),[w,h,v,o,d,l,a,_,r,i,n,f,I,p,m,c,R,Y,ne,T,u,k,S,y,b,oe,he,_e,ee,O,de,x,ce,A,re,ge,Me,we]}class zr extends Pe{constructor(t){super(),$e(this,t,Or,Ur,Ne,{},null,[-1,-1,-1])}}function _n(s,t,e){const n=s.slice();n[26]=t[e].node,n[27]=t[e].nodeId,n[30]=e;const o=n[26].velocity??1;return n[28]=o,n}function vn(s,t,e){const n=s.slice();n[31]=t[e];const o=Math.abs(n[31].velocity-n[28])<1/gt/2;return n[32]=o,n}function In(s,t,e){const n=s.slice();return n[31]=t[e],n}function kn(s){let t,e,n,o,a=[],i=new Map,d,l,r,c,_=[],m=new Map,y,p,b=Ie(s[5]);const T=f=>f[31].velocity;for(let f=0;f<b.length;f+=1){let w=In(s,b,f),h=T(w);i.set(h,a[f]=bn(h,w))}let u=Ie(s[4]);const g=f=>f[27];for(let f=0;f<u.length;f+=1){let w=_n(s,u,f),h=g(w);m.set(h,_[f]=wn(h,w))}return{c(){t=E("div"),e=E("div"),n=E("div"),o=E("div");for(let f=0;f<a.length;f+=1)a[f].c();d=U(),l=E("div"),r=E("div"),c=E("div");for(let f=0;f<_.length;f+=1)_[f].c();this.h()},l(f){t=D(f,"DIV",{class:!0});var w=j(t);e=D(w,"DIV",{class:!0});var h=j(e);n=D(h,"DIV",{class:!0});var v=j(n);o=D(v,"DIV",{class:!0,style:!0});var I=j(o);for(let M=0;M<a.length;M+=1)a[M].l(I);I.forEach(P),v.forEach(P),d=F(h),l=D(h,"DIV",{class:!0});var k=j(l);r=D(k,"DIV",{class:!0});var S=j(r);c=D(S,"DIV",{class:!0,style:!0});var N=j(c);for(let M=0;M<_.length;M+=1)_[M].l(N);N.forEach(P),S.forEach(P),k.forEach(P),h.forEach(P),w.forEach(P),this.h()},h(){$(o,"class","velocity-scale-content"),me(o,"height",s[9]+"px"),$(n,"class","velocity-scale"),$(c,"class","grid-content"),me(c,"height",s[9]+"px"),$(r,"class","grid-container"),$(l,"class","grid-area"),$(e,"class","velocity-roll-container"),$(t,"class","velocity-editor")},m(f,w){W(f,t,w),C(t,e),C(e,n),C(n,o);for(let h=0;h<a.length;h+=1)a[h]&&a[h].m(o,null);s[15](n),C(e,d),C(e,l),C(l,r),C(r,c);for(let h=0;h<_.length;h+=1)_[h]&&_[h].m(c,null);s[18](r),s[19](l),s[20](t),y||(p=[ie(n,"scroll",s[10]),ie(r,"scroll",s[10])],y=!0)},p(f,w){w[0]&32&&(b=Ie(f[5]),a=Ge(a,w,T,1,f,b,i,o,Je,bn,null,In)),w[0]&512&&me(o,"height",f[9]+"px"),w[0]&2480&&(u=Ie(f[4]),_=Ge(_,w,g,1,f,u,m,c,Je,wn,null,_n)),w[0]&512&&me(c,"height",f[9]+"px")},d(f){f&&P(t);for(let w=0;w<a.length;w+=1)a[w].d();s[15](null);for(let w=0;w<_.length;w+=1)_[w].d();s[18](null),s[19](null),s[20](null),y=!1,Fe(p)}}}function bn(s,t){let e,n,o=t[31].value+"",a,i,d;return{key:s,first:null,c(){e=E("div"),n=E("span"),a=be(o),i=be("%"),d=U(),this.h()},l(l){e=D(l,"DIV",{class:!0,style:!0});var r=j(e);n=D(r,"SPAN",{class:!0});var c=j(n);a=ke(c,o),i=ke(c,"%"),c.forEach(P),d=F(r),r.forEach(P),this.h()},h(){$(n,"class","scale-label"),$(e,"class","velocity-scale-row"),me(e,"height",Tt+"px"),this.first=e},m(l,r){W(l,e,r),C(e,n),C(n,a),C(n,i),C(e,d)},p(l,r){t=l,r[0]&32&&o!==(o=t[31].value+"")&&Ue(a,o)},d(l){l&&P(e)}}}function Tn(s){let t,e,n=Math.round(s[28]*100)+"",o,a;return{c(){t=E("div"),e=E("span"),o=be(n),a=be("%"),this.h()},l(i){t=D(i,"DIV",{class:!0,style:!0});var d=j(t);e=D(d,"SPAN",{class:!0});var l=j(e);o=ke(l,n),a=ke(l,"%"),l.forEach(P),d.forEach(P),this.h()},h(){var i;$(e,"class","velocity-label"),$(t,"class","velocity-block"),me(t,"background-color",((i=s[8])==null?void 0:i.color)||"#7ab8ff")},m(i,d){W(i,t,d),C(t,e),C(e,o),C(e,a)},p(i,d){var l;d[0]&16&&n!==(n=Math.round(i[28]*100)+"")&&Ue(o,n),d[0]&256&&me(t,"background-color",((l=i[8])==null?void 0:l.color)||"#7ab8ff")},d(i){i&&P(t)}}}function yn(s,t){let e,n,o,a,i=t[32]&&Tn(t);function d(...r){return t[16](t[30],t[31],...r)}function l(...r){return t[17](t[30],t[31],...r)}return{key:s,first:null,c(){e=E("div"),i&&i.c(),this.h()},l(r){e=D(r,"DIV",{class:!0,style:!0,role:!0,tabindex:!0});var c=j(e);i&&i.l(c),c.forEach(P),this.h()},h(){$(e,"class",n="grid-cell "+(t[32]?"active":"")),me(e,"height",Tt+"px"),$(e,"role","gridcell"),$(e,"tabindex","0"),this.first=e},m(r,c){W(r,e,c),i&&i.m(e,null),o||(a=[ie(e,"click",d),ie(e,"mousedown",jr),ie(e,"keydown",l)],o=!0)},p(r,c){t=r,t[32]?i?i.p(t,c):(i=Tn(t),i.c(),i.m(e,null)):i&&(i.d(1),i=null),c[0]&48&&n!==(n="grid-cell "+(t[32]?"active":""))&&$(e,"class",n)},d(r){r&&P(e),i&&i.d(),o=!1,Fe(a)}}}function wn(s,t){let e,n=[],o=new Map,a,i=Ie(t[5]);const d=l=>l[31].velocity;for(let l=0;l<i.length;l+=1){let r=vn(t,i,l),c=d(r);o.set(c,n[l]=yn(c,r))}return{key:s,first:null,c(){e=E("div");for(let l=0;l<n.length;l+=1)n[l].c();a=U(),this.h()},l(l){e=D(l,"DIV",{class:!0,style:!0});var r=j(e);for(let c=0;c<n.length;c+=1)n[c].l(r);a=F(r),r.forEach(P),this.h()},h(){$(e,"class","grid-column"),me(e,"width",t[7]+"px"),this.first=e},m(l,r){W(l,e,r);for(let c=0;c<n.length;c+=1)n[c]&&n[c].m(e,null);C(e,a)},p(l,r){t=l,r[0]&2352&&(i=Ie(t[5]),n=Ge(n,r,d,1,t,i,o,e,Je,yn,a,vn)),r[0]&128&&me(e,"width",t[7]+"px")},d(l){l&&P(e);for(let r=0;r<n.length;r+=1)n[r].d()}}}function Br(s){let t,e=s[3]&&s[4].length>0&&kn(s);return{c(){e&&e.c(),t=Oe()},l(n){e&&e.l(n),t=Oe()},m(n,o){e&&e.m(n,o),W(n,t,o)},p(n,o){n[3]&&n[4].length>0?e?e.p(n,o):(e=kn(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:Ve,o:Ve,d(n){n&&P(t),e&&e.d(n)}}}const Tt=20,gt=50,jr=s=>s.preventDefault();function Wr(s,t,e){let n,o,a,i,d,l,r,c,_,m,y,p=60,b=!1;Z.subscribe(M=>e(12,l=M)),Se.subscribe(M=>e(13,r=M));const T=["bass","subtractive","fm","wavetable","supersaw","pluck","pad","organ","kick","snare","hihat","clap","tom","cymbal","shaker","rimshot"];function u(M){const q=M.target;q===m&&y?e(2,y.scrollTop=q.scrollTop,y):q===y&&m&&e(1,m.scrollTop=q.scrollTop,m)}function g(M,q,J){if(M>=o.length)return;const{nodeId:R}=o[M];f(R,q)}function f(M,q){if(!l)return;const J=Math.max(0,Math.min(1,q));if(r.selectedTrackId)Z.updateNodeVelocity(r.selectedTrackId,M,J);else if(r.selectedPatternId&&r.selectedInstrumentId)Z.updatePatternNodeVelocity(r.selectedPatternId,M,J,r.selectedInstrumentId);else return;window.dispatchEvent(new CustomEvent("reloadProject"))}function w(){_&&o.length>0?e(7,p=Math.max(40,_.clientWidth/o.length)):e(7,p=60)}It(()=>{const M=new ResizeObserver(()=>{w()}),q=()=>{_&&M.observe(_)};return q(),setTimeout(q,100),window.addEventListener("resize",w),()=>{M.disconnect(),window.removeEventListener("resize",w)}});function h(M){Le[M?"unshift":"push"](()=>{m=M,e(1,m),e(3,n),e(14,b),e(4,o),e(2,y),e(12,l),e(13,r)})}const v=(M,q,J)=>g(M,q.velocity),I=(M,q,J)=>{(J.key==="Enter"||J.key===" ")&&(J.preventDefault(),g(M,q.velocity))};function k(M){Le[M?"unshift":"push"](()=>{y=M,e(2,y),e(3,n),e(14,b),e(4,o),e(1,m),e(12,l),e(13,r)})}function S(M){Le[M?"unshift":"push"](()=>{_=M,e(0,_)})}function N(M){Le[M?"unshift":"push"](()=>{c=M,e(6,c)})}return s.$$.update=()=>{s.$$.dirty[0]&12288&&e(3,n=(()=>{var q,J;if(!l||r.selectedNodes.size<2)return!1;let M=null;if(r.selectedTrackId&&(M=(q=l.standaloneInstruments)==null?void 0:q.find(R=>R.id===r.selectedTrackId)),!M&&r.selectedPatternId&&r.selectedInstrumentId){const R=(J=l.patterns)==null?void 0:J.find(Y=>Y.id===r.selectedPatternId);if(R){const Y=R.instruments&&Array.isArray(R.instruments)&&R.instruments.length>0?R.instruments:R.instrumentType&&R.patternTree?[{id:R.id,instrumentType:R.instrumentType,patternTree:R.patternTree,settings:R.settings||{},instrumentSettings:R.instrumentSettings,color:R.color||"#7ab8ff",volume:R.volume??1,pan:R.pan??0,mute:R.mute,solo:R.solo}]:[];M=Y.find(ne=>ne.id===r.selectedInstrumentId)||Y[0]||null}}return M?!T.includes(M.instrumentType):!1})()),s.$$.dirty[0]&8&&typeof document<"u"&&(n?(document.body.classList.add("velocity-editor-visible"),document.body.classList.add("midi-editor-visible")):(document.body.classList.remove("velocity-editor-visible"),document.body.classList.contains("midi-editor-visible"))),s.$$.dirty[0]&12296&&e(4,o=(()=>{var Y,ne;if(!n||!l)return[];let M=null;if(r.selectedTrackId&&(M=(Y=l.standaloneInstruments)==null?void 0:Y.find(se=>se.id===r.selectedTrackId)),!M&&r.selectedPatternId&&r.selectedInstrumentId){const se=(ne=l.patterns)==null?void 0:ne.find(V=>V.id===r.selectedPatternId);if(se){const V=se.instruments&&Array.isArray(se.instruments)&&se.instruments.length>0?se.instruments:se.instrumentType&&se.patternTree?[{id:se.id,instrumentType:se.instrumentType,patternTree:se.patternTree,settings:se.settings||{},instrumentSettings:se.instrumentSettings,color:se.color||"#7ab8ff",volume:se.volume??1,pan:se.pan??0,mute:se.mute,solo:se.solo}]:[];M=V.find(B=>B.id===r.selectedInstrumentId)||V[0]||null}}if(!M)return[];const q=[];let J=0;const R=se=>{r.selectedNodes.has(se.id)&&(!se.children||se.children.length===0)&&q.push({node:se,nodeId:se.id,index:J++});for(const V of se.children)R(V)};return R(M.patternTree),q})()),s.$$.dirty[0]&32&&e(9,i=a.length*Tt),s.$$.dirty[0]&16414&&(n&&!b&&o.length>0?(e(14,b=!0),setTimeout(()=>{if(y&&m&&o.length>0){const M=o.map(({node:ne})=>ne.velocity??1),q=Math.max(...M),J=(Math.min(...M)+q)/2,R=Math.round(J*gt);let Y;q>=.95?Y=0:Y=Math.max(0,(gt-R)*Tt-y.clientHeight/2),e(1,m.scrollTop=Y,m),e(2,y.scrollTop=Y,y)}},150)):!n&&b?e(14,b=!1):n&&e(14,b=!0)),s.$$.dirty[0]&17&&_&&o.length>0&&w(),s.$$.dirty[0]&12296&&e(8,d=(()=>{var M,q;if(!n||!l)return null;if(r.selectedTrackId)return((M=l.standaloneInstruments)==null?void 0:M.find(J=>J.id===r.selectedTrackId))||null;if(r.selectedPatternId&&r.selectedInstrumentId){const J=(q=l.patterns)==null?void 0:q.find(R=>R.id===r.selectedPatternId);if(J){const R=J.instruments&&Array.isArray(J.instruments)&&J.instruments.length>0?J.instruments:J.instrumentType&&J.patternTree?[{id:J.id,instrumentType:J.instrumentType,patternTree:J.patternTree,settings:J.settings||{},instrumentSettings:J.instrumentSettings,color:J.color||"#7ab8ff",volume:J.volume??1,pan:J.pan??0,mute:J.mute,solo:J.solo}]:[];return R.find(Y=>Y.id===r.selectedInstrumentId)||R[0]||null}}return null})())},e(5,a=(()=>{const M=[];for(let q=gt;q>=0;q--){const J=q/gt;M.push({velocity:J,value:Math.round(J*100)})}return M})()),[_,m,y,n,o,a,c,p,d,i,u,g,l,r,b,h,v,I,k,S,N]}class Yr extends Pe{constructor(t){super(),$e(this,t,Wr,Br,Ne,{},null,[-1,-1])}}function qr(s){let t,e,n,o="Oscillator",a,i,d,l,r="Waveform",c,_,m,y="Sawtooth",p,b="Square",T,u="Sine",g,f="Triangle",w,h,v,I,k,S,N,M,q,J,R,Y="Filter",ne,se,V,B,oe,he,_e,ee,O="LFO Modulation",de,x,ce,A,re,ge,Me,we,Q,ue,ae,pe,Te,Ae,ve="Envelope",ze,Re,qe,yt,Qe,wt,Ze,St,xe,pt,Ct,Vt;return v=new te({props:{id:"pad-num-osc",label:"Oscillators",value:s[0].numOscillators??8,min:4,max:16,step:1,onUpdate:s[6]}}),S=new te({props:{id:"pad-detune",label:"Detune",value:s[0].detune??.15,min:0,max:1,step:.01,onUpdate:s[7]}}),M=new te({props:{id:"pad-spread",label:"Spread",value:s[0].spread??.7,min:0,max:1,step:.01,onUpdate:s[8]}}),V=new te({props:{id:"pad-filter-cutoff",label:"Cutoff (Hz)",value:s[0].filterCutoff??4e3,min:20,max:2e4,step:10,onUpdate:s[9]}}),oe=new te({props:{id:"pad-filter-resonance",label:"Resonance",value:s[0].filterResonance??.3,min:0,max:1,step:.01,onUpdate:s[10]}}),A=new te({props:{id:"pad-pitch-lfo-rate",label:"Pitch LFO Rate",value:s[0].pitchLfoRate??.5,min:0,max:10,step:.1,onUpdate:s[11]}}),ge=new te({props:{id:"pad-pitch-lfo-amount",label:"Pitch LFO Amount",value:s[0].pitchLfoAmount??.02,min:0,max:.5,step:.01,onUpdate:s[12]}}),Q=new te({props:{id:"pad-filter-lfo-rate",label:"Filter LFO Rate",value:s[0].filterLfoRate??.3,min:0,max:5,step:.1,onUpdate:s[13]}}),ae=new te({props:{id:"pad-filter-lfo-amount",label:"Filter LFO Amount",value:s[0].filterLfoAmount??1e3,min:0,max:5e3,step:10,onUpdate:s[14]}}),qe=new te({props:{id:"pad-attack",label:"Attack",value:s[0].attack??.5,min:0,max:1,step:.01,onUpdate:s[15]}}),Qe=new te({props:{id:"pad-decay",label:"Decay",value:s[0].decay??.3,min:0,max:1,step:.01,onUpdate:s[16]}}),Ze=new te({props:{id:"pad-sustain",label:"Sustain",value:s[0].sustain??.9,min:0,max:1,step:.01,onUpdate:s[17]}}),xe=new te({props:{id:"pad-release",label:"Release",value:s[0].release??1.5,min:0,max:3,step:.01,onUpdate:s[18]}}),{c(){t=E("div"),e=E("div"),n=E("div"),n.textContent=o,a=U(),i=E("div"),d=E("div"),l=E("label"),l.textContent=r,c=U(),_=E("select"),m=E("option"),m.textContent=y,p=E("option"),p.textContent=b,T=E("option"),T.textContent=u,g=E("option"),g.textContent=f,h=U(),G(v.$$.fragment),I=U(),k=E("div"),G(S.$$.fragment),N=U(),G(M.$$.fragment),q=U(),J=E("div"),R=E("div"),R.textContent=Y,ne=U(),se=E("div"),G(V.$$.fragment),B=U(),G(oe.$$.fragment),he=U(),_e=E("div"),ee=E("div"),ee.textContent=O,de=U(),x=E("div"),ce=E("div"),G(A.$$.fragment),re=U(),G(ge.$$.fragment),Me=U(),we=E("div"),G(Q.$$.fragment),ue=U(),G(ae.$$.fragment),pe=U(),Te=E("div"),Ae=E("div"),Ae.textContent=ve,ze=U(),Re=E("div"),G(qe.$$.fragment),yt=U(),G(Qe.$$.fragment),wt=U(),G(Ze.$$.fragment),St=U(),G(xe.$$.fragment),this.h()},l(fe){t=D(fe,"DIV",{class:!0});var ye=j(t);e=D(ye,"DIV",{class:!0});var Ke=j(e);n=D(Ke,"DIV",{class:!0,"data-svelte-h":!0}),le(n)!=="svelte-24p4tz"&&(n.textContent=o),a=F(Ke),i=D(Ke,"DIV",{class:!0});var rt=j(i);d=D(rt,"DIV",{class:!0});var at=j(d);l=D(at,"LABEL",{for:!0,"data-svelte-h":!0}),le(l)!=="svelte-1b02dl3"&&(l.textContent=r),c=F(at),_=D(at,"SELECT",{id:!0});var et=j(_);m=D(et,"OPTION",{"data-svelte-h":!0}),le(m)!=="svelte-hfmaw8"&&(m.textContent=y),p=D(et,"OPTION",{"data-svelte-h":!0}),le(p)!=="svelte-bkgndu"&&(p.textContent=b),T=D(et,"OPTION",{"data-svelte-h":!0}),le(T)!=="svelte-1mpn6cq"&&(T.textContent=u),g=D(et,"OPTION",{"data-svelte-h":!0}),le(g)!=="svelte-1f5nbzi"&&(g.textContent=f),et.forEach(P),at.forEach(P),h=F(rt),K(v.$$.fragment,rt),rt.forEach(P),I=F(Ke),k=D(Ke,"DIV",{class:!0});var lt=j(k);K(S.$$.fragment,lt),N=F(lt),K(M.$$.fragment,lt),lt.forEach(P),Ke.forEach(P),q=F(ye),J=D(ye,"DIV",{class:!0});var it=j(J);R=D(it,"DIV",{class:!0,"data-svelte-h":!0}),le(R)!=="svelte-10czic3"&&(R.textContent=Y),ne=F(it),se=D(it,"DIV",{class:!0});var ot=j(se);K(V.$$.fragment,ot),B=F(ot),K(oe.$$.fragment,ot),ot.forEach(P),it.forEach(P),he=F(ye),_e=D(ye,"DIV",{class:!0});var ct=j(_e);ee=D(ct,"DIV",{class:!0,"data-svelte-h":!0}),le(ee)!=="svelte-9y8pj0"&&(ee.textContent=O),de=F(ct),x=D(ct,"DIV",{class:!0});var ut=j(x);ce=D(ut,"DIV",{class:!0});var dt=j(ce);K(A.$$.fragment,dt),re=F(dt),K(ge.$$.fragment,dt),dt.forEach(P),Me=F(ut),we=D(ut,"DIV",{class:!0});var ft=j(we);K(Q.$$.fragment,ft),ue=F(ft),K(ae.$$.fragment,ft),ft.forEach(P),ut.forEach(P),ct.forEach(P),pe=F(ye),Te=D(ye,"DIV",{class:!0});var mt=j(Te);Ae=D(mt,"DIV",{class:!0,"data-svelte-h":!0}),le(Ae)!=="svelte-1d2koqh"&&(Ae.textContent=ve),ze=F(mt),Re=D(mt,"DIV",{class:!0});var He=j(Re);K(qe.$$.fragment,He),yt=F(He),K(Qe.$$.fragment,He),wt=F(He),K(Ze.$$.fragment,He),St=F(He),K(xe.$$.fragment,He),He.forEach(P),mt.forEach(P),ye.forEach(P),this.h()},h(){$(n,"class","param-group-title"),$(l,"for","pad-osc-type"),m.__value="saw",Ce(m,m.__value),p.__value="square",Ce(p,p.__value),T.__value="sine",Ce(T,T.__value),g.__value="triangle",Ce(g,g.__value),$(_,"id","pad-osc-type"),$(d,"class","param"),$(i,"class","param-grid two-column"),$(k,"class","param-grid three-column"),$(e,"class","param-group"),$(R,"class","param-group-title"),$(se,"class","param-grid two-column"),$(J,"class","param-group"),$(ee,"class","param-group-title"),$(ce,"class","param-grid two-column"),$(we,"class","param-grid two-column"),$(x,"class","param-grid"),$(_e,"class","param-group"),$(Ae,"class","param-group-title"),$(Re,"class","param-grid four-column svelte-jswoc3"),$(Te,"class","param-group"),$(t,"class","synth-plugin")},m(fe,ye){W(fe,t,ye),C(t,e),C(e,n),C(e,a),C(e,i),C(i,d),C(d,l),C(d,c),C(d,_),C(_,m),C(_,p),C(_,T),C(_,g),Xe(_,s[0].oscType??"saw"),C(i,h),X(v,i,null),C(e,I),C(e,k),X(S,k,null),C(k,N),X(M,k,null),C(t,q),C(t,J),C(J,R),C(J,ne),C(J,se),X(V,se,null),C(se,B),X(oe,se,null),C(t,he),C(t,_e),C(_e,ee),C(_e,de),C(_e,x),C(x,ce),X(A,ce,null),C(ce,re),X(ge,ce,null),C(x,Me),C(x,we),X(Q,we,null),C(we,ue),X(ae,we,null),C(t,pe),C(t,Te),C(Te,Ae),C(Te,ze),C(Te,Re),X(qe,Re,null),C(Re,yt),X(Qe,Re,null),C(Re,wt),X(Ze,Re,null),C(Re,St),X(xe,Re,null),pt=!0,Ct||(Vt=ie(_,"change",s[5]),Ct=!0)},p(fe,[ye]){(!pt||ye&1&&w!==(w=fe[0].oscType??"saw"))&&Xe(_,fe[0].oscType??"saw");const Ke={};ye&1&&(Ke.value=fe[0].numOscillators??8),v.$set(Ke);const rt={};ye&1&&(rt.value=fe[0].detune??.15),S.$set(rt);const at={};ye&1&&(at.value=fe[0].spread??.7),M.$set(at);const et={};ye&1&&(et.value=fe[0].filterCutoff??4e3),V.$set(et);const lt={};ye&1&&(lt.value=fe[0].filterResonance??.3),oe.$set(lt);const it={};ye&1&&(it.value=fe[0].pitchLfoRate??.5),A.$set(it);const ot={};ye&1&&(ot.value=fe[0].pitchLfoAmount??.02),ge.$set(ot);const ct={};ye&1&&(ct.value=fe[0].filterLfoRate??.3),Q.$set(ct);const ut={};ye&1&&(ut.value=fe[0].filterLfoAmount??1e3),ae.$set(ut);const dt={};ye&1&&(dt.value=fe[0].attack??.5),qe.$set(dt);const ft={};ye&1&&(ft.value=fe[0].decay??.3),Qe.$set(ft);const mt={};ye&1&&(mt.value=fe[0].sustain??.9),Ze.$set(mt);const He={};ye&1&&(He.value=fe[0].release??1.5),xe.$set(He)},i(fe){pt||(L(v.$$.fragment,fe),L(S.$$.fragment,fe),L(M.$$.fragment,fe),L(V.$$.fragment,fe),L(oe.$$.fragment,fe),L(A.$$.fragment,fe),L(ge.$$.fragment,fe),L(Q.$$.fragment,fe),L(ae.$$.fragment,fe),L(qe.$$.fragment,fe),L(Qe.$$.fragment,fe),L(Ze.$$.fragment,fe),L(xe.$$.fragment,fe),pt=!0)},o(fe){z(v.$$.fragment,fe),z(S.$$.fragment,fe),z(M.$$.fragment,fe),z(V.$$.fragment,fe),z(oe.$$.fragment,fe),z(A.$$.fragment,fe),z(ge.$$.fragment,fe),z(Q.$$.fragment,fe),z(ae.$$.fragment,fe),z(qe.$$.fragment,fe),z(Qe.$$.fragment,fe),z(Ze.$$.fragment,fe),z(xe.$$.fragment,fe),pt=!1},d(fe){fe&&P(t),H(v),H(S),H(M),H(V),H(oe),H(A),H(ge),H(Q),H(ae),H(qe),H(Qe),H(Ze),H(xe),Ct=!1,Vt()}}}function Hr(s,t,e){let n,{selectedTrack:o=void 0}=t,{selectedPattern:a=void 0}=t,{selectedInstrument:i=void 0}=t,{trackSettings:d}=t,l=null;De.subscribe(k=>l=k);function r(k,S){if(!n)return;let N=S;if(typeof S=="number"){if(isNaN(S))return;k==="attack"||k==="decay"?N=Math.max(0,Math.min(1,parseFloat(S.toFixed(2)))):k==="release"?N=Math.max(0,Math.min(3,parseFloat(S.toFixed(2)))):k==="sustain"?N=Math.max(0,Math.min(1,parseFloat(S.toFixed(2)))):k==="filterCutoff"?N=Math.max(20,Math.min(2e4,parseFloat(S.toFixed(0)))):k==="filterResonance"?N=Math.max(0,Math.min(1,parseFloat(S.toFixed(2)))):k==="filterLfoAmount"?N=Math.max(0,Math.min(5e3,parseFloat(S.toFixed(0)))):N=parseFloat(S.toFixed(2))}const M={...n.settings,[k]:N},q=n.instrumentSettings||{};if(n.instrumentType&&(q[n.instrumentType]={...M}),a&&i){if(Z.updatePatternInstrument(a.id,i.id,{settings:M,instrumentSettings:q}),l){const J=`__pattern_${a.id}_${i.id}`;l.updateTrackSettings(J,M)}}else o&&(Z.updateTrack(o.id,{settings:M,instrumentSettings:q}),l&&l.updateTrackSettings(o.id,M))}const c=k=>r("oscType",kt(k)||"saw"),_=k=>r("numOscillators",k),m=k=>r("detune",k),y=k=>r("spread",k),p=k=>r("filterCutoff",k),b=k=>r("filterResonance",k),T=k=>r("pitchLfoRate",k),u=k=>r("pitchLfoAmount",k),g=k=>r("filterLfoRate",k),f=k=>r("filterLfoAmount",k),w=k=>r("attack",k),h=k=>r("decay",k),v=k=>r("sustain",k),I=k=>r("release",k);return s.$$set=k=>{"selectedTrack"in k&&e(2,o=k.selectedTrack),"selectedPattern"in k&&e(3,a=k.selectedPattern),"selectedInstrument"in k&&e(4,i=k.selectedInstrument),"trackSettings"in k&&e(0,d=k.trackSettings)},s.$$.update=()=>{s.$$.dirty&20&&(n=i||o)},[d,r,o,a,i,c,_,m,y,p,b,T,u,g,f,w,h,v,I]}class Xr extends Pe{constructor(t){super(),$e(this,t,Hr,qr,Ne,{selectedTrack:2,selectedPattern:3,selectedInstrument:4,trackSettings:0})}}function Sn(s,t,e){const n=s.slice();return n[19]=t[e],n[21]=e,n}function Cn(s){let t,e,n=s[2][s[21]]+"",o,a,i,d,l,r,c=Math.round(s[19]*100)+"",_,m,y,p;function b(...T){return s[8](s[21],...T)}return d=new te({props:{id:"organ-drawbar-"+s[21],label:"",value:s[19],min:0,max:1,step:.01,onUpdate:b}}),{c(){t=E("div"),e=E("div"),o=be(n),a=U(),i=E("div"),G(d.$$.fragment),l=U(),r=E("div"),_=be(c),m=be("%"),y=U(),this.h()},l(T){t=D(T,"DIV",{class:!0});var u=j(t);e=D(u,"DIV",{class:!0});var g=j(e);o=ke(g,n),g.forEach(P),a=F(u),i=D(u,"DIV",{class:!0});var f=j(i);K(d.$$.fragment,f),f.forEach(P),l=F(u),r=D(u,"DIV",{class:!0});var w=j(r);_=ke(w,c),m=ke(w,"%"),w.forEach(P),y=F(u),u.forEach(P),this.h()},h(){$(e,"class","drawbar-label"),$(i,"class","drawbar-slider"),$(r,"class","drawbar-value"),$(t,"class","drawbar-row")},m(T,u){W(T,t,u),C(t,e),C(e,o),C(t,a),C(t,i),X(d,i,null),C(t,l),C(t,r),C(r,_),C(r,m),C(t,y),p=!0},p(T,u){s=T,(!p||u&4)&&n!==(n=s[2][s[21]]+"")&&Ue(o,n);const g={};u&2&&(g.value=s[19]),d.$set(g),(!p||u&2)&&c!==(c=Math.round(s[19]*100)+"")&&Ue(_,c)},i(T){p||(L(d.$$.fragment,T),p=!0)},o(T){z(d.$$.fragment,T),p=!1},d(T){T&&P(t),H(d)}}}function Kr(s){let t,e,n,o="Drawbars",a,i,d,l,r,c="Rotary Speaker",_,m,y,p,b,T,u,g,f="Filter",w,h,v,I,k,S,N,M,q="Envelope",J,R,Y,ne,se,V,B,oe,he,_e,ee=Ie(s[1]),O=[];for(let x=0;x<ee.length;x+=1)O[x]=Cn(Sn(s,ee,x));const de=x=>z(O[x],1,1,()=>{O[x]=null});return y=new te({props:{id:"organ-rotary-speed",label:"Speed (Hz)",value:s[0].rotarySpeed??4,min:0,max:10,step:.1,onUpdate:s[9]}}),b=new te({props:{id:"organ-rotary-depth",label:"Depth",value:s[0].rotaryDepth??.3,min:0,max:1,step:.01,onUpdate:s[10]}}),v=new te({props:{id:"organ-filter-cutoff",label:"Cutoff (Hz)",value:s[0].filterCutoff??8e3,min:20,max:2e4,step:10,onUpdate:s[11]}}),k=new te({props:{id:"organ-filter-resonance",label:"Resonance",value:s[0].filterResonance??.2,min:0,max:1,step:.01,onUpdate:s[12]}}),Y=new te({props:{id:"organ-attack",label:"Attack",value:s[0].attack??.01,min:0,max:1,step:.01,onUpdate:s[13]}}),se=new te({props:{id:"organ-decay",label:"Decay",value:s[0].decay??.1,min:0,max:1,step:.01,onUpdate:s[14]}}),B=new te({props:{id:"organ-sustain",label:"Sustain",value:s[0].sustain??1,min:0,max:1,step:.01,onUpdate:s[15]}}),he=new te({props:{id:"organ-release",label:"Release",value:s[0].release??.2,min:0,max:1,step:.01,onUpdate:s[16]}}),{c(){t=E("div"),e=E("div"),n=E("div"),n.textContent=o,a=U(),i=E("div");for(let x=0;x<O.length;x+=1)O[x].c();d=U(),l=E("div"),r=E("div"),r.textContent=c,_=U(),m=E("div"),G(y.$$.fragment),p=U(),G(b.$$.fragment),T=U(),u=E("div"),g=E("div"),g.textContent=f,w=U(),h=E("div"),G(v.$$.fragment),I=U(),G(k.$$.fragment),S=U(),N=E("div"),M=E("div"),M.textContent=q,J=U(),R=E("div"),G(Y.$$.fragment),ne=U(),G(se.$$.fragment),V=U(),G(B.$$.fragment),oe=U(),G(he.$$.fragment),this.h()},l(x){t=D(x,"DIV",{class:!0});var ce=j(t);e=D(ce,"DIV",{class:!0});var A=j(e);n=D(A,"DIV",{class:!0,"data-svelte-h":!0}),le(n)!=="svelte-19dpm1"&&(n.textContent=o),a=F(A),i=D(A,"DIV",{class:!0});var re=j(i);for(let pe=0;pe<O.length;pe+=1)O[pe].l(re);re.forEach(P),A.forEach(P),d=F(ce),l=D(ce,"DIV",{class:!0});var ge=j(l);r=D(ge,"DIV",{class:!0,"data-svelte-h":!0}),le(r)!=="svelte-1qq2zjd"&&(r.textContent=c),_=F(ge),m=D(ge,"DIV",{class:!0});var Me=j(m);K(y.$$.fragment,Me),p=F(Me),K(b.$$.fragment,Me),Me.forEach(P),ge.forEach(P),T=F(ce),u=D(ce,"DIV",{class:!0});var we=j(u);g=D(we,"DIV",{class:!0,"data-svelte-h":!0}),le(g)!=="svelte-10czic3"&&(g.textContent=f),w=F(we),h=D(we,"DIV",{class:!0});var Q=j(h);K(v.$$.fragment,Q),I=F(Q),K(k.$$.fragment,Q),Q.forEach(P),we.forEach(P),S=F(ce),N=D(ce,"DIV",{class:!0});var ue=j(N);M=D(ue,"DIV",{class:!0,"data-svelte-h":!0}),le(M)!=="svelte-1d2koqh"&&(M.textContent=q),J=F(ue),R=D(ue,"DIV",{class:!0});var ae=j(R);K(Y.$$.fragment,ae),ne=F(ae),K(se.$$.fragment,ae),V=F(ae),K(B.$$.fragment,ae),oe=F(ae),K(he.$$.fragment,ae),ae.forEach(P),ue.forEach(P),ce.forEach(P),this.h()},h(){$(n,"class","param-group-title"),$(i,"class","drawbar-container"),$(e,"class","param-group"),$(r,"class","param-group-title"),$(m,"class","param-grid two-column"),$(l,"class","param-group"),$(g,"class","param-group-title"),$(h,"class","param-grid two-column"),$(u,"class","param-group"),$(M,"class","param-group-title"),$(R,"class","param-grid four-column svelte-jswoc3"),$(N,"class","param-group"),$(t,"class","synth-plugin")},m(x,ce){W(x,t,ce),C(t,e),C(e,n),C(e,a),C(e,i);for(let A=0;A<O.length;A+=1)O[A]&&O[A].m(i,null);C(t,d),C(t,l),C(l,r),C(l,_),C(l,m),X(y,m,null),C(m,p),X(b,m,null),C(t,T),C(t,u),C(u,g),C(u,w),C(u,h),X(v,h,null),C(h,I),X(k,h,null),C(t,S),C(t,N),C(N,M),C(N,J),C(N,R),X(Y,R,null),C(R,ne),X(se,R,null),C(R,V),X(B,R,null),C(R,oe),X(he,R,null),_e=!0},p(x,[ce]){if(ce&22){ee=Ie(x[1]);let pe;for(pe=0;pe<ee.length;pe+=1){const Te=Sn(x,ee,pe);O[pe]?(O[pe].p(Te,ce),L(O[pe],1)):(O[pe]=Cn(Te),O[pe].c(),L(O[pe],1),O[pe].m(i,null))}for(We(),pe=ee.length;pe<O.length;pe+=1)de(pe);Ye()}const A={};ce&1&&(A.value=x[0].rotarySpeed??4),y.$set(A);const re={};ce&1&&(re.value=x[0].rotaryDepth??.3),b.$set(re);const ge={};ce&1&&(ge.value=x[0].filterCutoff??8e3),v.$set(ge);const Me={};ce&1&&(Me.value=x[0].filterResonance??.2),k.$set(Me);const we={};ce&1&&(we.value=x[0].attack??.01),Y.$set(we);const Q={};ce&1&&(Q.value=x[0].decay??.1),se.$set(Q);const ue={};ce&1&&(ue.value=x[0].sustain??1),B.$set(ue);const ae={};ce&1&&(ae.value=x[0].release??.2),he.$set(ae)},i(x){if(!_e){for(let ce=0;ce<ee.length;ce+=1)L(O[ce]);L(y.$$.fragment,x),L(b.$$.fragment,x),L(v.$$.fragment,x),L(k.$$.fragment,x),L(Y.$$.fragment,x),L(se.$$.fragment,x),L(B.$$.fragment,x),L(he.$$.fragment,x),_e=!0}},o(x){O=O.filter(Boolean);for(let ce=0;ce<O.length;ce+=1)z(O[ce]);z(y.$$.fragment,x),z(b.$$.fragment,x),z(v.$$.fragment,x),z(k.$$.fragment,x),z(Y.$$.fragment,x),z(se.$$.fragment,x),z(B.$$.fragment,x),z(he.$$.fragment,x),_e=!1},d(x){x&&P(t),_t(O,x),H(y),H(b),H(v),H(k),H(Y),H(se),H(B),H(he)}}}function Gr(s,t,e){let n,o,a,{selectedTrack:i=void 0}=t,{selectedPattern:d=void 0}=t,{selectedInstrument:l=void 0}=t,{trackSettings:r}=t,c=null;De.subscribe(v=>c=v);function _(v,I){if(!n)return;let k=I;if(typeof I=="number"){if(isNaN(I))return;v==="attack"||v==="decay"||v==="release"||v==="sustain"?k=Math.max(0,Math.min(1,parseFloat(I.toFixed(2)))):v==="filterCutoff"?k=Math.max(20,Math.min(2e4,parseFloat(I.toFixed(0)))):v==="filterResonance"?k=Math.max(0,Math.min(1,parseFloat(I.toFixed(2)))):k=parseFloat(I.toFixed(2))}const S={...n.settings,[v]:k},N=n.instrumentSettings||{};if(n.instrumentType&&(N[n.instrumentType]={...S}),d&&l){if(Z.updatePatternInstrument(d.id,l.id,{settings:S,instrumentSettings:N}),c){const M=`__pattern_${d.id}_${l.id}`;c.updateTrackSettings(M,S)}}else i&&(Z.updateTrack(i.id,{settings:S,instrumentSettings:N}),c&&c.updateTrackSettings(i.id,S))}function m(v,I){if(!n)return;const k=[...a];k[v]=Math.max(0,Math.min(1,parseFloat(I.toFixed(2)))),_("drawbars",k)}const y=(v,I)=>m(v,I),p=v=>_("rotarySpeed",v),b=v=>_("rotaryDepth",v),T=v=>_("filterCutoff",v),u=v=>_("filterResonance",v),g=v=>_("attack",v),f=v=>_("decay",v),w=v=>_("sustain",v),h=v=>_("release",v);return s.$$set=v=>{"selectedTrack"in v&&e(5,i=v.selectedTrack),"selectedPattern"in v&&e(6,d=v.selectedPattern),"selectedInstrument"in v&&e(7,l=v.selectedInstrument),"trackSettings"in v&&e(0,r=v.trackSettings)},s.$$.update=()=>{s.$$.dirty&160&&(n=l||i),s.$$.dirty&1&&e(1,a=r.drawbars??[.8,0,1,0,.6,0,.4,0,.2])},e(2,o=["16'","5 1/3'","8'","4'","2 2/3'","2'","1 3/5'","1 1/3'","1'"]),[r,a,o,_,m,i,d,l,y,p,b,T,u,g,f,w,h]}class Jr extends Pe{constructor(t){super(),$e(this,t,Gr,Kr,Ne,{selectedTrack:5,selectedPattern:6,selectedInstrument:7,trackSettings:0})}}function Qr(s){let t,e="Loading instrument data...";return{c(){t=E("div"),t.textContent=e,this.h()},l(n){t=D(n,"DIV",{style:!0,"data-svelte-h":!0}),le(t)!=="svelte-u3qn2w"&&(t.textContent=e),this.h()},h(){me(t,"padding","20px"),me(t,"color","#b8b8b8"),me(t,"text-align","center")},m(n,o){W(n,t,o)},p:Ve,i:Ve,o:Ve,d(n){n&&P(t)}}}function Zr(s){let t,e,n,o;const a=[ea,xr],i=[];function d(l,r){return l[0].instrumentType==="pad"?0:l[0].instrumentType==="organ"?1:-1}return~(t=d(s))&&(e=i[t]=a[t](s)),{c(){e&&e.c(),n=Oe()},l(l){e&&e.l(l),n=Oe()},m(l,r){~t&&i[t].m(l,r),W(l,n,r),o=!0},p(l,r){let c=t;t=d(l),t===c?~t&&i[t].p(l,r):(e&&(We(),z(i[c],1,1,()=>{i[c]=null}),Ye()),~t?(e=i[t],e?e.p(l,r):(e=i[t]=a[t](l),e.c()),L(e,1),e.m(n.parentNode,n)):e=null)},i(l){o||(L(e),o=!0)},o(l){z(e),o=!1},d(l){l&&P(n),~t&&i[t].d(l)}}}function xr(s){let t,e;return t=new Jr({props:{selectedTrack:s[7],selectedPattern:s[6],selectedInstrument:s[1],trackSettings:s[8]}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p(n,o){const a={};o&128&&(a.selectedTrack=n[7]),o&64&&(a.selectedPattern=n[6]),o&2&&(a.selectedInstrument=n[1]),o&256&&(a.trackSettings=n[8]),t.$set(a)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function ea(s){let t,e;return t=new Xr({props:{selectedTrack:s[7],selectedPattern:s[6],selectedInstrument:s[1],trackSettings:s[8]}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p(n,o){const a={};o&128&&(a.selectedTrack=n[7]),o&64&&(a.selectedPattern=n[6]),o&2&&(a.selectedInstrument=n[1]),o&256&&(a.trackSettings=n[8]),t.$set(a)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function ta(s){let t,e,n,o,a=(s[0].instrumentType==="pad",""),i,d,l,r=s[0].label+"",c,_,m,y="",p,b,T,u,g,f,w;const h=[Zr,Qr],v=[];function I(k,S){return k[1]?0:1}return T=I(s),u=v[T]=h[T](s),{c(){t=E("div"),e=E("div"),n=E("div"),o=E("span"),i=be(a),d=U(),l=E("span"),c=be(r),_=U(),m=E("button"),m.textContent=y,p=U(),b=E("div"),u.c(),this.h()},l(k){t=D(k,"DIV",{class:!0,style:!0});var S=j(t);e=D(S,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0,style:!0});var N=j(e);n=D(N,"DIV",{class:!0});var M=j(n);o=D(M,"SPAN",{class:!0});var q=j(o);i=ke(q,a),q.forEach(P),d=F(M),l=D(M,"SPAN",{class:!0});var J=j(l);c=ke(J,r),J.forEach(P),M.forEach(P),_=F(N),m=D(N,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(m)!=="svelte-4hn109"&&(m.textContent=y),N.forEach(P),p=F(S),b=D(S,"DIV",{class:!0});var R=j(b);u.l(R),R.forEach(P),S.forEach(P),this.h()},h(){var k;$(o,"class","plugin-icon"),$(l,"class","plugin-name"),$(n,"class","plugin-title"),$(m,"class","plugin-close"),$(m,"title","Close"),$(e,"class","plugin-header"),$(e,"role","button"),$(e,"tabindex","0"),$(e,"aria-label","Plugin window header - drag to move"),me(e,"border-color",((k=s[1])==null?void 0:k.color)||"#7ab8ff"),$(b,"class","plugin-content"),$(t,"class","synth-plugin-window"),me(t,"left",s[5].x+"px"),me(t,"top",s[5].y+"px"),Ee(t,"dragging",s[4])},m(k,S){W(k,t,S),C(t,e),C(e,n),C(n,o),C(o,i),C(n,d),C(n,l),C(l,c),C(e,_),C(e,m),s[13](e),C(t,p),C(t,b),v[T].m(b,null),s[14](t),g=!0,f||(w=[ie(m,"click",s[10]),ie(e,"mousedown",s[9]),ie(e,"keydown",na)],f=!0)},p(k,[S]){var M;(!g||S&1)&&a!==(a=(k[0].instrumentType==="pad",""))&&Ue(i,a),(!g||S&1)&&r!==(r=k[0].label+"")&&Ue(c,r),(!g||S&2)&&me(e,"border-color",((M=k[1])==null?void 0:M.color)||"#7ab8ff");let N=T;T=I(k),T===N?v[T].p(k,S):(We(),z(v[N],1,1,()=>{v[N]=null}),Ye(),u=v[T],u?u.p(k,S):(u=v[T]=h[T](k),u.c()),L(u,1),u.m(b,null)),(!g||S&32)&&me(t,"left",k[5].x+"px"),(!g||S&32)&&me(t,"top",k[5].y+"px"),(!g||S&16)&&Ee(t,"dragging",k[4])},i(k){g||(L(u),g=!0)},o(k){z(u),g=!1},d(k){k&&P(t),s[13](null),v[T].d(),s[14](null),f=!1,Fe(w)}}}const na=s=>{(s.key==="Enter"||s.key===" ")&&s.preventDefault()};function sa(s,t,e){let n,o,a,i,d,{window:l}=t,r;Z.subscribe(h=>e(12,r=h));let c,_,m=!1,y={x:0,y:0},p={x:100,y:100};function b(h){if(!_||!c)return;e(4,m=!0);const v=c.getBoundingClientRect();y.x=h.clientX-v.left,y.y=h.clientY-v.top,document.addEventListener("mousemove",T),document.addEventListener("mouseup",u),h.preventDefault()}function T(h){if(!m||!c)return;e(5,p.x=h.clientX-y.x,p),e(5,p.y=h.clientY-y.y,p);const v=globalThis.window.innerWidth-c.offsetWidth,I=globalThis.window.innerHeight-c.offsetHeight;e(5,p.x=Math.max(0,Math.min(v,p.x)),p),e(5,p.y=Math.max(0,Math.min(I,p.y)),p),e(2,c.style.left=`${p.x}px`,c),e(2,c.style.top=`${p.y}px`,c)}function u(){e(4,m=!1),document.removeEventListener("mousemove",T),document.removeEventListener("mouseup",u)}function g(){Et.closeWindow(l.id)}It(()=>{const h=localStorage.getItem(`synthPlugin:${l.id}`);if(h)try{const v=JSON.parse(h);e(5,p={x:v.x||100,y:v.y||100})}catch{}}),Dn(()=>{if(c){const h=c.getBoundingClientRect();localStorage.setItem(`synthPlugin:${l.id}`,JSON.stringify({x:h.left,y:h.top}))}u()});function f(h){Le[h?"unshift":"push"](()=>{_=h,e(3,_)})}function w(h){Le[h?"unshift":"push"](()=>{c=h,e(2,c)})}return s.$$set=h=>{"window"in h&&e(11,l=h.window)},s.$$.update=()=>{var h,v;s.$$.dirty&2048&&e(0,n=l),s.$$.dirty&1&&console.log("SynthPluginWindow rendered with window:",n),s.$$.dirty&4096&&console.log("Project available:",!!r),s.$$.dirty&4097&&e(1,o=(()=>{var I,k;if(!r||!n)return null;if(n.trackId)return((I=r.standaloneInstruments)==null?void 0:I.find(S=>S.id===n.trackId))||null;if(n.patternId&&n.instrumentId){const S=(k=r.patterns)==null?void 0:k.find(N=>N.id===n.patternId);if(S){const N=S.instruments&&Array.isArray(S.instruments)&&S.instruments.length>0?S.instruments:S.instrumentType&&S.patternTree?[{id:S.id,instrumentType:S.instrumentType,patternTree:S.patternTree,settings:S.settings||{},instrumentSettings:S.instrumentSettings,color:S.color||"#7ab8ff",volume:S.volume??1,pan:S.pan??0,mute:S.mute,solo:S.solo}]:[];return N.find(M=>M.id===n.instrumentId)||N[0]||null}}return null})()),s.$$.dirty&2&&e(8,a=(o==null?void 0:o.settings)||{}),s.$$.dirty&4097&&e(7,i=n.trackId?(h=r==null?void 0:r.standaloneInstruments)==null?void 0:h.find(I=>I.id===n.trackId):void 0),s.$$.dirty&4097&&e(6,d=n.patternId?(v=r==null?void 0:r.patterns)==null?void 0:v.find(I=>I.id===n.patternId):void 0)},[n,o,c,_,m,p,d,i,a,b,g,l,r,f,w]}class ra extends Pe{constructor(t){super(),$e(this,t,sa,ta,Ne,{window:11})}}function Pn(s,t,e){const n=s.slice();return n[14]=t[e],n}function aa(s){let t,e="Loading pattern...";return{c(){t=E("div"),t.textContent=e,this.h()},l(n){t=D(n,"DIV",{class:!0,"data-svelte-h":!0}),le(t)!=="svelte-115d3ox"&&(t.textContent=e),this.h()},h(){$(t,"class","loading svelte-3jfcw5")},m(n,o){W(n,t,o)},p:Ve,i:Ve,o:Ve,d(n){n&&P(t)}}}function la(s){let t,e,n,o,a,i,d=" Back to Patterns",l,r,c=s[1].name+"",_,m,y,p,b,T,u="+ Instrument",g,f,w,h,v,I,k,S,N,M,q,J;t=new zn({}),f=new Vs({props:{patternId:s[1].id}}),h=new Vr({}),I=new zr({}),S=new Yr({});let R=s[5].length>0&&$n(s);return{c(){G(t.$$.fragment),e=U(),n=E("div"),o=E("div"),a=E("div"),i=E("button"),i.textContent=d,l=U(),r=E("h2"),_=be(c),m=U(),y=E("input"),b=U(),T=E("button"),T.textContent=u,g=U(),G(f.$$.fragment),w=U(),G(h.$$.fragment),v=U(),G(I.$$.fragment),k=U(),G(S.$$.fragment),N=U(),R&&R.c(),this.h()},l(Y){K(t.$$.fragment,Y),e=F(Y),n=D(Y,"DIV",{class:!0});var ne=j(n);o=D(ne,"DIV",{class:!0});var se=j(o);a=D(se,"DIV",{class:!0});var V=j(a);i=D(V,"BUTTON",{class:!0,"data-svelte-h":!0}),le(i)!=="svelte-16gkfju"&&(i.textContent=d),l=F(V),r=D(V,"H2",{class:!0});var B=j(r);_=ke(B,c),B.forEach(P),m=F(V),y=D(V,"INPUT",{type:!0,class:!0}),V.forEach(P),b=F(se),T=D(se,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(T)!=="svelte-53gj7j"&&(T.textContent=u),se.forEach(P),g=F(ne),K(f.$$.fragment,ne),w=F(ne),K(h.$$.fragment,ne),v=F(ne),K(I.$$.fragment,ne),k=F(ne),K(S.$$.fragment,ne),N=F(ne),R&&R.l(ne),ne.forEach(P),this.h()},h(){$(i,"class","back-btn svelte-3jfcw5"),$(r,"class","svelte-3jfcw5"),$(y,"type","text"),y.value=p=s[1].name,$(y,"class","pattern-name-input svelte-3jfcw5"),$(a,"class","pattern-header-left svelte-3jfcw5"),$(T,"class","add-instrument-btn svelte-3jfcw5"),$(T,"title","Add new instrument to pattern"),$(o,"class","pattern-header svelte-3jfcw5"),$(n,"class","pattern-editor svelte-3jfcw5")},m(Y,ne){X(t,Y,ne),W(Y,e,ne),W(Y,n,ne),C(n,o),C(o,a),C(a,i),C(a,l),C(a,r),C(r,_),C(a,m),C(a,y),C(o,b),C(o,T),C(n,g),X(f,n,null),C(n,w),X(h,n,null),C(n,v),X(I,n,null),C(n,k),X(S,n,null),C(n,N),R&&R.m(n,null),M=!0,q||(J=[ie(i,"click",s[10]),ie(y,"input",s[11]),ie(T,"click",s[12])],q=!0)},p(Y,ne){(!M||ne&2)&&c!==(c=Y[1].name+"")&&Ue(_,c),(!M||ne&2&&p!==(p=Y[1].name)&&y.value!==p)&&(y.value=p);const se={};ne&2&&(se.patternId=Y[1].id),f.$set(se),Y[5].length>0?R?(R.p(Y,ne),ne&32&&L(R,1)):(R=$n(Y),R.c(),L(R,1),R.m(n,null)):R&&(We(),z(R,1,1,()=>{R=null}),Ye())},i(Y){M||(L(t.$$.fragment,Y),L(f.$$.fragment,Y),L(h.$$.fragment,Y),L(I.$$.fragment,Y),L(S.$$.fragment,Y),L(R),M=!0)},o(Y){z(t.$$.fragment,Y),z(f.$$.fragment,Y),z(h.$$.fragment,Y),z(I.$$.fragment,Y),z(S.$$.fragment,Y),z(R),M=!1},d(Y){Y&&(P(e),P(n)),H(t,Y),H(f),H(h),H(I),H(S),R&&R.d(),q=!1,Fe(J)}}}function ia(s){let t,e;return t=new On({props:{viewMode:"pattern",isPatternEditor:!0}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p:Ve,i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function $n(s){let t,e,n=Ie(s[5]),o=[];for(let i=0;i<n.length;i+=1)o[i]=Nn(Pn(s,n,i));const a=i=>z(o[i],1,1,()=>{o[i]=null});return{c(){for(let i=0;i<o.length;i+=1)o[i].c();t=Oe()},l(i){for(let d=0;d<o.length;d+=1)o[d].l(i);t=Oe()},m(i,d){for(let l=0;l<o.length;l+=1)o[l]&&o[l].m(i,d);W(i,t,d),e=!0},p(i,d){if(d&32){n=Ie(i[5]);let l;for(l=0;l<n.length;l+=1){const r=Pn(i,n,l);o[l]?(o[l].p(r,d),L(o[l],1)):(o[l]=Nn(r),o[l].c(),L(o[l],1),o[l].m(t.parentNode,t))}for(We(),l=n.length;l<o.length;l+=1)a(l);Ye()}},i(i){if(!e){for(let d=0;d<n.length;d+=1)L(o[d]);e=!0}},o(i){o=o.filter(Boolean);for(let d=0;d<o.length;d+=1)z(o[d]);e=!1},d(i){i&&P(t),_t(o,i)}}}function Nn(s){let t,e;return t=new ra({props:{window:s[14]}}),{c(){G(t.$$.fragment)},l(n){K(t.$$.fragment,n)},m(n,o){X(t,n,o),e=!0},p(n,o){const a={};o&32&&(a.window=n[14]),t.$set(a)},i(n){e||(L(t.$$.fragment,n),e=!0)},o(n){z(t.$$.fragment,n),e=!1},d(n){H(t,n)}}}function oa(s){let t,e,n,o;const a=[ia,la,aa],i=[];function d(l,r){return l[3]?0:l[1]?1:2}return t=d(s),e=i[t]=a[t](s),{c(){e.c(),n=Oe()},l(l){e.l(l),n=Oe()},m(l,r){i[t].m(l,r),W(l,n,r),o=!0},p(l,[r]){let c=t;t=d(l),t===c?i[t].p(l,r):(We(),z(i[c],1,1,()=>{i[c]=null}),Ye(),e=i[t],e?e.p(l,r):(e=i[t]=a[t](l),e.c()),L(e,1),e.m(n.parentNode,n))},i(l){o||(L(e),o=!0)},o(l){z(e),o=!1},d(l){l&&P(n),i[t].d(l)}}}function ca(s,t,e){let n,o;bt(s,Yn,u=>e(4,n=u)),bt(s,Et,u=>e(5,o=u));let a,i=null,d=null,l=null,r=!0;De.subscribe(u=>e(2,l=u)),Z.subscribe(u=>{var g;e(0,a=u),a&&n.params.patternId&&(e(1,i=((g=a.patterns)==null?void 0:g.find(f=>f.id===n.params.patternId))||null),i&&r&&setTimeout(()=>{e(3,r=!1),Nt.stopLoading()},100))});function c(){if(a&&n.params.id)try{localStorage.setItem(`project_${n.params.id}`,JSON.stringify(a)),console.log("[Pattern Editor] Project saved to localStorage")}catch(u){console.error("[Pattern Editor] Failed to save project:",u)}}let _="",m=!0,y=null;It(()=>{var g,f,w;if(e(3,r=!0),Nt.stopLoading(),a&&n.params.patternId){const h=(g=a.patterns)==null?void 0:g.find(v=>v.id===n.params.patternId);h&&(e(1,i=h),e(3,r=!1),Nt.stopLoading())}if($t.setPattern(),$t.setCurrentPatternId(n.params.patternId),Se.selectNode("root",null,!0,!1,n.params.patternId),i)return;const u=localStorage.getItem(`project_${n.params.id}`);if(u)try{const h=JSON.parse(u);Z.set(h)}catch(h){console.error("Failed to load project:",h),e(3,r=!1)}else e(3,r=!1);if(d=Z.subscribe(h=>{h&&n.params.id&&setTimeout(()=>{c()},100)}),a&&n.params.patternId&&!((f=a.patterns)==null?void 0:f.find(v=>v.id===n.params.patternId))){const v=Z.createPattern(n.params.id,`Pattern ${(((w=a.patterns)==null?void 0:w.length)||0)+1}`);Z.addPattern(v)}setTimeout(()=>{e(8,m=!1),window.dispatchEvent(new CustomEvent("reloadProject"))},300)}),Bn(({to:u,cancel:g})=>{c()}),Dn(()=>{c(),d&&d()});const p=()=>{c(),$t.setPattern(),jn(`/project/${n.params.id}`)},b=u=>{const g=u.currentTarget.value;Z.updatePattern(i.id,{name:g})},T=()=>{if(!a||!i)return;const g={kick:{color:"#00ffff",settings:{attack:.005,decay:.4,sustain:0,release:.15}}}.kick,f={id:crypto.randomUUID(),instrumentType:"kick",patternTree:{id:crypto.randomUUID(),division:4,x:400+Math.random()*200,y:200+Math.random()*100,children:[]},settings:{...g.settings},instrumentSettings:void 0,color:g.color,volume:1,pan:0,mute:!1,solo:!1};Z.addPatternInstrument(i.id,f),Se.selectNode(f.patternTree.id,null,!0,!1,i.id,f.id),setTimeout(()=>{var w;if(l){let h=null;if(Z.subscribe(M=>h=M)(),!h)return;const v=(w=h.patterns)==null?void 0:w.find(M=>M.id===i.id);if(!v)return;const k=(v.instruments&&Array.isArray(v.instruments)&&v.instruments.length>0?v.instruments:[]).find(M=>M.id===f.id);if(!k)return;const S=`__pattern_${i.id}_${f.id}`,N={id:S,projectId:i.projectId,instrumentType:k.instrumentType,patternTree:k.patternTree,settings:k.settings||{},instrumentSettings:k.instrumentSettings,volume:k.volume??1,pan:k.pan??0,color:k.color,mute:k.mute??!1,solo:k.solo??!1};l.updateTrack(S,N)}},0)};return s.$$.update=()=>{if(s.$$.dirty&899&&i&&a){const u=JSON.stringify({id:i.id,patternTree:i.patternTree,instrumentType:i.instrumentType,settings:i.settings});u!==_&&(e(7,_=u),m?e(8,m=!1):(y&&clearTimeout(y),e(9,y=setTimeout(()=>{window.dispatchEvent(new CustomEvent("reloadProject")),e(9,y=null)},150))))}},[a,i,l,r,n,o,c,_,m,y,p,b,T]}class va extends Pe{constructor(t){super(),$e(this,t,ca,oa,Ne,{})}}export{va as component};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CpFYu2kg.js","./BJF9mgOB.js","./C-KikI3b.js","./Ue2r4fdp.js"])))=>i.map(i=>d[i]);
var Tn=Object.defineProperty;var yn=(s,t,e)=>t in s?Tn(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var ft=(s,t,e)=>yn(s,typeof t!="symbol"?t+"":t,e);import{N as Ue,v as Oe,S as He,i as We,s as Fe,n as we,d as b,b as pe,y as zt,a1 as Ht,T as Le,a as De,c as i,m as X,Q as In,o as n,e as y,f as S,q as le,h as R,p as ie,g as me,j as I,k as x,r as ue,t as ve,O as Mn,$ as rt,H as $t,D as ot,u as qe,F as lt,G as at,E as it,l as Lt,A as En,a0 as wn,V as Sn,I as Cn,w as Pn,x as Bn}from"./C-KikI3b.js";import{_ as st}from"./C1FmrZbK.js";import"./IHki7fMi.js";import{g as en}from"./Bg53_pdl.js";import{projectStore as ae}from"./CpFYu2kg.js";import{w as Ke}from"./BJF9mgOB.js";function Ss(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function Cs(s,t){s.d(1),t.delete(s.key)}function Ps(s,t,e,r,o,a,l,p,v,c,f,h){let C=s.length,d=a.length,u=C;const _={};for(;u--;)_[s[u].key]=u;const k=[],w=new Map,g=new Map,m=[];for(u=d;u--;){const V=h(o,a,u),A=e(V);let O=l.get(A);O?m.push(()=>O.p(V,t)):(O=c(A,V),O.c()),w.set(A,k[u]=O),A in _&&g.set(A,Math.abs(u-_[A]))}const M=new Set,L=new Set;function W(V){Oe(V,1),V.m(p,f),l.set(V.key,V),f=V.first,d--}for(;C&&d;){const V=k[d-1],A=s[C-1],O=V.key,G=A.key;V===A?(f=V.first,C--,d--):w.has(G)?!l.has(O)||M.has(O)?W(V):L.has(G)?C--:g.get(O)>g.get(G)?(L.add(O),W(V)):(M.add(G),C--):(v(A,l),C--)}for(;C--;){const V=s[C];w.has(V.key)||v(V,l)}for(;d;)W(k[d-1]);return Ue(m),k}function Ln(){const{subscribe:s,set:t,update:e}=Ke({currentTime:0,playingNodes:new Set}),r=new Map,o=150;return{subscribe:s,set:t,update:e,updatePlayback:(a,l)=>{const p=Date.now();e(v=>{const c=new Set;for(const f of v.playingNodes){const h=r.get(f);h!==void 0&&p-h<o?c.add(f):r.delete(f)}for(const f of l)c.add(f),r.set(f,p);return{currentTime:a,playingNodes:c}})},clear:()=>{r.clear(),t({currentTime:0,playingNodes:new Set})}}}const tn=Ln();function zn(){const{subscribe:s,set:t,update:e}=Ke({selectedNodes:new Set,selectedTrackId:null,selectedPatternId:null,selectedInstrumentId:null,selectedNodeId:null,isRoot:!1});return{subscribe:s,selectNode:(r,o,a,l=!1,p=null,v=null)=>{e(c=>{const f=l?new Set(c.selectedNodes):new Set;return f.add(r),{selectedNodes:f,selectedTrackId:o,selectedPatternId:p,selectedInstrumentId:v,selectedNodeId:r,isRoot:a}})},selectMultipleNodes:(r,o,a=!1,l=null,p=null)=>{e(v=>{const c=new Set(r);return{selectedNodes:c,selectedTrackId:o,selectedPatternId:l,selectedInstrumentId:p,selectedNodeId:c.size===1?Array.from(c)[0]:null,isRoot:a}})},clearSelection:()=>{t({selectedNodes:new Set,selectedTrackId:null,selectedPatternId:null,selectedInstrumentId:null,selectedNodeId:null,isRoot:!1})},isSelected:r=>{let o=!1;return s(a=>{o=a.selectedNodes.has(r)})(),o}}}const bn=zn(),Bs=Object.freeze(Object.defineProperty({__proto__:null,selectionStore:bn},Symbol.toStringTag,{value:"Module"}));function Vn(){const{subscribe:s,set:t,update:e}=Ke("arrangement");let r=null;return{subscribe:s,set:t,update:e,toggle:()=>{e(o=>o==="arrangement"?"pattern":"arrangement")},setArrangement:()=>t("arrangement"),setPattern:()=>t("pattern"),setCurrentPatternId:o=>{r=o},getCurrentPatternId:()=>r}}const Qe=Vn();function Dn(){const{subscribe:s,set:t}=Ke(null);return{subscribe:s,set:t,updateTrack:async(e,r)=>{var a,l;let o=null;if(s(p=>o=p)(),o){if(r.settings&&o.updateTrackSettings(e,r.settings),r.volume!==void 0&&o.updateTrackVolume(e,r.volume),r.pan!==void 0&&o.updateTrackPan(e,r.pan),r.mute!==void 0&&o.updateTrackMute(e,r.mute),r.solo!==void 0&&o.updateTrackSolo(e,r.solo),r.instrumentType){const{projectStore:p}=await st(async()=>{const{projectStore:c}=await import("./CpFYu2kg.js");return{projectStore:c}},__vite__mapDeps([0,1,2]),import.meta.url);let v;if(p.subscribe(c=>v=c)(),v){let c=(a=v.standaloneInstruments)==null?void 0:a.find(f=>f.id===e);if(!c&&e.startsWith("__pattern_")){const h=e.substring(10).split("_");if(h.length>=2){const C=h[0],d=h.slice(1).join("_"),u=(l=v.patterns)==null?void 0:l.find(_=>_.id===C);u&&(c=(u.instruments&&Array.isArray(u.instruments)&&u.instruments.length>0?u.instruments:u.instrumentType&&u.patternTree?[{id:u.id,instrumentType:u.instrumentType,patternTree:u.patternTree,settings:u.settings||{},instrumentSettings:u.instrumentSettings,color:u.color||"#7ab8ff",volume:u.volume??1,pan:u.pan??0,mute:u.mute,solo:u.solo}]:[]).find(k=>k.id===d),c&&(c={id:e,projectId:u.projectId,instrumentType:r.instrumentType,patternTree:c.patternTree,settings:r.settings||c.settings||{},instrumentSettings:r.instrumentSettings||c.instrumentSettings,volume:c.volume??1,pan:c.pan??0,color:c.color||"#7ab8ff",mute:c.mute??!1,solo:c.solo??!1}))}}c&&o.updateTrack(e,{...c,...r})}}r.patternTree&&o.updatePatternTree(e,r.patternTree)}}}}const Nn=Dn();function _n(s,t,e,r){if(!s.children||s.children.length===0)return e===0&&s.velocity===void 0&&s.pitch===void 0?[]:[{time:e,velocity:s.velocity??1,pitch:s.pitch??60,instrumentId:r}];const o=s.children.reduce((p,v)=>p+(v.division||1),0);if(o===0)return console.warn("[flattenTree] Total division is 0, returning empty events"),[];let a=e;const l=[];for(const p of s.children){const v=p.division||1,c=t*(v/o);l.push(..._n(p,c,a,r)),a+=c}return l}function Bt(s,t,e=4){return _n(s,e,0,t)}class kn{constructor(){ft(this,"audioContext");ft(this,"workletNode",null);ft(this,"isInitialized",!1);ft(this,"playbackCallbacks",[]);this.audioContext=new AudioContext({sampleRate:44100})}getAudioContext(){return this.audioContext}async initialize(){if(!this.isInitialized)try{await this.audioContext.audioWorklet.addModule("/EngineWorkletProcessor.js"),this.workletNode=new AudioWorkletNode(this.audioContext,"engine-worklet-processor"),this.workletNode.connect(this.audioContext.destination),this.workletNode.port.onmessage=t=>{this.handleMessage(t.data)},this.isInitialized=!0,this.sendMessage({type:"ready"})}catch(t){throw console.error("Failed to initialize audio worklet:",t),t}}handleMessage(t){t.type==="playbackUpdate"||t.type==="playbackPosition"?this.notifyPlaybackUpdate(t.time,t.eventIds||[]):t.type==="debug"?console.log(`[Worklet Debug] ${t.message}:`,t.data):console.log("Message from worklet:",t)}sendMessage(t){this.workletNode&&this.workletNode.port.postMessage(t)}async loadProject(t,e,r,o,a,l,p,v){var _,k,w,g;if(await this.ensureInitialized(),o&&o.clips&&o.clips.length>0&&a){const m=[],M=new Map(a.map(N=>[N.id,N])),L=o.clips||[],W=L.length>0?Math.max(...L.map(N=>N.startBeat+N.duration)):0,V=Math.max(o.totalLength||0,W,4),A=[],O=new Map;for(const N of o.clips){const T=M.get(N.patternId);if(!T)continue;let Q=[];T.instruments&&Array.isArray(T.instruments)&&T.instruments.length>0?Q=T.instruments:T.instrumentType&&T.patternTree&&(Q=[{id:T.id,instrumentType:T.instrumentType,patternTree:T.patternTree,settings:T.settings||{},instrumentSettings:T.instrumentSettings,color:T.color||"#7ab8ff",volume:T.volume??1,pan:T.pan??0,mute:T.mute,solo:T.solo}]);for(const H of Q){const F=`__pattern_${N.patternId}_${H.id}`;if(!O.has(`${N.patternId}_${H.id}`)){O.set(`${N.patternId}_${H.id}`,F);let Z=H.patternTree;if(!Z||!Z.children||Z.children.length===0){const re=`__pattern_${N.patternId}`,K=t.find(ne=>ne.id===re);K&&K.patternTree&&K.patternTree.children&&K.patternTree.children.length>0&&(console.log(`[EngineWorklet] Instrument tree incomplete, using temporary instrument's patternTree for pattern ${N.patternId} instrument ${H.id}`),Z=K.patternTree)}Z?A.push({id:F,projectId:T.projectId,instrumentType:H.instrumentType||"kick",patternTree:Z,settings:H.settings||{},instrumentSettings:H.instrumentSettings||{},volume:H.volume??1,pan:H.pan??0,color:H.color||"#7ab8ff",mute:(T.mute??!1)||(H.mute??!1),solo:H.solo??!1}):console.warn(`[EngineWorklet] Cannot create instrument track for pattern ${N.patternId} instrument ${H.id}: no valid patternTree found`)}}}for(const N of o.clips){const T=M.get(N.patternId);if(!T)continue;let Q=[];T.instruments&&Array.isArray(T.instruments)&&T.instruments.length>0?Q=T.instruments:T.instrumentType&&T.patternTree&&(Q=[{id:T.id,instrumentType:T.instrumentType,patternTree:T.patternTree,settings:T.settings||{},instrumentSettings:T.instrumentSettings,color:T.color||"#7ab8ff",volume:T.volume??1,pan:T.pan??0,mute:T.mute,solo:T.solo}]);for(const H of Q){const F=O.get(`${N.patternId}_${H.id}`);if(!F)continue;let Z=H.patternTree;if(!Z||!Z.children||Z.children.length===0){const U=A.find(se=>se.id===F);U&&U.patternTree&&U.patternTree.children&&U.patternTree.children.length>0&&(console.log(`[EngineWorklet] Instrument tree incomplete, using temporary instrument's patternTree for pattern ${N.patternId} instrument ${H.id}`),Z=U.patternTree)}if(!Z){console.warn(`[EngineWorklet] No valid patternTree found for pattern ${N.patternId} instrument ${H.id}`);continue}const re=T.baseMeter||4,K=re,ne=Bt(Z,F,re),oe=N.offsetBeats||0;let j=N.startBeat;for(;j<N.startBeat+N.duration;){for(const U of ne){let se=U.time+oe;se>=K?se=se%K:se<0&&(se=K+se%K);const z=j+se;z>=N.startBeat&&z<N.startBeat+N.duration&&m.push({...U,time:z,instrumentId:F,patternId:N.patternId})}j+=K}}}m.sort((N,T)=>N.time-T.time),console.log("[EngineWorklet] Final events for arrangement view:",{totalEvents:m.length,events:m.map(N=>({time:N.time,instrumentId:N.instrumentId,pitch:N.pitch,patternId:N.patternId}))});const G=new Map;if(o!=null&&o.tracks)for(const N of o.tracks){const T=[],Q=o.clips.filter(H=>H.trackId===N.id);for(const H of Q){const F=M.get(H.patternId);if(!F)continue;let Z=[];F.instruments&&Array.isArray(F.instruments)&&F.instruments.length>0?Z=F.instruments:F.instrumentType&&F.patternTree&&(Z=[{id:F.id,instrumentType:F.instrumentType,patternTree:F.patternTree}]);for(const re of Z){const K=O.get(`${H.patternId}_${re.id}`);K&&!T.includes(K)&&T.push(K)}}T.length>0&&G.set(N.id,T)}this.sendMessage({type:"loadProject",tracks:A,bpm:e,events:m,baseMeterTrackId:(_=A[0])==null?void 0:_.id,timeline:{clips:o.clips,tracks:o.tracks,effects:o.effects||[],envelopes:o.envelopes||[],totalLength:V},patterns:a||[],effects:l||[],envelopes:p||[],automation:v||null,viewMode:"arrangement",patternToTrackId:Array.from(O.entries()),timelineTrackToAudioTracks:Array.from(G.entries())});return}const c=a?new Map(a.map(m=>[m.id,m])):new Map,f=r||((k=t[0])==null?void 0:k.id),h=t.find(m=>m.id===f);let C=4;if((w=h==null?void 0:h.id)!=null&&w.startsWith("__pattern_")){const m=h.id.lastIndexOf("_");if(m>10){const M=h.id.substring(10,m),L=c.get(M);L&&(C=L.baseMeter||4)}}const d=C,u=[];for(const m of t){const M=(g=m.patternTree)==null?void 0:g.division;if(!M||M<=0)continue;let L=4;if(m.id.startsWith("__pattern_")){const V=m.id.lastIndexOf("_");if(V>10){const A=m.id.substring(10,V),O=c.get(A);O&&(L=O.baseMeter||4)}}const W=L;if(W<d){const V=Bt(m.patternTree,m.id,L);if(V.length>0){let A=0;for(;A<d;){for(const O of V){const G=O.time+A;G<d&&u.push({...O,time:G})}A+=W}}}else{const V=Bt(m.patternTree,m.id,L);V.length>0&&u.push(...V)}}u.sort((m,M)=>m.time-M.time),this.sendMessage({type:"loadProject",tracks:t,bpm:e,events:u,baseMeterTrackId:f,timeline:void 0,patterns:a||[],effects:l||[],envelopes:p||[],automation:v||null,viewMode:"pattern"})}setTransport(t,e){this.sendMessage({type:"setTransport",state:t,position:e})}setTempo(t){this.sendMessage({type:"setTempo",bpm:t})}updatePatternTree(t,e,r=4){this.sendMessage({type:"updatePatternTree",trackId:t,patternTree:e}),this.updateTrackEvents(t,e,r)}updateTrackEvents(t,e,r=4){const o=Bt(e,t,r);this.sendMessage({type:"updateTrackEvents",trackId:t,events:o})}removeTrack(t){this.sendMessage({type:"removeTrack",trackId:t})}updateTrackSettings(t,e){this.sendMessage({type:"updateTrackSettings",trackId:t,settings:e})}updateEffect(t,e){this.sendMessage({type:"updateEffect",effectId:t,settings:e})}updateEnvelope(t,e){this.sendMessage({type:"updateEnvelope",envelopeId:t,settings:e})}updateTrack(t,e){this.sendMessage({type:"updateTrack",trackId:t,track:e})}updateTrackVolume(t,e){this.sendMessage({type:"updateTrackVolume",trackId:t,volume:e})}updateTrackPan(t,e){this.sendMessage({type:"updateTrackPan",trackId:t,pan:e})}updateTrackMute(t,e){this.sendMessage({type:"updateTrackMute",trackId:t,mute:e})}updateTrackSolo(t,e){this.sendMessage({type:"updateTrackSolo",trackId:t,solo:e})}updateTimelineTrackVolume(t,e){this.sendMessage({type:"updateTimelineTrackVolume",trackId:t,volume:e})}updateTimelineTrackMute(t,e){this.sendMessage({type:"updateTimelineTrackMute",trackId:t,mute:e})}updateTimelineTrackSolo(t,e){this.sendMessage({type:"updateTimelineTrackSolo",trackId:t,solo:e})}onPlaybackUpdate(t){this.playbackCallbacks.push(t)}notifyPlaybackUpdate(t,e){for(const r of this.playbackCallbacks)r(t,e)}async ensureInitialized(){this.isInitialized||await this.initialize()}async resume(){this.audioContext.state==="suspended"&&await this.audioContext.resume()}connectToDestination(t){this.workletNode&&(this.workletNode.disconnect(),this.workletNode.connect(t))}reconnectToOutput(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode.connect(this.audioContext.destination))}destroy(){this.workletNode&&(this.workletNode.disconnect(),this.workletNode=null),this.audioContext.state!=="closed"&&this.audioContext.close()}}const nn=44100;async function jn(s,t,e,r,o,a,l,p,v,c){const f=new kn;await f.initialize(),await f.resume();const h=f.getAudioContext();await f.loadProject(s,t,e,a,l,p,v,c);const C=r*60/t,d=Math.ceil(C*nn),u=4096,_=h.createScriptProcessor(u,2,2),k=[],w=[];let g=0,m=!0;_.onaudioprocess=A=>{if(!m||g>=d)return;const O=A.inputBuffer,G=O.getChannelData(0),N=O.getChannelData(1),T=Math.min(u,d-g);k.push(new Float32Array(G.subarray(0,T))),w.push(new Float32Array(N.subarray(0,T))),g+=T,o&&o(Math.min(1,g/d)),g>=d&&(m=!1)},f.connectToDestination(_),f.setTransport("play"),await new Promise(A=>{let O=!1;const G=()=>{O||(O=!0,f.setTransport("stop"),_.disconnect(),f.reconnectToOutput(),A())},N=Math.ceil(C*1e3)+1e3,T=setTimeout(()=>{O||G()},N),Q=()=>{O||(g>=d?(clearTimeout(T),G()):setTimeout(Q,100))};Q()});const M=new Float32Array(d),L=new Float32Array(d);let W=0;for(let A=0;A<k.length&&W<d;A++){const O=k[A],G=Math.min(O.length,d-W);M.set(O.subarray(0,G),W),L.set(w[A].subarray(0,G),W),W+=G}const V=h.createBuffer(2,d,nn);return V.getChannelData(0).set(M),V.getChannelData(1).set(L),_.disconnect(),f.destroy(),V}function sn(s,t="export.wav"){const e=s.numberOfChannels,r=s.length,o=s.sampleRate,a=new ArrayBuffer(44+r*e*2),l=new DataView(a),p=(C,d)=>{for(let u=0;u<d.length;u++)l.setUint8(C+u,d.charCodeAt(u))};p(0,"RIFF"),l.setUint32(4,36+r*e*2,!0),p(8,"WAVE"),p(12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,1,!0),l.setUint16(22,e,!0),l.setUint32(24,o,!0),l.setUint32(28,o*e*2,!0),l.setUint16(32,e*2,!0),l.setUint16(34,16,!0),p(36,"data"),l.setUint32(40,r*e*2,!0);let v=44;for(let C=0;C<r;C++)for(let d=0;d<e;d++){const u=Math.max(-1,Math.min(1,s.getChannelData(d)[C]));l.setInt16(v,u<0?u*32768:u*32767,!0),v+=2}const c=new Blob([a],{type:"audio/wav"}),f=URL.createObjectURL(c),h=document.createElement("a");h.href=f,h.download=t,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(f)}async function Un(s,t="export.ogg"){if(!MediaRecorder.isTypeSupported("audio/ogg; codecs=opus"))throw new Error("OGG format not supported in this browser. Please use WAV format instead.");const e=new AudioContext({sampleRate:s.sampleRate}),r=e.createBufferSource();r.buffer=s;const o=e.createMediaStreamDestination();r.connect(o);const a=new MediaRecorder(o.stream,{mimeType:"audio/ogg; codecs=opus"}),l=[];return a.ondataavailable=p=>{p.data.size>0&&l.push(p.data)},new Promise((p,v)=>{a.onstop=()=>{const f=new Blob(l,{type:"audio/ogg; codecs=opus"}),h=URL.createObjectURL(f),C=document.createElement("a");C.href=h,C.download=t,document.body.appendChild(C),C.click(),document.body.removeChild(C),URL.revokeObjectURL(h),e.close(),p()},a.onerror=()=>{e.close(),v(new Error("MediaRecorder error"))},a.start(),r.start(0);const c=s.duration*1e3;setTimeout(()=>{a.stop(),r.stop()},c+100)})}async function An(s,t="export.mp3"){var o;const e=["audio/mpeg","audio/mp3","audio/mpeg3"];let r=null;for(const a of e)if(MediaRecorder.isTypeSupported(a)){r=a;break}if(r){const a=new AudioContext({sampleRate:s.sampleRate}),l=a.createBufferSource();l.buffer=s;const p=a.createMediaStreamDestination();l.connect(p);const v=new MediaRecorder(p.stream,{mimeType:r,audioBitsPerSecond:128e3}),c=[];return v.ondataavailable=f=>{f.data.size>0&&c.push(f.data)},new Promise((f,h)=>{v.onstop=()=>{const d=new Blob(c,{type:r}),u=URL.createObjectURL(d),_=document.createElement("a");_.href=u,_.download=t,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(u),a.close(),f()},v.onerror=()=>{a.close(),h(new Error("MediaRecorder error during MP3 encoding"))},v.start(),l.start(0);const C=s.duration*1e3;setTimeout(()=>{v.stop(),l.stop()},C+100)})}try{let a;const l=await st(()=>import("./CPgFxoxe.js").then(m=>m.i),[],import.meta.url);if(a=l.Mp3Encoder||((o=l.default)==null?void 0:o.Mp3Encoder)||l.default,!a||typeof a!="function")throw new Error("Mp3Encoder not found in lamejs module");const p=s.sampleRate,v=s.numberOfChannels,c=new a(v,p,128),f=s.length,h=new Int16Array(f*v);for(let m=0;m<f;m++)for(let M=0;M<v;M++){const L=s.getChannelData(M)[m],W=Math.max(-32768,Math.min(32767,Math.floor(L*32767)));h[m*v+M]=W}const C=1152,d=[];for(let m=0;m<h.length;m+=C*v){const M=h.subarray(m,Math.min(m+C*v,h.length)),L=c.encodeBuffer(M);L.length>0&&d.push(L)}const u=c.flush();u.length>0&&d.push(u);const _=d.reduce((m,M)=>m+M.length,0),k=new Blob(d,{type:"audio/mpeg"}),w=URL.createObjectURL(k),g=document.createElement("a");g.href=w,g.download=t,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(w)}catch(a){if(a instanceof Error){const l=a.message;throw l.includes("MPEGMode")||l.includes("is not defined")?new Error("MP3 export is not available in this browser. The lamejs library has compatibility issues. Please use WAV or OGG format instead, or use Chrome/Edge which support MP3 via MediaRecorder."):l.includes("Failed to resolve module")||l.includes("Cannot find module")?new Error("MP3 export requires lamejs. Please install it: npm install lamejs"):a}throw new Error("MP3 encoding failed: "+String(a))}}async function Rn(s,t,e="wav"){const r=t.replace(/\.(wav|ogg|mp3)$/i,"");switch(e){case"wav":sn(s,`${r}.wav`);break;case"ogg":await Un(s,`${r}.ogg`);break;case"mp3":await An(s,`${r}.mp3`);break;default:sn(s,`${r}.wav`)}}function rn(s){let t,e,r,o,a="Export Audio",l,p,v,c,f,h,C,d,u,_="Export Range",k,w,g,m,M,L,W,V='<span class="option-title svelte-s7zu5d">Custom Range</span> <span class="option-description svelte-s7zu5d">Select specific beats</span>',A,O,G,N,T="Format",Q,H,F,Z,re,K,ne="WAV (Lossless)",oe,j,U,se,z,E="MP3",P,D,q,ge,ee,he="OGG Vorbis",ce,fe,B,Y="Filename",be,te,Ae,ze,Ie,Me,J,Se="Duration:",Ce,Pe,Ee,Xe,Ve,Ne,ut="BPM:",je,Je,pt,Vt,Ge,Ye,Wt="Format:",Dt,$e,ct=s[2]==="wav"?"WAV (44.1kHz, 16-bit)":s[2]==="mp3"?"MP3":s[2]==="ogg"?"OGG Vorbis":"WAV",ht,Nt,jt,Ze,Re,Ut,At,xe,dt=s[13]?"Exporting...":"Export",mt,vt,Rt,xt,Ot,Ft,_e=s[15]&&on(s),ke=s[17]&&ln(s),Te=s[1]==="custom"&&an(s),ye=s[13]&&un(s);return Rt=Ht(s[30][0]),xt=Ht(s[30][1]),{c(){t=I("div"),e=I("div"),r=I("div"),o=I("h2"),o.textContent=a,l=x(),p=I("button"),v=ue("svg"),c=ue("path"),f=x(),h=I("div"),_e&&_e.c(),C=x(),d=I("div"),u=I("div"),u.textContent=_,k=x(),w=I("div"),ke&&ke.c(),g=x(),m=I("label"),M=I("input"),L=x(),W=I("div"),W.innerHTML=V,A=x(),Te&&Te.c(),O=x(),G=I("div"),N=I("div"),N.textContent=T,Q=x(),H=I("div"),F=I("label"),Z=I("input"),re=x(),K=I("span"),K.textContent=ne,oe=x(),j=I("label"),U=I("input"),se=x(),z=I("span"),z.textContent=E,P=x(),D=I("label"),q=I("input"),ge=x(),ee=I("span"),ee.textContent=he,ce=x(),fe=I("div"),B=I("label"),B.textContent=Y,be=x(),te=I("input"),Ae=x(),ze=I("div"),Ie=I("div"),Me=I("div"),J=I("span"),J.textContent=Se,Ce=x(),Pe=I("span"),Ee=ve(s[16]),Xe=x(),Ve=I("div"),Ne=I("span"),Ne.textContent=ut,je=x(),Je=I("span"),pt=ve(s[10]),Vt=x(),Ge=I("div"),Ye=I("span"),Ye.textContent=Wt,Dt=x(),$e=I("span"),ht=ve(ct),Nt=x(),ye&&ye.c(),jt=x(),Ze=I("div"),Re=I("button"),Ut=ve("Cancel"),At=x(),xe=I("button"),mt=ve(dt),this.h()},l($){t=y($,"DIV",{class:!0,role:!0});var de=S(t);e=y(de,"DIV",{class:!0,role:!0,"aria-modal":!0,"aria-label":!0});var et=S(e);r=y(et,"DIV",{class:!0});var gt=S(r);o=y(gt,"H2",{class:!0,"data-svelte-h":!0}),le(o)!=="svelte-sw0w1y"&&(o.textContent=a),l=R(gt),p=y(gt,"BUTTON",{class:!0,title:!0});var Gt=S(p);v=ie(Gt,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0});var Zt=S(v);c=ie(Zt,"path",{d:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),S(c).forEach(b),Zt.forEach(b),Gt.forEach(b),gt.forEach(b),f=R(et),h=y(et,"DIV",{class:!0});var Be=S(h);_e&&_e.l(Be),C=R(Be),d=y(Be,"DIV",{class:!0});var wt=S(d);u=y(wt,"DIV",{class:!0,"data-svelte-h":!0}),le(u)!=="svelte-h5agz5"&&(u.textContent=_),k=R(wt),w=y(wt,"DIV",{class:!0});var bt=S(w);ke&&ke.l(bt),g=R(bt),m=y(bt,"LABEL",{class:!0});var _t=S(m);M=y(_t,"INPUT",{type:!0,class:!0}),L=R(_t),W=y(_t,"DIV",{class:!0,"data-svelte-h":!0}),le(W)!=="svelte-t4japk"&&(W.innerHTML=V),_t.forEach(b),bt.forEach(b),wt.forEach(b),A=R(Be),Te&&Te.l(Be),O=R(Be),G=y(Be,"DIV",{class:!0});var kt=S(G);N=y(kt,"DIV",{class:!0,"data-svelte-h":!0}),le(N)!=="svelte-h1o7cl"&&(N.textContent=T),Q=R(kt),H=y(kt,"DIV",{class:!0,role:!0,"aria-label":!0});var tt=S(H);F=y(tt,"LABEL",{class:!0});var Tt=S(F);Z=y(Tt,"INPUT",{type:!0,class:!0}),re=R(Tt),K=y(Tt,"SPAN",{"data-svelte-h":!0}),le(K)!=="svelte-m52szp"&&(K.textContent=ne),Tt.forEach(b),oe=R(tt),j=y(tt,"LABEL",{class:!0});var yt=S(j);U=y(yt,"INPUT",{type:!0,class:!0}),se=R(yt),z=y(yt,"SPAN",{"data-svelte-h":!0}),le(z)!=="svelte-1ybxcx8"&&(z.textContent=E),yt.forEach(b),P=R(tt),D=y(tt,"LABEL",{class:!0});var It=S(D);q=y(It,"INPUT",{type:!0,class:!0}),ge=R(It),ee=y(It,"SPAN",{"data-svelte-h":!0}),le(ee)!=="svelte-1nhf45o"&&(ee.textContent=he),It.forEach(b),tt.forEach(b),kt.forEach(b),ce=R(Be),fe=y(Be,"DIV",{class:!0});var Mt=S(fe);B=y(Mt,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),le(B)!=="svelte-te977l"&&(B.textContent=Y),be=R(Mt),te=y(Mt,"INPUT",{id:!0,type:!0,placeholder:!0,class:!0}),Mt.forEach(b),Ae=R(Be),ze=y(Be,"DIV",{class:!0});var qt=S(ze);Ie=y(qt,"DIV",{class:!0});var nt=S(Ie);Me=y(nt,"DIV",{class:!0});var Et=S(Me);J=y(Et,"SPAN",{class:!0,"data-svelte-h":!0}),le(J)!=="svelte-du4i06"&&(J.textContent=Se),Ce=R(Et),Pe=y(Et,"SPAN",{class:!0});var Kt=S(Pe);Ee=me(Kt,s[16]),Kt.forEach(b),Et.forEach(b),Xe=R(nt),Ve=y(nt,"DIV",{class:!0});var St=S(Ve);Ne=y(St,"SPAN",{class:!0,"data-svelte-h":!0}),le(Ne)!=="svelte-108c4vr"&&(Ne.textContent=ut),je=R(St),Je=y(St,"SPAN",{class:!0});var Yt=S(Je);pt=me(Yt,s[10]),Yt.forEach(b),St.forEach(b),Vt=R(nt),Ge=y(nt,"DIV",{class:!0});var Ct=S(Ge);Ye=y(Ct,"SPAN",{class:!0,"data-svelte-h":!0}),le(Ye)!=="svelte-e657cj"&&(Ye.textContent=Wt),Dt=R(Ct),$e=y(Ct,"SPAN",{class:!0});var Qt=S($e);ht=me(Qt,ct),Qt.forEach(b),Ct.forEach(b),nt.forEach(b),qt.forEach(b),Nt=R(Be),ye&&ye.l(Be),Be.forEach(b),jt=R(et),Ze=y(et,"DIV",{class:!0});var Pt=S(Ze);Re=y(Pt,"BUTTON",{class:!0});var Xt=S(Re);Ut=me(Xt,"Cancel"),Xt.forEach(b),At=R(Pt),xe=y(Pt,"BUTTON",{class:!0});var Jt=S(xe);mt=me(Jt,dt),Jt.forEach(b),Pt.forEach(b),et.forEach(b),de.forEach(b),this.h()},h(){n(o,"class","svelte-s7zu5d"),n(c,"d","M12 4L4 12M4 4L12 12"),n(c,"stroke","currentColor"),n(c,"stroke-width","1.5"),n(c,"stroke-linecap","round"),n(c,"stroke-linejoin","round"),n(v,"width","16"),n(v,"height","16"),n(v,"viewBox","0 0 16 16"),n(v,"fill","none"),n(v,"xmlns","http://www.w3.org/2000/svg"),n(p,"class","close-button svelte-s7zu5d"),p.disabled=s[13],n(p,"title","Close"),n(r,"class","export-dialog-header svelte-s7zu5d"),n(u,"class","export-label svelte-s7zu5d"),n(M,"type","radio"),M.__value="custom",Le(M,M.__value),M.disabled=s[13],n(M,"class","svelte-s7zu5d"),n(W,"class","option-content svelte-s7zu5d"),n(m,"class","export-option svelte-s7zu5d"),n(w,"class","export-options svelte-s7zu5d"),n(d,"class","export-section svelte-s7zu5d"),n(N,"class","export-label svelte-s7zu5d"),n(Z,"type","radio"),Z.__value="wav",Le(Z,Z.__value),Z.disabled=s[13],n(Z,"class","svelte-s7zu5d"),n(F,"class","format-option svelte-s7zu5d"),n(U,"type","radio"),U.__value="mp3",Le(U,U.__value),U.disabled=s[13],n(U,"class","svelte-s7zu5d"),n(j,"class","format-option svelte-s7zu5d"),n(q,"type","radio"),q.__value="ogg",Le(q,q.__value),q.disabled=s[13],n(q,"class","svelte-s7zu5d"),n(D,"class","format-option svelte-s7zu5d"),n(H,"class","format-selector svelte-s7zu5d"),n(H,"role","radiogroup"),n(H,"aria-label","Export format"),n(G,"class","export-section svelte-s7zu5d"),n(B,"class","export-label svelte-s7zu5d"),n(B,"for","filename-input"),n(te,"id","filename-input"),n(te,"type","text"),n(te,"placeholder","export.wav"),te.disabled=s[13],n(te,"class","filename-input svelte-s7zu5d"),n(fe,"class","export-section svelte-s7zu5d"),n(J,"class","info-label svelte-s7zu5d"),n(Pe,"class","info-value svelte-s7zu5d"),n(Me,"class","info-item svelte-s7zu5d"),n(Ne,"class","info-label svelte-s7zu5d"),n(Je,"class","info-value svelte-s7zu5d"),n(Ve,"class","info-item svelte-s7zu5d"),n(Ye,"class","info-label svelte-s7zu5d"),n($e,"class","info-value svelte-s7zu5d"),n(Ge,"class","info-item svelte-s7zu5d"),n(Ie,"class","export-info svelte-s7zu5d"),n(ze,"class","export-section svelte-s7zu5d"),n(h,"class","export-dialog-content svelte-s7zu5d"),n(Re,"class","export-button-cancel svelte-s7zu5d"),Re.disabled=s[13],n(xe,"class","export-button-submit svelte-s7zu5d"),xe.disabled=vt=s[13]||!s[5].trim(),n(Ze,"class","export-dialog-footer svelte-s7zu5d"),n(e,"class","export-dialog svelte-s7zu5d"),n(e,"role","dialog"),n(e,"aria-modal","true"),n(e,"aria-label","Export audio dialog"),n(t,"class","export-dialog-overlay svelte-s7zu5d"),n(t,"role","presentation"),Rt.p(Z,U,q),xt.p(M)},m($,de){pe($,t,de),i(t,e),i(e,r),i(r,o),i(r,l),i(r,p),i(p,v),i(v,c),i(e,f),i(e,h),_e&&_e.m(h,null),i(h,C),i(h,d),i(d,u),i(d,k),i(d,w),ke&&ke.m(w,null),i(w,g),i(w,m),i(m,M),M.checked=M.__value===s[1],i(m,L),i(m,W),i(h,A),Te&&Te.m(h,null),i(h,O),i(h,G),i(G,N),i(G,Q),i(G,H),i(H,F),i(F,Z),Z.checked=Z.__value===s[2],i(F,re),i(F,K),i(H,oe),i(H,j),i(j,U),U.checked=U.__value===s[2],i(j,se),i(j,z),i(H,P),i(H,D),i(D,q),q.checked=q.__value===s[2],i(D,ge),i(D,ee),i(h,ce),i(h,fe),i(fe,B),i(fe,be),i(fe,te),Le(te,s[5]),i(h,Ae),i(h,ze),i(ze,Ie),i(Ie,Me),i(Me,J),i(Me,Ce),i(Me,Pe),i(Pe,Ee),i(Ie,Xe),i(Ie,Ve),i(Ve,Ne),i(Ve,je),i(Ve,Je),i(Je,pt),i(Ie,Vt),i(Ie,Ge),i(Ge,Ye),i(Ge,Dt),i(Ge,$e),i($e,ht),i(h,Nt),ye&&ye.m(h,null),i(e,jt),i(e,Ze),i(Ze,Re),i(Re,Ut),i(Ze,At),i(Ze,xe),i(xe,mt),Ot||(Ft=[X(p,"click",s[21]),X(M,"change",s[31]),X(Z,"change",s[42]),X(U,"change",s[43]),X(q,"change",s[44]),X(te,"input",s[45]),X(Re,"click",s[21]),X(xe,"click",s[20]),X(e,"click",In(s[28])),X(t,"click",s[21]),X(t,"keydown",s[46])],Ot=!0)},p($,de){de[0]&8192&&(p.disabled=$[13]),$[15]?_e?_e.p($,de):(_e=on($),_e.c(),_e.m(h,C)):_e&&(_e.d(1),_e=null),$[17]?ke?ke.p($,de):(ke=ln($),ke.c(),ke.m(w,g)):ke&&(ke.d(1),ke=null),de[0]&8192&&(M.disabled=$[13]),de[0]&2&&(M.checked=M.__value===$[1]),$[1]==="custom"?Te?Te.p($,de):(Te=an($),Te.c(),Te.m(h,O)):Te&&(Te.d(1),Te=null),de[0]&8192&&(Z.disabled=$[13]),de[0]&4&&(Z.checked=Z.__value===$[2]),de[0]&8192&&(U.disabled=$[13]),de[0]&4&&(U.checked=U.__value===$[2]),de[0]&8192&&(q.disabled=$[13]),de[0]&4&&(q.checked=q.__value===$[2]),de[0]&8192&&(te.disabled=$[13]),de[0]&32&&te.value!==$[5]&&Le(te,$[5]),de[0]&65536&&De(Ee,$[16]),de[0]&1024&&De(pt,$[10]),de[0]&4&&ct!==(ct=$[2]==="wav"?"WAV (44.1kHz, 16-bit)":$[2]==="mp3"?"MP3":$[2]==="ogg"?"OGG Vorbis":"WAV")&&De(ht,ct),$[13]?ye?ye.p($,de):(ye=un($),ye.c(),ye.m(h,null)):ye&&(ye.d(1),ye=null),de[0]&8192&&(Re.disabled=$[13]),de[0]&8192&&dt!==(dt=$[13]?"Exporting...":"Export")&&De(mt,dt),de[0]&8224&&vt!==(vt=$[13]||!$[5].trim())&&(xe.disabled=vt)},d($){$&&b(t),_e&&_e.d(),ke&&ke.d(),Te&&Te.d(),ye&&ye.d(),Rt.r(),xt.r(),Ot=!1,Ue(Ft)}}}function on(s){let t,e,r,o,a,l,p;return{c(){t=I("div"),e=ue("svg"),r=ue("path"),o=ue("circle"),a=x(),l=I("span"),p=ve(s[15]),this.h()},l(v){t=y(v,"DIV",{class:!0});var c=S(t);e=ie(c,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0,class:!0});var f=S(e);r=ie(f,"path",{d:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),S(r).forEach(b),o=ie(f,"circle",{cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),S(o).forEach(b),f.forEach(b),a=R(c),l=y(c,"SPAN",{});var h=S(l);p=me(h,s[15]),h.forEach(b),c.forEach(b),this.h()},h(){n(r,"d","M8 4V8M8 12H8.01"),n(r,"stroke","currentColor"),n(r,"stroke-width","1.5"),n(r,"stroke-linecap","round"),n(r,"stroke-linejoin","round"),n(o,"cx","8"),n(o,"cy","8"),n(o,"r","7"),n(o,"stroke","currentColor"),n(o,"stroke-width","1.5"),n(e,"width","16"),n(e,"height","16"),n(e,"viewBox","0 0 16 16"),n(e,"fill","none"),n(e,"xmlns","http://www.w3.org/2000/svg"),n(e,"class","svelte-s7zu5d"),n(t,"class","export-error svelte-s7zu5d")},m(v,c){pe(v,t,c),i(t,e),i(e,r),i(e,o),i(t,a),i(t,l),i(l,p)},p(v,c){c[0]&32768&&De(p,v[15])},d(v){v&&b(t)}}}function ln(s){let t,e,r,o,a,l="Full Timeline",p,v,c,f,h,C,d,u,_;return d=Ht(s[30][1]),{c(){t=I("label"),e=I("input"),r=x(),o=I("div"),a=I("span"),a.textContent=l,p=x(),v=I("span"),c=ve(s[9]),f=ve(" beats ("),h=ve(s[16]),C=ve(")"),this.h()},l(k){t=y(k,"LABEL",{class:!0});var w=S(t);e=y(w,"INPUT",{type:!0,class:!0}),r=R(w),o=y(w,"DIV",{class:!0});var g=S(o);a=y(g,"SPAN",{class:!0,"data-svelte-h":!0}),le(a)!=="svelte-2lbufr"&&(a.textContent=l),p=R(g),v=y(g,"SPAN",{class:!0});var m=S(v);c=me(m,s[9]),f=me(m," beats ("),h=me(m,s[16]),C=me(m,")"),m.forEach(b),g.forEach(b),w.forEach(b),this.h()},h(){n(e,"type","radio"),e.__value="full",Le(e,e.__value),e.disabled=s[13],n(e,"class","svelte-s7zu5d"),n(a,"class","option-title svelte-s7zu5d"),n(v,"class","option-description svelte-s7zu5d"),n(o,"class","option-content svelte-s7zu5d"),n(t,"class","export-option svelte-s7zu5d"),d.p(e)},m(k,w){pe(k,t,w),i(t,e),e.checked=e.__value===s[1],i(t,r),i(t,o),i(o,a),i(o,p),i(o,v),i(v,c),i(v,f),i(v,h),i(v,C),u||(_=X(e,"change",s[29]),u=!0)},p(k,w){w[0]&8192&&(e.disabled=k[13]),w[0]&2&&(e.checked=e.__value===k[1]),w[0]&512&&De(c,k[9]),w[0]&65536&&De(h,k[16])},d(k){k&&b(t),d.r(),u=!1,_()}}}function an(s){let t,e,r="Custom Range (beats)",o,a,l,p,v="Start",c,f,h,C,d,u,_,k,w,g,m,M,L,W,V,A,O="End",G,N,T,Q,H,F,Z,re,K,ne,oe,j,U,se,z,E,P,D=s[11].toFixed(2)+"",q,ge,ee,he,ce,fe;return{c(){t=I("div"),e=I("div"),e.textContent=r,o=x(),a=I("div"),l=I("div"),p=I("label"),p.textContent=v,c=x(),f=I("div"),h=I("input"),d=x(),u=I("div"),_=I("button"),k=ue("svg"),w=ue("path"),g=x(),m=I("button"),M=ue("svg"),L=ue("path"),W=x(),V=I("div"),A=I("label"),A.textContent=O,G=x(),N=I("div"),T=I("input"),F=x(),Z=I("div"),re=I("button"),K=ue("svg"),ne=ue("path"),oe=x(),j=I("button"),U=ue("svg"),se=ue("path"),z=x(),E=I("div"),P=ve("Duration: "),q=ve(D),ge=ve(" beats ("),ee=ve(s[16]),he=ve(")"),this.h()},l(B){t=y(B,"DIV",{class:!0});var Y=S(t);e=y(Y,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-76utfc"&&(e.textContent=r),o=R(Y),a=y(Y,"DIV",{class:!0});var be=S(a);l=y(be,"DIV",{class:!0});var te=S(l);p=y(te,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),le(p)!=="svelte-hpz28l"&&(p.textContent=v),c=R(te),f=y(te,"DIV",{class:!0});var Ae=S(f);h=y(Ae,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0,class:!0}),d=R(Ae),u=y(Ae,"DIV",{class:!0});var ze=S(u);_=y(ze,"BUTTON",{type:!0,class:!0,title:!0});var Ie=S(_);k=ie(Ie,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0,class:!0});var Me=S(k);w=ie(Me,"path",{d:!0,fill:!0}),S(w).forEach(b),Me.forEach(b),Ie.forEach(b),g=R(ze),m=y(ze,"BUTTON",{type:!0,class:!0,title:!0});var J=S(m);M=ie(J,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0,class:!0});var Se=S(M);L=ie(Se,"path",{d:!0,fill:!0}),S(L).forEach(b),Se.forEach(b),J.forEach(b),ze.forEach(b),Ae.forEach(b),te.forEach(b),W=R(be),V=y(be,"DIV",{class:!0});var Ce=S(V);A=y(Ce,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),le(A)!=="svelte-1xoa7t9"&&(A.textContent=O),G=R(Ce),N=y(Ce,"DIV",{class:!0});var Pe=S(N);T=y(Pe,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0,class:!0}),F=R(Pe),Z=y(Pe,"DIV",{class:!0});var Ee=S(Z);re=y(Ee,"BUTTON",{type:!0,class:!0,title:!0});var Xe=S(re);K=ie(Xe,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0,class:!0});var Ve=S(K);ne=ie(Ve,"path",{d:!0,fill:!0}),S(ne).forEach(b),Ve.forEach(b),Xe.forEach(b),oe=R(Ee),j=y(Ee,"BUTTON",{type:!0,class:!0,title:!0});var Ne=S(j);U=ie(Ne,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0,class:!0});var ut=S(U);se=ie(ut,"path",{d:!0,fill:!0}),S(se).forEach(b),ut.forEach(b),Ne.forEach(b),Ee.forEach(b),Pe.forEach(b),Ce.forEach(b),be.forEach(b),z=R(Y),E=y(Y,"DIV",{class:!0});var je=S(E);P=me(je,"Duration: "),q=me(je,D),ge=me(je," beats ("),ee=me(je,s[16]),he=me(je,")"),je.forEach(b),Y.forEach(b),this.h()},h(){n(e,"class","export-label svelte-s7zu5d"),n(p,"for","custom-start-beat"),n(p,"class","svelte-s7zu5d"),n(h,"id","custom-start-beat"),n(h,"type","number"),n(h,"min","0"),n(h,"max",C=s[9]>0?s[9]-.25:void 0),n(h,"step","0.25"),h.disabled=s[13],n(h,"class","range-number-input svelte-s7zu5d"),n(w,"d","M5 2L8 6H2L5 2Z"),n(w,"fill","currentColor"),n(k,"width","10"),n(k,"height","10"),n(k,"viewBox","0 0 10 10"),n(k,"fill","none"),n(k,"xmlns","http://www.w3.org/2000/svg"),n(k,"class","svelte-s7zu5d"),n(_,"type","button"),n(_,"class","arrow-button arrow-up svelte-s7zu5d"),_.disabled=s[13],n(_,"title","Increase start beat"),n(L,"d","M5 8L2 4H8L5 8Z"),n(L,"fill","currentColor"),n(M,"width","10"),n(M,"height","10"),n(M,"viewBox","0 0 10 10"),n(M,"fill","none"),n(M,"xmlns","http://www.w3.org/2000/svg"),n(M,"class","svelte-s7zu5d"),n(m,"type","button"),n(m,"class","arrow-button arrow-down svelte-s7zu5d"),m.disabled=s[13],n(m,"title","Decrease start beat"),n(u,"class","number-input-arrows svelte-s7zu5d"),n(f,"class","number-input-wrapper svelte-s7zu5d"),n(l,"class","range-input-group svelte-s7zu5d"),n(A,"for","custom-end-beat"),n(A,"class","svelte-s7zu5d"),n(T,"id","custom-end-beat"),n(T,"type","number"),n(T,"min",Q=s[3]+.25),n(T,"max",H=s[9]>0?s[9]:void 0),n(T,"step","0.25"),T.disabled=s[13],n(T,"class","range-number-input svelte-s7zu5d"),n(ne,"d","M5 2L8 6H2L5 2Z"),n(ne,"fill","currentColor"),n(K,"width","10"),n(K,"height","10"),n(K,"viewBox","0 0 10 10"),n(K,"fill","none"),n(K,"xmlns","http://www.w3.org/2000/svg"),n(K,"class","svelte-s7zu5d"),n(re,"type","button"),n(re,"class","arrow-button arrow-up svelte-s7zu5d"),re.disabled=s[13],n(re,"title","Increase end beat"),n(se,"d","M5 8L2 4H8L5 8Z"),n(se,"fill","currentColor"),n(U,"width","10"),n(U,"height","10"),n(U,"viewBox","0 0 10 10"),n(U,"fill","none"),n(U,"xmlns","http://www.w3.org/2000/svg"),n(U,"class","svelte-s7zu5d"),n(j,"type","button"),n(j,"class","arrow-button arrow-down svelte-s7zu5d"),j.disabled=s[13],n(j,"title","Decrease end beat"),n(Z,"class","number-input-arrows svelte-s7zu5d"),n(N,"class","number-input-wrapper svelte-s7zu5d"),n(V,"class","range-input-group svelte-s7zu5d"),n(a,"class","custom-range-inputs svelte-s7zu5d"),n(E,"class","range-info svelte-s7zu5d"),n(t,"class","export-section svelte-s7zu5d")},m(B,Y){pe(B,t,Y),i(t,e),i(t,o),i(t,a),i(a,l),i(l,p),i(l,c),i(l,f),i(f,h),Le(h,s[3]),i(f,d),i(f,u),i(u,_),i(_,k),i(k,w),i(u,g),i(u,m),i(m,M),i(M,L),i(a,W),i(a,V),i(V,A),i(V,G),i(V,N),i(N,T),Le(T,s[4]),i(N,F),i(N,Z),i(Z,re),i(re,K),i(K,ne),i(Z,oe),i(Z,j),i(j,U),i(U,se),i(t,z),i(t,E),i(E,P),i(E,q),i(E,ge),i(E,ee),i(E,he),ce||(fe=[X(h,"input",s[32]),X(h,"focus",s[33]),X(h,"blur",s[34]),X(_,"click",s[35]),X(m,"click",s[36]),X(T,"input",s[37]),X(T,"focus",s[38]),X(T,"blur",s[39]),X(re,"click",s[40]),X(j,"click",s[41])],ce=!0)},p(B,Y){Y[0]&512&&C!==(C=B[9]>0?B[9]-.25:void 0)&&n(h,"max",C),Y[0]&8192&&(h.disabled=B[13]),Y[0]&8&&rt(h.value)!==B[3]&&Le(h,B[3]),Y[0]&8192&&(_.disabled=B[13]),Y[0]&8192&&(m.disabled=B[13]),Y[0]&8&&Q!==(Q=B[3]+.25)&&n(T,"min",Q),Y[0]&512&&H!==(H=B[9]>0?B[9]:void 0)&&n(T,"max",H),Y[0]&8192&&(T.disabled=B[13]),Y[0]&16&&rt(T.value)!==B[4]&&Le(T,B[4]),Y[0]&8192&&(re.disabled=B[13]),Y[0]&8192&&(j.disabled=B[13]),Y[0]&2048&&D!==(D=B[11].toFixed(2)+"")&&De(q,D),Y[0]&65536&&De(ee,B[16])},d(B){B&&b(t),ce=!1,Ue(fe)}}}function un(s){let t,e,r,o,a,l,p=Math.round(s[14]*100)+"",v,c;return{c(){t=I("div"),e=I("div"),r=I("div"),o=x(),a=I("div"),l=ve("Exporting... "),v=ve(p),c=ve("%"),this.h()},l(f){t=y(f,"DIV",{class:!0});var h=S(t);e=y(h,"DIV",{class:!0});var C=S(e);r=y(C,"DIV",{class:!0,style:!0}),S(r).forEach(b),C.forEach(b),o=R(h),a=y(h,"DIV",{class:!0});var d=S(a);l=me(d,"Exporting... "),v=me(d,p),c=me(d,"%"),d.forEach(b),h.forEach(b),this.h()},h(){n(r,"class","export-progress-fill svelte-s7zu5d"),$t(r,"width",s[14]*100+"%"),n(e,"class","export-progress-bar svelte-s7zu5d"),n(a,"class","export-progress-text svelte-s7zu5d"),n(t,"class","export-progress-section svelte-s7zu5d")},m(f,h){pe(f,t,h),i(t,e),i(e,r),i(t,o),i(t,a),i(a,l),i(a,v),i(a,c)},p(f,h){h[0]&16384&&$t(r,"width",f[14]*100+"%"),h[0]&16384&&p!==(p=Math.round(f[14]*100)+"")&&De(v,p)},d(f){f&&b(t)}}}function xn(s){let t,e=s[0]&&rn(s);return{c(){e&&e.c(),t=zt()},l(r){e&&e.l(r),t=zt()},m(r,o){e&&e.m(r,o),pe(r,t,o)},p(r,o){r[0]?e?e.p(r,o):(e=rn(r),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:we,o:we,d(r){r&&b(t),e&&e.d(r)}}}function On(s,t,e){let r,o,a,l,p,v,c,f,h,{isOpen:C=!1}=t,{onClose:d}=t,u;ae.subscribe(B=>e(23,u=B));let _=a?"full":"custom",k="wav",w=0,g=16,m="",M=!1,L=!1,W=!1,V=!1;function A(B){const Y=l>0?Math.min(l-.25,g-.25):g-.25;return Math.max(0,Math.min(B,Y))}function O(B){const Y=l>0?l:1/0;return Math.max(w+.25,Math.min(B,Y))}let G=!1,N=0,T=null;async function Q(){if(!u||!u.standaloneInstruments||u.standaloneInstruments.length===0){e(15,T="No project to export");return}if(!G){e(13,G=!0),e(14,N=0),e(15,T=null);try{let B,Y=null;if(_==="full")B=l,Y=o;else if(_==="custom")if(o){const Me={...o,tracks:(o==null?void 0:o.tracks)||[],clips:((o==null?void 0:o.clips)||[]).filter(J=>J.startBeat+J.duration>w&&J.startBeat<g).map(J=>{const Se=Math.max(0,J.startBeat-w),Ce=Math.max(w,J.startBeat),Ee=Math.min(g,J.startBeat+J.duration)-Ce;return{...J,startBeat:Se,duration:Math.max(0,Ee)}}),effects:((o==null?void 0:o.effects)||[]).filter(J=>J.startBeat+J.duration>w&&J.startBeat<g).map(J=>{const Se=Math.max(0,J.startBeat-w),Ce=Math.max(w,J.startBeat),Ee=Math.min(g,J.startBeat+J.duration)-Ce;return{...J,startBeat:Se,duration:Math.max(0,Ee)}}),envelopes:((o==null?void 0:o.envelopes)||[]).filter(J=>J.startBeat+J.duration>w&&J.startBeat<g).map(J=>{const Se=Math.max(0,J.startBeat-w),Ce=Math.max(w,J.startBeat),Ee=Math.min(g,J.startBeat+J.duration)-Ce;return{...J,startBeat:Se,duration:Math.max(0,Ee)}}),totalLength:g-w};B=g-w,Y=Me}else B=g-w,Y=null;else B=patternLength,Y=null;const be=Me=>{e(14,N=Me)},te=await jn(u.standaloneInstruments,r,u.baseMeterTrackId,B,be,Y,u.patterns,u.effects,u.envelopes,u.automation),Ie=`${m.replace(/\.(wav|ogg|mp3)$/i,"")}.${k==="wav"?"wav":k==="mp3"?"mp3":k==="ogg"?"ogg":"wav"}`;await Rn(te,Ie,k),setTimeout(()=>{d(),e(13,G=!1),e(14,N=0)},500)}catch(B){console.error("Export failed:",B),e(15,T=B instanceof Error?B.message:String(B)),e(13,G=!1)}}}function H(){G||d()}const F=[[],[]];function Z(B){Mn.call(this,s,B)}function re(){_=this.__value,e(1,_)}function K(){_=this.__value,e(1,_)}function ne(){w=rt(this.value),e(3,w)}const oe=()=>{e(7,W=!0),e(12,M=!0)},j=()=>{e(7,W=!1),e(3,w=A(w)),g<=w&&(e(4,g=w+.25),e(6,L=!0))},U=()=>{e(12,M=!0);const B=Math.min(l>0?l-.25:1/0,g-.25,w+.25);e(3,w=A(B))},se=()=>{e(12,M=!0);const B=Math.max(0,w-.25);e(3,w=A(B))};function z(){g=rt(this.value),e(4,g),e(24,o),e(9,l),e(8,V),e(6,L),e(1,_),e(7,W),e(23,u)}const E=()=>{e(8,V=!0),e(6,L=!0)},P=()=>{e(8,V=!1),e(4,g=O(g))},D=()=>{e(6,L=!0);const B=l>0?l:1/0,Y=Math.min(B,g+.25);e(4,g=O(Y))},q=()=>{e(6,L=!0);const B=Math.max(w+.25,g-.25);e(4,g=O(B))};function ge(){k=this.__value,e(2,k)}function ee(){k=this.__value,e(2,k)}function he(){k=this.__value,e(2,k)}function ce(){m=this.value,e(5,m),e(23,u),e(2,k)}const fe=B=>{B.key==="Escape"&&(B.preventDefault(),H())};return s.$$set=B=>{"isOpen"in B&&e(0,C=B.isOpen),"onClose"in B&&e(22,d=B.onClose)},s.$$.update=()=>{if(s.$$.dirty[0]&8388608&&e(10,r=(u==null?void 0:u.bpm)??120),s.$$.dirty[0]&8388608&&e(24,o=u==null?void 0:u.timeline),s.$$.dirty[0]&16777216&&e(17,a=o&&o.clips&&o.clips.length>0),s.$$.dirty[0]&16777216&&e(9,l=(o==null?void 0:o.totalLength)||16),s.$$.dirty[0]&16778064&&o&&l>0&&!V&&!L&&(g>l||g===16)&&e(4,g=l),s.$$.dirty[0]&16778194&&_==="custom"&&o&&!V&&!W&&!L&&g<l&&g===16&&e(4,g=l),s.$$.dirty[0]&538&&e(11,p=_==="full"?l:g-w),s.$$.dirty[0]&3072&&e(27,v=p*60/r),s.$$.dirty[0]&134217728&&e(26,c=Math.floor(v/60)),s.$$.dirty[0]&134217728&&e(25,f=Math.floor(v%60)),s.$$.dirty[0]&234881024&&e(16,h=v<60?`${v.toFixed(1)}s`:`${c}:${f.toString().padStart(2,"0")}`),s.$$.dirty[0]&8388644&&!m&&u){const B=u.name||"untitled";e(5,m=`${B}-${new Date().toISOString().slice(0,10).replace(/-/g,"")}.${k==="wav"?"wav":k==="mp3"?"mp3":k==="ogg"?"ogg":"wav"}`)}if(s.$$.dirty[0]&8388644&&m&&u){const B=m.replace(/\.(wav|ogg|mp3)$/i,""),Y=k==="wav"?"wav":k==="mp3"?"mp3":k==="ogg"?"ogg":"wav";m.endsWith(`.${Y}`)||e(5,m=`${B}.${Y}`)}},[C,_,k,w,g,m,L,W,V,l,r,p,M,G,N,T,h,a,A,O,Q,H,d,u,o,f,c,v,Z,re,F,K,ne,oe,j,U,se,z,E,P,D,q,ge,ee,he,ce,fe]}class Hn extends He{constructor(t){super(),We(this,t,On,xn,Fe,{isOpen:0,onClose:22},null,[-1,-1])}}function cn(s){var o,a;const t=s.slice(),e=window.location.pathname.match(/\/project\/[^/]+\/pattern\/([^/]+)/);t[38]=e;const r=t[38]?(a=(o=t[2])==null?void 0:o.patterns)==null?void 0:a.find(function(...p){return s[30](t[38],...p)}):null;return t[39]=r,t}function dn(s){let t,e,r="BPM",o,a,l,p,v,c,f='<svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-1w9eo4a"><path d="M5 2L8 6H2L5 2Z" fill="currentColor"></path></svg>',h,C,d='<svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-1w9eo4a"><path d="M5 8L2 4H8L5 8Z" fill="currentColor"></path></svg>',u,_;return{c(){t=I("div"),e=I("label"),e.textContent=r,o=x(),a=I("div"),l=I("input"),p=x(),v=I("div"),c=I("button"),c.innerHTML=f,h=x(),C=I("button"),C.innerHTML=d,this.h()},l(k){t=y(k,"DIV",{class:!0});var w=S(t);e=y(w,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),le(e)!=="svelte-mchvk7"&&(e.textContent=r),o=R(w),a=y(w,"DIV",{class:!0});var g=S(a);l=y(g,"INPUT",{id:!0,type:!0,min:!0,max:!0,class:!0}),p=R(g),v=y(g,"DIV",{class:!0});var m=S(v);c=y(m,"BUTTON",{type:!0,class:!0,title:!0,"data-svelte-h":!0}),le(c)!=="svelte-16uvtlc"&&(c.innerHTML=f),h=R(m),C=y(m,"BUTTON",{type:!0,class:!0,title:!0,"data-svelte-h":!0}),le(C)!=="svelte-rlu3hy"&&(C.innerHTML=d),m.forEach(b),g.forEach(b),w.forEach(b),this.h()},h(){n(e,"for","bpm-input"),n(e,"class","svelte-1w9eo4a"),n(l,"id","bpm-input"),n(l,"type","number"),n(l,"min","20"),n(l,"max","500"),n(l,"class","svelte-1w9eo4a"),n(c,"type","button"),n(c,"class","arrow-button arrow-up svelte-1w9eo4a"),n(c,"title","Increase BPM"),n(C,"type","button"),n(C,"class","arrow-button arrow-down svelte-1w9eo4a"),n(C,"title","Decrease BPM"),n(v,"class","number-input-arrows svelte-1w9eo4a"),n(a,"class","number-input-wrapper svelte-1w9eo4a"),n(t,"class","bpm-control svelte-1w9eo4a")},m(k,w){pe(k,t,w),i(t,e),i(t,o),i(t,a),i(a,l),Le(l,s[5]),i(a,p),i(a,v),i(v,c),i(v,h),i(v,C),u||(_=[X(l,"input",s[26]),X(l,"input",s[27]),X(c,"click",s[28]),X(C,"click",s[29])],u=!0)},p(k,w){w[0]&32&&rt(l.value)!==k[5]&&Le(l,k[5])},d(k){k&&b(t),u=!1,Ue(_)}}}function Wn(s){let t,e=s[39]&&fn(s);return{c(){e&&e.c(),t=zt()},l(r){e&&e.l(r),t=zt()},m(r,o){e&&e.m(r,o),pe(r,t,o)},p(r,o){r[39]?e?e.p(r,o):(e=fn(r),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},d(r){r&&b(t),e&&e.d(r)}}}function fn(s){let t,e,r="Base Meter",o,a,l,p,v,c,f,h='<svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-1w9eo4a"><path d="M5 2L8 6H2L5 2Z" fill="currentColor"></path></svg>',C,d,u='<svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-1w9eo4a"><path d="M5 8L2 4H8L5 8Z" fill="currentColor"></path></svg>',_,k;function w(...M){return s[31](s[39],...M)}function g(){return s[32](s[39])}function m(){return s[33](s[39])}return{c(){t=I("div"),e=I("label"),e.textContent=r,o=x(),a=I("div"),l=I("input"),v=x(),c=I("div"),f=I("button"),f.innerHTML=h,C=x(),d=I("button"),d.innerHTML=u,this.h()},l(M){t=y(M,"DIV",{class:!0});var L=S(t);e=y(L,"LABEL",{for:!0,class:!0,"data-svelte-h":!0}),le(e)!=="svelte-1h9e1ga"&&(e.textContent=r),o=R(L),a=y(L,"DIV",{class:!0});var W=S(a);l=y(W,"INPUT",{id:!0,type:!0,min:!0,max:!0,title:!0,class:!0}),v=R(W),c=y(W,"DIV",{class:!0});var V=S(c);f=y(V,"BUTTON",{type:!0,class:!0,title:!0,"data-svelte-h":!0}),le(f)!=="svelte-d78la5"&&(f.innerHTML=h),C=R(V),d=y(V,"BUTTON",{type:!0,class:!0,title:!0,"data-svelte-h":!0}),le(d)!=="svelte-1fcg3su"&&(d.innerHTML=u),V.forEach(b),W.forEach(b),L.forEach(b),this.h()},h(){n(e,"for","base-meter-input"),n(e,"class","svelte-1w9eo4a"),n(l,"id","base-meter-input"),n(l,"type","number"),l.value=p=s[39].baseMeter||4,n(l,"min","1"),n(l,"max","32"),n(l,"title","Base meter (denominator X in Y/X time signature). Root node division (Y) is independent."),n(l,"class","svelte-1w9eo4a"),n(f,"type","button"),n(f,"class","arrow-button arrow-up svelte-1w9eo4a"),n(f,"title","Increase Base Meter"),n(d,"type","button"),n(d,"class","arrow-button arrow-down svelte-1w9eo4a"),n(d,"title","Decrease Base Meter"),n(c,"class","number-input-arrows svelte-1w9eo4a"),n(a,"class","number-input-wrapper svelte-1w9eo4a"),n(t,"class","base-meter-control svelte-1w9eo4a")},m(M,L){pe(M,t,L),i(t,e),i(t,o),i(t,a),i(a,l),i(a,v),i(a,c),i(c,f),i(c,C),i(c,d),_||(k=[X(l,"change",w),X(f,"click",g),X(d,"click",m)],_=!0)},p(M,L){s=M,L[0]&4&&p!==(p=s[39].baseMeter||4)&&l.value!==p&&(l.value=p)},d(M){M&&b(t),_=!1,Ue(k)}}}function pn(s){let t,e,r,o,a,l,p,v,c,f,h,C;return{c(){t=I("div"),e=I("button"),r=ve("M"),l=x(),p=I("button"),v=ve("S"),this.h()},l(d){t=y(d,"DIV",{class:!0});var u=S(t);e=y(u,"BUTTON",{class:!0,title:!0});var _=S(e);r=me(_,"M"),_.forEach(b),l=R(u),p=y(u,"BUTTON",{class:!0,title:!0});var k=S(p);v=me(k,"S"),k.forEach(b),u.forEach(b),this.h()},h(){n(e,"class",o="track-mute "+(s[8]?"active":"")+" svelte-1w9eo4a"),n(e,"title",a=s[8]?"Unmute track":"Mute track"),n(p,"class",c="track-solo "+(s[9]?"active":"")+" svelte-1w9eo4a"),n(p,"title",f=s[9]?"Unsolo track":"Solo track"),n(t,"class","mute-solo-controls svelte-1w9eo4a")},m(d,u){pe(d,t,u),i(t,e),i(e,r),i(t,l),i(t,p),i(p,v),h||(C=[X(e,"click",s[15]),X(p,"click",s[16])],h=!0)},p(d,u){u[0]&256&&o!==(o="track-mute "+(d[8]?"active":"")+" svelte-1w9eo4a")&&n(e,"class",o),u[0]&256&&a!==(a=d[8]?"Unmute track":"Mute track")&&n(e,"title",a),u[0]&512&&c!==(c="track-solo "+(d[9]?"active":"")+" svelte-1w9eo4a")&&n(p,"class",c),u[0]&512&&f!==(f=d[9]?"Unsolo track":"Solo track")&&n(p,"title",f)},d(d){d&&b(t),h=!1,Ue(C)}}}function Fn(s){let t,e;return{c(){t=ue("svg"),e=ue("path"),this.h()},l(r){t=ie(r,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0,class:!0});var o=S(t);e=ie(o,"path",{d:!0,fill:!0}),S(e).forEach(b),o.forEach(b),this.h()},h(){n(e,"d","M5 3L13 8L5 13V3Z"),n(e,"fill","currentColor"),n(t,"width","16"),n(t,"height","16"),n(t,"viewBox","0 0 16 16"),n(t,"fill","none"),n(t,"xmlns","http://www.w3.org/2000/svg"),n(t,"class","svelte-1w9eo4a")},m(r,o){pe(r,t,o),i(t,e)},d(r){r&&b(t)}}}function Gn(s){let t,e,r;return{c(){t=ue("svg"),e=ue("rect"),r=ue("rect"),this.h()},l(o){t=ie(o,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0,class:!0});var a=S(t);e=ie(a,"rect",{x:!0,y:!0,width:!0,height:!0,fill:!0}),S(e).forEach(b),r=ie(a,"rect",{x:!0,y:!0,width:!0,height:!0,fill:!0}),S(r).forEach(b),a.forEach(b),this.h()},h(){n(e,"x","5"),n(e,"y","3"),n(e,"width","2"),n(e,"height","10"),n(e,"fill","currentColor"),n(r,"x","9"),n(r,"y","3"),n(r,"width","2"),n(r,"height","10"),n(r,"fill","currentColor"),n(t,"width","16"),n(t,"height","16"),n(t,"viewBox","0 0 16 16"),n(t,"fill","none"),n(t,"xmlns","http://www.w3.org/2000/svg"),n(t,"class","svelte-1w9eo4a")},m(o,a){pe(o,t,a),i(t,e),i(t,r)},d(o){o&&b(t)}}}function hn(s){let t,e,r,o,a,l,p,v,c,f,h,C,d,u;return{c(){t=I("div"),e=I("button"),r=ue("svg"),o=ue("path"),a=ue("path"),p=x(),v=I("button"),c=ue("svg"),f=ue("path"),h=ue("path"),this.h()},l(_){t=y(_,"DIV",{class:!0});var k=S(t);e=y(k,"BUTTON",{class:!0,title:!0});var w=S(e);r=ie(w,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0,class:!0});var g=S(r);o=ie(g,"path",{d:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),S(o).forEach(b),a=ie(g,"path",{d:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),S(a).forEach(b),g.forEach(b),w.forEach(b),p=R(k),v=y(k,"BUTTON",{class:!0,title:!0});var m=S(v);c=ie(m,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0,class:!0});var M=S(c);f=ie(M,"path",{d:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),S(f).forEach(b),h=ie(M,"path",{d:!0,stroke:!0,"stroke-width":!0,"stroke-linecap":!0,"stroke-linejoin":!0}),S(h).forEach(b),M.forEach(b),m.forEach(b),k.forEach(b),this.h()},h(){n(o,"d","M2 8C2 10.2091 3.79086 12 6 12H12"),n(o,"stroke","currentColor"),n(o,"stroke-width","1.5"),n(o,"stroke-linecap","round"),n(o,"stroke-linejoin","round"),n(a,"d","M5 5L2 8L5 11"),n(a,"stroke","currentColor"),n(a,"stroke-width","1.5"),n(a,"stroke-linecap","round"),n(a,"stroke-linejoin","round"),n(r,"width","16"),n(r,"height","16"),n(r,"viewBox","0 0 16 16"),n(r,"fill","none"),n(r,"xmlns","http://www.w3.org/2000/svg"),n(r,"class","svelte-1w9eo4a"),n(e,"class","undo-button svelte-1w9eo4a"),e.disabled=l=!s[6],n(e,"title","Undo (Ctrl+Z)"),n(f,"d","M14 8C14 5.79086 12.2091 4 10 4H4"),n(f,"stroke","currentColor"),n(f,"stroke-width","1.5"),n(f,"stroke-linecap","round"),n(f,"stroke-linejoin","round"),n(h,"d","M11 11L14 8L11 5"),n(h,"stroke","currentColor"),n(h,"stroke-width","1.5"),n(h,"stroke-linecap","round"),n(h,"stroke-linejoin","round"),n(c,"width","16"),n(c,"height","16"),n(c,"viewBox","0 0 16 16"),n(c,"fill","none"),n(c,"xmlns","http://www.w3.org/2000/svg"),n(c,"class","svelte-1w9eo4a"),n(v,"class","redo-button svelte-1w9eo4a"),v.disabled=C=!s[7],n(v,"title","Redo (Ctrl+Shift+Z or Ctrl+Y)"),n(t,"class","undo-redo-controls svelte-1w9eo4a")},m(_,k){pe(_,t,k),i(t,e),i(e,r),i(r,o),i(r,a),i(t,p),i(t,v),i(v,c),i(c,f),i(c,h),d||(u=[X(e,"click",s[13]),X(v,"click",s[14])],d=!0)},p(_,k){k[0]&64&&l!==(l=!_[6])&&(e.disabled=l),k[0]&128&&C!==(C=!_[7])&&(v.disabled=C)},d(_){_&&b(t),d=!1,Ue(u)}}}function mn(s){let t,e=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="svelte-1w9eo4a"><path d="M8 2V10M8 10L5 7M8 10L11 7" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M2 12V13C2 14.1046 2.89543 15 4 15H12C13.1046 15 14 14.1046 14 13V12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>
				Export`,r,o;return{c(){t=I("button"),t.innerHTML=e,this.h()},l(a){t=y(a,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(t)!=="svelte-opt4pr"&&(t.innerHTML=e),this.h()},h(){n(t,"class","export-button svelte-1w9eo4a"),n(t,"title","Export to WAV")},m(a,l){pe(a,t,l),r||(o=X(t,"click",s[17]),r=!0)},p:we,d(a){a&&b(t),r=!1,o()}}}function Zn(s){let t,e,r=s[11]==="arrangement"||typeof window<"u"&&window.location.pathname.match(/\/project\/[^/]+\/pattern\/([^/]+)/),o,a=typeof window<"u"&&window.location.pathname.match(/\/project\/[^/]+\/pattern\/([^/]+)/),l,p=typeof window<"u"&&window.location.pathname.match(/\/project\/[^/]+\/pattern\/([^/]+)/)&&s[3].isRoot&&s[4]&&s[3].selectedInstrumentId,v,c,f,h,C,d,u,_,k,w,g,m,M,L,W=s[11]==="arrangement"||typeof window<"u"&&window.location.pathname.match(/\/project\/[^/]+\/pattern\/([^/]+)/),V,A,O,G,N,T,Q=r&&dn(s),H=a&&Wn(cn(s)),F=p&&pn(s);function Z(j,U){return j[1]?Gn:Fn}let re=Z(s),K=re(s),ne=W&&hn(s),oe=s[11]==="arrangement"&&mn(s);return O=new Hn({props:{isOpen:s[10],onClose:s[18]}}),{c(){t=I("div"),e=I("div"),Q&&Q.c(),o=x(),H&&H.c(),l=x(),F&&F.c(),v=x(),c=I("div"),f=I("button"),h=ve("Arrangement"),d=x(),u=I("button"),K.c(),k=x(),w=I("button"),g=ve("Patterns"),M=x(),L=I("div"),ne&&ne.c(),V=x(),oe&&oe.c(),A=x(),it(O.$$.fragment),this.h()},l(j){t=y(j,"DIV",{class:!0});var U=S(t);e=y(U,"DIV",{class:!0});var se=S(e);Q&&Q.l(se),o=R(se),H&&H.l(se),l=R(se),F&&F.l(se),se.forEach(b),v=R(U),c=y(U,"DIV",{class:!0});var z=S(c);f=y(z,"BUTTON",{class:!0,title:!0});var E=S(f);h=me(E,"Arrangement"),E.forEach(b),d=R(z),u=y(z,"BUTTON",{class:!0,title:!0});var P=S(u);K.l(P),P.forEach(b),k=R(z),w=y(z,"BUTTON",{class:!0,title:!0});var D=S(w);g=me(D,"Patterns"),D.forEach(b),z.forEach(b),M=R(U),L=y(U,"DIV",{class:!0});var q=S(L);ne&&ne.l(q),V=R(q),oe&&oe.l(q),q.forEach(b),U.forEach(b),A=R(j),at(O.$$.fragment,j),this.h()},h(){n(e,"class","toolbar-left svelte-1w9eo4a"),n(f,"class",C="view-toggle "+(s[11]==="arrangement"?"active":"")+" svelte-1w9eo4a"),n(f,"title","Arrangement View"),n(u,"class","play-button svelte-1w9eo4a"),n(u,"title",_=s[1]?"Pause":"Play"),n(w,"class",m="view-toggle "+(s[11]==="pattern"?"active":"")+" svelte-1w9eo4a"),n(w,"title","Pattern View"),n(c,"class","toolbar-center svelte-1w9eo4a"),n(L,"class","toolbar-right svelte-1w9eo4a"),n(t,"class","toolbar svelte-1w9eo4a")},m(j,U){pe(j,t,U),i(t,e),Q&&Q.m(e,null),i(e,o),H&&H.m(e,null),i(e,l),F&&F.m(e,null),i(t,v),i(t,c),i(c,f),i(f,h),i(c,d),i(c,u),K.m(u,null),i(c,k),i(c,w),i(w,g),i(t,M),i(t,L),ne&&ne.m(L,null),i(L,V),oe&&oe.m(L,null),pe(j,A,U),lt(O,j,U),G=!0,N||(T=[X(f,"click",s[34]),X(u,"click",s[12]),X(w,"click",s[35])],N=!0)},p(j,U){U[0]&2048&&(r=j[11]==="arrangement"||typeof window<"u"&&window.location.pathname.match(/\/project\/[^/]+\/pattern\/([^/]+)/)),r?Q?Q.p(j,U):(Q=dn(j),Q.c(),Q.m(e,o)):Q&&(Q.d(1),Q=null),a&&H.p(cn(j),U),U[0]&24&&(p=typeof window<"u"&&window.location.pathname.match(/\/project\/[^/]+\/pattern\/([^/]+)/)&&j[3].isRoot&&j[4]&&j[3].selectedInstrumentId),p?F?F.p(j,U):(F=pn(j),F.c(),F.m(e,null)):F&&(F.d(1),F=null),(!G||U[0]&2048&&C!==(C="view-toggle "+(j[11]==="arrangement"?"active":"")+" svelte-1w9eo4a"))&&n(f,"class",C),re!==(re=Z(j))&&(K.d(1),K=re(j),K&&(K.c(),K.m(u,null))),(!G||U[0]&2&&_!==(_=j[1]?"Pause":"Play"))&&n(u,"title",_),(!G||U[0]&2048&&m!==(m="view-toggle "+(j[11]==="pattern"?"active":"")+" svelte-1w9eo4a"))&&n(w,"class",m),U[0]&2048&&(W=j[11]==="arrangement"||typeof window<"u"&&window.location.pathname.match(/\/project\/[^/]+\/pattern\/([^/]+)/)),W?ne?ne.p(j,U):(ne=hn(j),ne.c(),ne.m(L,V)):ne&&(ne.d(1),ne=null),j[11]==="arrangement"?oe?oe.p(j,U):(oe=mn(j),oe.c(),oe.m(L,null)):oe&&(oe.d(1),oe=null);const se={};U[0]&1024&&(se.isOpen=j[10]),O.$set(se)},i(j){G||(Oe(O.$$.fragment,j),G=!0)},o(j){qe(O.$$.fragment,j),G=!1},d(j){j&&(b(t),b(A)),Q&&Q.d(),H&&H.d(),F&&F.d(),K.d(),ne&&ne.d(),oe&&oe.d(),ot(O,j),N=!1,Ue(T)}}}function qn(s,t,e){let r,o,a,l,p,v,c,f,h,C;Lt(s,Qe,z=>e(23,f=z)),Lt(s,bn,z=>e(24,h=z)),Lt(s,ae,z=>e(25,C=z));let d=null,u=!1,_="stop",k=!1,w=!1,g=!1,m=!1;ae.subscribeHistory(z=>{e(6,k=z.canUndo),e(7,w=z.canRedo)}),En(()=>{(async()=>(e(0,d=new kn),await d.initialize(),await d.resume(),Nn.set(d),d.onPlaybackUpdate((P,D)=>{tn.updatePlayback(P,D)})))();const z=async()=>{var P;if(d){await new Promise(q=>setTimeout(q,10));let D;if(ae.subscribe(q=>D=q)(),D){const q=f,ge=_==="play"&&u;if(ge&&(_="play",e(1,u=!0)),q==="arrangement"&&D.timeline&&D.timeline.clips&&D.timeline.clips.length>0)await d.loadProject(D.standaloneInstruments||[],l,D.baseMeterTrackId,D.timeline,D.patterns,D.effects,D.envelopes,D.automation),ge&&(_="stop",e(1,u=!1),d.setTransport("stop",0),_="play",e(1,u=!0),d.setTransport("play",0));else{const he=window.location.pathname.match(/\/project\/[^/]+\/pattern\/([^/]+)/);if(he&&D.patterns){const ce=he[1],fe=D.patterns.find(B=>B.id===ce);if(fe){const{projectStore:B}=await st(async()=>{const{projectStore:te}=await import("./CpFYu2kg.js");return{projectStore:te}},__vite__mapDeps([0,1,2]),import.meta.url),be=B.getPatternInstruments(fe).map(te=>({id:`__pattern_${fe.id}_${te.id}`,projectId:fe.projectId,instrumentType:te.instrumentType||"kick",patternTree:te.patternTree,settings:te.settings||{},instrumentSettings:te.instrumentSettings||{},volume:te.volume??1,pan:te.pan??0,color:te.color,mute:te.mute??!1,solo:te.solo??!1}));await d.loadProject(be,l,(P=be[0])==null?void 0:P.id,void 0,D.patterns,D.effects,D.envelopes,D.automation),ge&&(_="play",e(1,u=!0),d.setTransport("play"))}else await d.loadProject(D.standaloneInstruments||[],l,D.baseMeterTrackId,void 0,D.patterns,D.effects,D.envelopes,D.automation),ge&&(_="play",e(1,u=!0),d.setTransport("play"))}else await d.loadProject(D.standaloneInstruments||[],l,D.baseMeterTrackId,void 0,D.patterns,D.effects,D.envelopes,D.automation),ge&&(_="play",e(1,u=!0),d.setTransport("play"))}}}};window.addEventListener("reloadProject",z);const E=P=>{if(P.key===" "&&!(P.target instanceof HTMLInputElement)&&!(P.target instanceof HTMLTextAreaElement)){P.preventDefault(),W();return}(P.ctrlKey||P.metaKey)&&P.key==="z"&&!P.shiftKey&&(P.preventDefault(),V()),(P.ctrlKey||P.metaKey)&&(P.key==="y"||P.key==="z"&&P.shiftKey)&&(P.preventDefault(),A())};return window.addEventListener("keydown",E),()=>{window.removeEventListener("reloadProject",z),window.removeEventListener("keydown",E)}}),wn(()=>{d==null||d.destroy()});let M=0,L=null;async function W(){var z;if(d&&(await d.resume(),e(1,u=!u),_=u?"play":"stop",d.setTransport(_),u||tn.clear(),u)){let E;if(ae.subscribe(P=>E=P)(),E)if(f==="arrangement"&&E.timeline&&E.timeline.clips&&E.timeline.clips.length>0)await d.loadProject(E.standaloneInstruments||[],l,E.baseMeterTrackId,E.timeline,E.patterns,E.effects,E.envelopes,E.automation),_="stop",e(1,u=!1),d.setTransport("stop",0),_="play",e(1,u=!0),d.setTransport("play",0);else{const q=window.location.pathname.match(/\/project\/[^/]+\/pattern\/([^/]+)/);if(q&&E.patterns){const ge=q[1],ee=E.patterns.find(he=>he.id===ge);if(ee){let he=[];ee.instruments&&Array.isArray(ee.instruments)&&ee.instruments.length>0?he=ee.instruments:ee.instrumentType&&ee.patternTree&&(he=[{id:ee.id,instrumentType:ee.instrumentType,patternTree:ee.patternTree,settings:ee.settings||{},instrumentSettings:ee.instrumentSettings,color:ee.color||"#7ab8ff",volume:ee.volume??1,pan:ee.pan??0,mute:ee.mute,solo:ee.solo}]);const ce=he.map((B,Y)=>({id:`__pattern_${ee.id}_${B.id}`,projectId:ee.projectId,instrumentType:B.instrumentType||"kick",patternTree:B.patternTree,settings:B.settings||{},instrumentSettings:B.instrumentSettings||{},volume:B.volume??1,pan:B.pan??0,color:B.color||"#7ab8ff",mute:(ee.mute??!1)||(B.mute??!1),solo:B.solo??!1})),fe=[...E.standaloneInstruments||[],...ce];await d.loadProject(fe,l,((z=ce[0])==null?void 0:z.id)||E.baseMeterTrackId,void 0,E.patterns,E.effects,E.envelopes,E.automation),_="play",e(1,u=!0),d.setTransport("play")}else await d.loadProject(E.standaloneInstruments||[],l,E.baseMeterTrackId,void 0,E.patterns,E.effects,E.envelopes,E.automation),_="play",e(1,u=!0),d.setTransport("play")}else await d.loadProject(E.standaloneInstruments||[],l,E.baseMeterTrackId,void 0,E.patterns,E.effects,E.envelopes),d.setTransport("play")}}}async function V(){if(!k)return;if(ae.undo()&&d&&u){let E;ae.subscribe(P=>E=P)(),E&&await d.loadProject(E.standaloneInstruments||[],l,E.baseMeterTrackId,E.timeline,E.patterns,E.effects,E.envelopes)}window.dispatchEvent(new CustomEvent("reloadProject"))}async function A(){if(!w)return;if(ae.redo()&&d&&u){let E;ae.subscribe(P=>E=P)(),E&&await d.loadProject(E.standaloneInstruments||[],l,E.baseMeterTrackId,E.timeline,E.patterns,E.effects,E.envelopes)}window.dispatchEvent(new CustomEvent("reloadProject"))}function O(){if(v&&o.selectedInstrumentId){const E=!((c==null?void 0:c.mute)??!1);if(ae.updatePatternInstrument(v.id,o.selectedInstrumentId,{mute:E}),d){const P=`__pattern_${v.id}_${o.selectedInstrumentId}`;d.updateTrackMute(P,E)}}else if(p){const E=!(p.mute??!1);ae.updateStandaloneInstrument(p.id,{mute:E}),d&&d.updateTrackMute(p.id,E)}}function G(){if(v&&o.selectedInstrumentId){const E=!((c==null?void 0:c.solo)??!1);if(E&&d){const P=ae.getPatternInstruments(v);for(const D of P)if(D.id!==o.selectedInstrumentId&&D.solo){ae.updatePatternInstrument(v.id,D.id,{solo:!1});const q=`__pattern_${v.id}_${D.id}`;d.updateTrackSolo(q,!1)}}if(ae.updatePatternInstrument(v.id,o.selectedInstrumentId,{solo:E}),d){const P=`__pattern_${v.id}_${o.selectedInstrumentId}`;d.updateTrackSolo(P,E)}}else if(p){const E=!(p.solo??!1);if(E&&r&&d)for(const P of r.standaloneInstruments||[])P.id!==p.id&&P.solo&&(ae.updateStandaloneInstrument(P.id,{solo:!1}),d.updateTrackSolo(P.id,!1));ae.updateStandaloneInstrument(p.id,{solo:E}),d&&d.updateTrackSolo(p.id,E)}}let N=!1;function T(){e(10,N=!0)}function Q(){e(10,N=!1)}function H(){l=rt(this.value),e(5,l),e(2,r),e(25,C)}const F=()=>{ae.update(z=>(z&&(z.bpm=l),z)),d&&d.setTempo(l)},Z=()=>{const z=Math.min(500,l+1);e(5,l=z),ae.update(E=>(E&&(E.bpm=z),E)),d&&d.setTempo(z)},re=()=>{const z=Math.max(20,l-1);e(5,l=z),ae.update(E=>(E&&(E.bpm=z),E)),d&&d.setTempo(z)},K=(z,E)=>E.id===z[1],ne=(z,E)=>{const P=parseInt(E.currentTarget.value)||4;z&&(ae.updatePattern(z.id,{baseMeter:P}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("reloadProject"))},50))},oe=z=>{const E=z.baseMeter||4,P=Math.min(32,E+1);z&&(ae.updatePattern(z.id,{baseMeter:P}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("reloadProject"))},50))},j=z=>{const E=z.baseMeter||4,P=Math.max(1,E-1);z&&(ae.updatePattern(z.id,{baseMeter:P}),setTimeout(()=>{window.dispatchEvent(new CustomEvent("reloadProject"))},50))},U=async()=>{const{loadingStore:z}=await st(async()=>{const{loadingStore:D}=await import("./Ue2r4fdp.js");return{loadingStore:D}},__vite__mapDeps([3,1,2]),import.meta.url);z.startLoading("Switching to arrangement view...");const P=(typeof window<"u"?window.location.pathname:"").match(/\/project\/([^/]+)\/pattern\/([^/]+)/);if(P){const D=P[1],q=P[2];Qe.setCurrentPatternId(q),await en(`/project/${D}`),Qe.setArrangement()}else Qe.setArrangement();setTimeout(()=>{z.stopLoading()},200)},se=async()=>{const{loadingStore:z}=await st(async()=>{const{loadingStore:D}=await import("./Ue2r4fdp.js");return{loadingStore:D}},__vite__mapDeps([3,1,2]),import.meta.url);z.startLoading("Switching to pattern view...");const E=typeof window<"u"?window.location.pathname:"",P=E.match(/\/project\/([^/]+)/);if(P){const D=P[1];E.match(/\/project\/([^/]+)\/pattern\/([^/]+)/)&&await en(`/project/${D}`),Qe.setPattern()}else Qe.setPattern(),window.dispatchEvent(new CustomEvent("switchToPatternView"));setTimeout(()=>{z.stopLoading()},200)};return s.$$.update=()=>{var z,E;if(s.$$.dirty[0]&33554432&&e(2,r=C),s.$$.dirty[0]&16777216&&e(3,o=h),s.$$.dirty[0]&8388608&&e(11,a=f),s.$$.dirty[0]&4&&e(5,l=(r==null?void 0:r.bpm)??120),s.$$.dirty[0]&12&&e(21,p=(z=r==null?void 0:r.standaloneInstruments)==null?void 0:z.find(P=>P.id===o.selectedTrackId)),s.$$.dirty[0]&12&&e(4,v=o.selectedPatternId?(E=r==null?void 0:r.patterns)==null?void 0:E.find(P=>P.id===o.selectedPatternId):null),s.$$.dirty[0]&28&&e(22,c=!r||!v||!o.selectedInstrumentId?null:(v.updatedAt,v.instruments,ae.getPatternInstruments(v).find(P=>P.id===o.selectedInstrumentId))),s.$$.dirty[0]&6291476){const P=v,D=c,q=p;q?(e(8,g=q.mute??!1),e(9,m=q.solo??!1)):P&&D?(e(8,g=D.mute??!1),e(9,m=D.solo??!1)):P?(e(8,g=P.mute??!1),e(9,m=P.solo??!1)):(e(8,g=!1),e(9,m=!1))}s.$$.dirty[0]&524293&&d&&r!=null&&r.bpm&&r.bpm!==M&&(e(19,M=r.bpm),d.setTempo(r.bpm)),s.$$.dirty[0]&9437219&&d&&f&&L!==f&&(async()=>{var D,q;e(20,L=f),await new Promise(ge=>setTimeout(ge,100));let P;if(ae.subscribe(ge=>P=ge)(),P)if(f==="arrangement"&&P.timeline&&P.timeline.clips&&P.timeline.clips.length>0){const ee=new Set(P.timeline.clips.map(he=>he.patternId));for(const he of ee){const ce=(D=P.patterns)==null?void 0:D.find(fe=>fe.id===he);if(ce){const fe=`__pattern_${he}`;if(!((q=P.standaloneInstruments)==null?void 0:q.find(Y=>Y.id===fe))){const{projectStore:Y}=await st(async()=>{const{projectStore:te}=await import("./CpFYu2kg.js");return{projectStore:te}},__vite__mapDeps([0,1,2]),import.meta.url),be={id:fe,projectId:ce.projectId,instrumentType:ce.instrumentType||"kick",patternTree:ce.patternTree,settings:ce.settings||{},instrumentSettings:ce.instrumentSettings||{},volume:ce.volume??1,pan:ce.pan??0,color:ce.color||"#00ffff",mute:ce.mute??!1,solo:ce.solo??!1};Y.addStandaloneInstrument(be),Y.subscribe(te=>P=te)()}}}ae.subscribe(he=>P=he)(),await d.loadProject(P.standaloneInstruments||[],l,P.baseMeterTrackId,P.timeline,P.patterns,P.effects,P.envelopes,P.automation),u&&(_="stop",d.setTransport("stop",0),_="play",d.setTransport("play",0))}else await d.loadProject(P.standaloneInstruments||[],l,P.baseMeterTrackId,void 0,P.patterns,P.effects,P.envelopes,P.automation),u&&(_="play",d.setTransport("play"))})()},[d,u,r,o,v,l,k,w,g,m,N,a,W,V,A,O,G,T,Q,M,L,p,c,f,h,C,H,F,Z,re,K,ne,oe,j,U,se]}class Ls extends He{constructor(t){super(),We(this,t,qn,Zn,Fe,{},null,[-1,-1])}}function Kn(){const{subscribe:s,set:t,update:e}=Ke({x:0,y:0,zoom:1});return{subscribe:s,set:t,update:e,pan:(r,o)=>{e(a=>({...a,x:a.x+r,y:a.y+o}))},zoom:(r,o,a)=>{e(l=>{const p=l.zoom,v=Math.max(.1,Math.min(5,l.zoom+r));if(o!==void 0&&a!==void 0){const c=o/p+l.x,f=a/p+l.y;return{x:c-o/v,y:f-a/v,zoom:v}}return{...l,zoom:v}})},reset:()=>{t({x:0,y:0,zoom:1})}}}const zs=Kn();function Yn(s){let t,e,r,o,a,l,p,v,c,f,h,C,d;return{c(){t=I("div"),e=I("input"),r=x(),o=I("div"),a=I("button"),l=ue("svg"),p=ue("path"),v=x(),c=I("button"),f=ue("svg"),h=ue("path"),this.h()},l(u){t=y(u,"DIV",{class:!0});var _=S(t);e=y(_,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0,placeholder:!0,title:!0,class:!0}),r=R(_),o=y(_,"DIV",{class:!0});var k=S(o);a=y(k,"BUTTON",{type:!0,class:!0,title:!0});var w=S(a);l=ie(w,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0});var g=S(l);p=ie(g,"path",{d:!0,fill:!0}),S(p).forEach(b),g.forEach(b),w.forEach(b),v=R(k),c=y(k,"BUTTON",{type:!0,class:!0,title:!0});var m=S(c);f=ie(m,"svg",{width:!0,height:!0,viewBox:!0,fill:!0,xmlns:!0});var M=S(f);h=ie(M,"path",{d:!0,fill:!0}),S(h).forEach(b),M.forEach(b),m.forEach(b),k.forEach(b),_.forEach(b),this.h()},h(){n(e,"id",s[0]),n(e,"type","number"),n(e,"min",s[2]),n(e,"max",s[3]),n(e,"step",s[4]),n(e,"placeholder",s[5]),n(e,"title",s[6]),e.disabled=s[7],e.value=s[1],n(e,"class","numeric-input"),n(p,"d","M5 2L8 6H2L5 2Z"),n(p,"fill","currentColor"),n(l,"width","10"),n(l,"height","10"),n(l,"viewBox","0 0 10 10"),n(l,"fill","none"),n(l,"xmlns","http://www.w3.org/2000/svg"),n(a,"type","button"),n(a,"class","numeric-arrow-button arrow-up"),n(a,"title","Increase value"),a.disabled=s[7],n(h,"d","M5 8L2 4H8L5 8Z"),n(h,"fill","currentColor"),n(f,"width","10"),n(f,"height","10"),n(f,"viewBox","0 0 10 10"),n(f,"fill","none"),n(f,"xmlns","http://www.w3.org/2000/svg"),n(c,"type","button"),n(c,"class","numeric-arrow-button arrow-down"),n(c,"title","Decrease value"),c.disabled=s[7],n(o,"class","numeric-input-arrows"),n(t,"class","numeric-input-wrapper")},m(u,_){pe(u,t,_),i(t,e),i(t,r),i(t,o),i(o,a),i(a,l),i(l,p),i(o,v),i(o,c),i(c,f),i(f,h),C||(d=[X(e,"input",s[8]),X(a,"click",s[11]),X(c,"click",s[12])],C=!0)},p(u,[_]){_&1&&n(e,"id",u[0]),_&4&&n(e,"min",u[2]),_&8&&n(e,"max",u[3]),_&16&&n(e,"step",u[4]),_&32&&n(e,"placeholder",u[5]),_&64&&n(e,"title",u[6]),_&128&&(e.disabled=u[7]),_&2&&e.value!==u[1]&&(e.value=u[1]),_&128&&(a.disabled=u[7]),_&128&&(c.disabled=u[7])},i:we,o:we,d(u){u&&b(t),C=!1,Ue(d)}}}function Qn(s,t,e){let{id:r}=t,{value:o=0}=t,{min:a=void 0}=t,{max:l=void 0}=t,{step:p=void 0}=t,{placeholder:v=void 0}=t,{title:c=void 0}=t,{disabled:f=!1}=t,{onInput:h=void 0}=t;const C=()=>typeof p=="number"&&!isNaN(p)&&p!==0?p:1,d=g=>{let m=g;return typeof a=="number"&&(m=Math.max(a,m)),typeof l=="number"&&(m=Math.min(l,m)),m},u=g=>{const m=g.target,M=Number((m==null?void 0:m.value)??o);!isNaN(M)&&typeof h=="function"&&h(M)},_=g=>{if(f)return;const m=C()*g,M=d(Number((o+m).toFixed(6)));h==null||h(M)},k=()=>_(1),w=()=>_(-1);return s.$$set=g=>{"id"in g&&e(0,r=g.id),"value"in g&&e(1,o=g.value),"min"in g&&e(2,a=g.min),"max"in g&&e(3,l=g.max),"step"in g&&e(4,p=g.step),"placeholder"in g&&e(5,v=g.placeholder),"title"in g&&e(6,c=g.title),"disabled"in g&&e(7,f=g.disabled),"onInput"in g&&e(10,h=g.onInput)},[r,o,a,l,p,v,c,f,u,_,h,k,w]}class Xn extends He{constructor(t){super(),We(this,t,Qn,Yn,Fe,{id:0,value:1,min:2,max:3,step:4,placeholder:5,title:6,disabled:7,onInput:10})}}function Jn(){const{subscribe:s,set:t,update:e}=Ke([]);return{subscribe:s,openWindow:r=>{console.log("synthPluginStore.openWindow called with:",r),e(o=>{const a=o.findIndex(p=>p.id===r.id);if(a>=0){const p=[...o];return p[a]=r,console.log("Replaced existing window, new windows:",p),p}const l=[...o,r];return console.log("Added new window, total windows:",l.length,l),l})},closeWindow:r=>{e(o=>o.filter(a=>a.id!==r))},closeAll:()=>{t([])}}}const Vs=Jn();function $n(s,t){if(s.id===t)return s;for(const e of s.children){const r=$n(e,t);if(r)return r}return null}function es(s){const t=s.target;return(t==null?void 0:t.value)||""}function Ds(s){const t=s.target;return(t==null?void 0:t.value)||""}function ts(){const{subscribe:s,set:t,update:e}=Ke([]);return{subscribe:s,openWindow:r=>{e(o=>[r])},closeWindow:r=>{e(o=>o.filter(a=>a.id!==r))},closeAll:()=>{t([])}}}const ns=ts();function vn(s){let t,e='<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="2" cy="10" r="1.5" stroke="currentColor" stroke-width="1.5" fill="none"></circle><circle cx="10" cy="2" r="1.5" stroke="currentColor" stroke-width="1.5" fill="none"></circle><line x1="3.5" y1="10" x2="8.5" y2="2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"></line></svg>',r,o;return{c(){t=I("button"),t.innerHTML=e,this.h()},l(a){t=y(a,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),le(t)!=="svelte-2ufg47"&&(t.innerHTML=e),this.h()},h(){n(t,"class","automation-btn"),n(t,"title","Open automation editor")},m(a,l){pe(a,t,l),r||(o=X(t,"click",s[14]),r=!0)},p:we,d(a){a&&b(t),r=!1,o()}}}function gn(s){let t,e="Reset",r,o;return{c(){t=I("button"),t.textContent=e,this.h()},l(a){t=y(a,"BUTTON",{class:!0,"data-svelte-h":!0}),le(t)!=="svelte-1x3h04k"&&(t.textContent=e),this.h()},h(){n(t,"class","reset-btn")},m(a,l){pe(a,t,l),r||(o=X(t,"click",function(){Sn(s[6])&&s[6].apply(this,arguments)}),r=!0)},p(a,l){s=a},d(a){a&&b(t),r=!1,o()}}}function ss(s){let t,e,r,o,a,l,p,v,c,f,h,C,d,u,_,k,w=s[7]&&s[8]&&s[9]&&vn(s),g=s[6]&&s[5]!==void 0&&gn(s);return d=new Xn({props:{id:`${s[0]}-number`,min:s[11],max:s[3],step:s[4],value:Math.max(s[11],s[2]),onInput:s[12]}}),{c(){t=I("div"),e=I("div"),r=I("label"),o=ve(s[1]),a=x(),l=I("div"),w&&w.c(),p=x(),g&&g.c(),v=x(),c=I("div"),f=I("input"),C=x(),it(d.$$.fragment),this.h()},l(m){t=y(m,"DIV",{class:!0});var M=S(t);e=y(M,"DIV",{class:!0});var L=S(e);r=y(L,"LABEL",{for:!0});var W=S(r);o=me(W,s[1]),W.forEach(b),a=R(L),l=y(L,"DIV",{class:!0});var V=S(l);w&&w.l(V),p=R(V),g&&g.l(V),V.forEach(b),L.forEach(b),v=R(M),c=y(M,"DIV",{class:!0});var A=S(c);f=y(A,"INPUT",{id:!0,type:!0,min:!0,max:!0,step:!0}),C=R(A),at(d.$$.fragment,A),A.forEach(b),M.forEach(b),this.h()},h(){n(r,"for",s[0]),n(l,"class","param-header-actions"),n(e,"class","param-header"),n(f,"id",s[0]),n(f,"type","range"),n(f,"min",s[11]),n(f,"max",s[3]),n(f,"step",s[4]),f.value=h=Math.max(s[11],s[2]),n(c,"class","param-controls"),n(t,"class","param")},m(m,M){pe(m,t,M),i(t,e),i(e,r),i(r,o),i(e,a),i(e,l),w&&w.m(l,null),i(l,p),g&&g.m(l,null),i(t,v),i(t,c),i(c,f),s[20](f),i(c,C),lt(d,c,null),u=!0,_||(k=[X(f,"mousedown",s[13]),X(f,"input",s[21])],_=!0)},p(m,[M]){(!u||M&2)&&De(o,m[1]),(!u||M&1)&&n(r,"for",m[0]),m[7]&&m[8]&&m[9]?w?w.p(m,M):(w=vn(m),w.c(),w.m(l,p)):w&&(w.d(1),w=null),m[6]&&m[5]!==void 0?g?g.p(m,M):(g=gn(m),g.c(),g.m(l,null)):g&&(g.d(1),g=null),(!u||M&1)&&n(f,"id",m[0]),(!u||M&8)&&n(f,"max",m[3]),(!u||M&16)&&n(f,"step",m[4]),(!u||M&4&&h!==(h=Math.max(m[11],m[2])))&&(f.value=h);const L={};M&1&&(L.id=`${m[0]}-number`),M&8&&(L.max=m[3]),M&16&&(L.step=m[4]),M&4&&(L.value=Math.max(m[11],m[2])),d.$set(L)},i(m){u||(Oe(d.$$.fragment,m),u=!0)},o(m){qe(d.$$.fragment,m),u=!1},d(m){m&&b(t),w&&w.d(),g&&g.d(),s[20](null),ot(d),_=!1,Ue(k)}}}const rs=.01;function os(s,t,e){const r=`param-${Math.random().toString(36).slice(2)}`;let{id:o=r}=t,{label:a}=t,{value:l}=t,{min:p}=t,{max:v}=t,{step:c}=t,{onUpdate:f=void 0}=t,{onChange:h=void 0}=t,{resetValue:C=void 0}=t,{onReset:d=void 0}=t,{automationTargetType:u=null}=t,{automationTargetId:_=null}=t,{automationParameterKey:k=null}=t,{automationTimelineInstanceId:w=null}=t,{automationLabel:g=null}=t,m=!1,M,L=null;const W=p===0?rs:p,V=T=>{const Q=Math.max(W,T);typeof f=="function"&&f(Q),typeof h=="function"&&h(Q)},A=()=>{m||(m=!0,ae.startBatch(),L=()=>{m&&(m=!1,ae.endBatch(),L&&(window.removeEventListener("mouseup",L),L=null))},window.addEventListener("mouseup",L))};wn(()=>{L&&(window.removeEventListener("mouseup",L),L=null),m&&(m=!1,ae.endBatch())});function O(){if(!u||!_||!k)return;const T=`${u}:${_}:${k}:${w||"global"}`,Q=g||`${u} - ${a}`;ns.openWindow({id:T,targetType:u,targetId:_,parameterKey:k,timelineInstanceId:w||void 0,label:Q})}function G(T){Cn[T?"unshift":"push"](()=>{M=T,e(10,M)})}const N=T=>V(Number(es(T)));return s.$$set=T=>{"id"in T&&e(0,o=T.id),"label"in T&&e(1,a=T.label),"value"in T&&e(2,l=T.value),"min"in T&&e(15,p=T.min),"max"in T&&e(3,v=T.max),"step"in T&&e(4,c=T.step),"onUpdate"in T&&e(16,f=T.onUpdate),"onChange"in T&&e(17,h=T.onChange),"resetValue"in T&&e(5,C=T.resetValue),"onReset"in T&&e(6,d=T.onReset),"automationTargetType"in T&&e(7,u=T.automationTargetType),"automationTargetId"in T&&e(8,_=T.automationTargetId),"automationParameterKey"in T&&e(9,k=T.automationParameterKey),"automationTimelineInstanceId"in T&&e(18,w=T.automationTimelineInstanceId),"automationLabel"in T&&e(19,g=T.automationLabel)},[o,a,l,v,c,C,d,u,_,k,M,W,V,A,O,p,f,h,w,g,G,N]}class Ns extends He{constructor(t){super(),We(this,t,os,ss,Fe,{id:0,label:1,value:2,min:15,max:3,step:4,onUpdate:16,onChange:17,resetValue:5,onReset:6,automationTargetType:7,automationTargetId:8,automationParameterKey:9,automationTimelineInstanceId:18,automationLabel:19})}}function ls(){const{subscribe:s,set:t,update:e}=Ke("pitch");return{subscribe:s,set:t,update:e,setMode:r=>t(r),toggle:()=>e(r=>r==="pitch"?"velocity":"pitch")}}const js=ls();function as(s){let t,e='<div class="skeleton-grid svelte-i3nqz9"></div> <div class="skeleton-nodes svelte-i3nqz9"><div class="skeleton-node skeleton-node-large svelte-i3nqz9"></div> <div class="skeleton-node svelte-i3nqz9"></div> <div class="skeleton-node svelte-i3nqz9"></div> <div class="skeleton-node svelte-i3nqz9"></div> <div class="skeleton-node svelte-i3nqz9"></div></div>';return{c(){t=I("div"),t.innerHTML=e,this.h()},l(r){t=y(r,"DIV",{class:!0,"data-svelte-h":!0}),le(t)!=="svelte-1yv41qp"&&(t.innerHTML=e),this.h()},h(){n(t,"class","canvas-skeleton svelte-i3nqz9")},m(r,o){pe(r,t,o)},p:we,i:we,o:we,d(r){r&&b(t)}}}class is extends He{constructor(t){super(),We(this,t,null,as,Fe,{})}}function us(s){let t,e='<div class="skeleton-section svelte-lbrrhm"><div class="skeleton-title svelte-lbrrhm"></div> <div class="skeleton-controls svelte-lbrrhm"><div class="skeleton-control svelte-lbrrhm"></div> <div class="skeleton-control svelte-lbrrhm"></div> <div class="skeleton-control svelte-lbrrhm"></div></div></div> <div class="skeleton-section svelte-lbrrhm"><div class="skeleton-title svelte-lbrrhm"></div> <div class="skeleton-list svelte-lbrrhm"><div class="skeleton-item svelte-lbrrhm"></div> <div class="skeleton-item svelte-lbrrhm"></div> <div class="skeleton-item svelte-lbrrhm"></div></div></div>';return{c(){t=I("div"),t.innerHTML=e,this.h()},l(r){t=y(r,"DIV",{class:!0,"data-svelte-h":!0}),le(t)!=="svelte-1bnhzgd"&&(t.innerHTML=e),this.h()},h(){n(t,"class","sidebar-skeleton svelte-lbrrhm")},m(r,o){pe(r,t,o)},p:we,i:we,o:we,d(r){r&&b(t)}}}class cs extends He{constructor(t){super(),We(this,t,null,us,Fe,{})}}function ds(s){let t,e='<div class="skeleton-ruler svelte-1b2yrl7"><div class="skeleton-ruler-mark svelte-1b2yrl7"></div> <div class="skeleton-ruler-mark svelte-1b2yrl7"></div> <div class="skeleton-ruler-mark svelte-1b2yrl7"></div> <div class="skeleton-ruler-mark svelte-1b2yrl7"></div> <div class="skeleton-ruler-mark svelte-1b2yrl7"></div></div> <div class="skeleton-tracks svelte-1b2yrl7"><div class="skeleton-track svelte-1b2yrl7"><div class="skeleton-track-header svelte-1b2yrl7"></div> <div class="skeleton-track-content svelte-1b2yrl7"><div class="skeleton-clip svelte-1b2yrl7"></div> <div class="skeleton-clip svelte-1b2yrl7"></div></div></div> <div class="skeleton-track svelte-1b2yrl7"><div class="skeleton-track-header svelte-1b2yrl7"></div> <div class="skeleton-track-content svelte-1b2yrl7"><div class="skeleton-clip svelte-1b2yrl7"></div></div></div> <div class="skeleton-track svelte-1b2yrl7"><div class="skeleton-track-header svelte-1b2yrl7"></div> <div class="skeleton-track-content svelte-1b2yrl7"></div></div></div>';return{c(){t=I("div"),t.innerHTML=e,this.h()},l(r){t=y(r,"DIV",{class:!0,"data-svelte-h":!0}),le(t)!=="svelte-1tsso8v"&&(t.innerHTML=e),this.h()},h(){n(t,"class","timeline-skeleton svelte-1b2yrl7")},m(r,o){pe(r,t,o)},p:we,i:we,o:we,d(r){r&&b(t)}}}class fs extends He{constructor(t){super(),We(this,t,null,ds,Fe,{})}}function ps(s){let t,e='<div class="skeleton-header svelte-r8pez8"><div class="skeleton-title svelte-r8pez8"></div> <div class="skeleton-button svelte-r8pez8"></div></div> <div class="skeleton-grid svelte-r8pez8"><div class="skeleton-card svelte-r8pez8"></div> <div class="skeleton-card svelte-r8pez8"></div> <div class="skeleton-card svelte-r8pez8"></div> <div class="skeleton-card svelte-r8pez8"></div></div>';return{c(){t=I("div"),t.innerHTML=e,this.h()},l(r){t=y(r,"DIV",{class:!0,"data-svelte-h":!0}),le(t)!=="svelte-7duwsv"&&(t.innerHTML=e),this.h()},h(){n(t,"class","pattern-list-skeleton svelte-r8pez8")},m(r,o){pe(r,t,o)},p:we,i:we,o:we,d(r){r&&b(t)}}}class hs extends He{constructor(t){super(),We(this,t,null,ps,Fe,{})}}function ms(s){let t,e;return t=new hs({}),{c(){it(t.$$.fragment)},l(r){at(t.$$.fragment,r)},m(r,o){lt(t,r,o),e=!0},i(r){e||(Oe(t.$$.fragment,r),e=!0)},o(r){qe(t.$$.fragment,r),e=!1},d(r){ot(t,r)}}}function vs(s){let t,e;return t=new is({}),{c(){it(t.$$.fragment)},l(r){at(t.$$.fragment,r)},m(r,o){lt(t,r,o),e=!0},i(r){e||(Oe(t.$$.fragment,r),e=!0)},o(r){qe(t.$$.fragment,r),e=!1},d(r){ot(t,r)}}}function gs(s){let t,e;return t=new fs({}),{c(){it(t.$$.fragment)},l(r){at(t.$$.fragment,r)},m(r,o){lt(t,r,o),e=!0},i(r){e||(Oe(t.$$.fragment,r),e=!0)},o(r){qe(t.$$.fragment,r),e=!1},d(r){ot(t,r)}}}function ws(s){let t,e,r='<div class="skeleton-toolbar-button svelte-1n03c9x"></div> <div class="skeleton-toolbar-button svelte-1n03c9x"></div> <div class="skeleton-toolbar-button skeleton-toolbar-button-large svelte-1n03c9x"></div> <div class="skeleton-toolbar-button svelte-1n03c9x"></div> <div class="skeleton-toolbar-button svelte-1n03c9x"></div>',o,a,l,p,v,c,f,h,C;p=new cs({});const d=[gs,vs,ms],u=[];function _(k,w){return k[1]==="arrangement"?0:k[0]?1:2}return f=_(s),h=u[f]=d[f](s),{c(){t=I("div"),e=I("div"),e.innerHTML=r,o=x(),a=I("div"),l=I("div"),it(p.$$.fragment),v=x(),c=I("div"),h.c(),this.h()},l(k){t=y(k,"DIV",{class:!0});var w=S(t);e=y(w,"DIV",{class:!0,"data-svelte-h":!0}),le(e)!=="svelte-mabtkb"&&(e.innerHTML=r),o=R(w),a=y(w,"DIV",{class:!0});var g=S(a);l=y(g,"DIV",{class:!0});var m=S(l);at(p.$$.fragment,m),m.forEach(b),v=R(g),c=y(g,"DIV",{class:!0});var M=S(c);h.l(M),M.forEach(b),g.forEach(b),w.forEach(b),this.h()},h(){n(e,"class","skeleton-toolbar svelte-1n03c9x"),n(l,"class","skeleton-sidebar svelte-1n03c9x"),n(c,"class","skeleton-content svelte-1n03c9x"),n(a,"class","skeleton-main svelte-1n03c9x"),n(t,"class","project-skeleton svelte-1n03c9x")},m(k,w){pe(k,t,w),i(t,e),i(t,o),i(t,a),i(a,l),lt(p,l,null),i(a,v),i(a,c),u[f].m(c,null),C=!0},p(k,[w]){let g=f;f=_(k),f!==g&&(Pn(),qe(u[g],1,1,()=>{u[g]=null}),Bn(),h=u[f],h||(h=u[f]=d[f](k),h.c()),Oe(h,1),h.m(c,null))},i(k){C||(Oe(p.$$.fragment,k),Oe(h),C=!0)},o(k){qe(p.$$.fragment,k),qe(h),C=!1},d(k){k&&b(t),ot(p),u[f].d()}}}function bs(s,t,e){let r,o;Lt(s,Qe,p=>e(3,o=p));let{viewMode:a=null}=t,{isPatternEditor:l=!1}=t;return s.$$set=p=>{"viewMode"in p&&e(2,a=p.viewMode),"isPatternEditor"in p&&e(0,l=p.isPatternEditor)},s.$$.update=()=>{s.$$.dirty&12&&e(1,r=a??o)},[l,r,a,o]}class Us extends He{constructor(t){super(),We(this,t,bs,ws,Fe,{viewMode:2,isPatternEditor:0})}}export{Xn as N,Ns as P,Ls as T,Nn as a,ns as b,Us as c,zs as d,Ss as e,Bt as f,Ds as g,Vs as h,js as i,es as j,$n as k,Cs as l,Bs as m,tn as p,bn as s,Ps as u,Qe as v};
